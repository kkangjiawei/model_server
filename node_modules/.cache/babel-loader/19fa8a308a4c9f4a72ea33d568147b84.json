{"remainingRequest":"/Users/a1/Desktop/code/golang/src/vue-element-admin/node_modules/babel-loader/lib/index.js!/Users/a1/Desktop/code/golang/src/vue-element-admin/src/utils/jquery.js","dependencies":[{"path":"/Users/a1/Desktop/code/golang/src/vue-element-admin/src/utils/jquery.js","mtime":1677395941797},{"path":"/Users/a1/Desktop/code/golang/src/vue-element-admin/babel.config.js","mtime":1677293736750},{"path":"/Users/a1/Desktop/code/golang/src/vue-element-admin/node_modules/cache-loader/dist/cjs.js","mtime":1677293886981},{"path":"/Users/a1/Desktop/code/golang/src/vue-element-admin/node_modules/babel-loader/lib/index.js","mtime":1677293894163}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF90eXBlb2YgPSByZXF1aXJlKCIvVXNlcnMvYTEvRGVza3RvcC9jb2RlL2dvbGFuZy9zcmMvdnVlLWVsZW1lbnQtYWRtaW4vbm9kZV9tb2R1bGVzL0B2dWUvY2xpLXBsdWdpbi1iYWJlbC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YuanMiKS5kZWZhdWx0OwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1wcm90b3R5cGUtb2YuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mbGF0LmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS51bnNjb3BhYmxlcy5mbGF0LmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuaXRlcmF0b3IuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuc3RpY2t5LmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudGVzdC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2guanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIik7Ci8qIQogKiBqUXVlcnkgSmF2YVNjcmlwdCBMaWJyYXJ5IHYzLjUuMQogKiBodHRwczovL2pxdWVyeS5jb20vCiAqCiAqIEluY2x1ZGVzIFNpenpsZS5qcwogKiBodHRwczovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IEpTIEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cHM6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogRGF0ZTogMjAyMC0wNS0wNFQyMjo0OVoKICovCihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CiAgInVzZSBzdHJpY3QiOwoKICBpZiAoKHR5cGVvZiBtb2R1bGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG1vZHVsZSkpID09PSAib2JqZWN0IiAmJiBfdHlwZW9mKG1vZHVsZS5leHBvcnRzKSA9PT0gIm9iamVjdCIpIHsKICAgIC8vIEZvciBDb21tb25KUyBhbmQgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgd2hlcmUgYSBwcm9wZXIgYHdpbmRvd2AKICAgIC8vIGlzIHByZXNlbnQsIGV4ZWN1dGUgdGhlIGZhY3RvcnkgYW5kIGdldCBqUXVlcnkuCiAgICAvLyBGb3IgZW52aXJvbm1lbnRzIHRoYXQgZG8gbm90IGhhdmUgYSBgd2luZG93YCB3aXRoIGEgYGRvY3VtZW50YAogICAgLy8gKHN1Y2ggYXMgTm9kZS5qcyksIGV4cG9zZSBhIGZhY3RvcnkgYXMgbW9kdWxlLmV4cG9ydHMuCiAgICAvLyBUaGlzIGFjY2VudHVhdGVzIHRoZSBuZWVkIGZvciB0aGUgY3JlYXRpb24gb2YgYSByZWFsIGB3aW5kb3dgLgogICAgLy8gZS5nLiB2YXIgalF1ZXJ5ID0gcmVxdWlyZSgianF1ZXJ5Iikod2luZG93KTsKICAgIC8vIFNlZSB0aWNrZXQgIzE0NTQ5IGZvciBtb3JlIGluZm8uCiAgICBtb2R1bGUuZXhwb3J0cyA9IGdsb2JhbC5kb2N1bWVudCA/IGZhY3RvcnkoZ2xvYmFsLCB0cnVlKSA6IGZ1bmN0aW9uICh3KSB7CiAgICAgIGlmICghdy5kb2N1bWVudCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIpOwogICAgICB9CiAgICAgIHJldHVybiBmYWN0b3J5KHcpOwogICAgfTsKICB9IGVsc2UgewogICAgZmFjdG9yeShnbG9iYWwpOwogIH0KCiAgLy8gUGFzcyB0aGlzIGlmIHdpbmRvdyBpcyBub3QgZGVmaW5lZCB5ZXQKfSkodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB0aGlzLCBmdW5jdGlvbiAod2luZG93LCBub0dsb2JhbCkgewogIC8vIEVkZ2UgPD0gMTIgLSAxMyssIEZpcmVmb3ggPD0xOCAtIDQ1KywgSUUgMTAgLSAxMSwgU2FmYXJpIDUuMSAtIDkrLCBpT1MgNiAtIDkuMQogIC8vIHRocm93IGV4Y2VwdGlvbnMgd2hlbiBub24tc3RyaWN0IGNvZGUgKGUuZy4sIEFTUC5ORVQgNC41KSBhY2Nlc3NlcyBzdHJpY3QgbW9kZQogIC8vIGFyZ3VtZW50cy5jYWxsZWUuY2FsbGVyICh0cmFjLTEzMzM1KS4gQnV0IGFzIG9mIGpRdWVyeSAzLjAgKDIwMTYpLCBzdHJpY3QgbW9kZSBzaG91bGQgYmUgY29tbW9uCiAgLy8gZW5vdWdoIHRoYXQgYWxsIHN1Y2ggYXR0ZW1wdHMgYXJlIGd1YXJkZWQgaW4gYSB0cnkgYmxvY2suCiAgInVzZSBzdHJpY3QiOwoKICB2YXIgYXJyID0gW107CiAgdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwogIHZhciBfc2xpY2UgPSBhcnIuc2xpY2U7CiAgdmFyIGZsYXQgPSBhcnIuZmxhdCA/IGZ1bmN0aW9uIChhcnJheSkgewogICAgcmV0dXJuIGFyci5mbGF0LmNhbGwoYXJyYXkpOwogIH0gOiBmdW5jdGlvbiAoYXJyYXkpIHsKICAgIHJldHVybiBhcnIuY29uY2F0LmFwcGx5KFtdLCBhcnJheSk7CiAgfTsKICB2YXIgcHVzaCA9IGFyci5wdXNoOwogIHZhciBpbmRleE9mID0gYXJyLmluZGV4T2Y7CiAgdmFyIGNsYXNzMnR5cGUgPSB7fTsKICB2YXIgdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nOwogIHZhciBoYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5OwogIHZhciBmblRvU3RyaW5nID0gaGFzT3duLnRvU3RyaW5nOwogIHZhciBPYmplY3RGdW5jdGlvblN0cmluZyA9IGZuVG9TdHJpbmcuY2FsbChPYmplY3QpOwogIHZhciBzdXBwb3J0ID0ge307CiAgdmFyIGlzRnVuY3Rpb24gPSBmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iaikgewogICAgLy8gU3VwcG9ydDogQ2hyb21lIDw9NTcsIEZpcmVmb3ggPD01MgogICAgLy8gSW4gc29tZSBicm93c2VycywgdHlwZW9mIHJldHVybnMgImZ1bmN0aW9uIiBmb3IgSFRNTCA8b2JqZWN0PiBlbGVtZW50cwogICAgLy8gKGkuZS4sIGB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggIm9iamVjdCIgKSA9PT0gImZ1bmN0aW9uImApLgogICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBjbGFzc2lmeSAqYW55KiBET00gbm9kZSBhcyBhIGZ1bmN0aW9uLgogICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIG9iai5ub2RlVHlwZSAhPT0gIm51bWJlciI7CiAgfTsKICB2YXIgaXNXaW5kb3cgPSBmdW5jdGlvbiBpc1dpbmRvdyhvYmopIHsKICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT09IG9iai53aW5kb3c7CiAgfTsKICB2YXIgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7CiAgdmFyIHByZXNlcnZlZFNjcmlwdEF0dHJpYnV0ZXMgPSB7CiAgICB0eXBlOiB0cnVlLAogICAgc3JjOiB0cnVlLAogICAgbm9uY2U6IHRydWUsCiAgICBub01vZHVsZTogdHJ1ZQogIH07CiAgZnVuY3Rpb24gRE9NRXZhbChjb2RlLCBub2RlLCBkb2MpIHsKICAgIGRvYyA9IGRvYyB8fCBkb2N1bWVudDsKICAgIHZhciBpLAogICAgICB2YWwsCiAgICAgIHNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgIHNjcmlwdC50ZXh0ID0gY29kZTsKICAgIGlmIChub2RlKSB7CiAgICAgIGZvciAoaSBpbiBwcmVzZXJ2ZWRTY3JpcHRBdHRyaWJ1dGVzKSB7CiAgICAgICAgLy8gU3VwcG9ydDogRmlyZWZveCA2NCssIEVkZ2UgMTgrCiAgICAgICAgLy8gU29tZSBicm93c2VycyBkb24ndCBzdXBwb3J0IHRoZSAibm9uY2UiIHByb3BlcnR5IG9uIHNjcmlwdHMuCiAgICAgICAgLy8gT24gdGhlIG90aGVyIGhhbmQsIGp1c3QgdXNpbmcgYGdldEF0dHJpYnV0ZWAgaXMgbm90IGVub3VnaCBhcwogICAgICAgIC8vIHRoZSBgbm9uY2VgIGF0dHJpYnV0ZSBpcyByZXNldCB0byBhbiBlbXB0eSBzdHJpbmcgd2hlbmV2ZXIgaXQKICAgICAgICAvLyBiZWNvbWVzIGJyb3dzaW5nLWNvbnRleHQgY29ubmVjdGVkLgogICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vd2hhdHdnL2h0bWwvaXNzdWVzLzIzNjkKICAgICAgICAvLyBTZWUgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy8jbm9uY2UtYXR0cmlidXRlcwogICAgICAgIC8vIFRoZSBgbm9kZS5nZXRBdHRyaWJ1dGVgIGNoZWNrIHdhcyBhZGRlZCBmb3IgdGhlIHNha2Ugb2YKICAgICAgICAvLyBgalF1ZXJ5Lmdsb2JhbEV2YWxgIHNvIHRoYXQgaXQgY2FuIGZha2UgYSBub25jZS1jb250YWluaW5nIG5vZGUKICAgICAgICAvLyB2aWEgYW4gb2JqZWN0LgogICAgICAgIHZhbCA9IG5vZGVbaV0gfHwgbm9kZS5nZXRBdHRyaWJ1dGUgJiYgbm9kZS5nZXRBdHRyaWJ1dGUoaSk7CiAgICAgICAgaWYgKHZhbCkgewogICAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZShpLCB2YWwpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZG9jLmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7CiAgfQogIGZ1bmN0aW9uIHRvVHlwZShvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgewogICAgICByZXR1cm4gb2JqICsgIiI7CiAgICB9CgogICAgLy8gU3VwcG9ydDogQW5kcm9pZCA8PTIuMyBvbmx5IChmdW5jdGlvbmlzaCBSZWdFeHApCiAgICByZXR1cm4gX3R5cGVvZihvYmopID09PSAib2JqZWN0IiB8fCB0eXBlb2Ygb2JqID09PSAiZnVuY3Rpb24iID8gY2xhc3MydHlwZVt0b1N0cmluZy5jYWxsKG9iaildIHx8ICJvYmplY3QiIDogX3R5cGVvZihvYmopOwogIH0KICAvKiBnbG9iYWwgU3ltYm9sICovCiAgLy8gRGVmaW5pbmcgdGhpcyBnbG9iYWwgaW4gLmVzbGludHJjLmpzb24gd291bGQgY3JlYXRlIGEgZGFuZ2VyIG9mIHVzaW5nIHRoZSBnbG9iYWwKICAvLyB1bmd1YXJkZWQgaW4gYW5vdGhlciBwbGFjZSwgaXQgc2VlbXMgc2FmZXIgdG8gZGVmaW5lIGdsb2JhbCBvbmx5IGZvciB0aGlzIG1vZHVsZQoKICB2YXIgdmVyc2lvbiA9ICIzLjUuMSIsCiAgICAvLyBEZWZpbmUgYSBsb2NhbCBjb3B5IG9mIGpRdWVyeQogICAgalF1ZXJ5ID0gZnVuY3Rpb24galF1ZXJ5KHNlbGVjdG9yLCBjb250ZXh0KSB7CiAgICAgIC8vIFRoZSBqUXVlcnkgb2JqZWN0IGlzIGFjdHVhbGx5IGp1c3QgdGhlIGluaXQgY29uc3RydWN0b3IgJ2VuaGFuY2VkJwogICAgICAvLyBOZWVkIGluaXQgaWYgalF1ZXJ5IGlzIGNhbGxlZCAoanVzdCBhbGxvdyBlcnJvciB0byBiZSB0aHJvd24gaWYgbm90IGluY2x1ZGVkKQogICAgICByZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KHNlbGVjdG9yLCBjb250ZXh0KTsKICAgIH07CiAgalF1ZXJ5LmZuID0galF1ZXJ5LnByb3RvdHlwZSA9IHsKICAgIC8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKICAgIGpxdWVyeTogdmVyc2lvbiwKICAgIGNvbnN0cnVjdG9yOiBqUXVlcnksCiAgICAvLyBUaGUgZGVmYXVsdCBsZW5ndGggb2YgYSBqUXVlcnkgb2JqZWN0IGlzIDAKICAgIGxlbmd0aDogMCwKICAgIHRvQXJyYXk6IGZ1bmN0aW9uIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBfc2xpY2UuY2FsbCh0aGlzKTsKICAgIH0sCiAgICAvLyBHZXQgdGhlIE50aCBlbGVtZW50IGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0IE9SCiAgICAvLyBHZXQgdGhlIHdob2xlIG1hdGNoZWQgZWxlbWVudCBzZXQgYXMgYSBjbGVhbiBhcnJheQogICAgZ2V0OiBmdW5jdGlvbiBnZXQobnVtKSB7CiAgICAgIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGluIGEgY2xlYW4gYXJyYXkKICAgICAgaWYgKG51bSA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIF9zbGljZS5jYWxsKHRoaXMpOwogICAgICB9CgogICAgICAvLyBSZXR1cm4ganVzdCB0aGUgb25lIGVsZW1lbnQgZnJvbSB0aGUgc2V0CiAgICAgIHJldHVybiBudW0gPCAwID8gdGhpc1tudW0gKyB0aGlzLmxlbmd0aF0gOiB0aGlzW251bV07CiAgICB9LAogICAgLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjawogICAgLy8gKHJldHVybmluZyB0aGUgbmV3IG1hdGNoZWQgZWxlbWVudCBzZXQpCiAgICBwdXNoU3RhY2s6IGZ1bmN0aW9uIHB1c2hTdGFjayhlbGVtcykgewogICAgICAvLyBCdWlsZCBhIG5ldyBqUXVlcnkgbWF0Y2hlZCBlbGVtZW50IHNldAogICAgICB2YXIgcmV0ID0galF1ZXJ5Lm1lcmdlKHRoaXMuY29uc3RydWN0b3IoKSwgZWxlbXMpOwoKICAgICAgLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKICAgICAgcmV0LnByZXZPYmplY3QgPSB0aGlzOwoKICAgICAgLy8gUmV0dXJuIHRoZSBuZXdseS1mb3JtZWQgZWxlbWVudCBzZXQKICAgICAgcmV0dXJuIHJldDsKICAgIH0sCiAgICAvLyBFeGVjdXRlIGEgY2FsbGJhY2sgZm9yIGV2ZXJ5IGVsZW1lbnQgaW4gdGhlIG1hdGNoZWQgc2V0LgogICAgZWFjaDogZnVuY3Rpb24gZWFjaChjYWxsYmFjaykgewogICAgICByZXR1cm4galF1ZXJ5LmVhY2godGhpcywgY2FsbGJhY2spOwogICAgfSwKICAgIG1hcDogZnVuY3Rpb24gbWFwKGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uIChlbGVtLCBpKSB7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmNhbGwoZWxlbSwgaSwgZWxlbSk7CiAgICAgIH0pKTsKICAgIH0sCiAgICBzbGljZTogZnVuY3Rpb24gc2xpY2UoKSB7CiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhfc2xpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9LAogICAgZmlyc3Q6IGZ1bmN0aW9uIGZpcnN0KCkgewogICAgICByZXR1cm4gdGhpcy5lcSgwKTsKICAgIH0sCiAgICBsYXN0OiBmdW5jdGlvbiBsYXN0KCkgewogICAgICByZXR1cm4gdGhpcy5lcSgtMSk7CiAgICB9LAogICAgZXZlbjogZnVuY3Rpb24gZXZlbigpIHsKICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGpRdWVyeS5ncmVwKHRoaXMsIGZ1bmN0aW9uIChfZWxlbSwgaSkgewogICAgICAgIHJldHVybiAoaSArIDEpICUgMjsKICAgICAgfSkpOwogICAgfSwKICAgIG9kZDogZnVuY3Rpb24gb2RkKCkgewogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soalF1ZXJ5LmdyZXAodGhpcywgZnVuY3Rpb24gKF9lbGVtLCBpKSB7CiAgICAgICAgcmV0dXJuIGkgJSAyOwogICAgICB9KSk7CiAgICB9LAogICAgZXE6IGZ1bmN0aW9uIGVxKGkpIHsKICAgICAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoLAogICAgICAgIGogPSAraSArIChpIDwgMCA/IGxlbiA6IDApOwogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2soaiA+PSAwICYmIGogPCBsZW4gPyBbdGhpc1tqXV0gOiBbXSk7CiAgICB9LAogICAgZW5kOiBmdW5jdGlvbiBlbmQoKSB7CiAgICAgIHJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcigpOwogICAgfSwKICAgIC8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KICAgIC8vIEJlaGF2ZXMgbGlrZSBhbiBBcnJheSdzIG1ldGhvZCwgbm90IGxpa2UgYSBqUXVlcnkgbWV0aG9kLgogICAgcHVzaDogcHVzaCwKICAgIHNvcnQ6IGFyci5zb3J0LAogICAgc3BsaWNlOiBhcnIuc3BsaWNlCiAgfTsKICBqUXVlcnkuZXh0ZW5kID0galF1ZXJ5LmZuLmV4dGVuZCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBvcHRpb25zLAogICAgICBuYW1lLAogICAgICBzcmMsCiAgICAgIGNvcHksCiAgICAgIGNvcHlJc0FycmF5LAogICAgICBjbG9uZSwKICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAogICAgICBpID0gMSwKICAgICAgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCwKICAgICAgZGVlcCA9IGZhbHNlOwoKICAgIC8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAiYm9vbGVhbiIpIHsKICAgICAgZGVlcCA9IHRhcmdldDsKCiAgICAgIC8vIFNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKICAgICAgdGFyZ2V0ID0gYXJndW1lbnRzW2ldIHx8IHt9OwogICAgICBpKys7CiAgICB9CgogICAgLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpCiAgICBpZiAoX3R5cGVvZih0YXJnZXQpICE9PSAib2JqZWN0IiAmJiAhaXNGdW5jdGlvbih0YXJnZXQpKSB7CiAgICAgIHRhcmdldCA9IHt9OwogICAgfQoKICAgIC8vIEV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAogICAgaWYgKGkgPT09IGxlbmd0aCkgewogICAgICB0YXJnZXQgPSB0aGlzOwogICAgICBpLS07CiAgICB9CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIC8vIE9ubHkgZGVhbCB3aXRoIG5vbi1udWxsL3VuZGVmaW5lZCB2YWx1ZXMKICAgICAgaWYgKChvcHRpb25zID0gYXJndW1lbnRzW2ldKSAhPSBudWxsKSB7CiAgICAgICAgLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAogICAgICAgIGZvciAobmFtZSBpbiBvcHRpb25zKSB7CiAgICAgICAgICBjb3B5ID0gb3B0aW9uc1tuYW1lXTsKCiAgICAgICAgICAvLyBQcmV2ZW50IE9iamVjdC5wcm90b3R5cGUgcG9sbHV0aW9uCiAgICAgICAgICAvLyBQcmV2ZW50IG5ldmVyLWVuZGluZyBsb29wCiAgICAgICAgICBpZiAobmFtZSA9PT0gIl9fcHJvdG9fXyIgfHwgdGFyZ2V0ID09PSBjb3B5KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFJlY3Vyc2UgaWYgd2UncmUgbWVyZ2luZyBwbGFpbiBvYmplY3RzIG9yIGFycmF5cwogICAgICAgICAgaWYgKGRlZXAgJiYgY29weSAmJiAoalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29weSkgfHwgKGNvcHlJc0FycmF5ID0gQXJyYXkuaXNBcnJheShjb3B5KSkpKSB7CiAgICAgICAgICAgIHNyYyA9IHRhcmdldFtuYW1lXTsKCiAgICAgICAgICAgIC8vIEVuc3VyZSBwcm9wZXIgdHlwZSBmb3IgdGhlIHNvdXJjZSB2YWx1ZQogICAgICAgICAgICBpZiAoY29weUlzQXJyYXkgJiYgIUFycmF5LmlzQXJyYXkoc3JjKSkgewogICAgICAgICAgICAgIGNsb25lID0gW107CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWNvcHlJc0FycmF5ICYmICFqUXVlcnkuaXNQbGFpbk9iamVjdChzcmMpKSB7CiAgICAgICAgICAgICAgY2xvbmUgPSB7fTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjbG9uZSA9IHNyYzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3B5SXNBcnJheSA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCiAgICAgICAgICAgIHRhcmdldFtuYW1lXSA9IGpRdWVyeS5leHRlbmQoZGVlcCwgY2xvbmUsIGNvcHkpOwoKICAgICAgICAgICAgLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwogICAgICAgICAgfSBlbHNlIGlmIChjb3B5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGFyZ2V0W25hbWVdID0gY29weTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBSZXR1cm4gdGhlIG1vZGlmaWVkIG9iamVjdAogICAgcmV0dXJuIHRhcmdldDsKICB9OwogIGpRdWVyeS5leHRlbmQoewogICAgLy8gVW5pcXVlIGZvciBlYWNoIGNvcHkgb2YgalF1ZXJ5IG9uIHRoZSBwYWdlCiAgICBleHBhbmRvOiAialF1ZXJ5IiArICh2ZXJzaW9uICsgTWF0aC5yYW5kb20oKSkucmVwbGFjZSgvXEQvZywgIiIpLAogICAgLy8gQXNzdW1lIGpRdWVyeSBpcyByZWFkeSB3aXRob3V0IHRoZSByZWFkeSBtb2R1bGUKICAgIGlzUmVhZHk6IHRydWUsCiAgICBlcnJvcjogZnVuY3Rpb24gZXJyb3IobXNnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpOwogICAgfSwKICAgIG5vb3A6IGZ1bmN0aW9uIG5vb3AoKSB7fSwKICAgIGlzUGxhaW5PYmplY3Q6IGZ1bmN0aW9uIGlzUGxhaW5PYmplY3Qob2JqKSB7CiAgICAgIHZhciBwcm90bywgQ3RvcjsKCiAgICAgIC8vIERldGVjdCBvYnZpb3VzIG5lZ2F0aXZlcwogICAgICAvLyBVc2UgdG9TdHJpbmcgaW5zdGVhZCBvZiBqUXVlcnkudHlwZSB0byBjYXRjaCBob3N0IG9iamVjdHMKICAgICAgaWYgKCFvYmogfHwgdG9TdHJpbmcuY2FsbChvYmopICE9PSAiW29iamVjdCBPYmplY3RdIikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBwcm90byA9IGdldFByb3RvKG9iaik7CgogICAgICAvLyBPYmplY3RzIHdpdGggbm8gcHJvdG90eXBlIChlLmcuLCBgT2JqZWN0LmNyZWF0ZSggbnVsbCApYCkgYXJlIHBsYWluCiAgICAgIGlmICghcHJvdG8pIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgLy8gT2JqZWN0cyB3aXRoIHByb3RvdHlwZSBhcmUgcGxhaW4gaWZmIHRoZXkgd2VyZSBjb25zdHJ1Y3RlZCBieSBhIGdsb2JhbCBPYmplY3QgZnVuY3Rpb24KICAgICAgQ3RvciA9IGhhc093bi5jYWxsKHByb3RvLCAiY29uc3RydWN0b3IiKSAmJiBwcm90by5jb25zdHJ1Y3RvcjsKICAgICAgcmV0dXJuIHR5cGVvZiBDdG9yID09PSAiZnVuY3Rpb24iICYmIGZuVG9TdHJpbmcuY2FsbChDdG9yKSA9PT0gT2JqZWN0RnVuY3Rpb25TdHJpbmc7CiAgICB9LAogICAgaXNFbXB0eU9iamVjdDogZnVuY3Rpb24gaXNFbXB0eU9iamVjdChvYmopIHsKICAgICAgdmFyIG5hbWU7CiAgICAgIGZvciAobmFtZSBpbiBvYmopIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgcHJvdmlkZWQgY29udGV4dDsgZmFsbHMgYmFjayB0byB0aGUgZ2xvYmFsIG9uZQogICAgLy8gaWYgbm90IHNwZWNpZmllZC4KICAgIGdsb2JhbEV2YWw6IGZ1bmN0aW9uIGdsb2JhbEV2YWwoY29kZSwgb3B0aW9ucywgZG9jKSB7CiAgICAgIERPTUV2YWwoY29kZSwgewogICAgICAgIG5vbmNlOiBvcHRpb25zICYmIG9wdGlvbnMubm9uY2UKICAgICAgfSwgZG9jKTsKICAgIH0sCiAgICBlYWNoOiBmdW5jdGlvbiBlYWNoKG9iaiwgY2FsbGJhY2spIHsKICAgICAgdmFyIGxlbmd0aCwKICAgICAgICBpID0gMDsKICAgICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHsKICAgICAgICBsZW5ndGggPSBvYmoubGVuZ3RoOwogICAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChjYWxsYmFjay5jYWxsKG9ialtpXSwgaSwgb2JqW2ldKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSBpbiBvYmopIHsKICAgICAgICAgIGlmIChjYWxsYmFjay5jYWxsKG9ialtpXSwgaSwgb2JqW2ldKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmo7CiAgICB9LAogICAgLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQogICAgbWFrZUFycmF5OiBmdW5jdGlvbiBtYWtlQXJyYXkoYXJyLCByZXN1bHRzKSB7CiAgICAgIHZhciByZXQgPSByZXN1bHRzIHx8IFtdOwogICAgICBpZiAoYXJyICE9IG51bGwpIHsKICAgICAgICBpZiAoaXNBcnJheUxpa2UoT2JqZWN0KGFycikpKSB7CiAgICAgICAgICBqUXVlcnkubWVyZ2UocmV0LCB0eXBlb2YgYXJyID09PSAic3RyaW5nIiA/IFthcnJdIDogYXJyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHVzaC5jYWxsKHJldCwgYXJyKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJldDsKICAgIH0sCiAgICBpbkFycmF5OiBmdW5jdGlvbiBpbkFycmF5KGVsZW0sIGFyciwgaSkgewogICAgICByZXR1cm4gYXJyID09IG51bGwgPyAtMSA6IGluZGV4T2YuY2FsbChhcnIsIGVsZW0sIGkpOwogICAgfSwKICAgIC8vIFN1cHBvcnQ6IEFuZHJvaWQgPD00LjAgb25seSwgUGhhbnRvbUpTIDEgb25seQogICAgLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAogICAgbWVyZ2U6IGZ1bmN0aW9uIG1lcmdlKGZpcnN0LCBzZWNvbmQpIHsKICAgICAgdmFyIGxlbiA9ICtzZWNvbmQubGVuZ3RoLAogICAgICAgIGogPSAwLAogICAgICAgIGkgPSBmaXJzdC5sZW5ndGg7CiAgICAgIGZvciAoOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICBmaXJzdFtpKytdID0gc2Vjb25kW2pdOwogICAgICB9CiAgICAgIGZpcnN0Lmxlbmd0aCA9IGk7CiAgICAgIHJldHVybiBmaXJzdDsKICAgIH0sCiAgICBncmVwOiBmdW5jdGlvbiBncmVwKGVsZW1zLCBjYWxsYmFjaywgaW52ZXJ0KSB7CiAgICAgIHZhciBjYWxsYmFja0ludmVyc2UsCiAgICAgICAgbWF0Y2hlcyA9IFtdLAogICAgICAgIGkgPSAwLAogICAgICAgIGxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKICAgICAgICBjYWxsYmFja0V4cGVjdCA9ICFpbnZlcnQ7CgogICAgICAvLyBHbyB0aHJvdWdoIHRoZSBhcnJheSwgb25seSBzYXZpbmcgdGhlIGl0ZW1zCiAgICAgIC8vIHRoYXQgcGFzcyB0aGUgdmFsaWRhdG9yIGZ1bmN0aW9uCiAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBjYWxsYmFja0ludmVyc2UgPSAhY2FsbGJhY2soZWxlbXNbaV0sIGkpOwogICAgICAgIGlmIChjYWxsYmFja0ludmVyc2UgIT09IGNhbGxiYWNrRXhwZWN0KSB7CiAgICAgICAgICBtYXRjaGVzLnB1c2goZWxlbXNbaV0pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbWF0Y2hlczsKICAgIH0sCiAgICAvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKICAgIG1hcDogZnVuY3Rpb24gbWFwKGVsZW1zLCBjYWxsYmFjaywgYXJnKSB7CiAgICAgIHZhciBsZW5ndGgsCiAgICAgICAgdmFsdWUsCiAgICAgICAgaSA9IDAsCiAgICAgICAgcmV0ID0gW107CgogICAgICAvLyBHbyB0aHJvdWdoIHRoZSBhcnJheSwgdHJhbnNsYXRpbmcgZWFjaCBvZiB0aGUgaXRlbXMgdG8gdGhlaXIgbmV3IHZhbHVlcwogICAgICBpZiAoaXNBcnJheUxpa2UoZWxlbXMpKSB7CiAgICAgICAgbGVuZ3RoID0gZWxlbXMubGVuZ3RoOwogICAgICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhbHVlID0gY2FsbGJhY2soZWxlbXNbaV0sIGksIGFyZyk7CiAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICByZXQucHVzaCh2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBHbyB0aHJvdWdoIGV2ZXJ5IGtleSBvbiB0aGUgb2JqZWN0LAogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSBpbiBlbGVtcykgewogICAgICAgICAgdmFsdWUgPSBjYWxsYmFjayhlbGVtc1tpXSwgaSwgYXJnKTsKICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldC5wdXNoKHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIEZsYXR0ZW4gYW55IG5lc3RlZCBhcnJheXMKICAgICAgcmV0dXJuIGZsYXQocmV0KTsKICAgIH0sCiAgICAvLyBBIGdsb2JhbCBHVUlEIGNvdW50ZXIgZm9yIG9iamVjdHMKICAgIGd1aWQ6IDEsCiAgICAvLyBqUXVlcnkuc3VwcG9ydCBpcyBub3QgdXNlZCBpbiBDb3JlIGJ1dCBvdGhlciBwcm9qZWN0cyBhdHRhY2ggdGhlaXIKICAgIC8vIHByb3BlcnRpZXMgdG8gaXQgc28gaXQgbmVlZHMgdG8gZXhpc3QuCiAgICBzdXBwb3J0OiBzdXBwb3J0CiAgfSk7CiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIpIHsKICAgIGpRdWVyeS5mbltTeW1ib2wuaXRlcmF0b3JdID0gYXJyW1N5bWJvbC5pdGVyYXRvcl07CiAgfQoKICAvLyBQb3B1bGF0ZSB0aGUgY2xhc3MydHlwZSBtYXAKICBqUXVlcnkuZWFjaCgiQm9vbGVhbiBOdW1iZXIgU3RyaW5nIEZ1bmN0aW9uIEFycmF5IERhdGUgUmVnRXhwIE9iamVjdCBFcnJvciBTeW1ib2wiLnNwbGl0KCIgIiksIGZ1bmN0aW9uIChfaSwgbmFtZSkgewogICAgY2xhc3MydHlwZVsiW29iamVjdCAiICsgbmFtZSArICJdIl0gPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgfSk7CiAgZnVuY3Rpb24gaXNBcnJheUxpa2Uob2JqKSB7CiAgICAvLyBTdXBwb3J0OiByZWFsIGlPUyA4LjIgb25seSAobm90IHJlcHJvZHVjaWJsZSBpbiBzaW11bGF0b3IpCiAgICAvLyBgaW5gIGNoZWNrIHVzZWQgdG8gcHJldmVudCBKSVQgZXJyb3IgKGdoLTIxNDUpCiAgICAvLyBoYXNPd24gaXNuJ3QgdXNlZCBoZXJlIGR1ZSB0byBmYWxzZSBuZWdhdGl2ZXMKICAgIC8vIHJlZ2FyZGluZyBOb2RlbGlzdCBsZW5ndGggaW4gSUUKICAgIHZhciBsZW5ndGggPSAhIW9iaiAmJiAibGVuZ3RoIiBpbiBvYmogJiYgb2JqLmxlbmd0aCwKICAgICAgdHlwZSA9IHRvVHlwZShvYmopOwogICAgaWYgKGlzRnVuY3Rpb24ob2JqKSB8fCBpc1dpbmRvdyhvYmopKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0eXBlID09PSAiYXJyYXkiIHx8IGxlbmd0aCA9PT0gMCB8fCB0eXBlb2YgbGVuZ3RoID09PSAibnVtYmVyIiAmJiBsZW5ndGggPiAwICYmIGxlbmd0aCAtIDEgaW4gb2JqOwogIH0KICB2YXIgU2l6emxlID0KICAvKiEKICAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lIHYyLjMuNQogICogaHR0cHM6Ly9zaXp6bGVqcy5jb20vCiAgKgogICogQ29weXJpZ2h0IEpTIEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAgKiBodHRwczovL2pzLmZvdW5kYXRpb24vCiAgKgogICogRGF0ZTogMjAyMC0wMy0xNAogICovCiAgZnVuY3Rpb24gKHdpbmRvdykgewogICAgdmFyIGksCiAgICAgIHN1cHBvcnQsCiAgICAgIEV4cHIsCiAgICAgIGdldFRleHQsCiAgICAgIGlzWE1MLAogICAgICB0b2tlbml6ZSwKICAgICAgY29tcGlsZSwKICAgICAgc2VsZWN0LAogICAgICBvdXRlcm1vc3RDb250ZXh0LAogICAgICBzb3J0SW5wdXQsCiAgICAgIGhhc0R1cGxpY2F0ZSwKICAgICAgLy8gTG9jYWwgZG9jdW1lbnQgdmFycwogICAgICBzZXREb2N1bWVudCwKICAgICAgZG9jdW1lbnQsCiAgICAgIGRvY0VsZW0sCiAgICAgIGRvY3VtZW50SXNIVE1MLAogICAgICByYnVnZ3lRU0EsCiAgICAgIHJidWdneU1hdGNoZXMsCiAgICAgIG1hdGNoZXMsCiAgICAgIGNvbnRhaW5zLAogICAgICAvLyBJbnN0YW5jZS1zcGVjaWZpYyBkYXRhCiAgICAgIGV4cGFuZG8gPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSgpLAogICAgICBwcmVmZXJyZWREb2MgPSB3aW5kb3cuZG9jdW1lbnQsCiAgICAgIGRpcnJ1bnMgPSAwLAogICAgICBkb25lID0gMCwKICAgICAgY2xhc3NDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCiAgICAgIHRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAogICAgICBjb21waWxlckNhY2hlID0gY3JlYXRlQ2FjaGUoKSwKICAgICAgbm9ubmF0aXZlU2VsZWN0b3JDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCiAgICAgIHNvcnRPcmRlciA9IGZ1bmN0aW9uIHNvcnRPcmRlcihhLCBiKSB7CiAgICAgICAgaWYgKGEgPT09IGIpIHsKICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgICB9LAogICAgICAvLyBJbnN0YW5jZSBtZXRob2RzCiAgICAgIGhhc093biA9IHt9Lmhhc093blByb3BlcnR5LAogICAgICBhcnIgPSBbXSwKICAgICAgcG9wID0gYXJyLnBvcCwKICAgICAgcHVzaE5hdGl2ZSA9IGFyci5wdXNoLAogICAgICBwdXNoID0gYXJyLnB1c2gsCiAgICAgIHNsaWNlID0gYXJyLnNsaWNlLAogICAgICAvLyBVc2UgYSBzdHJpcHBlZC1kb3duIGluZGV4T2YgYXMgaXQncyBmYXN0ZXIgdGhhbiBuYXRpdmUKICAgICAgLy8gaHR0cHM6Ly9qc3BlcmYuY29tL3Rob3ItaW5kZXhvZi12cy1mb3IvNQogICAgICBpbmRleE9mID0gZnVuY3Rpb24gaW5kZXhPZihsaXN0LCBlbGVtKSB7CiAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgbGVuID0gbGlzdC5sZW5ndGg7CiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgaWYgKGxpc3RbaV0gPT09IGVsZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAgICAgfSwKICAgICAgYm9vbGVhbnMgPSAiY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufCIgKyAiaXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCIsCiAgICAgIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbnMKCiAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc2VsZWN0b3JzLyN3aGl0ZXNwYWNlCiAgICAgIHdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCiAgICAgIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3Mtc3ludGF4LTMvI2lkZW50LXRva2VuLWRpYWdyYW0KICAgICAgaWRlbnRpZmllciA9ICIoPzpcXFxcW1xcZGEtZkEtRl17MSw2fSIgKyB3aGl0ZXNwYWNlICsgIj98XFxcXFteXFxyXFxuXFxmXXxbXFx3LV18W15cMC1cXHg3Zl0pKyIsCiAgICAgIC8vIEF0dHJpYnV0ZSBzZWxlY3RvcnM6IGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycwogICAgICBhdHRyaWJ1dGVzID0gIlxcWyIgKyB3aGl0ZXNwYWNlICsgIiooIiArIGlkZW50aWZpZXIgKyAiKSg/OiIgKyB3aGl0ZXNwYWNlICsKICAgICAgLy8gT3BlcmF0b3IgKGNhcHR1cmUgMikKICAgICAgIiooWypeJHwhfl0/PSkiICsgd2hpdGVzcGFjZSArCiAgICAgIC8vICJBdHRyaWJ1dGUgdmFsdWVzIG11c3QgYmUgQ1NTIGlkZW50aWZpZXJzIFtjYXB0dXJlIDVdCiAgICAgIC8vIG9yIHN0cmluZ3MgW2NhcHR1cmUgMyBvciBjYXB0dXJlIDRdIgogICAgICAiKig/OicoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwifCgiICsgaWRlbnRpZmllciArICIpKXwpIiArIHdoaXRlc3BhY2UgKyAiKlxcXSIsCiAgICAgIHBzZXVkb3MgPSAiOigiICsgaWRlbnRpZmllciArICIpKD86XFwoKCIgKwogICAgICAvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOgogICAgICAvLyAxLiBxdW90ZWQgKGNhcHR1cmUgMzsgY2FwdHVyZSA0IG9yIGNhcHR1cmUgNSkKICAgICAgIignKCg/OlxcXFwufFteXFxcXCddKSopJ3xcIigoPzpcXFxcLnxbXlxcXFxcIl0pKilcIil8IiArCiAgICAgIC8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KQogICAgICAiKCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIGF0dHJpYnV0ZXMgKyAiKSopfCIgKwogICAgICAvLyAzLiBhbnl0aGluZyBlbHNlIChjYXB0dXJlIDIpCiAgICAgICIuKiIgKyAiKVxcKXwpIiwKICAgICAgLy8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlcgogICAgICByd2hpdGVzcGFjZSA9IG5ldyBSZWdFeHAod2hpdGVzcGFjZSArICIrIiwgImciKSwKICAgICAgcnRyaW0gPSBuZXcgUmVnRXhwKCJeIiArIHdoaXRlc3BhY2UgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIHdoaXRlc3BhY2UgKyAiKyQiLCAiZyIpLAogICAgICByY29tbWEgPSBuZXcgUmVnRXhwKCJeIiArIHdoaXRlc3BhY2UgKyAiKiwiICsgd2hpdGVzcGFjZSArICIqIiksCiAgICAgIHJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoIl4iICsgd2hpdGVzcGFjZSArICIqKFs+K35dfCIgKyB3aGl0ZXNwYWNlICsgIikiICsgd2hpdGVzcGFjZSArICIqIiksCiAgICAgIHJkZXNjZW5kID0gbmV3IFJlZ0V4cCh3aGl0ZXNwYWNlICsgInw+IiksCiAgICAgIHJwc2V1ZG8gPSBuZXcgUmVnRXhwKHBzZXVkb3MpLAogICAgICByaWRlbnRpZmllciA9IG5ldyBSZWdFeHAoIl4iICsgaWRlbnRpZmllciArICIkIiksCiAgICAgIG1hdGNoRXhwciA9IHsKICAgICAgICAiSUQiOiBuZXcgUmVnRXhwKCJeIygiICsgaWRlbnRpZmllciArICIpIiksCiAgICAgICAgIkNMQVNTIjogbmV3IFJlZ0V4cCgiXlxcLigiICsgaWRlbnRpZmllciArICIpIiksCiAgICAgICAgIlRBRyI6IG5ldyBSZWdFeHAoIl4oIiArIGlkZW50aWZpZXIgKyAifFsqXSkiKSwKICAgICAgICAiQVRUUiI6IG5ldyBSZWdFeHAoIl4iICsgYXR0cmlidXRlcyksCiAgICAgICAgIlBTRVVETyI6IG5ldyBSZWdFeHAoIl4iICsgcHNldWRvcyksCiAgICAgICAgIkNISUxEIjogbmV3IFJlZ0V4cCgiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIHdoaXRlc3BhY2UgKyAiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyB3aGl0ZXNwYWNlICsgIiooPzooWystXXwpIiArIHdoaXRlc3BhY2UgKyAiKihcXGQrKXwpKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSIsICJpIiksCiAgICAgICAgImJvb2wiOiBuZXcgUmVnRXhwKCJeKD86IiArIGJvb2xlYW5zICsgIikkIiwgImkiKSwKICAgICAgICAvLyBGb3IgdXNlIGluIGxpYnJhcmllcyBpbXBsZW1lbnRpbmcgLmlzKCkKICAgICAgICAvLyBXZSB1c2UgdGhpcyBmb3IgUE9TIG1hdGNoaW5nIGluIGBzZWxlY3RgCiAgICAgICAgIm5lZWRzQ29udGV4dCI6IG5ldyBSZWdFeHAoIl4iICsgd2hpdGVzcGFjZSArICIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiICsgd2hpdGVzcGFjZSArICIqKCg/Oi1cXGQpP1xcZCopIiArIHdoaXRlc3BhY2UgKyAiKlxcKXwpKD89W14tXXwkKSIsICJpIikKICAgICAgfSwKICAgICAgcmh0bWwgPSAvSFRNTCQvaSwKICAgICAgcmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksCiAgICAgIHJoZWFkZXIgPSAvXmhcZCQvaSwKICAgICAgcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIFx3LywKICAgICAgLy8gRWFzaWx5LXBhcnNlYWJsZS9yZXRyaWV2YWJsZSBJRCBvciBUQUcgb3IgQ0xBU1Mgc2VsZWN0b3JzCiAgICAgIHJxdWlja0V4cHIgPSAvXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLAogICAgICByc2libGluZyA9IC9bK35dLywKICAgICAgLy8gQ1NTIGVzY2FwZXMKICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVycwogICAgICBydW5lc2NhcGUgPSBuZXcgUmVnRXhwKCJcXFxcW1xcZGEtZkEtRl17MSw2fSIgKyB3aGl0ZXNwYWNlICsgIj98XFxcXChbXlxcclxcblxcZl0pIiwgImciKSwKICAgICAgZnVuZXNjYXBlID0gZnVuY3Rpb24gZnVuZXNjYXBlKGVzY2FwZSwgbm9uSGV4KSB7CiAgICAgICAgdmFyIGhpZ2ggPSAiMHgiICsgZXNjYXBlLnNsaWNlKDEpIC0gMHgxMDAwMDsKICAgICAgICByZXR1cm4gbm9uSGV4ID8KICAgICAgICAvLyBTdHJpcCB0aGUgYmFja3NsYXNoIHByZWZpeCBmcm9tIGEgbm9uLWhleCBlc2NhcGUgc2VxdWVuY2UKICAgICAgICBub25IZXggOgogICAgICAgIC8vIFJlcGxhY2UgYSBoZXhhZGVjaW1hbCBlc2NhcGUgc2VxdWVuY2Ugd2l0aCB0aGUgZW5jb2RlZCBVbmljb2RlIGNvZGUgcG9pbnQKICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PTExKwogICAgICAgIC8vIEZvciB2YWx1ZXMgb3V0c2lkZSB0aGUgQmFzaWMgTXVsdGlsaW5ndWFsIFBsYW5lIChCTVApLCBtYW51YWxseSBjb25zdHJ1Y3QgYQogICAgICAgIC8vIHN1cnJvZ2F0ZSBwYWlyCiAgICAgICAgaGlnaCA8IDAgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGhpZ2ggKyAweDEwMDAwKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwKTsKICAgICAgfSwKICAgICAgLy8gQ1NTIHN0cmluZy9pZGVudGlmaWVyIHNlcmlhbGl6YXRpb24KICAgICAgLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzc29tLyNjb21tb24tc2VyaWFsaXppbmctaWRpb21zCiAgICAgIHJjc3Nlc2NhcGUgPSAvKFtcMC1ceDFmXHg3Zl18Xi0/XGQpfF4tJHxbXlwwLVx4MWZceDdmLVx1RkZGRlx3LV0vZywKICAgICAgZmNzc2VzY2FwZSA9IGZ1bmN0aW9uIGZjc3Nlc2NhcGUoY2gsIGFzQ29kZVBvaW50KSB7CiAgICAgICAgaWYgKGFzQ29kZVBvaW50KSB7CiAgICAgICAgICAvLyBVKzAwMDAgTlVMTCBiZWNvbWVzIFUrRkZGRCBSRVBMQUNFTUVOVCBDSEFSQUNURVIKICAgICAgICAgIGlmIChjaCA9PT0gIlwwIikgewogICAgICAgICAgICByZXR1cm4gIlx1RkZGRCI7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQ29udHJvbCBjaGFyYWN0ZXJzIGFuZCAoZGVwZW5kZW50IHVwb24gcG9zaXRpb24pIG51bWJlcnMgZ2V0IGVzY2FwZWQgYXMgY29kZSBwb2ludHMKICAgICAgICAgIHJldHVybiBjaC5zbGljZSgwLCAtMSkgKyAiXFwiICsgY2guY2hhckNvZGVBdChjaC5sZW5ndGggLSAxKS50b1N0cmluZygxNikgKyAiICI7CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlciBwb3RlbnRpYWxseS1zcGVjaWFsIEFTQ0lJIGNoYXJhY3RlcnMgZ2V0IGJhY2tzbGFzaC1lc2NhcGVkCiAgICAgICAgcmV0dXJuICJcXCIgKyBjaDsKICAgICAgfSwKICAgICAgLy8gVXNlZCBmb3IgaWZyYW1lcwogICAgICAvLyBTZWUgc2V0RG9jdW1lbnQoKQogICAgICAvLyBSZW1vdmluZyB0aGUgZnVuY3Rpb24gd3JhcHBlciBjYXVzZXMgYSAiUGVybWlzc2lvbiBEZW5pZWQiCiAgICAgIC8vIGVycm9yIGluIElFCiAgICAgIHVubG9hZEhhbmRsZXIgPSBmdW5jdGlvbiB1bmxvYWRIYW5kbGVyKCkgewogICAgICAgIHNldERvY3VtZW50KCk7CiAgICAgIH0sCiAgICAgIGluRGlzYWJsZWRGaWVsZHNldCA9IGFkZENvbWJpbmF0b3IoZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJmaWVsZHNldCI7CiAgICAgIH0sIHsKICAgICAgICBkaXI6ICJwYXJlbnROb2RlIiwKICAgICAgICBuZXh0OiAibGVnZW5kIgogICAgICB9KTsKCiAgICAvLyBPcHRpbWl6ZSBmb3IgcHVzaC5hcHBseSggXywgTm9kZUxpc3QgKQogICAgdHJ5IHsKICAgICAgcHVzaC5hcHBseShhcnIgPSBzbGljZS5jYWxsKHByZWZlcnJlZERvYy5jaGlsZE5vZGVzKSwgcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMpOwoKICAgICAgLy8gU3VwcG9ydDogQW5kcm9pZDw0LjAKICAgICAgLy8gRGV0ZWN0IHNpbGVudGx5IGZhaWxpbmcgcHVzaC5hcHBseQogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLWV4cHJlc3Npb25zCiAgICAgIGFycltwcmVmZXJyZWREb2MuY2hpbGROb2Rlcy5sZW5ndGhdLm5vZGVUeXBlOwogICAgfSBjYXRjaCAoZSkgewogICAgICBwdXNoID0gewogICAgICAgIGFwcGx5OiBhcnIubGVuZ3RoID8KICAgICAgICAvLyBMZXZlcmFnZSBzbGljZSBpZiBwb3NzaWJsZQogICAgICAgIGZ1bmN0aW9uICh0YXJnZXQsIGVscykgewogICAgICAgICAgcHVzaE5hdGl2ZS5hcHBseSh0YXJnZXQsIHNsaWNlLmNhbGwoZWxzKSk7CiAgICAgICAgfSA6CiAgICAgICAgLy8gU3VwcG9ydDogSUU8OQogICAgICAgIC8vIE90aGVyd2lzZSBhcHBlbmQgZGlyZWN0bHkKICAgICAgICBmdW5jdGlvbiAodGFyZ2V0LCBlbHMpIHsKICAgICAgICAgIHZhciBqID0gdGFyZ2V0Lmxlbmd0aCwKICAgICAgICAgICAgaSA9IDA7CgogICAgICAgICAgLy8gQ2FuJ3QgdHJ1c3QgTm9kZUxpc3QubGVuZ3RoCiAgICAgICAgICB3aGlsZSAodGFyZ2V0W2orK10gPSBlbHNbaSsrXSkge30KICAgICAgICAgIHRhcmdldC5sZW5ndGggPSBqIC0gMTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBTaXp6bGUoc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQpIHsKICAgICAgdmFyIG0sCiAgICAgICAgaSwKICAgICAgICBlbGVtLAogICAgICAgIG5pZCwKICAgICAgICBtYXRjaCwKICAgICAgICBncm91cHMsCiAgICAgICAgbmV3U2VsZWN0b3IsCiAgICAgICAgbmV3Q29udGV4dCA9IGNvbnRleHQgJiYgY29udGV4dC5vd25lckRvY3VtZW50LAogICAgICAgIC8vIG5vZGVUeXBlIGRlZmF1bHRzIHRvIDksIHNpbmNlIGNvbnRleHQgZGVmYXVsdHMgdG8gZG9jdW1lbnQKICAgICAgICBub2RlVHlwZSA9IGNvbnRleHQgPyBjb250ZXh0Lm5vZGVUeXBlIDogOTsKICAgICAgcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgogICAgICAvLyBSZXR1cm4gZWFybHkgZnJvbSBjYWxscyB3aXRoIGludmFsaWQgc2VsZWN0b3Igb3IgY29udGV4dAogICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiB8fCAhc2VsZWN0b3IgfHwgbm9kZVR5cGUgIT09IDEgJiYgbm9kZVR5cGUgIT09IDkgJiYgbm9kZVR5cGUgIT09IDExKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgIH0KCiAgICAgIC8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgKGFzIG9wcG9zZWQgdG8gZmlsdGVycykgaW4gSFRNTCBkb2N1bWVudHMKICAgICAgaWYgKCFzZWVkKSB7CiAgICAgICAgc2V0RG9jdW1lbnQoY29udGV4dCk7CiAgICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7CiAgICAgICAgaWYgKGRvY3VtZW50SXNIVE1MKSB7CiAgICAgICAgICAvLyBJZiB0aGUgc2VsZWN0b3IgaXMgc3VmZmljaWVudGx5IHNpbXBsZSwgdHJ5IHVzaW5nIGEgImdldCpCeSoiIERPTSBtZXRob2QKICAgICAgICAgIC8vIChleGNlcHRpbmcgRG9jdW1lbnRGcmFnbWVudCBjb250ZXh0LCB3aGVyZSB0aGUgbWV0aG9kcyBkb24ndCBleGlzdCkKICAgICAgICAgIGlmIChub2RlVHlwZSAhPT0gMTEgJiYgKG1hdGNoID0gcnF1aWNrRXhwci5leGVjKHNlbGVjdG9yKSkpIHsKICAgICAgICAgICAgLy8gSUQgc2VsZWN0b3IKICAgICAgICAgICAgaWYgKG0gPSBtYXRjaFsxXSkgewogICAgICAgICAgICAgIC8vIERvY3VtZW50IGNvbnRleHQKICAgICAgICAgICAgICBpZiAobm9kZVR5cGUgPT09IDkpIHsKICAgICAgICAgICAgICAgIGlmIChlbGVtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZChtKSkgewogICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSwgT3BlcmEsIFdlYmtpdAogICAgICAgICAgICAgICAgICAvLyBUT0RPOiBpZGVudGlmeSB2ZXJzaW9ucwogICAgICAgICAgICAgICAgICAvLyBnZXRFbGVtZW50QnlJZCBjYW4gbWF0Y2ggZWxlbWVudHMgYnkgbmFtZSBpbnN0ZWFkIG9mIElECiAgICAgICAgICAgICAgICAgIGlmIChlbGVtLmlkID09PSBtKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGVsZW0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBFbGVtZW50IGNvbnRleHQKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gU3VwcG9ydDogSUUsIE9wZXJhLCBXZWJraXQKICAgICAgICAgICAgICAgIC8vIFRPRE86IGlkZW50aWZ5IHZlcnNpb25zCiAgICAgICAgICAgICAgICAvLyBnZXRFbGVtZW50QnlJZCBjYW4gbWF0Y2ggZWxlbWVudHMgYnkgbmFtZSBpbnN0ZWFkIG9mIElECiAgICAgICAgICAgICAgICBpZiAobmV3Q29udGV4dCAmJiAoZWxlbSA9IG5ld0NvbnRleHQuZ2V0RWxlbWVudEJ5SWQobSkpICYmIGNvbnRhaW5zKGNvbnRleHQsIGVsZW0pICYmIGVsZW0uaWQgPT09IG0pIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGVsZW0pOwogICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC8vIFR5cGUgc2VsZWN0b3IKICAgICAgICAgICAgfSBlbHNlIGlmIChtYXRjaFsyXSkgewogICAgICAgICAgICAgIHB1c2guYXBwbHkocmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZShzZWxlY3RvcikpOwogICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwoKICAgICAgICAgICAgICAvLyBDbGFzcyBzZWxlY3RvcgogICAgICAgICAgICB9IGVsc2UgaWYgKChtID0gbWF0Y2hbM10pICYmIHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIHsKICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShtKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBUYWtlIGFkdmFudGFnZSBvZiBxdWVyeVNlbGVjdG9yQWxsCiAgICAgICAgICBpZiAoc3VwcG9ydC5xc2EgJiYgIW5vbm5hdGl2ZVNlbGVjdG9yQ2FjaGVbc2VsZWN0b3IgKyAiICJdICYmICghcmJ1Z2d5UVNBIHx8ICFyYnVnZ3lRU0EudGVzdChzZWxlY3RvcikpICYmICgKICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDggb25seQogICAgICAgICAgLy8gRXhjbHVkZSBvYmplY3QgZWxlbWVudHMKICAgICAgICAgIG5vZGVUeXBlICE9PSAxIHx8IGNvbnRleHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gIm9iamVjdCIpKSB7CiAgICAgICAgICAgIG5ld1NlbGVjdG9yID0gc2VsZWN0b3I7CiAgICAgICAgICAgIG5ld0NvbnRleHQgPSBjb250ZXh0OwoKICAgICAgICAgICAgLy8gcVNBIGNvbnNpZGVycyBlbGVtZW50cyBvdXRzaWRlIGEgc2NvcGluZyByb290IHdoZW4gZXZhbHVhdGluZyBjaGlsZCBvcgogICAgICAgICAgICAvLyBkZXNjZW5kYW50IGNvbWJpbmF0b3JzLCB3aGljaCBpcyBub3Qgd2hhdCB3ZSB3YW50LgogICAgICAgICAgICAvLyBJbiBzdWNoIGNhc2VzLCB3ZSB3b3JrIGFyb3VuZCB0aGUgYmVoYXZpb3IgYnkgcHJlZml4aW5nIGV2ZXJ5IHNlbGVjdG9yIGluIHRoZQogICAgICAgICAgICAvLyBsaXN0IHdpdGggYW4gSUQgc2VsZWN0b3IgcmVmZXJlbmNpbmcgdGhlIHNjb3BlIGNvbnRleHQuCiAgICAgICAgICAgIC8vIFRoZSB0ZWNobmlxdWUgaGFzIHRvIGJlIHVzZWQgYXMgd2VsbCB3aGVuIGEgbGVhZGluZyBjb21iaW5hdG9yIGlzIHVzZWQKICAgICAgICAgICAgLy8gYXMgc3VjaCBzZWxlY3RvcnMgYXJlIG5vdCByZWNvZ25pemVkIGJ5IHF1ZXJ5U2VsZWN0b3JBbGwuCiAgICAgICAgICAgIC8vIFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGlzIHRlY2huaXF1ZS4KICAgICAgICAgICAgaWYgKG5vZGVUeXBlID09PSAxICYmIChyZGVzY2VuZC50ZXN0KHNlbGVjdG9yKSB8fCByY29tYmluYXRvcnMudGVzdChzZWxlY3RvcikpKSB7CiAgICAgICAgICAgICAgLy8gRXhwYW5kIGNvbnRleHQgZm9yIHNpYmxpbmcgc2VsZWN0b3JzCiAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IHJzaWJsaW5nLnRlc3Qoc2VsZWN0b3IpICYmIHRlc3RDb250ZXh0KGNvbnRleHQucGFyZW50Tm9kZSkgfHwgY29udGV4dDsKCiAgICAgICAgICAgICAgLy8gV2UgY2FuIHVzZSA6c2NvcGUgaW5zdGVhZCBvZiB0aGUgSUQgaGFjayBpZiB0aGUgYnJvd3NlcgogICAgICAgICAgICAgIC8vIHN1cHBvcnRzIGl0ICYgaWYgd2UncmUgbm90IGNoYW5naW5nIHRoZSBjb250ZXh0LgogICAgICAgICAgICAgIGlmIChuZXdDb250ZXh0ICE9PSBjb250ZXh0IHx8ICFzdXBwb3J0LnNjb3BlKSB7CiAgICAgICAgICAgICAgICAvLyBDYXB0dXJlIHRoZSBjb250ZXh0IElELCBzZXR0aW5nIGl0IGZpcnN0IGlmIG5lY2Vzc2FyeQogICAgICAgICAgICAgICAgaWYgKG5pZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKCJpZCIpKSB7CiAgICAgICAgICAgICAgICAgIG5pZCA9IG5pZC5yZXBsYWNlKHJjc3Nlc2NhcGUsIGZjc3Nlc2NhcGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgY29udGV4dC5zZXRBdHRyaWJ1dGUoImlkIiwgbmlkID0gZXhwYW5kbyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBQcmVmaXggZXZlcnkgc2VsZWN0b3IgaW4gdGhlIGxpc3QKICAgICAgICAgICAgICBncm91cHMgPSB0b2tlbml6ZShzZWxlY3Rvcik7CiAgICAgICAgICAgICAgaSA9IGdyb3Vwcy5sZW5ndGg7CiAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgZ3JvdXBzW2ldID0gKG5pZCA/ICIjIiArIG5pZCA6ICI6c2NvcGUiKSArICIgIiArIHRvU2VsZWN0b3IoZ3JvdXBzW2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbmV3U2VsZWN0b3IgPSBncm91cHMuam9pbigiLCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBuZXdDb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwobmV3U2VsZWN0b3IpKTsKICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICAgICAgfSBjYXRjaCAocXNhRXJyb3IpIHsKICAgICAgICAgICAgICBub25uYXRpdmVTZWxlY3RvckNhY2hlKHNlbGVjdG9yLCB0cnVlKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBpZiAobmlkID09PSBleHBhbmRvKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LnJlbW92ZUF0dHJpYnV0ZSgiaWQiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIEFsbCBvdGhlcnMKICAgICAgcmV0dXJuIHNlbGVjdChzZWxlY3Rvci5yZXBsYWNlKHJ0cmltLCAiJDEiKSwgY29udGV4dCwgcmVzdWx0cywgc2VlZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemUKICAgICAqIEByZXR1cm5zIHtmdW5jdGlvbihzdHJpbmcsIG9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGgKICAgICAqCXByb3BlcnR5IG5hbWUgdGhlIChzcGFjZS1zdWZmaXhlZCkgc3RyaW5nIGFuZCAoaWYgdGhlIGNhY2hlIGlzIGxhcmdlciB0aGFuIEV4cHIuY2FjaGVMZW5ndGgpCiAgICAgKglkZWxldGluZyB0aGUgb2xkZXN0IGVudHJ5CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkgewogICAgICB2YXIga2V5cyA9IFtdOwogICAgICBmdW5jdGlvbiBjYWNoZShrZXksIHZhbHVlKSB7CiAgICAgICAgLy8gVXNlIChrZXkgKyAiICIpIHRvIGF2b2lkIGNvbGxpc2lvbiB3aXRoIG5hdGl2ZSBwcm90b3R5cGUgcHJvcGVydGllcyAoc2VlIElzc3VlICMxNTcpCiAgICAgICAgaWYgKGtleXMucHVzaChrZXkgKyAiICIpID4gRXhwci5jYWNoZUxlbmd0aCkgewogICAgICAgICAgLy8gT25seSBrZWVwIHRoZSBtb3N0IHJlY2VudCBlbnRyaWVzCiAgICAgICAgICBkZWxldGUgY2FjaGVba2V5cy5zaGlmdCgpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNhY2hlW2tleSArICIgIl0gPSB2YWx1ZTsKICAgICAgfQogICAgICByZXR1cm4gY2FjaGU7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXJrIGEgZnVuY3Rpb24gZm9yIHNwZWNpYWwgdXNlIGJ5IFNpenpsZQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIG1hcmsKICAgICAqLwogICAgZnVuY3Rpb24gbWFya0Z1bmN0aW9uKGZuKSB7CiAgICAgIGZuW2V4cGFuZG9dID0gdHJ1ZTsKICAgICAgcmV0dXJuIGZuOwogICAgfQoKICAgIC8qKgogICAgICogU3VwcG9ydCB0ZXN0aW5nIHVzaW5nIGFuIGVsZW1lbnQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBlbGVtZW50IGFuZCByZXR1cm5zIGEgYm9vbGVhbiByZXN1bHQKICAgICAqLwogICAgZnVuY3Rpb24gYXNzZXJ0KGZuKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZpZWxkc2V0Iik7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuICEhZm4oZWwpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIC8vIFJlbW92ZSBmcm9tIGl0cyBwYXJlbnQgYnkgZGVmYXVsdAogICAgICAgIGlmIChlbC5wYXJlbnROb2RlKSB7CiAgICAgICAgICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlbGVhc2UgbWVtb3J5IGluIElFCiAgICAgICAgZWwgPSBudWxsOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBzYW1lIGhhbmRsZXIgZm9yIGFsbCBvZiB0aGUgc3BlY2lmaWVkIGF0dHJzCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYXR0cnMgUGlwZS1zZXBhcmF0ZWQgbGlzdCBvZiBhdHRyaWJ1dGVzCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBtZXRob2QgdGhhdCB3aWxsIGJlIGFwcGxpZWQKICAgICAqLwogICAgZnVuY3Rpb24gYWRkSGFuZGxlKGF0dHJzLCBoYW5kbGVyKSB7CiAgICAgIHZhciBhcnIgPSBhdHRycy5zcGxpdCgifCIpLAogICAgICAgIGkgPSBhcnIubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgRXhwci5hdHRySGFuZGxlW2FycltpXV0gPSBoYW5kbGVyOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgZG9jdW1lbnQgb3JkZXIgb2YgdHdvIHNpYmxpbmdzCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGEKICAgICAqIEBwYXJhbSB7RWxlbWVudH0gYgogICAgICogQHJldHVybnMge051bWJlcn0gUmV0dXJucyBsZXNzIHRoYW4gMCBpZiBhIHByZWNlZGVzIGIsIGdyZWF0ZXIgdGhhbiAwIGlmIGEgZm9sbG93cyBiCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNpYmxpbmdDaGVjayhhLCBiKSB7CiAgICAgIHZhciBjdXIgPSBiICYmIGEsCiAgICAgICAgZGlmZiA9IGN1ciAmJiBhLm5vZGVUeXBlID09PSAxICYmIGIubm9kZVR5cGUgPT09IDEgJiYgYS5zb3VyY2VJbmRleCAtIGIuc291cmNlSW5kZXg7CgogICAgICAvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXMKICAgICAgaWYgKGRpZmYpIHsKICAgICAgICByZXR1cm4gZGlmZjsKICAgICAgfQoKICAgICAgLy8gQ2hlY2sgaWYgYiBmb2xsb3dzIGEKICAgICAgaWYgKGN1cikgewogICAgICAgIHdoaWxlIChjdXIgPSBjdXIubmV4dFNpYmxpbmcpIHsKICAgICAgICAgIGlmIChjdXIgPT09IGIpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYSA/IDEgOiAtMTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgaW5wdXQgdHlwZXMKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKHR5cGUpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSB0eXBlOwogICAgICB9OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8odHlwZSkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICB2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICByZXR1cm4gKG5hbWUgPT09ICJpbnB1dCIgfHwgbmFtZSA9PT0gImJ1dHRvbiIpICYmIGVsZW0udHlwZSA9PT0gdHlwZTsKICAgICAgfTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgOmVuYWJsZWQvOmRpc2FibGVkCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRpc2FibGVkIHRydWUgZm9yIDpkaXNhYmxlZDsgZmFsc2UgZm9yIDplbmFibGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZURpc2FibGVkUHNldWRvKGRpc2FibGVkKSB7CiAgICAgIC8vIEtub3duIDpkaXNhYmxlZCBmYWxzZSBwb3NpdGl2ZXM6IGZpZWxkc2V0W2Rpc2FibGVkXSA+IGxlZ2VuZDpudGgtb2YtdHlwZShuKzIpIDpjYW4tZGlzYWJsZQogICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAvLyBPbmx5IGNlcnRhaW4gZWxlbWVudHMgY2FuIG1hdGNoIDplbmFibGVkIG9yIDpkaXNhYmxlZAogICAgICAgIC8vIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL3NjcmlwdGluZy5odG1sI3NlbGVjdG9yLWVuYWJsZWQKICAgICAgICAvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9zY3JpcHRpbmcuaHRtbCNzZWxlY3Rvci1kaXNhYmxlZAogICAgICAgIGlmICgiZm9ybSIgaW4gZWxlbSkgewogICAgICAgICAgLy8gQ2hlY2sgZm9yIGluaGVyaXRlZCBkaXNhYmxlZG5lc3Mgb24gcmVsZXZhbnQgbm9uLWRpc2FibGVkIGVsZW1lbnRzOgogICAgICAgICAgLy8gKiBsaXN0ZWQgZm9ybS1hc3NvY2lhdGVkIGVsZW1lbnRzIGluIGEgZGlzYWJsZWQgZmllbGRzZXQKICAgICAgICAgIC8vICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCNjYXRlZ29yeS1saXN0ZWQKICAgICAgICAgIC8vICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCNjb25jZXB0LWZlLWRpc2FibGVkCiAgICAgICAgICAvLyAqIG9wdGlvbiBlbGVtZW50cyBpbiBhIGRpc2FibGVkIG9wdGdyb3VwCiAgICAgICAgICAvLyAgIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2Zvcm1zLmh0bWwjY29uY2VwdC1vcHRpb24tZGlzYWJsZWQKICAgICAgICAgIC8vIEFsbCBzdWNoIGVsZW1lbnRzIGhhdmUgYSAiZm9ybSIgcHJvcGVydHkuCiAgICAgICAgICBpZiAoZWxlbS5wYXJlbnROb2RlICYmIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIE9wdGlvbiBlbGVtZW50cyBkZWZlciB0byBhIHBhcmVudCBvcHRncm91cCBpZiBwcmVzZW50CiAgICAgICAgICAgIGlmICgibGFiZWwiIGluIGVsZW0pIHsKICAgICAgICAgICAgICBpZiAoImxhYmVsIiBpbiBlbGVtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnBhcmVudE5vZGUuZGlzYWJsZWQgPT09IGRpc2FibGVkOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZGlzYWJsZWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA2IC0gMTEKICAgICAgICAgICAgLy8gVXNlIHRoZSBpc0Rpc2FibGVkIHNob3J0Y3V0IHByb3BlcnR5IHRvIGNoZWNrIGZvciBkaXNhYmxlZCBmaWVsZHNldCBhbmNlc3RvcnMKICAgICAgICAgICAgcmV0dXJuIGVsZW0uaXNEaXNhYmxlZCA9PT0gZGlzYWJsZWQgfHwKICAgICAgICAgICAgLy8gV2hlcmUgdGhlcmUgaXMgbm8gaXNEaXNhYmxlZCwgY2hlY2sgbWFudWFsbHkKICAgICAgICAgICAgLyoganNoaW50IC1XMDE4ICovCiAgICAgICAgICAgIGVsZW0uaXNEaXNhYmxlZCAhPT0gIWRpc2FibGVkICYmIGluRGlzYWJsZWRGaWVsZHNldChlbGVtKSA9PT0gZGlzYWJsZWQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZGlzYWJsZWQ7CgogICAgICAgICAgLy8gVHJ5IHRvIHdpbm5vdyBvdXQgZWxlbWVudHMgdGhhdCBjYW4ndCBiZSBkaXNhYmxlZCBiZWZvcmUgdHJ1c3RpbmcgdGhlIGRpc2FibGVkIHByb3BlcnR5LgogICAgICAgICAgLy8gU29tZSB2aWN0aW1zIGdldCBjYXVnaHQgaW4gb3VyIG5ldCAobGFiZWwsIGxlZ2VuZCwgbWVudSwgdHJhY2spLCBidXQgaXQgc2hvdWxkbid0CiAgICAgICAgICAvLyBldmVuIGV4aXN0IG9uIHRoZW0sIGxldCBhbG9uZSBoYXZlIGEgYm9vbGVhbiB2YWx1ZS4KICAgICAgICB9IGVsc2UgaWYgKCJsYWJlbCIgaW4gZWxlbSkgewogICAgICAgICAgcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGRpc2FibGVkOwogICAgICAgIH0KCiAgICAgICAgLy8gUmVtYWluaW5nIGVsZW1lbnRzIGFyZSBuZWl0aGVyIDplbmFibGVkIG5vciA6ZGlzYWJsZWQKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIHBvc2l0aW9uYWxzCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZuKSB7CiAgICAgIHJldHVybiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKGFyZ3VtZW50KSB7CiAgICAgICAgYXJndW1lbnQgPSArYXJndW1lbnQ7CiAgICAgICAgcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcykgewogICAgICAgICAgdmFyIGosCiAgICAgICAgICAgIG1hdGNoSW5kZXhlcyA9IGZuKFtdLCBzZWVkLmxlbmd0aCwgYXJndW1lbnQpLAogICAgICAgICAgICBpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDsKCiAgICAgICAgICAvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgaWYgKHNlZWRbaiA9IG1hdGNoSW5kZXhlc1tpXV0pIHsKICAgICAgICAgICAgICBzZWVkW2pdID0gIShtYXRjaGVzW2pdID0gc2VlZFtqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVja3MgYSBub2RlIGZvciB2YWxpZGl0eSBhcyBhIFNpenpsZSBjb250ZXh0CiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0PX0gY29udGV4dAogICAgICogQHJldHVybnMge0VsZW1lbnR8T2JqZWN0fEJvb2xlYW59IFRoZSBpbnB1dCBub2RlIGlmIGFjY2VwdGFibGUsIG90aGVyd2lzZSBhIGZhbHN5IHZhbHVlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRlc3RDb250ZXh0KGNvbnRleHQpIHsKICAgICAgcmV0dXJuIGNvbnRleHQgJiYgdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgIT09ICJ1bmRlZmluZWQiICYmIGNvbnRleHQ7CiAgICB9CgogICAgLy8gRXhwb3NlIHN1cHBvcnQgdmFycyBmb3IgY29udmVuaWVuY2UKICAgIHN1cHBvcnQgPSBTaXp6bGUuc3VwcG9ydCA9IHt9OwoKICAgIC8qKgogICAgICogRGV0ZWN0cyBYTUwgbm9kZXMKICAgICAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IGVsZW0gQW4gZWxlbWVudCBvciBhIGRvY3VtZW50CiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZmYgZWxlbSBpcyBhIG5vbi1IVE1MIFhNTCBub2RlCiAgICAgKi8KICAgIGlzWE1MID0gU2l6emxlLmlzWE1MID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgdmFyIG5hbWVzcGFjZSA9IGVsZW0ubmFtZXNwYWNlVVJJLAogICAgICAgIGRvY0VsZW0gPSAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCiAgICAgIC8vIFN1cHBvcnQ6IElFIDw9OAogICAgICAvLyBBc3N1bWUgSFRNTCB3aGVuIGRvY3VtZW50RWxlbWVudCBkb2Vzbid0IHlldCBleGlzdCwgc3VjaCBhcyBpbnNpZGUgbG9hZGluZyBpZnJhbWVzCiAgICAgIC8vIGh0dHBzOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC80ODMzCiAgICAgIHJldHVybiAhcmh0bWwudGVzdChuYW1lc3BhY2UgfHwgZG9jRWxlbSAmJiBkb2NFbGVtLm5vZGVOYW1lIHx8ICJIVE1MIik7CiAgICB9OwoKICAgIC8qKgogICAgICogU2V0cyBkb2N1bWVudC1yZWxhdGVkIHZhcmlhYmxlcyBvbmNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50CiAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudAogICAgICovCiAgICBzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgIHZhciBoYXNDb21wYXJlLAogICAgICAgIHN1YldpbmRvdywKICAgICAgICBkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2M7CgogICAgICAvLyBSZXR1cm4gZWFybHkgaWYgZG9jIGlzIGludmFsaWQgb3IgYWxyZWFkeSBzZWxlY3RlZAogICAgICAvLyBTdXBwb3J0OiBJRSAxMSssIEVkZ2UgMTcgLSAxOCsKICAgICAgLy8gSUUvRWRnZSBzb21ldGltZXMgdGhyb3cgYSAiUGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gc3RyaWN0LWNvbXBhcmluZwogICAgICAvLyB0d28gZG9jdW1lbnRzOyBzaGFsbG93IGNvbXBhcmlzb25zIHdvcmsuCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcWVxZXEKICAgICAgaWYgKGRvYyA9PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQ7CiAgICAgIH0KCiAgICAgIC8vIFVwZGF0ZSBnbG9iYWwgdmFyaWFibGVzCiAgICAgIGRvY3VtZW50ID0gZG9jOwogICAgICBkb2NFbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICBkb2N1bWVudElzSFRNTCA9ICFpc1hNTChkb2N1bWVudCk7CgogICAgICAvLyBTdXBwb3J0OiBJRSA5IC0gMTErLCBFZGdlIDEyIC0gMTgrCiAgICAgIC8vIEFjY2Vzc2luZyBpZnJhbWUgZG9jdW1lbnRzIGFmdGVyIHVubG9hZCB0aHJvd3MgInBlcm1pc3Npb24gZGVuaWVkIiBlcnJvcnMgKGpRdWVyeSAjMTM5MzYpCiAgICAgIC8vIFN1cHBvcnQ6IElFIDExKywgRWRnZSAxNyAtIDE4KwogICAgICAvLyBJRS9FZGdlIHNvbWV0aW1lcyB0aHJvdyBhICJQZXJtaXNzaW9uIGRlbmllZCIgZXJyb3Igd2hlbiBzdHJpY3QtY29tcGFyaW5nCiAgICAgIC8vIHR3byBkb2N1bWVudHM7IHNoYWxsb3cgY29tcGFyaXNvbnMgd29yay4KICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVxZXFlcQogICAgICBpZiAocHJlZmVycmVkRG9jICE9IGRvY3VtZW50ICYmIChzdWJXaW5kb3cgPSBkb2N1bWVudC5kZWZhdWx0VmlldykgJiYgc3ViV2luZG93LnRvcCAhPT0gc3ViV2luZG93KSB7CiAgICAgICAgLy8gU3VwcG9ydDogSUUgMTEsIEVkZ2UKICAgICAgICBpZiAoc3ViV2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgIHN1YldpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLCB1bmxvYWRIYW5kbGVyLCBmYWxzZSk7CgogICAgICAgICAgLy8gU3VwcG9ydDogSUUgOSAtIDEwIG9ubHkKICAgICAgICB9IGVsc2UgaWYgKHN1YldpbmRvdy5hdHRhY2hFdmVudCkgewogICAgICAgICAgc3ViV2luZG93LmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsIHVubG9hZEhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU3VwcG9ydDogSUUgOCAtIDExKywgRWRnZSAxMiAtIDE4KywgQ2hyb21lIDw9MTYgLSAyNSBvbmx5LCBGaXJlZm94IDw9My42IC0gMzEgb25seSwKICAgICAgLy8gU2FmYXJpIDQgLSA1IG9ubHksIE9wZXJhIDw9MTEuNiAtIDEyLnggb25seQogICAgICAvLyBJRS9FZGdlICYgb2xkZXIgYnJvd3NlcnMgZG9uJ3Qgc3VwcG9ydCB0aGUgOnNjb3BlIHBzZXVkby1jbGFzcy4KICAgICAgLy8gU3VwcG9ydDogU2FmYXJpIDYuMCBvbmx5CiAgICAgIC8vIFNhZmFyaSA2LjAgc3VwcG9ydHMgOnNjb3BlIGJ1dCBpdCdzIGFuIGFsaWFzIG9mIDpyb290IHRoZXJlLgogICAgICBzdXBwb3J0LnNjb3BlID0gYXNzZXJ0KGZ1bmN0aW9uIChlbCkgewogICAgICAgIGRvY0VsZW0uYXBwZW5kQ2hpbGQoZWwpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTsKICAgICAgICByZXR1cm4gdHlwZW9mIGVsLnF1ZXJ5U2VsZWN0b3JBbGwgIT09ICJ1bmRlZmluZWQiICYmICFlbC5xdWVyeVNlbGVjdG9yQWxsKCI6c2NvcGUgZmllbGRzZXQgZGl2IikubGVuZ3RoOwogICAgICB9KTsKCiAgICAgIC8qIEF0dHJpYnV0ZXMKICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKICAgICAgLy8gU3VwcG9ydDogSUU8OAogICAgICAvLyBWZXJpZnkgdGhhdCBnZXRBdHRyaWJ1dGUgcmVhbGx5IHJldHVybnMgYXR0cmlidXRlcyBhbmQgbm90IHByb3BlcnRpZXMKICAgICAgLy8gKGV4Y2VwdGluZyBJRTggYm9vbGVhbnMpCiAgICAgIHN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgICBlbC5jbGFzc05hbWUgPSAiaSI7CiAgICAgICAgcmV0dXJuICFlbC5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpOwogICAgICB9KTsKCiAgICAgIC8qIGdldEVsZW1lbnQocylCeSoKICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKICAgICAgLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSByZXR1cm5zIG9ubHkgZWxlbWVudHMKICAgICAgc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgICBlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVDb21tZW50KCIiKSk7CiAgICAgICAgcmV0dXJuICFlbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKICAgICAgfSk7CgogICAgICAvLyBTdXBwb3J0OiBJRTw5CiAgICAgIHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKTsKCiAgICAgIC8vIFN1cHBvcnQ6IElFPDEwCiAgICAgIC8vIENoZWNrIGlmIGdldEVsZW1lbnRCeUlkIHJldHVybnMgZWxlbWVudHMgYnkgbmFtZQogICAgICAvLyBUaGUgYnJva2VuIGdldEVsZW1lbnRCeUlkIG1ldGhvZHMgZG9uJ3QgcGljayB1cCBwcm9ncmFtbWF0aWNhbGx5LXNldCBuYW1lcywKICAgICAgLy8gc28gdXNlIGEgcm91bmRhYm91dCBnZXRFbGVtZW50c0J5TmFtZSB0ZXN0CiAgICAgIHN1cHBvcnQuZ2V0QnlJZCA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgICBkb2NFbGVtLmFwcGVuZENoaWxkKGVsKS5pZCA9IGV4cGFuZG87CiAgICAgICAgcmV0dXJuICFkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSB8fCAhZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoZXhwYW5kbykubGVuZ3RoOwogICAgICB9KTsKCiAgICAgIC8vIElEIGZpbHRlciBhbmQgZmluZAogICAgICBpZiAoc3VwcG9ydC5nZXRCeUlkKSB7CiAgICAgICAgRXhwci5maWx0ZXJbIklEIl0gPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgIHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoImlkIikgPT09IGF0dHJJZDsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgICBFeHByLmZpbmRbIklEIl0gPSBmdW5jdGlvbiAoaWQsIGNvbnRleHQpIHsKICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gInVuZGVmaW5lZCIgJiYgZG9jdW1lbnRJc0hUTUwpIHsKICAgICAgICAgICAgdmFyIGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICAgICAgcmV0dXJuIGVsZW0gPyBbZWxlbV0gOiBbXTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIEV4cHIuZmlsdGVyWyJJRCJdID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICB2YXIgYXR0cklkID0gaWQucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSAidW5kZWZpbmVkIiAmJiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7CiAgICAgICAgICAgIHJldHVybiBub2RlICYmIG5vZGUudmFsdWUgPT09IGF0dHJJZDsKICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgLy8gU3VwcG9ydDogSUUgNiAtIDcgb25seQogICAgICAgIC8vIGdldEVsZW1lbnRCeUlkIGlzIG5vdCByZWxpYWJsZSBhcyBhIGZpbmQgc2hvcnRjdXQKICAgICAgICBFeHByLmZpbmRbIklEIl0gPSBmdW5jdGlvbiAoaWQsIGNvbnRleHQpIHsKICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gInVuZGVmaW5lZCIgJiYgZG9jdW1lbnRJc0hUTUwpIHsKICAgICAgICAgICAgdmFyIG5vZGUsCiAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICBlbGVtcywKICAgICAgICAgICAgICBlbGVtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICAgICAgICAgIGlmIChlbGVtKSB7CiAgICAgICAgICAgICAgLy8gVmVyaWZ5IHRoZSBpZCBhdHRyaWJ1dGUKICAgICAgICAgICAgICBub2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwogICAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUudmFsdWUgPT09IGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW2VsZW1dOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gRmFsbCBiYWNrIG9uIGdldEVsZW1lbnRzQnlOYW1lCiAgICAgICAgICAgICAgZWxlbXMgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlOYW1lKGlkKTsKICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICB3aGlsZSAoZWxlbSA9IGVsZW1zW2krK10pIHsKICAgICAgICAgICAgICAgIG5vZGUgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7CiAgICAgICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLnZhbHVlID09PSBpZCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gW2VsZW1dOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgLy8gVGFnCiAgICAgIEV4cHIuZmluZFsiVEFHIl0gPSBzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24gKHRhZywgY29udGV4dCkgewogICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZyk7CgogICAgICAgICAgLy8gRG9jdW1lbnRGcmFnbWVudCBub2RlcyBkb24ndCBoYXZlIGdFQlROCiAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LnFzYSkgewogICAgICAgICAgcmV0dXJuIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCh0YWcpOwogICAgICAgIH0KICAgICAgfSA6IGZ1bmN0aW9uICh0YWcsIGNvbnRleHQpIHsKICAgICAgICB2YXIgZWxlbSwKICAgICAgICAgIHRtcCA9IFtdLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICAvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vCiAgICAgICAgICByZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcpOwoKICAgICAgICAvLyBGaWx0ZXIgb3V0IHBvc3NpYmxlIGNvbW1lbnRzCiAgICAgICAgaWYgKHRhZyA9PT0gIioiKSB7CiAgICAgICAgICB3aGlsZSAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgewogICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHRtcC5wdXNoKGVsZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdG1wOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIENsYXNzCiAgICAgIEV4cHIuZmluZFsiQ0xBU1MiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiAoY2xhc3NOYW1lLCBjb250ZXh0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgIT09ICJ1bmRlZmluZWQiICYmIGRvY3VtZW50SXNIVE1MKSB7CiAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgLyogUVNBL21hdGNoZXNTZWxlY3RvcgogICAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgogICAgICAvLyBRU0EgYW5kIG1hdGNoZXNTZWxlY3RvciBzdXBwb3J0CgogICAgICAvLyBtYXRjaGVzU2VsZWN0b3IoOmFjdGl2ZSkgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKElFOS9PcGVyYSAxMS41KQogICAgICByYnVnZ3lNYXRjaGVzID0gW107CgogICAgICAvLyBxU2EoOmZvY3VzKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoQ2hyb21lIDIxKQogICAgICAvLyBXZSBhbGxvdyB0aGlzIGJlY2F1c2Ugb2YgYSBidWcgaW4gSUU4LzkgdGhhdCB0aHJvd3MgYW4gZXJyb3IKICAgICAgLy8gd2hlbmV2ZXIgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIGlzIGFjY2Vzc2VkIG9uIGFuIGlmcmFtZQogICAgICAvLyBTbywgd2UgYWxsb3cgOmZvY3VzIHRvIHBhc3MgdGhyb3VnaCBRU0EgYWxsIHRoZSB0aW1lIHRvIGF2b2lkIHRoZSBJRSBlcnJvcgogICAgICAvLyBTZWUgaHR0cHM6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEzMzc4CiAgICAgIHJidWdneVFTQSA9IFtdOwogICAgICBpZiAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCkpIHsKICAgICAgICAvLyBCdWlsZCBRU0EgcmVnZXgKICAgICAgICAvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pCiAgICAgICAgYXNzZXJ0KGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgdmFyIGlucHV0OwoKICAgICAgICAgIC8vIFNlbGVjdCBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIG9uIHB1cnBvc2UKICAgICAgICAgIC8vIFRoaXMgaXMgdG8gdGVzdCBJRSdzIHRyZWF0bWVudCBvZiBub3QgZXhwbGljaXRseQogICAgICAgICAgLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCiAgICAgICAgICAvLyBzaW5jZSBpdHMgcHJlc2VuY2Ugc2hvdWxkIGJlIGVub3VnaAogICAgICAgICAgLy8gaHR0cHM6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CiAgICAgICAgICBkb2NFbGVtLmFwcGVuZENoaWxkKGVsKS5pbm5lckhUTUwgPSAiPGEgaWQ9JyIgKyBleHBhbmRvICsgIic+PC9hPiIgKyAiPHNlbGVjdCBpZD0nIiArIGV4cGFuZG8gKyAiLVxyXFwnIG1zYWxsb3djYXB0dXJlPScnPiIgKyAiPG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOwoKICAgICAgICAgIC8vIFN1cHBvcnQ6IElFOCwgT3BlcmEgMTEtMTIuMTYKICAgICAgICAgIC8vIE5vdGhpbmcgc2hvdWxkIGJlIHNlbGVjdGVkIHdoZW4gZW1wdHkgc3RyaW5ncyBmb2xsb3cgXj0gb3IgJD0gb3IgKj0KICAgICAgICAgIC8vIFRoZSB0ZXN0IGF0dHJpYnV0ZSBtdXN0IGJlIHVua25vd24gaW4gT3BlcmEgYnV0ICJzYWZlIiBmb3IgV2luUlQKICAgICAgICAgIC8vIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvaGg0NjUzODguYXNweCNhdHRyaWJ1dGVfc2VjdGlvbgogICAgICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoIlttc2FsbG93Y2FwdHVyZV49JyddIikubGVuZ3RoKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCJbKl4kXT0iICsgd2hpdGVzcGFjZSArICIqKD86Jyd8XCJcIikiKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdXBwb3J0OiBJRTgKICAgICAgICAgIC8vIEJvb2xlYW4gYXR0cmlidXRlcyBhbmQgInZhbHVlIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CiAgICAgICAgICBpZiAoIWVsLnF1ZXJ5U2VsZWN0b3JBbGwoIltzZWxlY3RlZF0iKS5sZW5ndGgpIHsKICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goIlxcWyIgKyB3aGl0ZXNwYWNlICsgIiooPzp2YWx1ZXwiICsgYm9vbGVhbnMgKyAiKSIpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjQsIFNhZmFyaTw3LjArLCBpT1M8Ny4wKywgUGhhbnRvbUpTPDEuOS44KwogICAgICAgICAgaWYgKCFlbC5xdWVyeVNlbGVjdG9yQWxsKCJbaWR+PSIgKyBleHBhbmRvICsgIi1dIikubGVuZ3RoKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCJ+PSIpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDExKywgRWRnZSAxNSAtIDE4KwogICAgICAgICAgLy8gSUUgMTEvRWRnZSBkb24ndCBmaW5kIGVsZW1lbnRzIG9uIGEgYFtuYW1lPScnXWAgcXVlcnkgaW4gc29tZSBjYXNlcy4KICAgICAgICAgIC8vIEFkZGluZyBhIHRlbXBvcmFyeSBhdHRyaWJ1dGUgdG8gdGhlIGRvY3VtZW50IGJlZm9yZSB0aGUgc2VsZWN0aW9uIHdvcmtzCiAgICAgICAgICAvLyBhcm91bmQgdGhlIGlzc3VlLgogICAgICAgICAgLy8gSW50ZXJlc3RpbmdseSwgSUUgMTAgJiBvbGRlciBkb24ndCBzZWVtIHRvIGhhdmUgdGhlIGlzc3VlLgogICAgICAgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCJuYW1lIiwgIiIpOwogICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoaW5wdXQpOwogICAgICAgICAgaWYgKCFlbC5xdWVyeVNlbGVjdG9yQWxsKCJbbmFtZT0nJ10iKS5sZW5ndGgpIHsKICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goIlxcWyIgKyB3aGl0ZXNwYWNlICsgIipuYW1lIiArIHdoaXRlc3BhY2UgKyAiKj0iICsgd2hpdGVzcGFjZSArICIqKD86Jyd8XCJcIikiKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBXZWJraXQvT3BlcmEgLSA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIHNlbGVjdGVkIG9wdGlvbiBlbGVtZW50cwogICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWQKICAgICAgICAgIC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCiAgICAgICAgICBpZiAoIWVsLnF1ZXJ5U2VsZWN0b3JBbGwoIjpjaGVja2VkIikubGVuZ3RoKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCI6Y2hlY2tlZCIpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFN1cHBvcnQ6IFNhZmFyaSA4KywgaU9TIDgrCiAgICAgICAgICAvLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTM2ODUxCiAgICAgICAgICAvLyBJbi1wYWdlIGBzZWxlY3RvciNpZCBzaWJsaW5nLWNvbWJpbmF0b3Igc2VsZWN0b3JgIGZhaWxzCiAgICAgICAgICBpZiAoIWVsLnF1ZXJ5U2VsZWN0b3JBbGwoImEjIiArIGV4cGFuZG8gKyAiKyoiKS5sZW5ndGgpIHsKICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goIi4jLitbK35dIik7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gU3VwcG9ydDogRmlyZWZveCA8PTMuNiAtIDUgb25seQogICAgICAgICAgLy8gT2xkIEZpcmVmb3ggZG9lc24ndCB0aHJvdyBvbiBhIGJhZGx5LWVzY2FwZWQgaWRlbnRpZmllci4KICAgICAgICAgIGVsLnF1ZXJ5U2VsZWN0b3JBbGwoIlxcXGYiKTsKICAgICAgICAgIHJidWdneVFTQS5wdXNoKCJbXFxyXFxuXFxmXSIpOwogICAgICAgIH0pOwogICAgICAgIGFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgIGVsLmlubmVySFRNTCA9ICI8YSBocmVmPScnIGRpc2FibGVkPSdkaXNhYmxlZCc+PC9hPiIgKyAiPHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PiI7CgogICAgICAgICAgLy8gU3VwcG9ydDogV2luZG93cyA4IE5hdGl2ZSBBcHBzCiAgICAgICAgICAvLyBUaGUgdHlwZSBhbmQgbmFtZSBhdHRyaWJ1dGVzIGFyZSByZXN0cmljdGVkIGR1cmluZyAuaW5uZXJIVE1MIGFzc2lnbm1lbnQKICAgICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAiaGlkZGVuIik7CiAgICAgICAgICBlbC5hcHBlbmRDaGlsZChpbnB1dCkuc2V0QXR0cmlidXRlKCJuYW1lIiwgIkQiKTsKCiAgICAgICAgICAvLyBTdXBwb3J0OiBJRTgKICAgICAgICAgIC8vIEVuZm9yY2UgY2FzZS1zZW5zaXRpdml0eSBvZiBuYW1lIGF0dHJpYnV0ZQogICAgICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCJuYW1lIiArIHdoaXRlc3BhY2UgKyAiKlsqXiR8IX5dPz0iKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBGRiAzLjUgLSA6ZW5hYmxlZC86ZGlzYWJsZWQgYW5kIGhpZGRlbiBlbGVtZW50cyAoaGlkZGVuIGVsZW1lbnRzIGFyZSBzdGlsbCBlbmFibGVkKQogICAgICAgICAgLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKICAgICAgICAgIGlmIChlbC5xdWVyeVNlbGVjdG9yQWxsKCI6ZW5hYmxlZCIpLmxlbmd0aCAhPT0gMikgewogICAgICAgICAgICByYnVnZ3lRU0EucHVzaCgiOmVuYWJsZWQiLCAiOmRpc2FibGVkIik7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gU3VwcG9ydDogSUU5LTExKwogICAgICAgICAgLy8gSUUncyA6ZGlzYWJsZWQgc2VsZWN0b3IgZG9lcyBub3QgcGljayB1cCB0aGUgY2hpbGRyZW4gb2YgZGlzYWJsZWQgZmllbGRzZXRzCiAgICAgICAgICBkb2NFbGVtLmFwcGVuZENoaWxkKGVsKS5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICBpZiAoZWwucXVlcnlTZWxlY3RvckFsbCgiOmRpc2FibGVkIikubGVuZ3RoICE9PSAyKSB7CiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKCI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdXBwb3J0OiBPcGVyYSAxMCAtIDExIG9ubHkKICAgICAgICAgIC8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCiAgICAgICAgICBlbC5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CiAgICAgICAgICByYnVnZ3lRU0EucHVzaCgiLC4qOiIpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciA9IHJuYXRpdmUudGVzdChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8IGRvY0VsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fCBkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSkgewogICAgICAgIGFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgogICAgICAgICAgLy8gb24gYSBkaXNjb25uZWN0ZWQgbm9kZSAoSUUgOSkKICAgICAgICAgIHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggPSBtYXRjaGVzLmNhbGwoZWwsICIqIik7CgogICAgICAgICAgLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvbgogICAgICAgICAgLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZAogICAgICAgICAgbWF0Y2hlcy5jYWxsKGVsLCAiW3MhPScnXTp4Iik7CiAgICAgICAgICByYnVnZ3lNYXRjaGVzLnB1c2goIiE9IiwgcHNldWRvcyk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmJ1Z2d5UVNBID0gcmJ1Z2d5UVNBLmxlbmd0aCAmJiBuZXcgUmVnRXhwKHJidWdneVFTQS5qb2luKCJ8IikpOwogICAgICByYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cChyYnVnZ3lNYXRjaGVzLmpvaW4oInwiKSk7CgogICAgICAvKiBDb250YWlucwogICAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCiAgICAgIGhhc0NvbXBhcmUgPSBybmF0aXZlLnRlc3QoZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbik7CgogICAgICAvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXIKICAgICAgLy8gUHVycG9zZWZ1bGx5IHNlbGYtZXhjbHVzaXZlCiAgICAgIC8vIEFzIGluLCBhbiBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gaXRzZWxmCiAgICAgIGNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoZG9jRWxlbS5jb250YWlucykgPyBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCiAgICAgICAgICBidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKICAgICAgICByZXR1cm4gYSA9PT0gYnVwIHx8ICEhKGJ1cCAmJiBidXAubm9kZVR5cGUgPT09IDEgJiYgKGFkb3duLmNvbnRhaW5zID8gYWRvd24uY29udGFpbnMoYnVwKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihidXApICYgMTYpKTsKICAgICAgfSA6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGIpIHsKICAgICAgICAgIHdoaWxlIChiID0gYi5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGlmIChiID09PSBhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9OwoKICAgICAgLyogU29ydGluZwogICAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgogICAgICAvLyBEb2N1bWVudCBvcmRlciBzb3J0aW5nCiAgICAgIHNvcnRPcmRlciA9IGhhc0NvbXBhcmUgPyBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIC8vIEZsYWcgZm9yIGR1cGxpY2F0ZSByZW1vdmFsCiAgICAgICAgaWYgKGEgPT09IGIpIHsKICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIFNvcnQgb24gbWV0aG9kIGV4aXN0ZW5jZSBpZiBvbmx5IG9uZSBpbnB1dCBoYXMgY29tcGFyZURvY3VtZW50UG9zaXRpb24KICAgICAgICB2YXIgY29tcGFyZSA9ICFhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uIC0gIWIuY29tcGFyZURvY3VtZW50UG9zaXRpb247CiAgICAgICAgaWYgKGNvbXBhcmUpIHsKICAgICAgICAgIHJldHVybiBjb21wYXJlOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIGlmIGJvdGggaW5wdXRzIGJlbG9uZyB0byB0aGUgc2FtZSBkb2N1bWVudAogICAgICAgIC8vIFN1cHBvcnQ6IElFIDExKywgRWRnZSAxNyAtIDE4KwogICAgICAgIC8vIElFL0VkZ2Ugc29tZXRpbWVzIHRocm93IGEgIlBlcm1pc3Npb24gZGVuaWVkIiBlcnJvciB3aGVuIHN0cmljdC1jb21wYXJpbmcKICAgICAgICAvLyB0d28gZG9jdW1lbnRzOyBzaGFsbG93IGNvbXBhcmlzb25zIHdvcmsuCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVxZXFlcQogICAgICAgIGNvbXBhcmUgPSAoYS5vd25lckRvY3VtZW50IHx8IGEpID09IChiLm93bmVyRG9jdW1lbnQgfHwgYikgPyBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpIDoKICAgICAgICAvLyBPdGhlcndpc2Ugd2Uga25vdyB0aGV5IGFyZSBkaXNjb25uZWN0ZWQKICAgICAgICAxOwoKICAgICAgICAvLyBEaXNjb25uZWN0ZWQgbm9kZXMKICAgICAgICBpZiAoY29tcGFyZSAmIDEgfHwgIXN1cHBvcnQuc29ydERldGFjaGVkICYmIGIuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYSkgPT09IGNvbXBhcmUpIHsKICAgICAgICAgIC8vIENob29zZSB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IGlzIHJlbGF0ZWQgdG8gb3VyIHByZWZlcnJlZCBkb2N1bWVudAogICAgICAgICAgLy8gU3VwcG9ydDogSUUgMTErLCBFZGdlIDE3IC0gMTgrCiAgICAgICAgICAvLyBJRS9FZGdlIHNvbWV0aW1lcyB0aHJvdyBhICJQZXJtaXNzaW9uIGRlbmllZCIgZXJyb3Igd2hlbiBzdHJpY3QtY29tcGFyaW5nCiAgICAgICAgICAvLyB0d28gZG9jdW1lbnRzOyBzaGFsbG93IGNvbXBhcmlzb25zIHdvcmsuCiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXFlcWVxCiAgICAgICAgICBpZiAoYSA9PSBkb2N1bWVudCB8fCBhLm93bmVyRG9jdW1lbnQgPT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYSkpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDExKywgRWRnZSAxNyAtIDE4KwogICAgICAgICAgLy8gSUUvRWRnZSBzb21ldGltZXMgdGhyb3cgYSAiUGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gc3RyaWN0LWNvbXBhcmluZwogICAgICAgICAgLy8gdHdvIGRvY3VtZW50czsgc2hhbGxvdyBjb21wYXJpc29ucyB3b3JrLgogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVxZXFlcQogICAgICAgICAgaWYgKGIgPT0gZG9jdW1lbnQgfHwgYi5vd25lckRvY3VtZW50ID09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGIpKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIE1haW50YWluIG9yaWdpbmFsIG9yZGVyCiAgICAgICAgICByZXR1cm4gc29ydElucHV0ID8gaW5kZXhPZihzb3J0SW5wdXQsIGEpIC0gaW5kZXhPZihzb3J0SW5wdXQsIGIpIDogMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwogICAgICB9IDogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAvLyBFeGl0IGVhcmx5IGlmIHRoZSBub2RlcyBhcmUgaWRlbnRpY2FsCiAgICAgICAgaWYgKGEgPT09IGIpIHsKICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdmFyIGN1ciwKICAgICAgICAgIGkgPSAwLAogICAgICAgICAgYXVwID0gYS5wYXJlbnROb2RlLAogICAgICAgICAgYnVwID0gYi5wYXJlbnROb2RlLAogICAgICAgICAgYXAgPSBbYV0sCiAgICAgICAgICBicCA9IFtiXTsKCiAgICAgICAgLy8gUGFyZW50bGVzcyBub2RlcyBhcmUgZWl0aGVyIGRvY3VtZW50cyBvciBkaXNjb25uZWN0ZWQKICAgICAgICBpZiAoIWF1cCB8fCAhYnVwKSB7CiAgICAgICAgICAvLyBTdXBwb3J0OiBJRSAxMSssIEVkZ2UgMTcgLSAxOCsKICAgICAgICAgIC8vIElFL0VkZ2Ugc29tZXRpbWVzIHRocm93IGEgIlBlcm1pc3Npb24gZGVuaWVkIiBlcnJvciB3aGVuIHN0cmljdC1jb21wYXJpbmcKICAgICAgICAgIC8vIHR3byBkb2N1bWVudHM7IHNoYWxsb3cgY29tcGFyaXNvbnMgd29yay4KICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIGVxZXFlcSAqLwogICAgICAgICAgcmV0dXJuIGEgPT0gZG9jdW1lbnQgPyAtMSA6IGIgPT0gZG9jdW1lbnQgPyAxIDogLyogZXNsaW50LWVuYWJsZSBlcWVxZXEgKi8KICAgICAgICAgIGF1cCA/IC0xIDogYnVwID8gMSA6IHNvcnRJbnB1dCA/IGluZGV4T2Yoc29ydElucHV0LCBhKSAtIGluZGV4T2Yoc29ydElucHV0LCBiKSA6IDA7CgogICAgICAgICAgLy8gSWYgdGhlIG5vZGVzIGFyZSBzaWJsaW5ncywgd2UgY2FuIGRvIGEgcXVpY2sgY2hlY2sKICAgICAgICB9IGVsc2UgaWYgKGF1cCA9PT0gYnVwKSB7CiAgICAgICAgICByZXR1cm4gc2libGluZ0NoZWNrKGEsIGIpOwogICAgICAgIH0KCiAgICAgICAgLy8gT3RoZXJ3aXNlIHdlIG5lZWQgZnVsbCBsaXN0cyBvZiB0aGVpciBhbmNlc3RvcnMgZm9yIGNvbXBhcmlzb24KICAgICAgICBjdXIgPSBhOwogICAgICAgIHdoaWxlIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgewogICAgICAgICAgYXAudW5zaGlmdChjdXIpOwogICAgICAgIH0KICAgICAgICBjdXIgPSBiOwogICAgICAgIHdoaWxlIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgewogICAgICAgICAgYnAudW5zaGlmdChjdXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gV2FsayBkb3duIHRoZSB0cmVlIGxvb2tpbmcgZm9yIGEgZGlzY3JlcGFuY3kKICAgICAgICB3aGlsZSAoYXBbaV0gPT09IGJwW2ldKSB7CiAgICAgICAgICBpKys7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpID8KICAgICAgICAvLyBEbyBhIHNpYmxpbmcgY2hlY2sgaWYgdGhlIG5vZGVzIGhhdmUgYSBjb21tb24gYW5jZXN0b3IKICAgICAgICBzaWJsaW5nQ2hlY2soYXBbaV0sIGJwW2ldKSA6CiAgICAgICAgLy8gT3RoZXJ3aXNlIG5vZGVzIGluIG91ciBkb2N1bWVudCBzb3J0IGZpcnN0CiAgICAgICAgLy8gU3VwcG9ydDogSUUgMTErLCBFZGdlIDE3IC0gMTgrCiAgICAgICAgLy8gSUUvRWRnZSBzb21ldGltZXMgdGhyb3cgYSAiUGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gc3RyaWN0LWNvbXBhcmluZwogICAgICAgIC8vIHR3byBkb2N1bWVudHM7IHNoYWxsb3cgY29tcGFyaXNvbnMgd29yay4KICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBlcWVxZXEgKi8KICAgICAgICBhcFtpXSA9PSBwcmVmZXJyZWREb2MgPyAtMSA6IGJwW2ldID09IHByZWZlcnJlZERvYyA/IDEgOiAvKiBlc2xpbnQtZW5hYmxlIGVxZXFlcSAqLwogICAgICAgIDA7CiAgICAgIH07CiAgICAgIHJldHVybiBkb2N1bWVudDsKICAgIH07CiAgICBTaXp6bGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChleHByLCBlbGVtZW50cykgewogICAgICByZXR1cm4gU2l6emxlKGV4cHIsIG51bGwsIG51bGwsIGVsZW1lbnRzKTsKICAgIH07CiAgICBTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24gKGVsZW0sIGV4cHIpIHsKICAgICAgc2V0RG9jdW1lbnQoZWxlbSk7CiAgICAgIGlmIChzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiBkb2N1bWVudElzSFRNTCAmJiAhbm9ubmF0aXZlU2VsZWN0b3JDYWNoZVtleHByICsgIiAiXSAmJiAoIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdChleHByKSkgJiYgKCFyYnVnZ3lRU0EgfHwgIXJidWdneVFTQS50ZXN0KGV4cHIpKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgcmV0ID0gbWF0Y2hlcy5jYWxsKGVsZW0sIGV4cHIpOwoKICAgICAgICAgIC8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKICAgICAgICAgIGlmIChyZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fAogICAgICAgICAgLy8gQXMgd2VsbCwgZGlzY29ubmVjdGVkIG5vZGVzIGFyZSBzYWlkIHRvIGJlIGluIGEgZG9jdW1lbnQKICAgICAgICAgIC8vIGZyYWdtZW50IGluIElFIDkKICAgICAgICAgIGVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEpIHsKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBub25uYXRpdmVTZWxlY3RvckNhY2hlKGV4cHIsIHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gU2l6emxlKGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0pLmxlbmd0aCA+IDA7CiAgICB9OwogICAgU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24gKGNvbnRleHQsIGVsZW0pIHsKICAgICAgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCiAgICAgIC8vIFN1cHBvcnQ6IElFIDExKywgRWRnZSAxNyAtIDE4KwogICAgICAvLyBJRS9FZGdlIHNvbWV0aW1lcyB0aHJvdyBhICJQZXJtaXNzaW9uIGRlbmllZCIgZXJyb3Igd2hlbiBzdHJpY3QtY29tcGFyaW5nCiAgICAgIC8vIHR3byBkb2N1bWVudHM7IHNoYWxsb3cgY29tcGFyaXNvbnMgd29yay4KICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVxZXFlcQogICAgICBpZiAoKGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0KSAhPSBkb2N1bWVudCkgewogICAgICAgIHNldERvY3VtZW50KGNvbnRleHQpOwogICAgICB9CiAgICAgIHJldHVybiBjb250YWlucyhjb250ZXh0LCBlbGVtKTsKICAgIH07CiAgICBTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uIChlbGVtLCBuYW1lKSB7CiAgICAgIC8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAogICAgICAvLyBTdXBwb3J0OiBJRSAxMSssIEVkZ2UgMTcgLSAxOCsKICAgICAgLy8gSUUvRWRnZSBzb21ldGltZXMgdGhyb3cgYSAiUGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gc3RyaWN0LWNvbXBhcmluZwogICAgICAvLyB0d28gZG9jdW1lbnRzOyBzaGFsbG93IGNvbXBhcmlzb25zIHdvcmsuCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBlcWVxZXEKICAgICAgaWYgKChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSkgIT0gZG9jdW1lbnQpIHsKICAgICAgICBzZXREb2N1bWVudChlbGVtKTsKICAgICAgfQogICAgICB2YXIgZm4gPSBFeHByLmF0dHJIYW5kbGVbbmFtZS50b0xvd2VyQ2FzZSgpXSwKICAgICAgICAvLyBEb24ndCBnZXQgZm9vbGVkIGJ5IE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoalF1ZXJ5ICMxMzgwNykKICAgICAgICB2YWwgPSBmbiAmJiBoYXNPd24uY2FsbChFeHByLmF0dHJIYW5kbGUsIG5hbWUudG9Mb3dlckNhc2UoKSkgPyBmbihlbGVtLCBuYW1lLCAhZG9jdW1lbnRJc0hUTUwpIDogdW5kZWZpbmVkOwogICAgICByZXR1cm4gdmFsICE9PSB1bmRlZmluZWQgPyB2YWwgOiBzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWRvY3VtZW50SXNIVE1MID8gZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSkgOiAodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8gdmFsLnZhbHVlIDogbnVsbDsKICAgIH07CiAgICBTaXp6bGUuZXNjYXBlID0gZnVuY3Rpb24gKHNlbCkgewogICAgICByZXR1cm4gKHNlbCArICIiKS5yZXBsYWNlKHJjc3Nlc2NhcGUsIGZjc3Nlc2NhcGUpOwogICAgfTsKICAgIFNpenpsZS5lcnJvciA9IGZ1bmN0aW9uIChtc2cpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsgbXNnKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzCiAgICAgKiBAcGFyYW0ge0FycmF5TGlrZX0gcmVzdWx0cwogICAgICovCiAgICBTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7CiAgICAgIHZhciBlbGVtLAogICAgICAgIGR1cGxpY2F0ZXMgPSBbXSwKICAgICAgICBqID0gMCwKICAgICAgICBpID0gMDsKCiAgICAgIC8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKICAgICAgaGFzRHVwbGljYXRlID0gIXN1cHBvcnQuZGV0ZWN0RHVwbGljYXRlczsKICAgICAgc29ydElucHV0ID0gIXN1cHBvcnQuc29ydFN0YWJsZSAmJiByZXN1bHRzLnNsaWNlKDApOwogICAgICByZXN1bHRzLnNvcnQoc29ydE9yZGVyKTsKICAgICAgaWYgKGhhc0R1cGxpY2F0ZSkgewogICAgICAgIHdoaWxlIChlbGVtID0gcmVzdWx0c1tpKytdKSB7CiAgICAgICAgICBpZiAoZWxlbSA9PT0gcmVzdWx0c1tpXSkgewogICAgICAgICAgICBqID0gZHVwbGljYXRlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgICByZXN1bHRzLnNwbGljZShkdXBsaWNhdGVzW2pdLCAxKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIENsZWFyIGlucHV0IGFmdGVyIHNvcnRpbmcgdG8gcmVsZWFzZSBvYmplY3RzCiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L3NpenpsZS9wdWxsLzIyNQogICAgICBzb3J0SW5wdXQgPSBudWxsOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH07CgogICAgLyoqCiAgICAgKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwogICAgICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtCiAgICAgKi8KICAgIGdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgIHZhciBub2RlLAogICAgICAgIHJldCA9ICIiLAogICAgICAgIGkgPSAwLAogICAgICAgIG5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTsKICAgICAgaWYgKCFub2RlVHlwZSkgewogICAgICAgIC8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CiAgICAgICAgd2hpbGUgKG5vZGUgPSBlbGVtW2krK10pIHsKICAgICAgICAgIC8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCiAgICAgICAgICByZXQgKz0gZ2V0VGV4dChub2RlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExKSB7CiAgICAgICAgLy8gVXNlIHRleHRDb250ZW50IGZvciBlbGVtZW50cwogICAgICAgIC8vIGlubmVyVGV4dCB1c2FnZSByZW1vdmVkIGZvciBjb25zaXN0ZW5jeSBvZiBuZXcgbGluZXMgKGpRdWVyeSAjMTExNTMpCiAgICAgICAgaWYgKHR5cGVvZiBlbGVtLnRleHRDb250ZW50ID09PSAic3RyaW5nIikgewogICAgICAgICAgcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFRyYXZlcnNlIGl0cyBjaGlsZHJlbgogICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykgewogICAgICAgICAgICByZXQgKz0gZ2V0VGV4dChlbGVtKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQpIHsKICAgICAgICByZXR1cm4gZWxlbS5ub2RlVmFsdWU7CiAgICAgIH0KCiAgICAgIC8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2RlcwoKICAgICAgcmV0dXJuIHJldDsKICAgIH07CiAgICBFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsKICAgICAgLy8gQ2FuIGJlIGFkanVzdGVkIGJ5IHRoZSB1c2VyCiAgICAgIGNhY2hlTGVuZ3RoOiA1MCwKICAgICAgY3JlYXRlUHNldWRvOiBtYXJrRnVuY3Rpb24sCiAgICAgIG1hdGNoOiBtYXRjaEV4cHIsCiAgICAgIGF0dHJIYW5kbGU6IHt9LAogICAgICBmaW5kOiB7fSwKICAgICAgcmVsYXRpdmU6IHsKICAgICAgICAiPiI6IHsKICAgICAgICAgIGRpcjogInBhcmVudE5vZGUiLAogICAgICAgICAgZmlyc3Q6IHRydWUKICAgICAgICB9LAogICAgICAgICIgIjogewogICAgICAgICAgZGlyOiAicGFyZW50Tm9kZSIKICAgICAgICB9LAogICAgICAgICIrIjogewogICAgICAgICAgZGlyOiAicHJldmlvdXNTaWJsaW5nIiwKICAgICAgICAgIGZpcnN0OiB0cnVlCiAgICAgICAgfSwKICAgICAgICAifiI6IHsKICAgICAgICAgIGRpcjogInByZXZpb3VzU2libGluZyIKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByZUZpbHRlcjogewogICAgICAgICJBVFRSIjogZnVuY3Rpb24gQVRUUihtYXRjaCkgewogICAgICAgICAgbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTsKCiAgICAgICAgICAvLyBNb3ZlIHRoZSBnaXZlbiB2YWx1ZSB0byBtYXRjaFszXSB3aGV0aGVyIHF1b3RlZCBvciB1bnF1b3RlZAogICAgICAgICAgbWF0Y2hbM10gPSAobWF0Y2hbM10gfHwgbWF0Y2hbNF0gfHwgbWF0Y2hbNV0gfHwgIiIpLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpOwogICAgICAgICAgaWYgKG1hdGNoWzJdID09PSAifj0iKSB7CiAgICAgICAgICAgIG1hdGNoWzNdID0gIiAiICsgbWF0Y2hbM10gKyAiICI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWF0Y2guc2xpY2UoMCwgNCk7CiAgICAgICAgfSwKICAgICAgICAiQ0hJTEQiOiBmdW5jdGlvbiBDSElMRChtYXRjaCkgewogICAgICAgICAgLyogbWF0Y2hlcyBmcm9tIG1hdGNoRXhwclsiQ0hJTEQiXQogICAgICAgICAgMSB0eXBlIChvbmx5fG50aHwuLi4pCiAgICAgICAgICAyIHdoYXQgKGNoaWxkfG9mLXR5cGUpCiAgICAgICAgICAzIGFyZ3VtZW50IChldmVufG9kZHxcZCp8XGQqbihbKy1dXGQrKT98Li4uKQogICAgICAgICAgNCB4bi1jb21wb25lbnQgb2YgeG4reSBhcmd1bWVudCAoWystXT9cZCpufCkKICAgICAgICAgIDUgc2lnbiBvZiB4bi1jb21wb25lbnQKICAgICAgICAgIDYgeCBvZiB4bi1jb21wb25lbnQKICAgICAgICAgIDcgc2lnbiBvZiB5LWNvbXBvbmVudAogICAgICAgICAgOCB5IG9mIHktY29tcG9uZW50CiAgICAgICAgICAqLwogICAgICAgICAgbWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgaWYgKG1hdGNoWzFdLnNsaWNlKDAsIDMpID09PSAibnRoIikgewogICAgICAgICAgICAvLyBudGgtKiByZXF1aXJlcyBhcmd1bWVudAogICAgICAgICAgICBpZiAoIW1hdGNoWzNdKSB7CiAgICAgICAgICAgICAgU2l6emxlLmVycm9yKG1hdGNoWzBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gbnVtZXJpYyB4IGFuZCB5IHBhcmFtZXRlcnMgZm9yIEV4cHIuZmlsdGVyLkNISUxECiAgICAgICAgICAgIC8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKICAgICAgICAgICAgbWF0Y2hbNF0gPSArKG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKG1hdGNoWzNdID09PSAiZXZlbiIgfHwgbWF0Y2hbM10gPT09ICJvZGQiKSk7CiAgICAgICAgICAgIG1hdGNoWzVdID0gKyhtYXRjaFs3XSArIG1hdGNoWzhdIHx8IG1hdGNoWzNdID09PSAib2RkIik7CgogICAgICAgICAgICAvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hbM10pIHsKICAgICAgICAgICAgU2l6emxlLmVycm9yKG1hdGNoWzBdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtYXRjaDsKICAgICAgICB9LAogICAgICAgICJQU0VVRE8iOiBmdW5jdGlvbiBQU0VVRE8obWF0Y2gpIHsKICAgICAgICAgIHZhciBleGNlc3MsCiAgICAgICAgICAgIHVucXVvdGVkID0gIW1hdGNoWzZdICYmIG1hdGNoWzJdOwogICAgICAgICAgaWYgKG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KG1hdGNoWzBdKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pcwogICAgICAgICAgaWYgKG1hdGNoWzNdKSB7CiAgICAgICAgICAgIG1hdGNoWzJdID0gbWF0Y2hbNF0gfHwgbWF0Y2hbNV0gfHwgIiI7CgogICAgICAgICAgICAvLyBTdHJpcCBleGNlc3MgY2hhcmFjdGVycyBmcm9tIHVucXVvdGVkIGFyZ3VtZW50cwogICAgICAgICAgfSBlbHNlIGlmICh1bnF1b3RlZCAmJiBycHNldWRvLnRlc3QodW5xdW90ZWQpICYmICgKICAgICAgICAgIC8vIEdldCBleGNlc3MgZnJvbSB0b2tlbml6ZSAocmVjdXJzaXZlbHkpCiAgICAgICAgICBleGNlc3MgPSB0b2tlbml6ZSh1bnF1b3RlZCwgdHJ1ZSkpICYmICgKICAgICAgICAgIC8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpcwogICAgICAgICAgZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZigiKSIsIHVucXVvdGVkLmxlbmd0aCAtIGV4Y2VzcykgLSB1bnF1b3RlZC5sZW5ndGgpKSB7CiAgICAgICAgICAgIC8vIGV4Y2VzcyBpcyBhIG5lZ2F0aXZlIGluZGV4CiAgICAgICAgICAgIG1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoMCwgZXhjZXNzKTsKICAgICAgICAgICAgbWF0Y2hbMl0gPSB1bnF1b3RlZC5zbGljZSgwLCBleGNlc3MpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQogICAgICAgICAgcmV0dXJuIG1hdGNoLnNsaWNlKDAsIDMpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZmlsdGVyOiB7CiAgICAgICAgIlRBRyI6IGZ1bmN0aW9uIFRBRyhub2RlTmFtZVNlbGVjdG9yKSB7CiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gbm9kZU5hbWVTZWxlY3RvciA9PT0gIioiID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gOiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGVOYW1lOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgICJDTEFTUyI6IGZ1bmN0aW9uIENMQVNTKGNsYXNzTmFtZSkgewogICAgICAgICAgdmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlW2NsYXNzTmFtZSArICIgIl07CiAgICAgICAgICByZXR1cm4gcGF0dGVybiB8fCAocGF0dGVybiA9IG5ldyBSZWdFeHAoIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiKSkgJiYgY2xhc3NDYWNoZShjbGFzc05hbWUsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgIHJldHVybiBwYXR0ZXJuLnRlc3QodHlwZW9mIGVsZW0uY2xhc3NOYW1lID09PSAic3RyaW5nIiAmJiBlbGVtLmNsYXNzTmFtZSB8fCB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09ICJ1bmRlZmluZWQiICYmIGVsZW0uZ2V0QXR0cmlidXRlKCJjbGFzcyIpIHx8ICIiKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgIkFUVFIiOiBmdW5jdGlvbiBBVFRSKG5hbWUsIG9wZXJhdG9yLCBjaGVjaykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBTaXp6bGUuYXR0cihlbGVtLCBuYW1lKTsKICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG9wZXJhdG9yID09PSAiIT0iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghb3BlcmF0b3IpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXN1bHQgKz0gIiI7CgogICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovCgogICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09ICI9IiA/IHJlc3VsdCA9PT0gY2hlY2sgOiBvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOiBvcGVyYXRvciA9PT0gIl49IiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKGNoZWNrKSA9PT0gMCA6IG9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoY2hlY2spID4gLTEgOiBvcGVyYXRvciA9PT0gIiQ9IiA/IGNoZWNrICYmIHJlc3VsdC5zbGljZSgtY2hlY2subGVuZ3RoKSA9PT0gY2hlY2sgOiBvcGVyYXRvciA9PT0gIn49IiA/ICgiICIgKyByZXN1bHQucmVwbGFjZShyd2hpdGVzcGFjZSwgIiAiKSArICIgIikuaW5kZXhPZihjaGVjaykgPiAtMSA6IG9wZXJhdG9yID09PSAifD0iID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoMCwgY2hlY2subGVuZ3RoICsgMSkgPT09IGNoZWNrICsgIi0iIDogZmFsc2U7CiAgICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqLwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICAiQ0hJTEQiOiBmdW5jdGlvbiBDSElMRCh0eXBlLCB3aGF0LCBfYXJndW1lbnQsIGZpcnN0LCBsYXN0KSB7CiAgICAgICAgICB2YXIgc2ltcGxlID0gdHlwZS5zbGljZSgwLCAzKSAhPT0gIm50aCIsCiAgICAgICAgICAgIGZvcndhcmQgPSB0eXBlLnNsaWNlKC00KSAhPT0gImxhc3QiLAogICAgICAgICAgICBvZlR5cGUgPSB3aGF0ID09PSAib2YtdHlwZSI7CiAgICAgICAgICByZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/CiAgICAgICAgICAvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pCiAgICAgICAgICBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7CiAgICAgICAgICB9IDogZnVuY3Rpb24gKGVsZW0sIF9jb250ZXh0LCB4bWwpIHsKICAgICAgICAgICAgdmFyIGNhY2hlLAogICAgICAgICAgICAgIHVuaXF1ZUNhY2hlLAogICAgICAgICAgICAgIG91dGVyQ2FjaGUsCiAgICAgICAgICAgICAgbm9kZSwKICAgICAgICAgICAgICBub2RlSW5kZXgsCiAgICAgICAgICAgICAgc3RhcnQsCiAgICAgICAgICAgICAgZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLAogICAgICAgICAgICAgIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZSwKICAgICAgICAgICAgICBuYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICB1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZSwKICAgICAgICAgICAgICBkaWZmID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgICAgICAvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpCiAgICAgICAgICAgICAgaWYgKHNpbXBsZSkgewogICAgICAgICAgICAgICAgd2hpbGUgKGRpcikgewogICAgICAgICAgICAgICAgICBub2RlID0gZWxlbTsKICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSBub2RlW2Rpcl0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAob2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgLy8gUmV2ZXJzZSBkaXJlY3Rpb24gZm9yIDpvbmx5LSogKGlmIHdlIGhhdmVuJ3QgeWV0IGRvbmUgc28pCiAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gIm9ubHkiICYmICFzdGFydCAmJiAibmV4dFNpYmxpbmciOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXJ0ID0gW2ZvcndhcmQgPyBwYXJlbnQuZmlyc3RDaGlsZCA6IHBhcmVudC5sYXN0Q2hpbGRdOwoKICAgICAgICAgICAgICAvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAogICAgICAgICAgICAgIGlmIChmb3J3YXJkICYmIHVzZUNhY2hlKSB7CiAgICAgICAgICAgICAgICAvLyBTZWVrIGBlbGVtYCBmcm9tIGEgcHJldmlvdXNseS1jYWNoZWQgaW5kZXgKCiAgICAgICAgICAgICAgICAvLyAuLi5pbiBhIGd6aXAtZnJpZW5kbHkgd2F5CiAgICAgICAgICAgICAgICBub2RlID0gcGFyZW50OwogICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSk7CgogICAgICAgICAgICAgICAgLy8gU3VwcG9ydDogSUUgPDkgb25seQogICAgICAgICAgICAgICAgLy8gRGVmZW5kIGFnYWluc3QgY2xvbmVkIGF0dHJvcGVydGllcyAoalF1ZXJ5IGdoLTE3MDkpCiAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZSA9IG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gfHwgKG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gPSB7fSk7CiAgICAgICAgICAgICAgICBjYWNoZSA9IHVuaXF1ZUNhY2hlW3R5cGVdIHx8IFtdOwogICAgICAgICAgICAgICAgbm9kZUluZGV4ID0gY2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbMV07CiAgICAgICAgICAgICAgICBkaWZmID0gbm9kZUluZGV4ICYmIGNhY2hlWzJdOwogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1tub2RlSW5kZXhdOwogICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbZGlyXSB8fCAoCiAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayB0byBzZWVraW5nIGBlbGVtYCBmcm9tIHRoZSBzdGFydAogICAgICAgICAgICAgICAgZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSB7CiAgICAgICAgICAgICAgICAgIC8vIFdoZW4gZm91bmQsIGNhY2hlIGluZGV4ZXMgb24gYHBhcmVudGAgYW5kIGJyZWFrCiAgICAgICAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmICsrZGlmZiAmJiBub2RlID09PSBlbGVtKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlQ2FjaGVbdHlwZV0gPSBbZGlycnVucywgbm9kZUluZGV4LCBkaWZmXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUKICAgICAgICAgICAgICAgIGlmICh1c2VDYWNoZSkgewogICAgICAgICAgICAgICAgICAvLyAuLi5pbiBhIGd6aXAtZnJpZW5kbHkgd2F5CiAgICAgICAgICAgICAgICAgIG5vZGUgPSBlbGVtOwogICAgICAgICAgICAgICAgICBvdXRlckNhY2hlID0gbm9kZVtleHBhbmRvXSB8fCAobm9kZVtleHBhbmRvXSA9IHt9KTsKCiAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDw5IG9ubHkKICAgICAgICAgICAgICAgICAgLy8gRGVmZW5kIGFnYWluc3QgY2xvbmVkIGF0dHJvcGVydGllcyAoalF1ZXJ5IGdoLTE3MDkpCiAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVtub2RlLnVuaXF1ZUlEXSB8fCAob3V0ZXJDYWNoZVtub2RlLnVuaXF1ZUlEXSA9IHt9KTsKICAgICAgICAgICAgICAgICAgY2FjaGUgPSB1bmlxdWVDYWNoZVt0eXBlXSB8fCBbXTsKICAgICAgICAgICAgICAgICAgbm9kZUluZGV4ID0gY2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbMV07CiAgICAgICAgICAgICAgICAgIGRpZmYgPSBub2RlSW5kZXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8geG1sIDpudGgtY2hpbGQoLi4uKQogICAgICAgICAgICAgICAgLy8gb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKQogICAgICAgICAgICAgICAgaWYgKGRpZmYgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgc2FtZSBsb29wIGFzIGFib3ZlIHRvIHNlZWsgYGVsZW1gIGZyb20gdGhlIHN0YXJ0CiAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlID0gKytub2RlSW5kZXggJiYgbm9kZSAmJiBub2RlW2Rpcl0gfHwgKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICgob2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSkgJiYgKytkaWZmKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlQ2FjaGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8OSBvbmx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KQogICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZSA9IG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gfHwgKG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gPSB7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlW3R5cGVdID0gW2RpcnJ1bnMsIGRpZmZdOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUgPT09IGVsZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBJbmNvcnBvcmF0ZSB0aGUgb2Zmc2V0LCB0aGVuIGNoZWNrIGFnYWluc3QgY3ljbGUgc2l6ZQogICAgICAgICAgICAgIGRpZmYgLT0gbGFzdDsKICAgICAgICAgICAgICByZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgIlBTRVVETyI6IGZ1bmN0aW9uIFBTRVVETyhwc2V1ZG8sIGFyZ3VtZW50KSB7CiAgICAgICAgICAvLyBwc2V1ZG8tY2xhc3MgbmFtZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUKICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jcHNldWRvLWNsYXNzZXMKICAgICAgICAgIC8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzCiAgICAgICAgICAvLyBSZW1lbWJlciB0aGF0IHNldEZpbHRlcnMgaW5oZXJpdHMgZnJvbSBwc2V1ZG9zCiAgICAgICAgICB2YXIgYXJncywKICAgICAgICAgICAgZm4gPSBFeHByLnBzZXVkb3NbcHNldWRvXSB8fCBFeHByLnNldEZpbHRlcnNbcHNldWRvLnRvTG93ZXJDYXNlKCldIHx8IFNpenpsZS5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgcHNldWRvKTsKCiAgICAgICAgICAvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CiAgICAgICAgICAvLyBhcmd1bWVudHMgYXJlIG5lZWRlZCB0byBjcmVhdGUgdGhlIGZpbHRlciBmdW5jdGlvbgogICAgICAgICAgLy8ganVzdCBhcyBTaXp6bGUgZG9lcwogICAgICAgICAgaWYgKGZuW2V4cGFuZG9dKSB7CiAgICAgICAgICAgIHJldHVybiBmbihhcmd1bWVudCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQnV0IG1haW50YWluIHN1cHBvcnQgZm9yIG9sZCBzaWduYXR1cmVzCiAgICAgICAgICBpZiAoZm4ubGVuZ3RoID4gMSkgewogICAgICAgICAgICBhcmdzID0gW3BzZXVkbywgcHNldWRvLCAiIiwgYXJndW1lbnRdOwogICAgICAgICAgICByZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KHBzZXVkby50b0xvd2VyQ2FzZSgpKSA/IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcykgewogICAgICAgICAgICAgIHZhciBpZHgsCiAgICAgICAgICAgICAgICBtYXRjaGVkID0gZm4oc2VlZCwgYXJndW1lbnQpLAogICAgICAgICAgICAgICAgaSA9IG1hdGNoZWQubGVuZ3RoOwogICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4T2Yoc2VlZCwgbWF0Y2hlZFtpXSk7CiAgICAgICAgICAgICAgICBzZWVkW2lkeF0gPSAhKG1hdGNoZXNbaWR4XSA9IG1hdGNoZWRbaV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkgOiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICAgIHJldHVybiBmbihlbGVtLCAwLCBhcmdzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmbjsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHBzZXVkb3M6IHsKICAgICAgICAvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKICAgICAgICAibm90IjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChzZWxlY3RvcikgewogICAgICAgICAgLy8gVHJpbSB0aGUgc2VsZWN0b3IgcGFzc2VkIHRvIGNvbXBpbGUKICAgICAgICAgIC8vIHRvIGF2b2lkIHRyZWF0aW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nCiAgICAgICAgICAvLyBzcGFjZXMgYXMgY29tYmluYXRvcnMKICAgICAgICAgIHZhciBpbnB1dCA9IFtdLAogICAgICAgICAgICByZXN1bHRzID0gW10sCiAgICAgICAgICAgIG1hdGNoZXIgPSBjb21waWxlKHNlbGVjdG9yLnJlcGxhY2UocnRyaW0sICIkMSIpKTsKICAgICAgICAgIHJldHVybiBtYXRjaGVyW2V4cGFuZG9dID8gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChzZWVkLCBtYXRjaGVzLCBfY29udGV4dCwgeG1sKSB7CiAgICAgICAgICAgIHZhciBlbGVtLAogICAgICAgICAgICAgIHVubWF0Y2hlZCA9IG1hdGNoZXIoc2VlZCwgbnVsbCwgeG1sLCBbXSksCiAgICAgICAgICAgICAgaSA9IHNlZWQubGVuZ3RoOwoKICAgICAgICAgICAgLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAogICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgaWYgKGVsZW0gPSB1bm1hdGNoZWRbaV0pIHsKICAgICAgICAgICAgICAgIHNlZWRbaV0gPSAhKG1hdGNoZXNbaV0gPSBlbGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pIDogZnVuY3Rpb24gKGVsZW0sIF9jb250ZXh0LCB4bWwpIHsKICAgICAgICAgICAgaW5wdXRbMF0gPSBlbGVtOwogICAgICAgICAgICBtYXRjaGVyKGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMpOwoKICAgICAgICAgICAgLy8gRG9uJ3Qga2VlcCB0aGUgZWxlbWVudCAoaXNzdWUgIzI5OSkKICAgICAgICAgICAgaW5wdXRbMF0gPSBudWxsOwogICAgICAgICAgICByZXR1cm4gIXJlc3VsdHMucG9wKCk7CiAgICAgICAgICB9OwogICAgICAgIH0pLAogICAgICAgICJoYXMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKHNlbGVjdG9yKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgcmV0dXJuIFNpenpsZShzZWxlY3RvciwgZWxlbSkubGVuZ3RoID4gMDsKICAgICAgICAgIH07CiAgICAgICAgfSksCiAgICAgICAgImNvbnRhaW5zIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gKGVsZW0udGV4dENvbnRlbnQgfHwgZ2V0VGV4dChlbGVtKSkuaW5kZXhPZih0ZXh0KSA+IC0xOwogICAgICAgICAgfTsKICAgICAgICB9KSwKICAgICAgICAvLyAiV2hldGhlciBhbiBlbGVtZW50IGlzIHJlcHJlc2VudGVkIGJ5IGEgOmxhbmcoKSBzZWxlY3RvcgogICAgICAgIC8vIGlzIGJhc2VkIHNvbGVseSBvbiB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlCiAgICAgICAgLy8gYmVpbmcgZXF1YWwgdG8gdGhlIGlkZW50aWZpZXIgQywKICAgICAgICAvLyBvciBiZWdpbm5pbmcgd2l0aCB0aGUgaWRlbnRpZmllciBDIGltbWVkaWF0ZWx5IGZvbGxvd2VkIGJ5ICItIi4KICAgICAgICAvLyBUaGUgbWF0Y2hpbmcgb2YgQyBhZ2FpbnN0IHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUgaXMgcGVyZm9ybWVkIGNhc2UtaW5zZW5zaXRpdmVseS4KICAgICAgICAvLyBUaGUgaWRlbnRpZmllciBDIGRvZXMgbm90IGhhdmUgdG8gYmUgYSB2YWxpZCBsYW5ndWFnZSBuYW1lLiIKICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2xhbmctcHNldWRvCiAgICAgICAgImxhbmciOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKGxhbmcpIHsKICAgICAgICAgIC8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZXIKICAgICAgICAgIGlmICghcmlkZW50aWZpZXIudGVzdChsYW5nIHx8ICIiKSkgewogICAgICAgICAgICBTaXp6bGUuZXJyb3IoInVuc3VwcG9ydGVkIGxhbmc6ICIgKyBsYW5nKTsKICAgICAgICAgIH0KICAgICAgICAgIGxhbmcgPSBsYW5nLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgdmFyIGVsZW1MYW5nOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKGVsZW1MYW5nID0gZG9jdW1lbnRJc0hUTUwgPyBlbGVtLmxhbmcgOiBlbGVtLmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSgibGFuZyIpKSB7CiAgICAgICAgICAgICAgICBlbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZihsYW5nICsgIi0iKSA9PT0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gd2hpbGUgKChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfTsKICAgICAgICB9KSwKICAgICAgICAvLyBNaXNjZWxsYW5lb3VzCiAgICAgICAgInRhcmdldCI6IGZ1bmN0aW9uIHRhcmdldChlbGVtKSB7CiAgICAgICAgICB2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDsKICAgICAgICAgIHJldHVybiBoYXNoICYmIGhhc2guc2xpY2UoMSkgPT09IGVsZW0uaWQ7CiAgICAgICAgfSwKICAgICAgICAicm9vdCI6IGZ1bmN0aW9uIHJvb3QoZWxlbSkgewogICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGRvY0VsZW07CiAgICAgICAgfSwKICAgICAgICAiZm9jdXMiOiBmdW5jdGlvbiBmb2N1cyhlbGVtKSB7CiAgICAgICAgICByZXR1cm4gZWxlbSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiAoIWRvY3VtZW50Lmhhc0ZvY3VzIHx8IGRvY3VtZW50Lmhhc0ZvY3VzKCkpICYmICEhKGVsZW0udHlwZSB8fCBlbGVtLmhyZWYgfHwgfmVsZW0udGFiSW5kZXgpOwogICAgICAgIH0sCiAgICAgICAgLy8gQm9vbGVhbiBwcm9wZXJ0aWVzCiAgICAgICAgImVuYWJsZWQiOiBjcmVhdGVEaXNhYmxlZFBzZXVkbyhmYWxzZSksCiAgICAgICAgImRpc2FibGVkIjogY3JlYXRlRGlzYWJsZWRQc2V1ZG8odHJ1ZSksCiAgICAgICAgImNoZWNrZWQiOiBmdW5jdGlvbiBjaGVja2VkKGVsZW0pIHsKICAgICAgICAgIC8vIEluIENTUzMsIDpjaGVja2VkIHNob3VsZCByZXR1cm4gYm90aCBjaGVja2VkIGFuZCBzZWxlY3RlZCBlbGVtZW50cwogICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWQKICAgICAgICAgIHZhciBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHJldHVybiBub2RlTmFtZSA9PT0gImlucHV0IiAmJiAhIWVsZW0uY2hlY2tlZCB8fCBub2RlTmFtZSA9PT0gIm9wdGlvbiIgJiYgISFlbGVtLnNlbGVjdGVkOwogICAgICAgIH0sCiAgICAgICAgInNlbGVjdGVkIjogZnVuY3Rpb24gc2VsZWN0ZWQoZWxlbSkgewogICAgICAgICAgLy8gQWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgbWFrZXMgc2VsZWN0ZWQtYnktZGVmYXVsdAogICAgICAgICAgLy8gb3B0aW9ucyBpbiBTYWZhcmkgd29yayBwcm9wZXJseQogICAgICAgICAgaWYgKGVsZW0ucGFyZW50Tm9kZSkgewogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLWV4cHJlc3Npb25zCiAgICAgICAgICAgIGVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGVsZW0uc2VsZWN0ZWQgPT09IHRydWU7CiAgICAgICAgfSwKICAgICAgICAvLyBDb250ZW50cwogICAgICAgICJlbXB0eSI6IGZ1bmN0aW9uIGVtcHR5KGVsZW0pIHsKICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jZW1wdHktcHNldWRvCiAgICAgICAgICAvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksCiAgICAgICAgICAvLyAgIGJ1dCBub3QgYnkgb3RoZXJzIChjb21tZW50OiA4OyBwcm9jZXNzaW5nIGluc3RydWN0aW9uOiA3OyBldGMuKQogICAgICAgICAgLy8gbm9kZVR5cGUgPCA2IHdvcmtzIGJlY2F1c2UgYXR0cmlidXRlcyAoMikgZG8gbm90IGFwcGVhciBhcyBjaGlsZHJlbgogICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykgewogICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA8IDYpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0sCiAgICAgICAgInBhcmVudCI6IGZ1bmN0aW9uIHBhcmVudChlbGVtKSB7CiAgICAgICAgICByZXR1cm4gIUV4cHIucHNldWRvc1siZW1wdHkiXShlbGVtKTsKICAgICAgICB9LAogICAgICAgIC8vIEVsZW1lbnQvaW5wdXQgdHlwZXMKICAgICAgICAiaGVhZGVyIjogZnVuY3Rpb24gaGVhZGVyKGVsZW0pIHsKICAgICAgICAgIHJldHVybiByaGVhZGVyLnRlc3QoZWxlbS5ub2RlTmFtZSk7CiAgICAgICAgfSwKICAgICAgICAiaW5wdXQiOiBmdW5jdGlvbiBpbnB1dChlbGVtKSB7CiAgICAgICAgICByZXR1cm4gcmlucHV0cy50ZXN0KGVsZW0ubm9kZU5hbWUpOwogICAgICAgIH0sCiAgICAgICAgImJ1dHRvbiI6IGZ1bmN0aW9uIGJ1dHRvbihlbGVtKSB7CiAgICAgICAgICB2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gImJ1dHRvbiIgfHwgbmFtZSA9PT0gImJ1dHRvbiI7CiAgICAgICAgfSwKICAgICAgICAidGV4dCI6IGZ1bmN0aW9uIHRleHQoZWxlbSkgewogICAgICAgICAgdmFyIGF0dHI7CiAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gInRleHQiICYmICgKICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDgKICAgICAgICAgIC8vIE5ldyBIVE1MNSBhdHRyaWJ1dGUgdmFsdWVzIChlLmcuLCAic2VhcmNoIikgYXBwZWFyIHdpdGggZWxlbS50eXBlID09PSAidGV4dCIKICAgICAgICAgIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09ICJ0ZXh0Iik7CiAgICAgICAgfSwKICAgICAgICAvLyBQb3NpdGlvbi1pbi1jb2xsZWN0aW9uCiAgICAgICAgImZpcnN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gWzBdOwogICAgICAgIH0pLAogICAgICAgICJsYXN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiAoX21hdGNoSW5kZXhlcywgbGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gW2xlbmd0aCAtIDFdOwogICAgICAgIH0pLAogICAgICAgICJlcSI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24gKF9tYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQpIHsKICAgICAgICAgIHJldHVybiBbYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudF07CiAgICAgICAgfSksCiAgICAgICAgImV2ZW4iOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uIChtYXRjaEluZGV4ZXMsIGxlbmd0aCkgewogICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgZm9yICg7IGkgPCBsZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBtYXRjaEluZGV4ZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtYXRjaEluZGV4ZXM7CiAgICAgICAgfSksCiAgICAgICAgIm9kZCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24gKG1hdGNoSW5kZXhlcywgbGVuZ3RoKSB7CiAgICAgICAgICB2YXIgaSA9IDE7CiAgICAgICAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgICAgIG1hdGNoSW5kZXhlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG1hdGNoSW5kZXhlczsKICAgICAgICB9KSwKICAgICAgICAibHQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uIChtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQpIHsKICAgICAgICAgIHZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudCA+IGxlbmd0aCA/IGxlbmd0aCA6IGFyZ3VtZW50OwogICAgICAgICAgZm9yICg7IC0taSA+PSAwOykgewogICAgICAgICAgICBtYXRjaEluZGV4ZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtYXRjaEluZGV4ZXM7CiAgICAgICAgfSksCiAgICAgICAgImd0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiAobWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50KSB7CiAgICAgICAgICB2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7CiAgICAgICAgICBmb3IgKDsgKytpIDwgbGVuZ3RoOykgewogICAgICAgICAgICBtYXRjaEluZGV4ZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtYXRjaEluZGV4ZXM7CiAgICAgICAgfSkKICAgICAgfQogICAgfTsKICAgIEV4cHIucHNldWRvc1sibnRoIl0gPSBFeHByLnBzZXVkb3NbImVxIl07CgogICAgLy8gQWRkIGJ1dHRvbi9pbnB1dCB0eXBlIHBzZXVkb3MKICAgIGZvciAoaSBpbiB7CiAgICAgIHJhZGlvOiB0cnVlLAogICAgICBjaGVja2JveDogdHJ1ZSwKICAgICAgZmlsZTogdHJ1ZSwKICAgICAgcGFzc3dvcmQ6IHRydWUsCiAgICAgIGltYWdlOiB0cnVlCiAgICB9KSB7CiAgICAgIEV4cHIucHNldWRvc1tpXSA9IGNyZWF0ZUlucHV0UHNldWRvKGkpOwogICAgfQogICAgZm9yIChpIGluIHsKICAgICAgc3VibWl0OiB0cnVlLAogICAgICByZXNldDogdHJ1ZQogICAgfSkgewogICAgICBFeHByLnBzZXVkb3NbaV0gPSBjcmVhdGVCdXR0b25Qc2V1ZG8oaSk7CiAgICB9CgogICAgLy8gRWFzeSBBUEkgZm9yIGNyZWF0aW5nIG5ldyBzZXRGaWx0ZXJzCiAgICBmdW5jdGlvbiBzZXRGaWx0ZXJzKCkge30KICAgIHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5maWx0ZXJzID0gRXhwci5wc2V1ZG9zOwogICAgRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTsKICAgIHRva2VuaXplID0gU2l6emxlLnRva2VuaXplID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBwYXJzZU9ubHkpIHsKICAgICAgdmFyIG1hdGNoZWQsCiAgICAgICAgbWF0Y2gsCiAgICAgICAgdG9rZW5zLAogICAgICAgIHR5cGUsCiAgICAgICAgc29GYXIsCiAgICAgICAgZ3JvdXBzLAogICAgICAgIHByZUZpbHRlcnMsCiAgICAgICAgY2FjaGVkID0gdG9rZW5DYWNoZVtzZWxlY3RvciArICIgIl07CiAgICAgIGlmIChjYWNoZWQpIHsKICAgICAgICByZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSgwKTsKICAgICAgfQogICAgICBzb0ZhciA9IHNlbGVjdG9yOwogICAgICBncm91cHMgPSBbXTsKICAgICAgcHJlRmlsdGVycyA9IEV4cHIucHJlRmlsdGVyOwogICAgICB3aGlsZSAoc29GYXIpIHsKICAgICAgICAvLyBDb21tYSBhbmQgZmlyc3QgcnVuCiAgICAgICAgaWYgKCFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKHNvRmFyKSkpIHsKICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZAogICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoWzBdLmxlbmd0aCkgfHwgc29GYXI7CiAgICAgICAgICB9CiAgICAgICAgICBncm91cHMucHVzaCh0b2tlbnMgPSBbXSk7CiAgICAgICAgfQogICAgICAgIG1hdGNoZWQgPSBmYWxzZTsKCiAgICAgICAgLy8gQ29tYmluYXRvcnMKICAgICAgICBpZiAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyhzb0ZhcikpIHsKICAgICAgICAgIG1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwogICAgICAgICAgdG9rZW5zLnB1c2goewogICAgICAgICAgICB2YWx1ZTogbWF0Y2hlZCwKICAgICAgICAgICAgLy8gQ2FzdCBkZXNjZW5kYW50IGNvbWJpbmF0b3JzIHRvIHNwYWNlCiAgICAgICAgICAgIHR5cGU6IG1hdGNoWzBdLnJlcGxhY2UocnRyaW0sICIgIikKICAgICAgICAgIH0pOwogICAgICAgICAgc29GYXIgPSBzb0Zhci5zbGljZShtYXRjaGVkLmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICAvLyBGaWx0ZXJzCiAgICAgICAgZm9yICh0eXBlIGluIEV4cHIuZmlsdGVyKSB7CiAgICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hFeHByW3R5cGVdLmV4ZWMoc29GYXIpKSAmJiAoIXByZUZpbHRlcnNbdHlwZV0gfHwgKG1hdGNoID0gcHJlRmlsdGVyc1t0eXBlXShtYXRjaCkpKSkgewogICAgICAgICAgICBtYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKICAgICAgICAgICAgdG9rZW5zLnB1c2goewogICAgICAgICAgICAgIHZhbHVlOiBtYXRjaGVkLAogICAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2gKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvRmFyID0gc29GYXIuc2xpY2UobWF0Y2hlZC5sZW5ndGgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIW1hdGNoZWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gUmV0dXJuIHRoZSBsZW5ndGggb2YgdGhlIGludmFsaWQgZXhjZXNzCiAgICAgIC8vIGlmIHdlJ3JlIGp1c3QgcGFyc2luZwogICAgICAvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKICAgICAgcmV0dXJuIHBhcnNlT25seSA/IHNvRmFyLmxlbmd0aCA6IHNvRmFyID8gU2l6emxlLmVycm9yKHNlbGVjdG9yKSA6CiAgICAgIC8vIENhY2hlIHRoZSB0b2tlbnMKICAgICAgdG9rZW5DYWNoZShzZWxlY3RvciwgZ3JvdXBzKS5zbGljZSgwKTsKICAgIH07CiAgICBmdW5jdGlvbiB0b1NlbGVjdG9yKHRva2VucykgewogICAgICB2YXIgaSA9IDAsCiAgICAgICAgbGVuID0gdG9rZW5zLmxlbmd0aCwKICAgICAgICBzZWxlY3RvciA9ICIiOwogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgc2VsZWN0b3IgKz0gdG9rZW5zW2ldLnZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiBzZWxlY3RvcjsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZENvbWJpbmF0b3IobWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSkgewogICAgICB2YXIgZGlyID0gY29tYmluYXRvci5kaXIsCiAgICAgICAgc2tpcCA9IGNvbWJpbmF0b3IubmV4dCwKICAgICAgICBrZXkgPSBza2lwIHx8IGRpciwKICAgICAgICBjaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBrZXkgPT09ICJwYXJlbnROb2RlIiwKICAgICAgICBkb25lTmFtZSA9IGRvbmUrKzsKICAgICAgcmV0dXJuIGNvbWJpbmF0b3IuZmlyc3QgPwogICAgICAvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnQKICAgICAgZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkgewogICAgICAgIHdoaWxlIChlbGVtID0gZWxlbVtkaXJdKSB7CiAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSA6CiAgICAgIC8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50cwogICAgICBmdW5jdGlvbiAoZWxlbSwgY29udGV4dCwgeG1sKSB7CiAgICAgICAgdmFyIG9sZENhY2hlLAogICAgICAgICAgdW5pcXVlQ2FjaGUsCiAgICAgICAgICBvdXRlckNhY2hlLAogICAgICAgICAgbmV3Q2FjaGUgPSBbZGlycnVucywgZG9uZU5hbWVdOwoKICAgICAgICAvLyBXZSBjYW4ndCBzZXQgYXJiaXRyYXJ5IGRhdGEgb24gWE1MIG5vZGVzLCBzbyB0aGV5IGRvbid0IGJlbmVmaXQgZnJvbSBjb21iaW5hdG9yIGNhY2hpbmcKICAgICAgICBpZiAoeG1sKSB7CiAgICAgICAgICB3aGlsZSAoZWxlbSA9IGVsZW1bZGlyXSkgewogICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7CiAgICAgICAgICAgICAgaWYgKG1hdGNoZXIoZWxlbSwgY29udGV4dCwgeG1sKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdoaWxlIChlbGVtID0gZWxlbVtkaXJdKSB7CiAgICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMpIHsKICAgICAgICAgICAgICBvdXRlckNhY2hlID0gZWxlbVtleHBhbmRvXSB8fCAoZWxlbVtleHBhbmRvXSA9IHt9KTsKCiAgICAgICAgICAgICAgLy8gU3VwcG9ydDogSUUgPDkgb25seQogICAgICAgICAgICAgIC8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KQogICAgICAgICAgICAgIHVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVtlbGVtLnVuaXF1ZUlEXSB8fCAob3V0ZXJDYWNoZVtlbGVtLnVuaXF1ZUlEXSA9IHt9KTsKICAgICAgICAgICAgICBpZiAoc2tpcCAmJiBza2lwID09PSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgIGVsZW0gPSBlbGVtW2Rpcl0gfHwgZWxlbTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKChvbGRDYWNoZSA9IHVuaXF1ZUNhY2hlW2tleV0pICYmIG9sZENhY2hlWzBdID09PSBkaXJydW5zICYmIG9sZENhY2hlWzFdID09PSBkb25lTmFtZSkgewogICAgICAgICAgICAgICAgLy8gQXNzaWduIHRvIG5ld0NhY2hlIHNvIHJlc3VsdHMgYmFjay1wcm9wYWdhdGUgdG8gcHJldmlvdXMgZWxlbWVudHMKICAgICAgICAgICAgICAgIHJldHVybiBuZXdDYWNoZVsyXSA9IG9sZENhY2hlWzJdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBSZXVzZSBuZXdjYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzCiAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZVtrZXldID0gbmV3Q2FjaGU7CgogICAgICAgICAgICAgICAgLy8gQSBtYXRjaCBtZWFucyB3ZSdyZSBkb25lOyBhIGZhaWwgbWVhbnMgd2UgaGF2ZSB0byBrZWVwIGNoZWNraW5nCiAgICAgICAgICAgICAgICBpZiAobmV3Q2FjaGVbMl0gPSBtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSB7CiAgICAgIHJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8gZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkgewogICAgICAgIHZhciBpID0gbWF0Y2hlcnMubGVuZ3RoOwogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgIGlmICghbWF0Y2hlcnNbaV0oZWxlbSwgY29udGV4dCwgeG1sKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IDogbWF0Y2hlcnNbMF07CiAgICB9CiAgICBmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKHNlbGVjdG9yLCBjb250ZXh0cywgcmVzdWx0cykgewogICAgICB2YXIgaSA9IDAsCiAgICAgICAgbGVuID0gY29udGV4dHMubGVuZ3RoOwogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgU2l6emxlKHNlbGVjdG9yLCBjb250ZXh0c1tpXSwgcmVzdWx0cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9CiAgICBmdW5jdGlvbiBjb25kZW5zZSh1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwpIHsKICAgICAgdmFyIGVsZW0sCiAgICAgICAgbmV3VW5tYXRjaGVkID0gW10sCiAgICAgICAgaSA9IDAsCiAgICAgICAgbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwKICAgICAgICBtYXBwZWQgPSBtYXAgIT0gbnVsbDsKICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChlbGVtID0gdW5tYXRjaGVkW2ldKSB7CiAgICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoZWxlbSwgY29udGV4dCwgeG1sKSkgewogICAgICAgICAgICBuZXdVbm1hdGNoZWQucHVzaChlbGVtKTsKICAgICAgICAgICAgaWYgKG1hcHBlZCkgewogICAgICAgICAgICAgIG1hcC5wdXNoKGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXdVbm1hdGNoZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRNYXRjaGVyKHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvcikgewogICAgICBpZiAocG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlcltleHBhbmRvXSkgewogICAgICAgIHBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKHBvc3RGaWx0ZXIpOwogICAgICB9CiAgICAgIGlmIChwb3N0RmluZGVyICYmICFwb3N0RmluZGVyW2V4cGFuZG9dKSB7CiAgICAgICAgcG9zdEZpbmRlciA9IHNldE1hdGNoZXIocG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yKTsKICAgICAgfQogICAgICByZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChzZWVkLCByZXN1bHRzLCBjb250ZXh0LCB4bWwpIHsKICAgICAgICB2YXIgdGVtcCwKICAgICAgICAgIGksCiAgICAgICAgICBlbGVtLAogICAgICAgICAgcHJlTWFwID0gW10sCiAgICAgICAgICBwb3N0TWFwID0gW10sCiAgICAgICAgICBwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLAogICAgICAgICAgLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQKICAgICAgICAgIGVsZW1zID0gc2VlZCB8fCBtdWx0aXBsZUNvbnRleHRzKHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFtjb250ZXh0XSA6IGNvbnRleHQsIFtdKSwKICAgICAgICAgIC8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvbgogICAgICAgICAgbWF0Y2hlckluID0gcHJlRmlsdGVyICYmIChzZWVkIHx8ICFzZWxlY3RvcikgPyBjb25kZW5zZShlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCkgOiBlbGVtcywKICAgICAgICAgIG1hdGNoZXJPdXQgPSBtYXRjaGVyID8KICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSBwb3N0RmluZGVyLCBvciBmaWx0ZXJlZCBzZWVkLCBvciBub24tc2VlZCBwb3N0RmlsdGVyIG9yIHByZWV4aXN0aW5nIHJlc3VsdHMsCiAgICAgICAgICBwb3N0RmluZGVyIHx8IChzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlcikgPwogICAgICAgICAgLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5CiAgICAgICAgICBbXSA6CiAgICAgICAgICAvLyAuLi5vdGhlcndpc2UgdXNlIHJlc3VsdHMgZGlyZWN0bHkKICAgICAgICAgIHJlc3VsdHMgOiBtYXRjaGVySW47CgogICAgICAgIC8vIEZpbmQgcHJpbWFyeSBtYXRjaGVzCiAgICAgICAgaWYgKG1hdGNoZXIpIHsKICAgICAgICAgIG1hdGNoZXIobWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwpOwogICAgICAgIH0KCiAgICAgICAgLy8gQXBwbHkgcG9zdEZpbHRlcgogICAgICAgIGlmIChwb3N0RmlsdGVyKSB7CiAgICAgICAgICB0ZW1wID0gY29uZGVuc2UobWF0Y2hlck91dCwgcG9zdE1hcCk7CiAgICAgICAgICBwb3N0RmlsdGVyKHRlbXAsIFtdLCBjb250ZXh0LCB4bWwpOwoKICAgICAgICAgIC8vIFVuLW1hdGNoIGZhaWxpbmcgZWxlbWVudHMgYnkgbW92aW5nIHRoZW0gYmFjayB0byBtYXRjaGVySW4KICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgaWYgKGVsZW0gPSB0ZW1wW2ldKSB7CiAgICAgICAgICAgICAgbWF0Y2hlck91dFtwb3N0TWFwW2ldXSA9ICEobWF0Y2hlckluW3Bvc3RNYXBbaV1dID0gZWxlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHNlZWQpIHsKICAgICAgICAgIGlmIChwb3N0RmluZGVyIHx8IHByZUZpbHRlcikgewogICAgICAgICAgICBpZiAocG9zdEZpbmRlcikgewogICAgICAgICAgICAgIC8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwogICAgICAgICAgICAgIHRlbXAgPSBbXTsKICAgICAgICAgICAgICBpID0gbWF0Y2hlck91dC5sZW5ndGg7CiAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgaWYgKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoCiAgICAgICAgICAgICAgICAgIHRlbXAucHVzaChtYXRjaGVySW5baV0gPSBlbGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcG9zdEZpbmRlcihudWxsLCBtYXRjaGVyT3V0ID0gW10sIHRlbXAsIHhtbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE1vdmUgbWF0Y2hlZCBlbGVtZW50cyBmcm9tIHNlZWQgdG8gcmVzdWx0cyB0byBrZWVwIHRoZW0gc3luY2hyb25pemVkCiAgICAgICAgICAgIGkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgIGlmICgoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICYmICh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2Yoc2VlZCwgZWxlbSkgOiBwcmVNYXBbaV0pID4gLTEpIHsKICAgICAgICAgICAgICAgIHNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBZGQgZWxlbWVudHMgdG8gcmVzdWx0cywgdGhyb3VnaCBwb3N0RmluZGVyIGlmIGRlZmluZWQKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0Y2hlck91dCA9IGNvbmRlbnNlKG1hdGNoZXJPdXQgPT09IHJlc3VsdHMgPyBtYXRjaGVyT3V0LnNwbGljZShwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGgpIDogbWF0Y2hlck91dCk7CiAgICAgICAgICBpZiAocG9zdEZpbmRlcikgewogICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIG1hdGNoZXJPdXQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBtYXRjaGVyRnJvbVRva2Vucyh0b2tlbnMpIHsKICAgICAgdmFyIGNoZWNrQ29udGV4dCwKICAgICAgICBtYXRjaGVyLAogICAgICAgIGosCiAgICAgICAgbGVuID0gdG9rZW5zLmxlbmd0aCwKICAgICAgICBsZWFkaW5nUmVsYXRpdmUgPSBFeHByLnJlbGF0aXZlW3Rva2Vuc1swXS50eXBlXSwKICAgICAgICBpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbIiAiXSwKICAgICAgICBpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsCiAgICAgICAgLy8gVGhlIGZvdW5kYXRpb25hbCBtYXRjaGVyIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBhcmUgcmVhY2hhYmxlIGZyb20gdG9wLWxldmVsIGNvbnRleHQocykKICAgICAgICBtYXRjaENvbnRleHQgPSBhZGRDb21iaW5hdG9yKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICByZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0OwogICAgICAgIH0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUpLAogICAgICAgIG1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgIHJldHVybiBpbmRleE9mKGNoZWNrQ29udGV4dCwgZWxlbSkgPiAtMTsKICAgICAgICB9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlKSwKICAgICAgICBtYXRjaGVycyA9IFtmdW5jdGlvbiAoZWxlbSwgY29udGV4dCwgeG1sKSB7CiAgICAgICAgICB2YXIgcmV0ID0gIWxlYWRpbmdSZWxhdGl2ZSAmJiAoeG1sIHx8IGNvbnRleHQgIT09IG91dGVybW9zdENvbnRleHQpIHx8ICgoY2hlY2tDb250ZXh0ID0gY29udGV4dCkubm9kZVR5cGUgPyBtYXRjaENvbnRleHQoZWxlbSwgY29udGV4dCwgeG1sKSA6IG1hdGNoQW55Q29udGV4dChlbGVtLCBjb250ZXh0LCB4bWwpKTsKCiAgICAgICAgICAvLyBBdm9pZCBoYW5naW5nIG9udG8gZWxlbWVudCAoaXNzdWUgIzI5OSkKICAgICAgICAgIGNoZWNrQ29udGV4dCA9IG51bGw7CiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH1dOwogICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlW3Rva2Vuc1tpXS50eXBlXSkgewogICAgICAgICAgbWF0Y2hlcnMgPSBbYWRkQ29tYmluYXRvcihlbGVtZW50TWF0Y2hlcihtYXRjaGVycyksIG1hdGNoZXIpXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0Y2hlciA9IEV4cHIuZmlsdGVyW3Rva2Vuc1tpXS50eXBlXS5hcHBseShudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyk7CgogICAgICAgICAgLy8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXIKICAgICAgICAgIGlmIChtYXRjaGVyW2V4cGFuZG9dKSB7CiAgICAgICAgICAgIC8vIEZpbmQgdGhlIG5leHQgcmVsYXRpdmUgb3BlcmF0b3IgKGlmIGFueSkgZm9yIHByb3BlciBoYW5kbGluZwogICAgICAgICAgICBqID0gKytpOwogICAgICAgICAgICBmb3IgKDsgaiA8IGxlbjsgaisrKSB7CiAgICAgICAgICAgICAgaWYgKEV4cHIucmVsYXRpdmVbdG9rZW5zW2pdLnR5cGVdKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNldE1hdGNoZXIoaSA+IDEgJiYgZWxlbWVudE1hdGNoZXIobWF0Y2hlcnMpLCBpID4gMSAmJiB0b1NlbGVjdG9yKAogICAgICAgICAgICAvLyBJZiB0aGUgcHJlY2VkaW5nIHRva2VuIHdhcyBhIGRlc2NlbmRhbnQgY29tYmluYXRvciwgaW5zZXJ0IGFuIGltcGxpY2l0IGFueS1lbGVtZW50IGAqYAogICAgICAgICAgICB0b2tlbnMuc2xpY2UoMCwgaSAtIDEpLmNvbmNhdCh7CiAgICAgICAgICAgICAgdmFsdWU6IHRva2Vuc1tpIC0gMl0udHlwZSA9PT0gIiAiID8gIioiIDogIiIKICAgICAgICAgICAgfSkpLnJlcGxhY2UocnRyaW0sICIkMSIpLCBtYXRjaGVyLCBpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2Vucyh0b2tlbnMuc2xpY2UoaSwgaikpLCBqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKHRva2VucyA9IHRva2Vucy5zbGljZShqKSksIGogPCBsZW4gJiYgdG9TZWxlY3Rvcih0b2tlbnMpKTsKICAgICAgICAgIH0KICAgICAgICAgIG1hdGNoZXJzLnB1c2gobWF0Y2hlcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBlbGVtZW50TWF0Y2hlcihtYXRjaGVycyk7CiAgICB9CiAgICBmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycykgewogICAgICB2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLAogICAgICAgIGJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLAogICAgICAgIHN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uIHN1cGVyTWF0Y2hlcihzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIG91dGVybW9zdCkgewogICAgICAgICAgdmFyIGVsZW0sCiAgICAgICAgICAgIGosCiAgICAgICAgICAgIG1hdGNoZXIsCiAgICAgICAgICAgIG1hdGNoZWRDb3VudCA9IDAsCiAgICAgICAgICAgIGkgPSAiMCIsCiAgICAgICAgICAgIHVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCiAgICAgICAgICAgIHNldE1hdGNoZWQgPSBbXSwKICAgICAgICAgICAgY29udGV4dEJhY2t1cCA9IG91dGVybW9zdENvbnRleHQsCiAgICAgICAgICAgIC8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3Igb3V0ZXJtb3N0IGNvbnRleHQKICAgICAgICAgICAgZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbIlRBRyJdKCIqIiwgb3V0ZXJtb3N0KSwKICAgICAgICAgICAgLy8gVXNlIGludGVnZXIgZGlycnVucyBpZmYgdGhpcyBpcyB0aGUgb3V0ZXJtb3N0IG1hdGNoZXIKICAgICAgICAgICAgZGlycnVuc1VuaXF1ZSA9IGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xLAogICAgICAgICAgICBsZW4gPSBlbGVtcy5sZW5ndGg7CiAgICAgICAgICBpZiAob3V0ZXJtb3N0KSB7CiAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDExKywgRWRnZSAxNyAtIDE4KwogICAgICAgICAgICAvLyBJRS9FZGdlIHNvbWV0aW1lcyB0aHJvdyBhICJQZXJtaXNzaW9uIGRlbmllZCIgZXJyb3Igd2hlbiBzdHJpY3QtY29tcGFyaW5nCiAgICAgICAgICAgIC8vIHR3byBkb2N1bWVudHM7IHNoYWxsb3cgY29tcGFyaXNvbnMgd29yay4KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGVxZXFlcQogICAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dCA9PSBkb2N1bWVudCB8fCBjb250ZXh0IHx8IG91dGVybW9zdDsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBZGQgZWxlbWVudHMgcGFzc2luZyBlbGVtZW50TWF0Y2hlcnMgZGlyZWN0bHkgdG8gcmVzdWx0cwogICAgICAgICAgLy8gU3VwcG9ydDogSUU8OSwgU2FmYXJpCiAgICAgICAgICAvLyBUb2xlcmF0ZSBOb2RlTGlzdCBwcm9wZXJ0aWVzIChJRTogImxlbmd0aCI7IFNhZmFyaTogPG51bWJlcj4pIG1hdGNoaW5nIGVsZW1lbnRzIGJ5IGlkCiAgICAgICAgICBmb3IgKDsgaSAhPT0gbGVuICYmIChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKykgewogICAgICAgICAgICBpZiAoYnlFbGVtZW50ICYmIGVsZW0pIHsKICAgICAgICAgICAgICBqID0gMDsKCiAgICAgICAgICAgICAgLy8gU3VwcG9ydDogSUUgMTErLCBFZGdlIDE3IC0gMTgrCiAgICAgICAgICAgICAgLy8gSUUvRWRnZSBzb21ldGltZXMgdGhyb3cgYSAiUGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gc3RyaWN0LWNvbXBhcmluZwogICAgICAgICAgICAgIC8vIHR3byBkb2N1bWVudHM7IHNoYWxsb3cgY29tcGFyaXNvbnMgd29yay4KICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXFlcWVxCiAgICAgICAgICAgICAgaWYgKCFjb250ZXh0ICYmIGVsZW0ub3duZXJEb2N1bWVudCAhPSBkb2N1bWVudCkgewogICAgICAgICAgICAgICAgc2V0RG9jdW1lbnQoZWxlbSk7CiAgICAgICAgICAgICAgICB4bWwgPSAhZG9jdW1lbnRJc0hUTUw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdoaWxlIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pIHsKICAgICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQgfHwgZG9jdW1lbnQsIHhtbCkpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGVsZW0pOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKG91dGVybW9zdCkgewogICAgICAgICAgICAgICAgZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUcmFjayB1bm1hdGNoZWQgZWxlbWVudHMgZm9yIHNldCBmaWx0ZXJzCiAgICAgICAgICAgIGlmIChieVNldCkgewogICAgICAgICAgICAgIC8vIFRoZXkgd2lsbCBoYXZlIGdvbmUgdGhyb3VnaCBhbGwgcG9zc2libGUgbWF0Y2hlcnMKICAgICAgICAgICAgICBpZiAoZWxlbSA9ICFtYXRjaGVyICYmIGVsZW0pIHsKICAgICAgICAgICAgICAgIG1hdGNoZWRDb3VudC0tOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gTGVuZ3RoZW4gdGhlIGFycmF5IGZvciBldmVyeSBlbGVtZW50LCBtYXRjaGVkIG9yIG5vdAogICAgICAgICAgICAgIGlmIChzZWVkKSB7CiAgICAgICAgICAgICAgICB1bm1hdGNoZWQucHVzaChlbGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBgaWAgaXMgbm93IHRoZSBjb3VudCBvZiBlbGVtZW50cyB2aXNpdGVkIGFib3ZlLCBhbmQgYWRkaW5nIGl0IHRvIGBtYXRjaGVkQ291bnRgCiAgICAgICAgICAvLyBtYWtlcyB0aGUgbGF0dGVyIG5vbm5lZ2F0aXZlLgogICAgICAgICAgbWF0Y2hlZENvdW50ICs9IGk7CgogICAgICAgICAgLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCiAgICAgICAgICAvLyBOT1RFOiBUaGlzIGNhbiBiZSBza2lwcGVkIGlmIHRoZXJlIGFyZSBubyB1bm1hdGNoZWQgZWxlbWVudHMgKGkuZS4sIGBtYXRjaGVkQ291bnRgCiAgICAgICAgICAvLyBlcXVhbHMgYGlgKSwgdW5sZXNzIHdlIGRpZG4ndCB2aXNpdCBfYW55XyBlbGVtZW50cyBpbiB0aGUgYWJvdmUgbG9vcCBiZWNhdXNlIHdlIGhhdmUKICAgICAgICAgIC8vIG5vIGVsZW1lbnQgbWF0Y2hlcnMgYW5kIG5vIHNlZWQuCiAgICAgICAgICAvLyBJbmNyZW1lbnRpbmcgYW4gaW5pdGlhbGx5LXN0cmluZyAiMCIgYGlgIGFsbG93cyBgaWAgdG8gcmVtYWluIGEgc3RyaW5nIG9ubHkgaW4gdGhhdAogICAgICAgICAgLy8gY2FzZSwgd2hpY2ggd2lsbCByZXN1bHQgaW4gYSAiMDAiIGBtYXRjaGVkQ291bnRgIHRoYXQgZGlmZmVycyBmcm9tIGBpYCBidXQgaXMgYWxzbwogICAgICAgICAgLy8gbnVtZXJpY2FsbHkgemVyby4KICAgICAgICAgIGlmIChieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQpIHsKICAgICAgICAgICAgaiA9IDA7CiAgICAgICAgICAgIHdoaWxlIChtYXRjaGVyID0gc2V0TWF0Y2hlcnNbaisrXSkgewogICAgICAgICAgICAgIG1hdGNoZXIodW5tYXRjaGVkLCBzZXRNYXRjaGVkLCBjb250ZXh0LCB4bWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzZWVkKSB7CiAgICAgICAgICAgICAgLy8gUmVpbnRlZ3JhdGUgZWxlbWVudCBtYXRjaGVzIHRvIGVsaW1pbmF0ZSB0aGUgbmVlZCBmb3Igc29ydGluZwogICAgICAgICAgICAgIGlmIChtYXRjaGVkQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgIGlmICghKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSkgewogICAgICAgICAgICAgICAgICAgIHNldE1hdGNoZWRbaV0gPSBwb3AuY2FsbChyZXN1bHRzKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKICAgICAgICAgICAgICBzZXRNYXRjaGVkID0gY29uZGVuc2Uoc2V0TWF0Y2hlZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFkZCBtYXRjaGVzIHRvIHJlc3VsdHMKICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzZXRNYXRjaGVkKTsKCiAgICAgICAgICAgIC8vIFNlZWRsZXNzIHNldCBtYXRjaGVzIHN1Y2NlZWRpbmcgbXVsdGlwbGUgc3VjY2Vzc2Z1bCBtYXRjaGVycyBzdGlwdWxhdGUgc29ydGluZwogICAgICAgICAgICBpZiAob3V0ZXJtb3N0ICYmICFzZWVkICYmIHNldE1hdGNoZWQubGVuZ3RoID4gMCAmJiBtYXRjaGVkQ291bnQgKyBzZXRNYXRjaGVycy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgU2l6emxlLnVuaXF1ZVNvcnQocmVzdWx0cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBPdmVycmlkZSBtYW5pcHVsYXRpb24gb2YgZ2xvYmFscyBieSBuZXN0ZWQgbWF0Y2hlcnMKICAgICAgICAgIGlmIChvdXRlcm1vc3QpIHsKICAgICAgICAgICAgZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CiAgICAgICAgICAgIG91dGVybW9zdENvbnRleHQgPSBjb250ZXh0QmFja3VwOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHVubWF0Y2hlZDsKICAgICAgICB9OwogICAgICByZXR1cm4gYnlTZXQgPyBtYXJrRnVuY3Rpb24oc3VwZXJNYXRjaGVyKSA6IHN1cGVyTWF0Y2hlcjsKICAgIH0KICAgIGNvbXBpbGUgPSBTaXp6bGUuY29tcGlsZSA9IGZ1bmN0aW9uIChzZWxlY3RvciwgbWF0Y2ggLyogSW50ZXJuYWwgVXNlIE9ubHkgKi8pIHsKICAgICAgdmFyIGksCiAgICAgICAgc2V0TWF0Y2hlcnMgPSBbXSwKICAgICAgICBlbGVtZW50TWF0Y2hlcnMgPSBbXSwKICAgICAgICBjYWNoZWQgPSBjb21waWxlckNhY2hlW3NlbGVjdG9yICsgIiAiXTsKICAgICAgaWYgKCFjYWNoZWQpIHsKICAgICAgICAvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICBtYXRjaCA9IHRva2VuaXplKHNlbGVjdG9yKTsKICAgICAgICB9CiAgICAgICAgaSA9IG1hdGNoLmxlbmd0aDsKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBjYWNoZWQgPSBtYXRjaGVyRnJvbVRva2VucyhtYXRjaFtpXSk7CiAgICAgICAgICBpZiAoY2FjaGVkW2V4cGFuZG9dKSB7CiAgICAgICAgICAgIHNldE1hdGNoZXJzLnB1c2goY2FjaGVkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsZW1lbnRNYXRjaGVycy5wdXNoKGNhY2hlZCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDYWNoZSB0aGUgY29tcGlsZWQgZnVuY3Rpb24KICAgICAgICBjYWNoZWQgPSBjb21waWxlckNhY2hlKHNlbGVjdG9yLCBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycykpOwoKICAgICAgICAvLyBTYXZlIHNlbGVjdG9yIGFuZCB0b2tlbml6YXRpb24KICAgICAgICBjYWNoZWQuc2VsZWN0b3IgPSBzZWxlY3RvcjsKICAgICAgfQogICAgICByZXR1cm4gY2FjaGVkOwogICAgfTsKCiAgICAvKioKICAgICAqIEEgbG93LWxldmVsIHNlbGVjdGlvbiBmdW5jdGlvbiB0aGF0IHdvcmtzIHdpdGggU2l6emxlJ3MgY29tcGlsZWQKICAgICAqICBzZWxlY3RvciBmdW5jdGlvbnMKICAgICAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBzZWxlY3RvciBBIHNlbGVjdG9yIG9yIGEgcHJlLWNvbXBpbGVkCiAgICAgKiAgc2VsZWN0b3IgZnVuY3Rpb24gYnVpbHQgd2l0aCBTaXp6bGUuY29tcGlsZQogICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0CiAgICAgKiBAcGFyYW0ge0FycmF5fSBbcmVzdWx0c10KICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzZWVkXSBBIHNldCBvZiBlbGVtZW50cyB0byBtYXRjaCBhZ2FpbnN0CiAgICAgKi8KICAgIHNlbGVjdCA9IFNpenpsZS5zZWxlY3QgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQpIHsKICAgICAgdmFyIGksCiAgICAgICAgdG9rZW5zLAogICAgICAgIHRva2VuLAogICAgICAgIHR5cGUsCiAgICAgICAgZmluZCwKICAgICAgICBjb21waWxlZCA9IHR5cGVvZiBzZWxlY3RvciA9PT0gImZ1bmN0aW9uIiAmJiBzZWxlY3RvciwKICAgICAgICBtYXRjaCA9ICFzZWVkICYmIHRva2VuaXplKHNlbGVjdG9yID0gY29tcGlsZWQuc2VsZWN0b3IgfHwgc2VsZWN0b3IpOwogICAgICByZXN1bHRzID0gcmVzdWx0cyB8fCBbXTsKCiAgICAgIC8vIFRyeSB0byBtaW5pbWl6ZSBvcGVyYXRpb25zIGlmIHRoZXJlIGlzIG9ubHkgb25lIHNlbGVjdG9yIGluIHRoZSBsaXN0IGFuZCBubyBzZWVkCiAgICAgIC8vICh0aGUgbGF0dGVyIG9mIHdoaWNoIGd1YXJhbnRlZXMgdXMgY29udGV4dCkKICAgICAgaWYgKG1hdGNoLmxlbmd0aCA9PT0gMSkgewogICAgICAgIC8vIFJlZHVjZSBjb250ZXh0IGlmIHRoZSBsZWFkaW5nIGNvbXBvdW5kIHNlbGVjdG9yIGlzIGFuIElECiAgICAgICAgdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSgwKTsKICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA+IDIgJiYgKHRva2VuID0gdG9rZW5zWzBdKS50eXBlID09PSAiSUQiICYmIGNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgZG9jdW1lbnRJc0hUTUwgJiYgRXhwci5yZWxhdGl2ZVt0b2tlbnNbMV0udHlwZV0pIHsKICAgICAgICAgIGNvbnRleHQgPSAoRXhwci5maW5kWyJJRCJdKHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSksIGNvbnRleHQpIHx8IFtdKVswXTsKICAgICAgICAgIGlmICghY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKCiAgICAgICAgICAgIC8vIFByZWNvbXBpbGVkIG1hdGNoZXJzIHdpbGwgc3RpbGwgdmVyaWZ5IGFuY2VzdHJ5LCBzbyBzdGVwIHVwIGEgbGV2ZWwKICAgICAgICAgIH0gZWxzZSBpZiAoY29tcGlsZWQpIHsKICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHQucGFyZW50Tm9kZTsKICAgICAgICAgIH0KICAgICAgICAgIHNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UodG9rZW5zLnNoaWZ0KCkudmFsdWUubGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIC8vIEZldGNoIGEgc2VlZCBzZXQgZm9yIHJpZ2h0LXRvLWxlZnQgbWF0Y2hpbmcKICAgICAgICBpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KHNlbGVjdG9yKSA/IDAgOiB0b2tlbnMubGVuZ3RoOwogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgIHRva2VuID0gdG9rZW5zW2ldOwoKICAgICAgICAgIC8vIEFib3J0IGlmIHdlIGhpdCBhIGNvbWJpbmF0b3IKICAgICAgICAgIGlmIChFeHByLnJlbGF0aXZlW3R5cGUgPSB0b2tlbi50eXBlXSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChmaW5kID0gRXhwci5maW5kW3R5cGVdKSB7CiAgICAgICAgICAgIC8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwogICAgICAgICAgICBpZiAoc2VlZCA9IGZpbmQodG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKSwgcnNpYmxpbmcudGVzdCh0b2tlbnNbMF0udHlwZSkgJiYgdGVzdENvbnRleHQoY29udGV4dC5wYXJlbnROb2RlKSB8fCBjb250ZXh0KSkgewogICAgICAgICAgICAgIC8vIElmIHNlZWQgaXMgZW1wdHkgb3Igbm8gdG9rZW5zIHJlbWFpbiwgd2UgY2FuIHJldHVybiBlYXJseQogICAgICAgICAgICAgIHRva2Vucy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgc2VsZWN0b3IgPSBzZWVkLmxlbmd0aCAmJiB0b1NlbGVjdG9yKHRva2Vucyk7CiAgICAgICAgICAgICAgaWYgKCFzZWxlY3RvcikgewogICAgICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzZWVkKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gQ29tcGlsZSBhbmQgZXhlY3V0ZSBhIGZpbHRlcmluZyBmdW5jdGlvbiBpZiBvbmUgaXMgbm90IHByb3ZpZGVkCiAgICAgIC8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmUKICAgICAgKGNvbXBpbGVkIHx8IGNvbXBpbGUoc2VsZWN0b3IsIG1hdGNoKSkoc2VlZCwgY29udGV4dCwgIWRvY3VtZW50SXNIVE1MLCByZXN1bHRzLCAhY29udGV4dCB8fCByc2libGluZy50ZXN0KHNlbGVjdG9yKSAmJiB0ZXN0Q29udGV4dChjb250ZXh0LnBhcmVudE5vZGUpIHx8IGNvbnRleHQpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH07CgogICAgLy8gT25lLXRpbWUgYXNzaWdubWVudHMKCiAgICAvLyBTb3J0IHN0YWJpbGl0eQogICAgc3VwcG9ydC5zb3J0U3RhYmxlID0gZXhwYW5kby5zcGxpdCgiIikuc29ydChzb3J0T3JkZXIpLmpvaW4oIiIpID09PSBleHBhbmRvOwoKICAgIC8vIFN1cHBvcnQ6IENocm9tZSAxNC0zNSsKICAgIC8vIEFsd2F5cyBhc3N1bWUgZHVwbGljYXRlcyBpZiB0aGV5IGFyZW4ndCBwYXNzZWQgdG8gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24KICAgIHN1cHBvcnQuZGV0ZWN0RHVwbGljYXRlcyA9ICEhaGFzRHVwbGljYXRlOwoKICAgIC8vIEluaXRpYWxpemUgYWdhaW5zdCB0aGUgZGVmYXVsdCBkb2N1bWVudAogICAgc2V0RG9jdW1lbnQoKTsKCiAgICAvLyBTdXBwb3J0OiBXZWJraXQ8NTM3LjMyIC0gU2FmYXJpIDYuMC4zL0Nocm9tZSAyNSAoZml4ZWQgaW4gQ2hyb21lIDI3KQogICAgLy8gRGV0YWNoZWQgbm9kZXMgY29uZm91bmRpbmdseSBmb2xsb3cgKmVhY2ggb3RoZXIqCiAgICBzdXBwb3J0LnNvcnREZXRhY2hlZCA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgLy8gU2hvdWxkIHJldHVybiAxLCBidXQgcmV0dXJucyA0IChmb2xsb3dpbmcpCiAgICAgIHJldHVybiBlbC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpKSAmIDE7CiAgICB9KTsKCiAgICAvLyBTdXBwb3J0OiBJRTw4CiAgICAvLyBQcmV2ZW50IGF0dHJpYnV0ZS9wcm9wZXJ0eSAiaW50ZXJwb2xhdGlvbiIKICAgIC8vIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvbXM1MzY0MjklMjhWUy44NSUyOS5hc3B4CiAgICBpZiAoIWFzc2VydChmdW5jdGlvbiAoZWwpIHsKICAgICAgZWwuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwogICAgICByZXR1cm4gZWwuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIiMiOwogICAgfSkpIHsKICAgICAgYWRkSGFuZGxlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIiwgZnVuY3Rpb24gKGVsZW0sIG5hbWUsIGlzWE1MKSB7CiAgICAgICAgaWYgKCFpc1hNTCkgewogICAgICAgICAgcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKG5hbWUsIG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gInR5cGUiID8gMSA6IDIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLy8gU3VwcG9ydDogSUU8OQogICAgLy8gVXNlIGRlZmF1bHRWYWx1ZSBpbiBwbGFjZSBvZiBnZXRBdHRyaWJ1dGUoInZhbHVlIikKICAgIGlmICghc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFhc3NlcnQoZnVuY3Rpb24gKGVsKSB7CiAgICAgIGVsLmlubmVySFRNTCA9ICI8aW5wdXQvPiI7CiAgICAgIGVsLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiKTsKICAgICAgcmV0dXJuIGVsLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSAiIjsKICAgIH0pKSB7CiAgICAgIGFkZEhhbmRsZSgidmFsdWUiLCBmdW5jdGlvbiAoZWxlbSwgX25hbWUsIGlzWE1MKSB7CiAgICAgICAgaWYgKCFpc1hNTCAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJpbnB1dCIpIHsKICAgICAgICAgIHJldHVybiBlbGVtLmRlZmF1bHRWYWx1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8vIFN1cHBvcnQ6IElFPDkKICAgIC8vIFVzZSBnZXRBdHRyaWJ1dGVOb2RlIHRvIGZldGNoIGJvb2xlYW5zIHdoZW4gZ2V0QXR0cmlidXRlIGxpZXMKICAgIGlmICghYXNzZXJ0KGZ1bmN0aW9uIChlbCkgewogICAgICByZXR1cm4gZWwuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09IG51bGw7CiAgICB9KSkgewogICAgICBhZGRIYW5kbGUoYm9vbGVhbnMsIGZ1bmN0aW9uIChlbGVtLCBuYW1lLCBpc1hNTCkgewogICAgICAgIHZhciB2YWw7CiAgICAgICAgaWYgKCFpc1hNTCkgewogICAgICAgICAgcmV0dXJuIGVsZW1bbmFtZV0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOiAodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8gdmFsLnZhbHVlIDogbnVsbDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIFNpenpsZTsKICB9KHdpbmRvdyk7CiAgalF1ZXJ5LmZpbmQgPSBTaXp6bGU7CiAgalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwoKICAvLyBEZXByZWNhdGVkCiAgalF1ZXJ5LmV4cHJbIjoiXSA9IGpRdWVyeS5leHByLnBzZXVkb3M7CiAgalF1ZXJ5LnVuaXF1ZVNvcnQgPSBqUXVlcnkudW5pcXVlID0gU2l6emxlLnVuaXF1ZVNvcnQ7CiAgalF1ZXJ5LnRleHQgPSBTaXp6bGUuZ2V0VGV4dDsKICBqUXVlcnkuaXNYTUxEb2MgPSBTaXp6bGUuaXNYTUw7CiAgalF1ZXJ5LmNvbnRhaW5zID0gU2l6emxlLmNvbnRhaW5zOwogIGpRdWVyeS5lc2NhcGVTZWxlY3RvciA9IFNpenpsZS5lc2NhcGU7CiAgdmFyIGRpciA9IGZ1bmN0aW9uIGRpcihlbGVtLCBfZGlyLCB1bnRpbCkgewogICAgdmFyIG1hdGNoZWQgPSBbXSwKICAgICAgdHJ1bmNhdGUgPSB1bnRpbCAhPT0gdW5kZWZpbmVkOwogICAgd2hpbGUgKChlbGVtID0gZWxlbVtfZGlyXSkgJiYgZWxlbS5ub2RlVHlwZSAhPT0gOSkgewogICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgIGlmICh0cnVuY2F0ZSAmJiBqUXVlcnkoZWxlbSkuaXModW50aWwpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbWF0Y2hlZC5wdXNoKGVsZW0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWF0Y2hlZDsKICB9OwogIHZhciBfc2libGluZ3MgPSBmdW5jdGlvbiBzaWJsaW5ncyhuLCBlbGVtKSB7CiAgICB2YXIgbWF0Y2hlZCA9IFtdOwogICAgZm9yICg7IG47IG4gPSBuLm5leHRTaWJsaW5nKSB7CiAgICAgIGlmIChuLm5vZGVUeXBlID09PSAxICYmIG4gIT09IGVsZW0pIHsKICAgICAgICBtYXRjaGVkLnB1c2gobik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXRjaGVkOwogIH07CiAgdmFyIHJuZWVkc0NvbnRleHQgPSBqUXVlcnkuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQ7CiAgZnVuY3Rpb24gbm9kZU5hbWUoZWxlbSwgbmFtZSkgewogICAgcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgfQogIDsKICB2YXIgcnNpbmdsZVRhZyA9IC9ePChbYS16XVteXC9cMD46XHgyMFx0XHJcblxmXSopW1x4MjBcdFxyXG5cZl0qXC8/Pig/OjxcL1wxPnwpJC9pOwoKICAvLyBJbXBsZW1lbnQgdGhlIGlkZW50aWNhbCBmdW5jdGlvbmFsaXR5IGZvciBmaWx0ZXIgYW5kIG5vdAogIGZ1bmN0aW9uIHdpbm5vdyhlbGVtZW50cywgcXVhbGlmaWVyLCBub3QpIHsKICAgIGlmIChpc0Z1bmN0aW9uKHF1YWxpZmllcikpIHsKICAgICAgcmV0dXJuIGpRdWVyeS5ncmVwKGVsZW1lbnRzLCBmdW5jdGlvbiAoZWxlbSwgaSkgewogICAgICAgIHJldHVybiAhIXF1YWxpZmllci5jYWxsKGVsZW0sIGksIGVsZW0pICE9PSBub3Q7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIFNpbmdsZSBlbGVtZW50CiAgICBpZiAocXVhbGlmaWVyLm5vZGVUeXBlKSB7CiAgICAgIHJldHVybiBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICByZXR1cm4gZWxlbSA9PT0gcXVhbGlmaWVyICE9PSBub3Q7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIEFycmF5bGlrZSBvZiBlbGVtZW50cyAoalF1ZXJ5LCBhcmd1bWVudHMsIEFycmF5KQogICAgaWYgKHR5cGVvZiBxdWFsaWZpZXIgIT09ICJzdHJpbmciKSB7CiAgICAgIHJldHVybiBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICByZXR1cm4gaW5kZXhPZi5jYWxsKHF1YWxpZmllciwgZWxlbSkgPiAtMSAhPT0gbm90OwogICAgICB9KTsKICAgIH0KCiAgICAvLyBGaWx0ZXJlZCBkaXJlY3RseSBmb3IgYm90aCBzaW1wbGUgYW5kIGNvbXBsZXggc2VsZWN0b3JzCiAgICByZXR1cm4galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGVsZW1lbnRzLCBub3QpOwogIH0KICBqUXVlcnkuZmlsdGVyID0gZnVuY3Rpb24gKGV4cHIsIGVsZW1zLCBub3QpIHsKICAgIHZhciBlbGVtID0gZWxlbXNbMF07CiAgICBpZiAobm90KSB7CiAgICAgIGV4cHIgPSAiOm5vdCgiICsgZXhwciArICIpIjsKICAgIH0KICAgIGlmIChlbGVtcy5sZW5ndGggPT09IDEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICByZXR1cm4galF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKGVsZW0sIGV4cHIpID8gW2VsZW1dIDogW107CiAgICB9CiAgICByZXR1cm4galF1ZXJ5LmZpbmQubWF0Y2hlcyhleHByLCBqUXVlcnkuZ3JlcChlbGVtcywgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgcmV0dXJuIGVsZW0ubm9kZVR5cGUgPT09IDE7CiAgICB9KSk7CiAgfTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQoc2VsZWN0b3IpIHsKICAgICAgdmFyIGksCiAgICAgICAgcmV0LAogICAgICAgIGxlbiA9IHRoaXMubGVuZ3RoLAogICAgICAgIHNlbGYgPSB0aGlzOwogICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayhqUXVlcnkoc2VsZWN0b3IpLmZpbHRlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaWYgKGpRdWVyeS5jb250YWlucyhzZWxmW2ldLCB0aGlzKSkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgICB9CiAgICAgIHJldCA9IHRoaXMucHVzaFN0YWNrKFtdKTsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgalF1ZXJ5LmZpbmQoc2VsZWN0b3IsIHNlbGZbaV0sIHJldCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlU29ydChyZXQpIDogcmV0OwogICAgfSwKICAgIGZpbHRlcjogZnVuY3Rpb24gZmlsdGVyKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnB1c2hTdGFjayh3aW5ub3codGhpcywgc2VsZWN0b3IgfHwgW10sIGZhbHNlKSk7CiAgICB9LAogICAgbm90OiBmdW5jdGlvbiBub3Qoc2VsZWN0b3IpIHsKICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKHdpbm5vdyh0aGlzLCBzZWxlY3RvciB8fCBbXSwgdHJ1ZSkpOwogICAgfSwKICAgIGlzOiBmdW5jdGlvbiBpcyhzZWxlY3RvcikgewogICAgICByZXR1cm4gISF3aW5ub3codGhpcywKICAgICAgLy8gSWYgdGhpcyBpcyBhIHBvc2l0aW9uYWwvcmVsYXRpdmUgc2VsZWN0b3IsIGNoZWNrIG1lbWJlcnNoaXAgaW4gdGhlIHJldHVybmVkIHNldAogICAgICAvLyBzbyAkKCJwOmZpcnN0IikuaXMoInA6bGFzdCIpIHdvbid0IHJldHVybiB0cnVlIGZvciBhIGRvYyB3aXRoIHR3byAicCIuCiAgICAgIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgJiYgcm5lZWRzQ29udGV4dC50ZXN0KHNlbGVjdG9yKSA/IGpRdWVyeShzZWxlY3RvcikgOiBzZWxlY3RvciB8fCBbXSwgZmFsc2UpLmxlbmd0aDsKICAgIH0KICB9KTsKCiAgLy8gSW5pdGlhbGl6ZSBhIGpRdWVyeSBvYmplY3QKCiAgLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpCiAgdmFyIHJvb3RqUXVlcnksCiAgICAvLyBBIHNpbXBsZSB3YXkgdG8gY2hlY2sgZm9yIEhUTUwgc3RyaW5ncwogICAgLy8gUHJpb3JpdGl6ZSAjaWQgb3ZlciA8dGFnPiB0byBhdm9pZCBYU1MgdmlhIGxvY2F0aW9uLmhhc2ggKCM5NTIxKQogICAgLy8gU3RyaWN0IEhUTUwgcmVjb2duaXRpb24gKCMxMTI5MDogbXVzdCBzdGFydCB3aXRoIDwpCiAgICAvLyBTaG9ydGN1dCBzaW1wbGUgI2lkIGNhc2UgZm9yIHNwZWVkCiAgICBycXVpY2tFeHByID0gL14oPzpccyooPFtcd1xXXSs+KVtePl0qfCMoW1x3LV0rKSkkLywKICAgIGluaXQgPSBqUXVlcnkuZm4uaW5pdCA9IGZ1bmN0aW9uIChzZWxlY3RvciwgY29udGV4dCwgcm9vdCkgewogICAgICB2YXIgbWF0Y2gsIGVsZW07CgogICAgICAvLyBIQU5ETEU6ICQoIiIpLCAkKG51bGwpLCAkKHVuZGVmaW5lZCksICQoZmFsc2UpCiAgICAgIGlmICghc2VsZWN0b3IpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgLy8gTWV0aG9kIGluaXQoKSBhY2NlcHRzIGFuIGFsdGVybmF0ZSByb290alF1ZXJ5CiAgICAgIC8vIHNvIG1pZ3JhdGUgY2FuIHN1cHBvcnQgalF1ZXJ5LnN1YiAoZ2gtMjEwMSkKICAgICAgcm9vdCA9IHJvb3QgfHwgcm9vdGpRdWVyeTsKCiAgICAgIC8vIEhhbmRsZSBIVE1MIHN0cmluZ3MKICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIpIHsKICAgICAgICBpZiAoc2VsZWN0b3JbMF0gPT09ICI8IiAmJiBzZWxlY3RvcltzZWxlY3Rvci5sZW5ndGggLSAxXSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzKSB7CiAgICAgICAgICAvLyBBc3N1bWUgdGhhdCBzdHJpbmdzIHRoYXQgc3RhcnQgYW5kIGVuZCB3aXRoIDw+IGFyZSBIVE1MIGFuZCBza2lwIHRoZSByZWdleCBjaGVjawogICAgICAgICAgbWF0Y2ggPSBbbnVsbCwgc2VsZWN0b3IsIG51bGxdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyhzZWxlY3Rvcik7CiAgICAgICAgfQoKICAgICAgICAvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCiAgICAgICAgaWYgKG1hdGNoICYmIChtYXRjaFsxXSB8fCAhY29udGV4dCkpIHsKICAgICAgICAgIC8vIEhBTkRMRTogJChodG1sKSAtPiAkKGFycmF5KQogICAgICAgICAgaWYgKG1hdGNoWzFdKSB7CiAgICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0IGluc3RhbmNlb2YgalF1ZXJ5ID8gY29udGV4dFswXSA6IGNvbnRleHQ7CgogICAgICAgICAgICAvLyBPcHRpb24gdG8gcnVuIHNjcmlwdHMgaXMgdHJ1ZSBmb3IgYmFjay1jb21wYXQKICAgICAgICAgICAgLy8gSW50ZW50aW9uYWxseSBsZXQgdGhlIGVycm9yIGJlIHRocm93biBpZiBwYXJzZUhUTUwgaXMgbm90IHByZXNlbnQKICAgICAgICAgICAgalF1ZXJ5Lm1lcmdlKHRoaXMsIGpRdWVyeS5wYXJzZUhUTUwobWF0Y2hbMV0sIGNvbnRleHQgJiYgY29udGV4dC5ub2RlVHlwZSA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogZG9jdW1lbnQsIHRydWUpKTsKCiAgICAgICAgICAgIC8vIEhBTkRMRTogJChodG1sLCBwcm9wcykKICAgICAgICAgICAgaWYgKHJzaW5nbGVUYWcudGVzdChtYXRjaFsxXSkgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29udGV4dCkpIHsKICAgICAgICAgICAgICBmb3IgKG1hdGNoIGluIGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIC8vIFByb3BlcnRpZXMgb2YgY29udGV4dCBhcmUgY2FsbGVkIGFzIG1ldGhvZHMgaWYgcG9zc2libGUKICAgICAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKHRoaXNbbWF0Y2hdKSkgewogICAgICAgICAgICAgICAgICB0aGlzW21hdGNoXShjb250ZXh0W21hdGNoXSk7CgogICAgICAgICAgICAgICAgICAvLyAuLi5hbmQgb3RoZXJ3aXNlIHNldCBhcyBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmF0dHIobWF0Y2gsIGNvbnRleHRbbWF0Y2hdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgogICAgICAgICAgICAvLyBIQU5ETEU6ICQoI2lkKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1hdGNoWzJdKTsKICAgICAgICAgICAgaWYgKGVsZW0pIHsKICAgICAgICAgICAgICAvLyBJbmplY3QgdGhlIGVsZW1lbnQgZGlyZWN0bHkgaW50byB0aGUgalF1ZXJ5IG9iamVjdAogICAgICAgICAgICAgIHRoaXNbMF0gPSBlbGVtOwogICAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKQogICAgICAgIH0gZWxzZSBpZiAoIWNvbnRleHQgfHwgY29udGV4dC5qcXVlcnkpIHsKICAgICAgICAgIHJldHVybiAoY29udGV4dCB8fCByb290KS5maW5kKHNlbGVjdG9yKTsKCiAgICAgICAgICAvLyBIQU5ETEU6ICQoZXhwciwgY29udGV4dCkKICAgICAgICAgIC8vICh3aGljaCBpcyBqdXN0IGVxdWl2YWxlbnQgdG86ICQoY29udGV4dCkuZmluZChleHByKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvcihjb250ZXh0KS5maW5kKHNlbGVjdG9yKTsKICAgICAgICB9CgogICAgICAgIC8vIEhBTkRMRTogJChET01FbGVtZW50KQogICAgICB9IGVsc2UgaWYgKHNlbGVjdG9yLm5vZGVUeXBlKSB7CiAgICAgICAgdGhpc1swXSA9IHNlbGVjdG9yOwogICAgICAgIHRoaXMubGVuZ3RoID0gMTsKICAgICAgICByZXR1cm4gdGhpczsKCiAgICAgICAgLy8gSEFORExFOiAkKGZ1bmN0aW9uKQogICAgICAgIC8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeQogICAgICB9IGVsc2UgaWYgKGlzRnVuY3Rpb24oc2VsZWN0b3IpKSB7CiAgICAgICAgcmV0dXJuIHJvb3QucmVhZHkgIT09IHVuZGVmaW5lZCA/IHJvb3QucmVhZHkoc2VsZWN0b3IpIDoKICAgICAgICAvLyBFeGVjdXRlIGltbWVkaWF0ZWx5IGlmIHJlYWR5IGlzIG5vdCBwcmVzZW50CiAgICAgICAgc2VsZWN0b3IoalF1ZXJ5KTsKICAgICAgfQogICAgICByZXR1cm4galF1ZXJ5Lm1ha2VBcnJheShzZWxlY3RvciwgdGhpcyk7CiAgICB9OwoKICAvLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCiAgaW5pdC5wcm90b3R5cGUgPSBqUXVlcnkuZm47CgogIC8vIEluaXRpYWxpemUgY2VudHJhbCByZWZlcmVuY2UKICByb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsKICB2YXIgcnBhcmVudHNwcmV2ID0gL14oPzpwYXJlbnRzfHByZXYoPzpVbnRpbHxBbGwpKS8sCiAgICAvLyBNZXRob2RzIGd1YXJhbnRlZWQgdG8gcHJvZHVjZSBhIHVuaXF1ZSBzZXQgd2hlbiBzdGFydGluZyBmcm9tIGEgdW5pcXVlIHNldAogICAgZ3VhcmFudGVlZFVuaXF1ZSA9IHsKICAgICAgY2hpbGRyZW46IHRydWUsCiAgICAgIGNvbnRlbnRzOiB0cnVlLAogICAgICBuZXh0OiB0cnVlLAogICAgICBwcmV2OiB0cnVlCiAgICB9OwogIGpRdWVyeS5mbi5leHRlbmQoewogICAgaGFzOiBmdW5jdGlvbiBoYXModGFyZ2V0KSB7CiAgICAgIHZhciB0YXJnZXRzID0galF1ZXJ5KHRhcmdldCwgdGhpcyksCiAgICAgICAgbCA9IHRhcmdldHMubGVuZ3RoOwogICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBpID0gMDsKICAgICAgICBmb3IgKDsgaSA8IGw7IGkrKykgewogICAgICAgICAgaWYgKGpRdWVyeS5jb250YWlucyh0aGlzLCB0YXJnZXRzW2ldKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNsb3Nlc3Q6IGZ1bmN0aW9uIGNsb3Nlc3Qoc2VsZWN0b3JzLCBjb250ZXh0KSB7CiAgICAgIHZhciBjdXIsCiAgICAgICAgaSA9IDAsCiAgICAgICAgbCA9IHRoaXMubGVuZ3RoLAogICAgICAgIG1hdGNoZWQgPSBbXSwKICAgICAgICB0YXJnZXRzID0gdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgJiYgalF1ZXJ5KHNlbGVjdG9ycyk7CgogICAgICAvLyBQb3NpdGlvbmFsIHNlbGVjdG9ycyBuZXZlciBtYXRjaCwgc2luY2UgdGhlcmUncyBubyBfc2VsZWN0aW9uXyBjb250ZXh0CiAgICAgIGlmICghcm5lZWRzQ29udGV4dC50ZXN0KHNlbGVjdG9ycykpIHsKICAgICAgICBmb3IgKDsgaSA8IGw7IGkrKykgewogICAgICAgICAgZm9yIChjdXIgPSB0aGlzW2ldOyBjdXIgJiYgY3VyICE9PSBjb250ZXh0OyBjdXIgPSBjdXIucGFyZW50Tm9kZSkgewogICAgICAgICAgICAvLyBBbHdheXMgc2tpcCBkb2N1bWVudCBmcmFnbWVudHMKICAgICAgICAgICAgaWYgKGN1ci5ub2RlVHlwZSA8IDExICYmICh0YXJnZXRzID8gdGFyZ2V0cy5pbmRleChjdXIpID4gLTEgOgogICAgICAgICAgICAvLyBEb24ndCBwYXNzIG5vbi1lbGVtZW50cyB0byBTaXp6bGUKICAgICAgICAgICAgY3VyLm5vZGVUeXBlID09PSAxICYmIGpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihjdXIsIHNlbGVjdG9ycykpKSB7CiAgICAgICAgICAgICAgbWF0Y2hlZC5wdXNoKGN1cik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKG1hdGNoZWQubGVuZ3RoID4gMSA/IGpRdWVyeS51bmlxdWVTb3J0KG1hdGNoZWQpIDogbWF0Y2hlZCk7CiAgICB9LAogICAgLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbiB0aGUgc2V0CiAgICBpbmRleDogZnVuY3Rpb24gaW5kZXgoZWxlbSkgewogICAgICAvLyBObyBhcmd1bWVudCwgcmV0dXJuIGluZGV4IGluIHBhcmVudAogICAgICBpZiAoIWVsZW0pIHsKICAgICAgICByZXR1cm4gdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xOwogICAgICB9CgogICAgICAvLyBJbmRleCBpbiBzZWxlY3RvcgogICAgICBpZiAodHlwZW9mIGVsZW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgcmV0dXJuIGluZGV4T2YuY2FsbChqUXVlcnkoZWxlbSksIHRoaXNbMF0pOwogICAgICB9CgogICAgICAvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKICAgICAgcmV0dXJuIGluZGV4T2YuY2FsbCh0aGlzLAogICAgICAvLyBJZiBpdCByZWNlaXZlcyBhIGpRdWVyeSBvYmplY3QsIHRoZSBmaXJzdCBlbGVtZW50IGlzIHVzZWQKICAgICAgZWxlbS5qcXVlcnkgPyBlbGVtWzBdIDogZWxlbSk7CiAgICB9LAogICAgYWRkOiBmdW5jdGlvbiBhZGQoc2VsZWN0b3IsIGNvbnRleHQpIHsKICAgICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGpRdWVyeS51bmlxdWVTb3J0KGpRdWVyeS5tZXJnZSh0aGlzLmdldCgpLCBqUXVlcnkoc2VsZWN0b3IsIGNvbnRleHQpKSkpOwogICAgfSwKICAgIGFkZEJhY2s6IGZ1bmN0aW9uIGFkZEJhY2soc2VsZWN0b3IpIHsKICAgICAgcmV0dXJuIHRoaXMuYWRkKHNlbGVjdG9yID09IG51bGwgPyB0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKSk7CiAgICB9CiAgfSk7CiAgZnVuY3Rpb24gc2libGluZyhjdXIsIGRpcikgewogICAgd2hpbGUgKChjdXIgPSBjdXJbZGlyXSkgJiYgY3VyLm5vZGVUeXBlICE9PSAxKSB7fQogICAgcmV0dXJuIGN1cjsKICB9CiAgalF1ZXJ5LmVhY2goewogICAgcGFyZW50OiBmdW5jdGlvbiBwYXJlbnQoZWxlbSkgewogICAgICB2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwogICAgICByZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsOwogICAgfSwKICAgIHBhcmVudHM6IGZ1bmN0aW9uIHBhcmVudHMoZWxlbSkgewogICAgICByZXR1cm4gZGlyKGVsZW0sICJwYXJlbnROb2RlIik7CiAgICB9LAogICAgcGFyZW50c1VudGlsOiBmdW5jdGlvbiBwYXJlbnRzVW50aWwoZWxlbSwgX2ksIHVudGlsKSB7CiAgICAgIHJldHVybiBkaXIoZWxlbSwgInBhcmVudE5vZGUiLCB1bnRpbCk7CiAgICB9LAogICAgbmV4dDogZnVuY3Rpb24gbmV4dChlbGVtKSB7CiAgICAgIHJldHVybiBzaWJsaW5nKGVsZW0sICJuZXh0U2libGluZyIpOwogICAgfSwKICAgIHByZXY6IGZ1bmN0aW9uIHByZXYoZWxlbSkgewogICAgICByZXR1cm4gc2libGluZyhlbGVtLCAicHJldmlvdXNTaWJsaW5nIik7CiAgICB9LAogICAgbmV4dEFsbDogZnVuY3Rpb24gbmV4dEFsbChlbGVtKSB7CiAgICAgIHJldHVybiBkaXIoZWxlbSwgIm5leHRTaWJsaW5nIik7CiAgICB9LAogICAgcHJldkFsbDogZnVuY3Rpb24gcHJldkFsbChlbGVtKSB7CiAgICAgIHJldHVybiBkaXIoZWxlbSwgInByZXZpb3VzU2libGluZyIpOwogICAgfSwKICAgIG5leHRVbnRpbDogZnVuY3Rpb24gbmV4dFVudGlsKGVsZW0sIF9pLCB1bnRpbCkgewogICAgICByZXR1cm4gZGlyKGVsZW0sICJuZXh0U2libGluZyIsIHVudGlsKTsKICAgIH0sCiAgICBwcmV2VW50aWw6IGZ1bmN0aW9uIHByZXZVbnRpbChlbGVtLCBfaSwgdW50aWwpIHsKICAgICAgcmV0dXJuIGRpcihlbGVtLCAicHJldmlvdXNTaWJsaW5nIiwgdW50aWwpOwogICAgfSwKICAgIHNpYmxpbmdzOiBmdW5jdGlvbiBzaWJsaW5ncyhlbGVtKSB7CiAgICAgIHJldHVybiBfc2libGluZ3MoKGVsZW0ucGFyZW50Tm9kZSB8fCB7fSkuZmlyc3RDaGlsZCwgZWxlbSk7CiAgICB9LAogICAgY2hpbGRyZW46IGZ1bmN0aW9uIGNoaWxkcmVuKGVsZW0pIHsKICAgICAgcmV0dXJuIF9zaWJsaW5ncyhlbGVtLmZpcnN0Q2hpbGQpOwogICAgfSwKICAgIGNvbnRlbnRzOiBmdW5jdGlvbiBjb250ZW50cyhlbGVtKSB7CiAgICAgIGlmIChlbGVtLmNvbnRlbnREb2N1bWVudCAhPSBudWxsICYmCiAgICAgIC8vIFN1cHBvcnQ6IElFIDExKwogICAgICAvLyA8b2JqZWN0PiBlbGVtZW50cyB3aXRoIG5vIGBkYXRhYCBhdHRyaWJ1dGUgaGFzIGFuIG9iamVjdAogICAgICAvLyBgY29udGVudERvY3VtZW50YCB3aXRoIGEgYG51bGxgIHByb3RvdHlwZS4KICAgICAgZ2V0UHJvdG8oZWxlbS5jb250ZW50RG9jdW1lbnQpKSB7CiAgICAgICAgcmV0dXJuIGVsZW0uY29udGVudERvY3VtZW50OwogICAgICB9CgogICAgICAvLyBTdXBwb3J0OiBJRSA5IC0gMTEgb25seSwgaU9TIDcgb25seSwgQW5kcm9pZCBCcm93c2VyIDw9NC4zIG9ubHkKICAgICAgLy8gVHJlYXQgdGhlIHRlbXBsYXRlIGVsZW1lbnQgYXMgYSByZWd1bGFyIG9uZSBpbiBicm93c2VycyB0aGF0CiAgICAgIC8vIGRvbid0IHN1cHBvcnQgaXQuCiAgICAgIGlmIChub2RlTmFtZShlbGVtLCAidGVtcGxhdGUiKSkgewogICAgICAgIGVsZW0gPSBlbGVtLmNvbnRlbnQgfHwgZWxlbTsKICAgICAgfQogICAgICByZXR1cm4galF1ZXJ5Lm1lcmdlKFtdLCBlbGVtLmNoaWxkTm9kZXMpOwogICAgfQogIH0sIGZ1bmN0aW9uIChuYW1lLCBmbikgewogICAgalF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24gKHVudGlsLCBzZWxlY3RvcikgewogICAgICB2YXIgbWF0Y2hlZCA9IGpRdWVyeS5tYXAodGhpcywgZm4sIHVudGlsKTsKICAgICAgaWYgKG5hbWUuc2xpY2UoLTUpICE9PSAiVW50aWwiKSB7CiAgICAgICAgc2VsZWN0b3IgPSB1bnRpbDsKICAgICAgfQogICAgICBpZiAoc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIikgewogICAgICAgIG1hdGNoZWQgPSBqUXVlcnkuZmlsdGVyKHNlbGVjdG9yLCBtYXRjaGVkKTsKICAgICAgfQogICAgICBpZiAodGhpcy5sZW5ndGggPiAxKSB7CiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMKICAgICAgICBpZiAoIWd1YXJhbnRlZWRVbmlxdWVbbmFtZV0pIHsKICAgICAgICAgIGpRdWVyeS51bmlxdWVTb3J0KG1hdGNoZWQpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV2ZXJzZSBvcmRlciBmb3IgcGFyZW50cyogYW5kIHByZXYtZGVyaXZhdGl2ZXMKICAgICAgICBpZiAocnBhcmVudHNwcmV2LnRlc3QobmFtZSkpIHsKICAgICAgICAgIG1hdGNoZWQucmV2ZXJzZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2sobWF0Y2hlZCk7CiAgICB9OwogIH0pOwogIHZhciBybm90aHRtbHdoaXRlID0gL1teXHgyMFx0XHJcblxmXSsvZzsKCiAgLy8gQ29udmVydCBTdHJpbmctZm9ybWF0dGVkIG9wdGlvbnMgaW50byBPYmplY3QtZm9ybWF0dGVkIG9uZXMKICBmdW5jdGlvbiBjcmVhdGVPcHRpb25zKG9wdGlvbnMpIHsKICAgIHZhciBvYmplY3QgPSB7fTsKICAgIGpRdWVyeS5lYWNoKG9wdGlvbnMubWF0Y2gocm5vdGh0bWx3aGl0ZSkgfHwgW10sIGZ1bmN0aW9uIChfLCBmbGFnKSB7CiAgICAgIG9iamVjdFtmbGFnXSA9IHRydWU7CiAgICB9KTsKICAgIHJldHVybiBvYmplY3Q7CiAgfQoKICAvKgogICogQ3JlYXRlIGEgY2FsbGJhY2sgbGlzdCB1c2luZyB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAgKgogICoJb3B0aW9uczogYW4gb3B0aW9uYWwgbGlzdCBvZiBzcGFjZS1zZXBhcmF0ZWQgb3B0aW9ucyB0aGF0IHdpbGwgY2hhbmdlIGhvdwogICoJCQl0aGUgY2FsbGJhY2sgbGlzdCBiZWhhdmVzIG9yIGEgbW9yZSB0cmFkaXRpb25hbCBvcHRpb24gb2JqZWN0CiAgKgogICogQnkgZGVmYXVsdCBhIGNhbGxiYWNrIGxpc3Qgd2lsbCBhY3QgbGlrZSBhbiBldmVudCBjYWxsYmFjayBsaXN0IGFuZCBjYW4gYmUKICAqICJmaXJlZCIgbXVsdGlwbGUgdGltZXMuCiAgKgogICogUG9zc2libGUgb3B0aW9uczoKICAqCiAgKglvbmNlOgkJCXdpbGwgZW5zdXJlIHRoZSBjYWxsYmFjayBsaXN0IGNhbiBvbmx5IGJlIGZpcmVkIG9uY2UgKGxpa2UgYSBEZWZlcnJlZCkKICAqCiAgKgltZW1vcnk6CQkJd2lsbCBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHZhbHVlcyBhbmQgd2lsbCBjYWxsIGFueSBjYWxsYmFjayBhZGRlZAogICoJCQkJCWFmdGVyIHRoZSBsaXN0IGhhcyBiZWVuIGZpcmVkIHJpZ2h0IGF3YXkgd2l0aCB0aGUgbGF0ZXN0ICJtZW1vcml6ZWQiCiAgKgkJCQkJdmFsdWVzIChsaWtlIGEgRGVmZXJyZWQpCiAgKgogICoJdW5pcXVlOgkJCXdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KQogICoKICAqCXN0b3BPbkZhbHNlOglpbnRlcnJ1cHQgY2FsbGluZ3Mgd2hlbiBhIGNhbGxiYWNrIHJldHVybnMgZmFsc2UKICAqCiAgKi8KICBqUXVlcnkuQ2FsbGJhY2tzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIC8vIENvbnZlcnQgb3B0aW9ucyBmcm9tIFN0cmluZy1mb3JtYXR0ZWQgdG8gT2JqZWN0LWZvcm1hdHRlZCBpZiBuZWVkZWQKICAgIC8vICh3ZSBjaGVjayBpbiBjYWNoZSBmaXJzdCkKICAgIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIgPyBjcmVhdGVPcHRpb25zKG9wdGlvbnMpIDogalF1ZXJ5LmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICB2YXIKICAgICAgLy8gRmxhZyB0byBrbm93IGlmIGxpc3QgaXMgY3VycmVudGx5IGZpcmluZwogICAgICBmaXJpbmcsCiAgICAgIC8vIExhc3QgZmlyZSB2YWx1ZSBmb3Igbm9uLWZvcmdldHRhYmxlIGxpc3RzCiAgICAgIG1lbW9yeSwKICAgICAgLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKICAgICAgX2ZpcmVkLAogICAgICAvLyBGbGFnIHRvIHByZXZlbnQgZmlyaW5nCiAgICAgIF9sb2NrZWQsCiAgICAgIC8vIEFjdHVhbCBjYWxsYmFjayBsaXN0CiAgICAgIGxpc3QgPSBbXSwKICAgICAgLy8gUXVldWUgb2YgZXhlY3V0aW9uIGRhdGEgZm9yIHJlcGVhdGFibGUgbGlzdHMKICAgICAgcXVldWUgPSBbXSwKICAgICAgLy8gSW5kZXggb2YgY3VycmVudGx5IGZpcmluZyBjYWxsYmFjayAobW9kaWZpZWQgYnkgYWRkL3JlbW92ZSBhcyBuZWVkZWQpCiAgICAgIGZpcmluZ0luZGV4ID0gLTEsCiAgICAgIC8vIEZpcmUgY2FsbGJhY2tzCiAgICAgIGZpcmUgPSBmdW5jdGlvbiBmaXJlKCkgewogICAgICAgIC8vIEVuZm9yY2Ugc2luZ2xlLWZpcmluZwogICAgICAgIF9sb2NrZWQgPSBfbG9ja2VkIHx8IG9wdGlvbnMub25jZTsKCiAgICAgICAgLy8gRXhlY3V0ZSBjYWxsYmFja3MgZm9yIGFsbCBwZW5kaW5nIGV4ZWN1dGlvbnMsCiAgICAgICAgLy8gcmVzcGVjdGluZyBmaXJpbmdJbmRleCBvdmVycmlkZXMgYW5kIHJ1bnRpbWUgY2hhbmdlcwogICAgICAgIF9maXJlZCA9IGZpcmluZyA9IHRydWU7CiAgICAgICAgZm9yICg7IHF1ZXVlLmxlbmd0aDsgZmlyaW5nSW5kZXggPSAtMSkgewogICAgICAgICAgbWVtb3J5ID0gcXVldWUuc2hpZnQoKTsKICAgICAgICAgIHdoaWxlICgrK2ZpcmluZ0luZGV4IDwgbGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgLy8gUnVuIGNhbGxiYWNrIGFuZCBjaGVjayBmb3IgZWFybHkgdGVybWluYXRpb24KICAgICAgICAgICAgaWYgKGxpc3RbZmlyaW5nSW5kZXhdLmFwcGx5KG1lbW9yeVswXSwgbWVtb3J5WzFdKSA9PT0gZmFsc2UgJiYgb3B0aW9ucy5zdG9wT25GYWxzZSkgewogICAgICAgICAgICAgIC8vIEp1bXAgdG8gZW5kIGFuZCBmb3JnZXQgdGhlIGRhdGEgc28gLmFkZCBkb2Vzbid0IHJlLWZpcmUKICAgICAgICAgICAgICBmaXJpbmdJbmRleCA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICAgIG1lbW9yeSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBGb3JnZXQgdGhlIGRhdGEgaWYgd2UncmUgZG9uZSB3aXRoIGl0CiAgICAgICAgaWYgKCFvcHRpb25zLm1lbW9yeSkgewogICAgICAgICAgbWVtb3J5ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZpcmluZyA9IGZhbHNlOwoKICAgICAgICAvLyBDbGVhbiB1cCBpZiB3ZSdyZSBkb25lIGZpcmluZyBmb3IgZ29vZAogICAgICAgIGlmIChfbG9ja2VkKSB7CiAgICAgICAgICAvLyBLZWVwIGFuIGVtcHR5IGxpc3QgaWYgd2UgaGF2ZSBkYXRhIGZvciBmdXR1cmUgYWRkIGNhbGxzCiAgICAgICAgICBpZiAobWVtb3J5KSB7CiAgICAgICAgICAgIGxpc3QgPSBbXTsKCiAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhpcyBvYmplY3QgaXMgc3BlbnQKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxpc3QgPSAiIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIEFjdHVhbCBDYWxsYmFja3Mgb2JqZWN0CiAgICAgIHNlbGYgPSB7CiAgICAgICAgLy8gQWRkIGEgY2FsbGJhY2sgb3IgYSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0byB0aGUgbGlzdAogICAgICAgIGFkZDogZnVuY3Rpb24gYWRkKCkgewogICAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBtZW1vcnkgZnJvbSBhIHBhc3QgcnVuLCB3ZSBzaG91bGQgZmlyZSBhZnRlciBhZGRpbmcKICAgICAgICAgICAgaWYgKG1lbW9yeSAmJiAhZmlyaW5nKSB7CiAgICAgICAgICAgICAgZmlyaW5nSW5kZXggPSBsaXN0Lmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgcXVldWUucHVzaChtZW1vcnkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIChmdW5jdGlvbiBhZGQoYXJncykgewogICAgICAgICAgICAgIGpRdWVyeS5lYWNoKGFyZ3MsIGZ1bmN0aW9uIChfLCBhcmcpIHsKICAgICAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKGFyZykpIHsKICAgICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLnVuaXF1ZSB8fCAhc2VsZi5oYXMoYXJnKSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChhcmcpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyZyAmJiBhcmcubGVuZ3RoICYmIHRvVHlwZShhcmcpICE9PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAvLyBJbnNwZWN0IHJlY3Vyc2l2ZWx5CiAgICAgICAgICAgICAgICAgIGFkZChhcmcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KShhcmd1bWVudHMpOwogICAgICAgICAgICBpZiAobWVtb3J5ICYmICFmaXJpbmcpIHsKICAgICAgICAgICAgICBmaXJlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLy8gUmVtb3ZlIGEgY2FsbGJhY2sgZnJvbSB0aGUgbGlzdAogICAgICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICAgICAgalF1ZXJ5LmVhY2goYXJndW1lbnRzLCBmdW5jdGlvbiAoXywgYXJnKSB7CiAgICAgICAgICAgIHZhciBpbmRleDsKICAgICAgICAgICAgd2hpbGUgKChpbmRleCA9IGpRdWVyeS5pbkFycmF5KGFyZywgbGlzdCwgaW5kZXgpKSA+IC0xKSB7CiAgICAgICAgICAgICAgbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgICAgICAgICAvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKICAgICAgICAgICAgICBpZiAoaW5kZXggPD0gZmlyaW5nSW5kZXgpIHsKICAgICAgICAgICAgICAgIGZpcmluZ0luZGV4LS07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLy8gQ2hlY2sgaWYgYSBnaXZlbiBjYWxsYmFjayBpcyBpbiB0aGUgbGlzdC4KICAgICAgICAvLyBJZiBubyBhcmd1bWVudCBpcyBnaXZlbiwgcmV0dXJuIHdoZXRoZXIgb3Igbm90IGxpc3QgaGFzIGNhbGxiYWNrcyBhdHRhY2hlZC4KICAgICAgICBoYXM6IGZ1bmN0aW9uIGhhcyhmbikgewogICAgICAgICAgcmV0dXJuIGZuID8galF1ZXJ5LmluQXJyYXkoZm4sIGxpc3QpID4gLTEgOiBsaXN0Lmxlbmd0aCA+IDA7CiAgICAgICAgfSwKICAgICAgICAvLyBSZW1vdmUgYWxsIGNhbGxiYWNrcyBmcm9tIHRoZSBsaXN0CiAgICAgICAgZW1wdHk6IGZ1bmN0aW9uIGVtcHR5KCkgewogICAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICAvLyBEaXNhYmxlIC5maXJlIGFuZCAuYWRkCiAgICAgICAgLy8gQWJvcnQgYW55IGN1cnJlbnQvcGVuZGluZyBleGVjdXRpb25zCiAgICAgICAgLy8gQ2xlYXIgYWxsIGNhbGxiYWNrcyBhbmQgdmFsdWVzCiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgICAgIF9sb2NrZWQgPSBxdWV1ZSA9IFtdOwogICAgICAgICAgbGlzdCA9IG1lbW9yeSA9ICIiOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24gZGlzYWJsZWQoKSB7CiAgICAgICAgICByZXR1cm4gIWxpc3Q7CiAgICAgICAgfSwKICAgICAgICAvLyBEaXNhYmxlIC5maXJlCiAgICAgICAgLy8gQWxzbyBkaXNhYmxlIC5hZGQgdW5sZXNzIHdlIGhhdmUgbWVtb3J5IChzaW5jZSBpdCB3b3VsZCBoYXZlIG5vIGVmZmVjdCkKICAgICAgICAvLyBBYm9ydCBhbnkgcGVuZGluZyBleGVjdXRpb25zCiAgICAgICAgbG9jazogZnVuY3Rpb24gbG9jaygpIHsKICAgICAgICAgIF9sb2NrZWQgPSBxdWV1ZSA9IFtdOwogICAgICAgICAgaWYgKCFtZW1vcnkgJiYgIWZpcmluZykgewogICAgICAgICAgICBsaXN0ID0gbWVtb3J5ID0gIiI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAogICAgICAgIGxvY2tlZDogZnVuY3Rpb24gbG9ja2VkKCkgewogICAgICAgICAgcmV0dXJuICEhX2xvY2tlZDsKICAgICAgICB9LAogICAgICAgIC8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKICAgICAgICBmaXJlV2l0aDogZnVuY3Rpb24gZmlyZVdpdGgoY29udGV4dCwgYXJncykgewogICAgICAgICAgaWYgKCFfbG9ja2VkKSB7CiAgICAgICAgICAgIGFyZ3MgPSBhcmdzIHx8IFtdOwogICAgICAgICAgICBhcmdzID0gW2NvbnRleHQsIGFyZ3Muc2xpY2UgPyBhcmdzLnNsaWNlKCkgOiBhcmdzXTsKICAgICAgICAgICAgcXVldWUucHVzaChhcmdzKTsKICAgICAgICAgICAgaWYgKCFmaXJpbmcpIHsKICAgICAgICAgICAgICBmaXJlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMKICAgICAgICBmaXJlOiBmdW5jdGlvbiBmaXJlKCkgewogICAgICAgICAgc2VsZi5maXJlV2l0aCh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICAvLyBUbyBrbm93IGlmIHRoZSBjYWxsYmFja3MgaGF2ZSBhbHJlYWR5IGJlZW4gY2FsbGVkIGF0IGxlYXN0IG9uY2UKICAgICAgICBmaXJlZDogZnVuY3Rpb24gZmlyZWQoKSB7CiAgICAgICAgICByZXR1cm4gISFfZmlyZWQ7CiAgICAgICAgfQogICAgICB9OwogICAgcmV0dXJuIHNlbGY7CiAgfTsKICBmdW5jdGlvbiBJZGVudGl0eSh2KSB7CiAgICByZXR1cm4gdjsKICB9CiAgZnVuY3Rpb24gVGhyb3dlcihleCkgewogICAgdGhyb3cgZXg7CiAgfQogIGZ1bmN0aW9uIGFkb3B0VmFsdWUodmFsdWUsIHJlc29sdmUsIHJlamVjdCwgbm9WYWx1ZSkgewogICAgdmFyIG1ldGhvZDsKICAgIHRyeSB7CiAgICAgIC8vIENoZWNrIGZvciBwcm9taXNlIGFzcGVjdCBmaXJzdCB0byBwcml2aWxlZ2Ugc3luY2hyb25vdXMgYmVoYXZpb3IKICAgICAgaWYgKHZhbHVlICYmIGlzRnVuY3Rpb24obWV0aG9kID0gdmFsdWUucHJvbWlzZSkpIHsKICAgICAgICBtZXRob2QuY2FsbCh2YWx1ZSkuZG9uZShyZXNvbHZlKS5mYWlsKHJlamVjdCk7CgogICAgICAgIC8vIE90aGVyIHRoZW5hYmxlcwogICAgICB9IGVsc2UgaWYgKHZhbHVlICYmIGlzRnVuY3Rpb24obWV0aG9kID0gdmFsdWUudGhlbikpIHsKICAgICAgICBtZXRob2QuY2FsbCh2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTsKCiAgICAgICAgLy8gT3RoZXIgbm9uLXRoZW5hYmxlcwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENvbnRyb2wgYHJlc29sdmVgIGFyZ3VtZW50cyBieSBsZXR0aW5nIEFycmF5I3NsaWNlIGNhc3QgYm9vbGVhbiBgbm9WYWx1ZWAgdG8gaW50ZWdlcjoKICAgICAgICAvLyAqIGZhbHNlOiBbIHZhbHVlIF0uc2xpY2UoIDAgKSA9PiByZXNvbHZlKCB2YWx1ZSApCiAgICAgICAgLy8gKiB0cnVlOiBbIHZhbHVlIF0uc2xpY2UoIDEgKSA9PiByZXNvbHZlKCkKICAgICAgICByZXNvbHZlLmFwcGx5KHVuZGVmaW5lZCwgW3ZhbHVlXS5zbGljZShub1ZhbHVlKSk7CiAgICAgIH0KCiAgICAgIC8vIEZvciBQcm9taXNlcy9BKywgY29udmVydCBleGNlcHRpb25zIGludG8gcmVqZWN0aW9ucwogICAgICAvLyBTaW5jZSBqUXVlcnkud2hlbiBkb2Vzbid0IHVud3JhcCB0aGVuYWJsZXMsIHdlIGNhbiBza2lwIHRoZSBleHRyYSBjaGVja3MgYXBwZWFyaW5nIGluCiAgICAgIC8vIERlZmVycmVkI3RoZW4gdG8gY29uZGl0aW9uYWxseSBzdXBwcmVzcyByZWplY3Rpb24uCiAgICB9IGNhdGNoICh2YWx1ZSkgewogICAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDQuMCBvbmx5CiAgICAgIC8vIFN0cmljdCBtb2RlIGZ1bmN0aW9ucyBpbnZva2VkIHdpdGhvdXQgLmNhbGwvLmFwcGx5IGdldCBnbG9iYWwtb2JqZWN0IGNvbnRleHQKICAgICAgcmVqZWN0LmFwcGx5KHVuZGVmaW5lZCwgW3ZhbHVlXSk7CiAgICB9CiAgfQogIGpRdWVyeS5leHRlbmQoewogICAgRGVmZXJyZWQ6IGZ1bmN0aW9uIERlZmVycmVkKGZ1bmMpIHsKICAgICAgdmFyIHR1cGxlcyA9IFsKICAgICAgICAvLyBhY3Rpb24sIGFkZCBsaXN0ZW5lciwgY2FsbGJhY2tzLAogICAgICAgIC8vIC4uLiAudGhlbiBoYW5kbGVycywgYXJndW1lbnQgaW5kZXgsIFtmaW5hbCBzdGF0ZV0KICAgICAgICBbIm5vdGlmeSIsICJwcm9ncmVzcyIsIGpRdWVyeS5DYWxsYmFja3MoIm1lbW9yeSIpLCBqUXVlcnkuQ2FsbGJhY2tzKCJtZW1vcnkiKSwgMl0sIFsicmVzb2x2ZSIsICJkb25lIiwgalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgMCwgInJlc29sdmVkIl0sIFsicmVqZWN0IiwgImZhaWwiLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAxLCAicmVqZWN0ZWQiXV0sCiAgICAgICAgX3N0YXRlID0gInBlbmRpbmciLAogICAgICAgIF9wcm9taXNlID0gewogICAgICAgICAgc3RhdGU6IGZ1bmN0aW9uIHN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gX3N0YXRlOwogICAgICAgICAgfSwKICAgICAgICAgIGFsd2F5czogZnVuY3Rpb24gYWx3YXlzKCkgewogICAgICAgICAgICBkZWZlcnJlZC5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0sCiAgICAgICAgICAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2goZm4pIHsKICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLnRoZW4obnVsbCwgZm4pOwogICAgICAgICAgfSwKICAgICAgICAgIC8vIEtlZXAgcGlwZSBmb3IgYmFjay1jb21wYXQKICAgICAgICAgIHBpcGU6IGZ1bmN0aW9uIHBpcGUoIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovCiAgICAgICAgICApIHsKICAgICAgICAgICAgdmFyIGZucyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiAobmV3RGVmZXIpIHsKICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0dXBsZXMsIGZ1bmN0aW9uIChfaSwgdHVwbGUpIHsKICAgICAgICAgICAgICAgIC8vIE1hcCB0dXBsZXMgKHByb2dyZXNzLCBkb25lLCBmYWlsKSB0byBhcmd1bWVudHMgKGRvbmUsIGZhaWwsIHByb2dyZXNzKQogICAgICAgICAgICAgICAgdmFyIGZuID0gaXNGdW5jdGlvbihmbnNbdHVwbGVbNF1dKSAmJiBmbnNbdHVwbGVbNF1dOwoKICAgICAgICAgICAgICAgIC8vIGRlZmVycmVkLnByb2dyZXNzKGZ1bmN0aW9uKCkgeyBiaW5kIHRvIG5ld0RlZmVyIG9yIG5ld0RlZmVyLm5vdGlmeSB9KQogICAgICAgICAgICAgICAgLy8gZGVmZXJyZWQuZG9uZShmdW5jdGlvbigpIHsgYmluZCB0byBuZXdEZWZlciBvciBuZXdEZWZlci5yZXNvbHZlIH0pCiAgICAgICAgICAgICAgICAvLyBkZWZlcnJlZC5mYWlsKGZ1bmN0aW9uKCkgeyBiaW5kIHRvIG5ld0RlZmVyIG9yIG5ld0RlZmVyLnJlamVjdCB9KQogICAgICAgICAgICAgICAgZGVmZXJyZWRbdHVwbGVbMV1dKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIHJldHVybmVkID0gZm4gJiYgZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgaWYgKHJldHVybmVkICYmIGlzRnVuY3Rpb24ocmV0dXJuZWQucHJvbWlzZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm5lZC5wcm9taXNlKCkucHJvZ3Jlc3MobmV3RGVmZXIubm90aWZ5KS5kb25lKG5ld0RlZmVyLnJlc29sdmUpLmZhaWwobmV3RGVmZXIucmVqZWN0KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBuZXdEZWZlclt0dXBsZVswXSArICJXaXRoIl0odGhpcywgZm4gPyBbcmV0dXJuZWRdIDogYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZm5zID0gbnVsbDsKICAgICAgICAgICAgfSkucHJvbWlzZSgpOwogICAgICAgICAgfSwKICAgICAgICAgIHRoZW46IGZ1bmN0aW9uIHRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIG9uUHJvZ3Jlc3MpIHsKICAgICAgICAgICAgdmFyIG1heERlcHRoID0gMDsKICAgICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZShkZXB0aCwgZGVmZXJyZWQsIGhhbmRsZXIsIHNwZWNpYWwpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLAogICAgICAgICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzLAogICAgICAgICAgICAgICAgICBtaWdodFRocm93ID0gZnVuY3Rpb24gbWlnaHRUaHJvdygpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuZWQsIHRoZW47CgogICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IFByb21pc2VzL0ErIHNlY3Rpb24gMi4zLjMuMy4zCiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9wcm9taXNlc2FwbHVzLmNvbS8jcG9pbnQtNTkKICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgZG91YmxlLXJlc29sdXRpb24gYXR0ZW1wdHMKICAgICAgICAgICAgICAgICAgICBpZiAoZGVwdGggPCBtYXhEZXB0aCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm5lZCA9IGhhbmRsZXIuYXBwbHkodGhhdCwgYXJncyk7CgogICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IFByb21pc2VzL0ErIHNlY3Rpb24gMi4zLjEKICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL3Byb21pc2VzYXBsdXMuY29tLyNwb2ludC00OAogICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9PT0gZGVmZXJyZWQucHJvbWlzZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGVuYWJsZSBzZWxmLXJlc29sdXRpb24iKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IFByb21pc2VzL0ErIHNlY3Rpb25zIDIuMy4zLjEsIDMuNQogICAgICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vcHJvbWlzZXNhcGx1cy5jb20vI3BvaW50LTU0CiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9wcm9taXNlc2FwbHVzLmNvbS8jcG9pbnQtNzUKICAgICAgICAgICAgICAgICAgICAvLyBSZXRyaWV2ZSBgdGhlbmAgb25seSBvbmNlCiAgICAgICAgICAgICAgICAgICAgdGhlbiA9IHJldHVybmVkICYmICgKICAgICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBQcm9taXNlcy9BKyBzZWN0aW9uIDIuMy40CiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9wcm9taXNlc2FwbHVzLmNvbS8jcG9pbnQtNjQKICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IGNoZWNrIG9iamVjdHMgYW5kIGZ1bmN0aW9ucyBmb3IgdGhlbmFiaWxpdHkKICAgICAgICAgICAgICAgICAgICBfdHlwZW9mKHJldHVybmVkKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIHJldHVybmVkID09PSAiZnVuY3Rpb24iKSAmJiByZXR1cm5lZC50aGVuOwoKICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgYSByZXR1cm5lZCB0aGVuYWJsZQogICAgICAgICAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKHRoZW4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBTcGVjaWFsIHByb2Nlc3NvcnMgKG5vdGlmeSkganVzdCB3YWl0IGZvciByZXNvbHV0aW9uCiAgICAgICAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGVuLmNhbGwocmV0dXJuZWQsIHJlc29sdmUobWF4RGVwdGgsIGRlZmVycmVkLCBJZGVudGl0eSwgc3BlY2lhbCksIHJlc29sdmUobWF4RGVwdGgsIGRlZmVycmVkLCBUaHJvd2VyLCBzcGVjaWFsKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3JtYWwgcHJvY2Vzc29ycyAocmVzb2x2ZSkgYWxzbyBob29rIGludG8gcHJvZ3Jlc3MKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC4uLmFuZCBkaXNyZWdhcmQgb2xkZXIgcmVzb2x1dGlvbiB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAgICAgbWF4RGVwdGgrKzsKICAgICAgICAgICAgICAgICAgICAgICAgdGhlbi5jYWxsKHJldHVybmVkLCByZXNvbHZlKG1heERlcHRoLCBkZWZlcnJlZCwgSWRlbnRpdHksIHNwZWNpYWwpLCByZXNvbHZlKG1heERlcHRoLCBkZWZlcnJlZCwgVGhyb3dlciwgc3BlY2lhbCksIHJlc29sdmUobWF4RGVwdGgsIGRlZmVycmVkLCBJZGVudGl0eSwgZGVmZXJyZWQubm90aWZ5V2l0aCkpOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBhbGwgb3RoZXIgcmV0dXJuZWQgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgc3Vic3RpdHV0ZSBoYW5kbGVycyBwYXNzIG9uIGNvbnRleHQKICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCBtdWx0aXBsZSB2YWx1ZXMgKG5vbi1zcGVjIGJlaGF2aW9yKQogICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIgIT09IElkZW50aXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBbcmV0dXJuZWRdOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIHZhbHVlKHMpCiAgICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IHByb2Nlc3MgaXMgcmVzb2x2ZQogICAgICAgICAgICAgICAgICAgICAgKHNwZWNpYWwgfHwgZGVmZXJyZWQucmVzb2x2ZVdpdGgpKHRoYXQsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgLy8gT25seSBub3JtYWwgcHJvY2Vzc29ycyAocmVzb2x2ZSkgY2F0Y2ggYW5kIHJlamVjdCBleGNlcHRpb25zCiAgICAgICAgICAgICAgICAgIHByb2Nlc3MgPSBzcGVjaWFsID8gbWlnaHRUaHJvdyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgbWlnaHRUaHJvdygpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChqUXVlcnkuRGVmZXJyZWQuZXhjZXB0aW9uSG9vaykgewogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayhlLCBwcm9jZXNzLnN0YWNrVHJhY2UpOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IFByb21pc2VzL0ErIHNlY3Rpb24gMi4zLjMuMy40LjEKICAgICAgICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vcHJvbWlzZXNhcGx1cy5jb20vI3BvaW50LTYxCiAgICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgcG9zdC1yZXNvbHV0aW9uIGV4Y2VwdGlvbnMKICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXB0aCArIDEgPj0gbWF4RGVwdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gT25seSBzdWJzdGl0dXRlIGhhbmRsZXJzIHBhc3Mgb24gY29udGV4dAogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgbXVsdGlwbGUgdmFsdWVzIChub24tc3BlYyBiZWhhdmlvcikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIgIT09IFRocm93ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBbZV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0V2l0aCh0aGF0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gU3VwcG9ydDogUHJvbWlzZXMvQSsgc2VjdGlvbiAyLjMuMy4zLjEKICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vcHJvbWlzZXNhcGx1cy5jb20vI3BvaW50LTU3CiAgICAgICAgICAgICAgICAvLyBSZS1yZXNvbHZlIHByb21pc2VzIGltbWVkaWF0ZWx5IHRvIGRvZGdlIGZhbHNlIHJlamVjdGlvbiBmcm9tCiAgICAgICAgICAgICAgICAvLyBzdWJzZXF1ZW50IGVycm9ycwogICAgICAgICAgICAgICAgaWYgKGRlcHRoKSB7CiAgICAgICAgICAgICAgICAgIHByb2Nlc3MoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIENhbGwgYW4gb3B0aW9uYWwgaG9vayB0byByZWNvcmQgdGhlIHN0YWNrLCBpbiBjYXNlIG9mIGV4Y2VwdGlvbgogICAgICAgICAgICAgICAgICAvLyBzaW5jZSBpdCdzIG90aGVyd2lzZSBsb3N0IHdoZW4gZXhlY3V0aW9uIGdvZXMgYXN5bmMKICAgICAgICAgICAgICAgICAgaWYgKGpRdWVyeS5EZWZlcnJlZC5nZXRTdGFja0hvb2spIHsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLnN0YWNrVHJhY2UgPSBqUXVlcnkuRGVmZXJyZWQuZ2V0U3RhY2tIb29rKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQocHJvY2Vzcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4galF1ZXJ5LkRlZmVycmVkKGZ1bmN0aW9uIChuZXdEZWZlcikgewogICAgICAgICAgICAgIC8vIHByb2dyZXNzX2hhbmRsZXJzLmFkZCggLi4uICkKICAgICAgICAgICAgICB0dXBsZXNbMF1bM10uYWRkKHJlc29sdmUoMCwgbmV3RGVmZXIsIGlzRnVuY3Rpb24ob25Qcm9ncmVzcykgPyBvblByb2dyZXNzIDogSWRlbnRpdHksIG5ld0RlZmVyLm5vdGlmeVdpdGgpKTsKCiAgICAgICAgICAgICAgLy8gZnVsZmlsbGVkX2hhbmRsZXJzLmFkZCggLi4uICkKICAgICAgICAgICAgICB0dXBsZXNbMV1bM10uYWRkKHJlc29sdmUoMCwgbmV3RGVmZXIsIGlzRnVuY3Rpb24ob25GdWxmaWxsZWQpID8gb25GdWxmaWxsZWQgOiBJZGVudGl0eSkpOwoKICAgICAgICAgICAgICAvLyByZWplY3RlZF9oYW5kbGVycy5hZGQoIC4uLiApCiAgICAgICAgICAgICAgdHVwbGVzWzJdWzNdLmFkZChyZXNvbHZlKDAsIG5ld0RlZmVyLCBpc0Z1bmN0aW9uKG9uUmVqZWN0ZWQpID8gb25SZWplY3RlZCA6IFRocm93ZXIpKTsKICAgICAgICAgICAgfSkucHJvbWlzZSgpOwogICAgICAgICAgfSwKICAgICAgICAgIC8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKICAgICAgICAgIC8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKICAgICAgICAgIHByb21pc2U6IGZ1bmN0aW9uIHByb21pc2Uob2JqKSB7CiAgICAgICAgICAgIHJldHVybiBvYmogIT0gbnVsbCA/IGpRdWVyeS5leHRlbmQob2JqLCBfcHJvbWlzZSkgOiBfcHJvbWlzZTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRlZmVycmVkID0ge307CgogICAgICAvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCiAgICAgIGpRdWVyeS5lYWNoKHR1cGxlcywgZnVuY3Rpb24gKGksIHR1cGxlKSB7CiAgICAgICAgdmFyIGxpc3QgPSB0dXBsZVsyXSwKICAgICAgICAgIHN0YXRlU3RyaW5nID0gdHVwbGVbNV07CgogICAgICAgIC8vIHByb21pc2UucHJvZ3Jlc3MgPSBsaXN0LmFkZAogICAgICAgIC8vIHByb21pc2UuZG9uZSA9IGxpc3QuYWRkCiAgICAgICAgLy8gcHJvbWlzZS5mYWlsID0gbGlzdC5hZGQKICAgICAgICBfcHJvbWlzZVt0dXBsZVsxXV0gPSBsaXN0LmFkZDsKCiAgICAgICAgLy8gSGFuZGxlIHN0YXRlCiAgICAgICAgaWYgKHN0YXRlU3RyaW5nKSB7CiAgICAgICAgICBsaXN0LmFkZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIHN0YXRlID0gInJlc29sdmVkIiAoaS5lLiwgZnVsZmlsbGVkKQogICAgICAgICAgICAvLyBzdGF0ZSA9ICJyZWplY3RlZCIKICAgICAgICAgICAgX3N0YXRlID0gc3RhdGVTdHJpbmc7CiAgICAgICAgICB9LAogICAgICAgICAgLy8gcmVqZWN0ZWRfY2FsbGJhY2tzLmRpc2FibGUKICAgICAgICAgIC8vIGZ1bGZpbGxlZF9jYWxsYmFja3MuZGlzYWJsZQogICAgICAgICAgdHVwbGVzWzMgLSBpXVsyXS5kaXNhYmxlLAogICAgICAgICAgLy8gcmVqZWN0ZWRfaGFuZGxlcnMuZGlzYWJsZQogICAgICAgICAgLy8gZnVsZmlsbGVkX2hhbmRsZXJzLmRpc2FibGUKICAgICAgICAgIHR1cGxlc1szIC0gaV1bM10uZGlzYWJsZSwKICAgICAgICAgIC8vIHByb2dyZXNzX2NhbGxiYWNrcy5sb2NrCiAgICAgICAgICB0dXBsZXNbMF1bMl0ubG9jaywKICAgICAgICAgIC8vIHByb2dyZXNzX2hhbmRsZXJzLmxvY2sKICAgICAgICAgIHR1cGxlc1swXVszXS5sb2NrKTsKICAgICAgICB9CgogICAgICAgIC8vIHByb2dyZXNzX2hhbmRsZXJzLmZpcmUKICAgICAgICAvLyBmdWxmaWxsZWRfaGFuZGxlcnMuZmlyZQogICAgICAgIC8vIHJlamVjdGVkX2hhbmRsZXJzLmZpcmUKICAgICAgICBsaXN0LmFkZCh0dXBsZVszXS5maXJlKTsKCiAgICAgICAgLy8gZGVmZXJyZWQubm90aWZ5ID0gZnVuY3Rpb24oKSB7IGRlZmVycmVkLm5vdGlmeVdpdGgoLi4uKSB9CiAgICAgICAgLy8gZGVmZXJyZWQucmVzb2x2ZSA9IGZ1bmN0aW9uKCkgeyBkZWZlcnJlZC5yZXNvbHZlV2l0aCguLi4pIH0KICAgICAgICAvLyBkZWZlcnJlZC5yZWplY3QgPSBmdW5jdGlvbigpIHsgZGVmZXJyZWQucmVqZWN0V2l0aCguLi4pIH0KICAgICAgICBkZWZlcnJlZFt0dXBsZVswXV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkZWZlcnJlZFt0dXBsZVswXSArICJXaXRoIl0odGhpcyA9PT0gZGVmZXJyZWQgPyB1bmRlZmluZWQgOiB0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICAgICAgLy8gZGVmZXJyZWQubm90aWZ5V2l0aCA9IGxpc3QuZmlyZVdpdGgKICAgICAgICAvLyBkZWZlcnJlZC5yZXNvbHZlV2l0aCA9IGxpc3QuZmlyZVdpdGgKICAgICAgICAvLyBkZWZlcnJlZC5yZWplY3RXaXRoID0gbGlzdC5maXJlV2l0aAogICAgICAgIGRlZmVycmVkW3R1cGxlWzBdICsgIldpdGgiXSA9IGxpc3QuZmlyZVdpdGg7CiAgICAgIH0pOwoKICAgICAgLy8gTWFrZSB0aGUgZGVmZXJyZWQgYSBwcm9taXNlCiAgICAgIF9wcm9taXNlLnByb21pc2UoZGVmZXJyZWQpOwoKICAgICAgLy8gQ2FsbCBnaXZlbiBmdW5jIGlmIGFueQogICAgICBpZiAoZnVuYykgewogICAgICAgIGZ1bmMuY2FsbChkZWZlcnJlZCwgZGVmZXJyZWQpOwogICAgICB9CgogICAgICAvLyBBbGwgZG9uZSEKICAgICAgcmV0dXJuIGRlZmVycmVkOwogICAgfSwKICAgIC8vIERlZmVycmVkIGhlbHBlcgogICAgd2hlbjogZnVuY3Rpb24gd2hlbihzaW5nbGVWYWx1ZSkgewogICAgICB2YXIKICAgICAgICAvLyBjb3VudCBvZiB1bmNvbXBsZXRlZCBzdWJvcmRpbmF0ZXMKICAgICAgICByZW1haW5pbmcgPSBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgIC8vIGNvdW50IG9mIHVucHJvY2Vzc2VkIGFyZ3VtZW50cwogICAgICAgIGkgPSByZW1haW5pbmcsCiAgICAgICAgLy8gc3Vib3JkaW5hdGUgZnVsZmlsbG1lbnQgZGF0YQogICAgICAgIHJlc29sdmVDb250ZXh0cyA9IEFycmF5KGkpLAogICAgICAgIHJlc29sdmVWYWx1ZXMgPSBfc2xpY2UuY2FsbChhcmd1bWVudHMpLAogICAgICAgIC8vIHRoZSBtYXN0ZXIgRGVmZXJyZWQKICAgICAgICBtYXN0ZXIgPSBqUXVlcnkuRGVmZXJyZWQoKSwKICAgICAgICAvLyBzdWJvcmRpbmF0ZSBjYWxsYmFjayBmYWN0b3J5CiAgICAgICAgdXBkYXRlRnVuYyA9IGZ1bmN0aW9uIHVwZGF0ZUZ1bmMoaSkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICByZXNvbHZlQ29udGV4dHNbaV0gPSB0aGlzOwogICAgICAgICAgICByZXNvbHZlVmFsdWVzW2ldID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBfc2xpY2UuY2FsbChhcmd1bWVudHMpIDogdmFsdWU7CiAgICAgICAgICAgIGlmICghIC0tcmVtYWluaW5nKSB7CiAgICAgICAgICAgICAgbWFzdGVyLnJlc29sdmVXaXRoKHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgIC8vIFNpbmdsZS0gYW5kIGVtcHR5IGFyZ3VtZW50cyBhcmUgYWRvcHRlZCBsaWtlIFByb21pc2UucmVzb2x2ZQogICAgICBpZiAocmVtYWluaW5nIDw9IDEpIHsKICAgICAgICBhZG9wdFZhbHVlKHNpbmdsZVZhbHVlLCBtYXN0ZXIuZG9uZSh1cGRhdGVGdW5jKGkpKS5yZXNvbHZlLCBtYXN0ZXIucmVqZWN0LCAhcmVtYWluaW5nKTsKCiAgICAgICAgLy8gVXNlIC50aGVuKCkgdG8gdW53cmFwIHNlY29uZGFyeSB0aGVuYWJsZXMgKGNmLiBnaC0zMDAwKQogICAgICAgIGlmIChtYXN0ZXIuc3RhdGUoKSA9PT0gInBlbmRpbmciIHx8IGlzRnVuY3Rpb24ocmVzb2x2ZVZhbHVlc1tpXSAmJiByZXNvbHZlVmFsdWVzW2ldLnRoZW4pKSB7CiAgICAgICAgICByZXR1cm4gbWFzdGVyLnRoZW4oKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIE11bHRpcGxlIGFyZ3VtZW50cyBhcmUgYWdncmVnYXRlZCBsaWtlIFByb21pc2UuYWxsIGFycmF5IGVsZW1lbnRzCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBhZG9wdFZhbHVlKHJlc29sdmVWYWx1ZXNbaV0sIHVwZGF0ZUZ1bmMoaSksIG1hc3Rlci5yZWplY3QpOwogICAgICB9CiAgICAgIHJldHVybiBtYXN0ZXIucHJvbWlzZSgpOwogICAgfQogIH0pOwoKICAvLyBUaGVzZSB1c3VhbGx5IGluZGljYXRlIGEgcHJvZ3JhbW1lciBtaXN0YWtlIGR1cmluZyBkZXZlbG9wbWVudCwKICAvLyB3YXJuIGFib3V0IHRoZW0gQVNBUCByYXRoZXIgdGhhbiBzd2FsbG93aW5nIHRoZW0gYnkgZGVmYXVsdC4KICB2YXIgcmVycm9yTmFtZXMgPSAvXihFdmFsfEludGVybmFsfFJhbmdlfFJlZmVyZW5jZXxTeW50YXh8VHlwZXxVUkkpRXJyb3IkLzsKICBqUXVlcnkuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayA9IGZ1bmN0aW9uIChlcnJvciwgc3RhY2spIHsKICAgIC8vIFN1cHBvcnQ6IElFIDggLSA5IG9ubHkKICAgIC8vIENvbnNvbGUgZXhpc3RzIHdoZW4gZGV2IHRvb2xzIGFyZSBvcGVuLCB3aGljaCBjYW4gaGFwcGVuIGF0IGFueSB0aW1lCiAgICBpZiAod2luZG93LmNvbnNvbGUgJiYgd2luZG93LmNvbnNvbGUud2FybiAmJiBlcnJvciAmJiByZXJyb3JOYW1lcy50ZXN0KGVycm9yLm5hbWUpKSB7CiAgICAgIHdpbmRvdy5jb25zb2xlLndhcm4oImpRdWVyeS5EZWZlcnJlZCBleGNlcHRpb246ICIgKyBlcnJvci5tZXNzYWdlLCBlcnJvci5zdGFjaywgc3RhY2spOwogICAgfQogIH07CiAgalF1ZXJ5LnJlYWR5RXhjZXB0aW9uID0gZnVuY3Rpb24gKGVycm9yKSB7CiAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIHRocm93IGVycm9yOwogICAgfSk7CiAgfTsKCiAgLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5CiAgdmFyIHJlYWR5TGlzdCA9IGpRdWVyeS5EZWZlcnJlZCgpOwogIGpRdWVyeS5mbi5yZWFkeSA9IGZ1bmN0aW9uIChmbikgewogICAgcmVhZHlMaXN0LnRoZW4oZm4pCgogICAgLy8gV3JhcCBqUXVlcnkucmVhZHlFeGNlcHRpb24gaW4gYSBmdW5jdGlvbiBzbyB0aGF0IHRoZSBsb29rdXAKICAgIC8vIGhhcHBlbnMgYXQgdGhlIHRpbWUgb2YgZXJyb3IgaGFuZGxpbmcgaW5zdGVhZCBvZiBjYWxsYmFjawogICAgLy8gcmVnaXN0cmF0aW9uLgogICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBqUXVlcnkucmVhZHlFeGNlcHRpb24oZXJyb3IpOwogICAgfSk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIGpRdWVyeS5leHRlbmQoewogICAgLy8gSXMgdGhlIERPTSByZWFkeSB0byBiZSB1c2VkPyBTZXQgdG8gdHJ1ZSBvbmNlIGl0IG9jY3Vycy4KICAgIGlzUmVhZHk6IGZhbHNlLAogICAgLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQogICAgLy8gdGhlIHJlYWR5IGV2ZW50IGZpcmVzLiBTZWUgIzY3ODEKICAgIHJlYWR5V2FpdDogMSwKICAgIC8vIEhhbmRsZSB3aGVuIHRoZSBET00gaXMgcmVhZHkKICAgIHJlYWR5OiBmdW5jdGlvbiByZWFkeSh3YWl0KSB7CiAgICAgIC8vIEFib3J0IGlmIHRoZXJlIGFyZSBwZW5kaW5nIGhvbGRzIG9yIHdlJ3JlIGFscmVhZHkgcmVhZHkKICAgICAgaWYgKHdhaXQgPT09IHRydWUgPyAtLWpRdWVyeS5yZWFkeVdhaXQgOiBqUXVlcnkuaXNSZWFkeSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gUmVtZW1iZXIgdGhhdCB0aGUgRE9NIGlzIHJlYWR5CiAgICAgIGpRdWVyeS5pc1JlYWR5ID0gdHJ1ZTsKCiAgICAgIC8vIElmIGEgbm9ybWFsIERPTSBSZWFkeSBldmVudCBmaXJlZCwgZGVjcmVtZW50LCBhbmQgd2FpdCBpZiBuZWVkIGJlCiAgICAgIGlmICh3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUKICAgICAgcmVhZHlMaXN0LnJlc29sdmVXaXRoKGRvY3VtZW50LCBbalF1ZXJ5XSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LnJlYWR5LnRoZW4gPSByZWFkeUxpc3QudGhlbjsKCiAgLy8gVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIgYW5kIHNlbGYgY2xlYW51cCBtZXRob2QKICBmdW5jdGlvbiBjb21wbGV0ZWQoKSB7CiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIiwgY29tcGxldGVkKTsKICAgIGpRdWVyeS5yZWFkeSgpOwogIH0KCiAgLy8gQ2F0Y2ggY2FzZXMgd2hlcmUgJChkb2N1bWVudCkucmVhZHkoKSBpcyBjYWxsZWQKICAvLyBhZnRlciB0aGUgYnJvd3NlciBldmVudCBoYXMgYWxyZWFkeSBvY2N1cnJlZC4KICAvLyBTdXBwb3J0OiBJRSA8PTkgLSAxMCBvbmx5CiAgLy8gT2xkZXIgSUUgc29tZXRpbWVzIHNpZ25hbHMgImludGVyYWN0aXZlIiB0b28gc29vbgogIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgIT09ICJsb2FkaW5nIiAmJiAhZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKSB7CiAgICAvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkKICAgIHdpbmRvdy5zZXRUaW1lb3V0KGpRdWVyeS5yZWFkeSk7CiAgfSBlbHNlIHsKICAgIC8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQpOwoKICAgIC8vIEEgZmFsbGJhY2sgdG8gd2luZG93Lm9ubG9hZCwgdGhhdCB3aWxsIGFsd2F5cyB3b3JrCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsIGNvbXBsZXRlZCk7CiAgfQoKICAvLyBNdWx0aWZ1bmN0aW9uYWwgbWV0aG9kIHRvIGdldCBhbmQgc2V0IHZhbHVlcyBvZiBhIGNvbGxlY3Rpb24KICAvLyBUaGUgdmFsdWUvcyBjYW4gb3B0aW9uYWxseSBiZSBleGVjdXRlZCBpZiBpdCdzIGEgZnVuY3Rpb24KICB2YXIgYWNjZXNzID0gZnVuY3Rpb24gYWNjZXNzKGVsZW1zLCBmbiwga2V5LCB2YWx1ZSwgY2hhaW5hYmxlLCBlbXB0eUdldCwgcmF3KSB7CiAgICB2YXIgaSA9IDAsCiAgICAgIGxlbiA9IGVsZW1zLmxlbmd0aCwKICAgICAgYnVsayA9IGtleSA9PSBudWxsOwoKICAgIC8vIFNldHMgbWFueSB2YWx1ZXMKICAgIGlmICh0b1R5cGUoa2V5KSA9PT0gIm9iamVjdCIpIHsKICAgICAgY2hhaW5hYmxlID0gdHJ1ZTsKICAgICAgZm9yIChpIGluIGtleSkgewogICAgICAgIGFjY2VzcyhlbGVtcywgZm4sIGksIGtleVtpXSwgdHJ1ZSwgZW1wdHlHZXQsIHJhdyk7CiAgICAgIH0KCiAgICAgIC8vIFNldHMgb25lIHZhbHVlCiAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgY2hhaW5hYmxlID0gdHJ1ZTsKICAgICAgaWYgKCFpc0Z1bmN0aW9uKHZhbHVlKSkgewogICAgICAgIHJhdyA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKGJ1bGspIHsKICAgICAgICAvLyBCdWxrIG9wZXJhdGlvbnMgcnVuIGFnYWluc3QgdGhlIGVudGlyZSBzZXQKICAgICAgICBpZiAocmF3KSB7CiAgICAgICAgICBmbi5jYWxsKGVsZW1zLCB2YWx1ZSk7CiAgICAgICAgICBmbiA9IG51bGw7CgogICAgICAgICAgLy8gLi4uZXhjZXB0IHdoZW4gZXhlY3V0aW5nIGZ1bmN0aW9uIHZhbHVlcwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBidWxrID0gZm47CiAgICAgICAgICBmbiA9IGZ1bmN0aW9uIGZuKGVsZW0sIF9rZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBidWxrLmNhbGwoalF1ZXJ5KGVsZW0pLCB2YWx1ZSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZm4pIHsKICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBmbihlbGVtc1tpXSwga2V5LCByYXcgPyB2YWx1ZSA6IHZhbHVlLmNhbGwoZWxlbXNbaV0sIGksIGZuKGVsZW1zW2ldLCBrZXkpKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoY2hhaW5hYmxlKSB7CiAgICAgIHJldHVybiBlbGVtczsKICAgIH0KCiAgICAvLyBHZXRzCiAgICBpZiAoYnVsaykgewogICAgICByZXR1cm4gZm4uY2FsbChlbGVtcyk7CiAgICB9CiAgICByZXR1cm4gbGVuID8gZm4oZWxlbXNbMF0sIGtleSkgOiBlbXB0eUdldDsKICB9OwoKICAvLyBNYXRjaGVzIGRhc2hlZCBzdHJpbmcgZm9yIGNhbWVsaXppbmcKICB2YXIgcm1zUHJlZml4ID0gL14tbXMtLywKICAgIHJkYXNoQWxwaGEgPSAvLShbYS16XSkvZzsKCiAgLy8gVXNlZCBieSBjYW1lbENhc2UgYXMgY2FsbGJhY2sgdG8gcmVwbGFjZSgpCiAgZnVuY3Rpb24gZmNhbWVsQ2FzZShfYWxsLCBsZXR0ZXIpIHsKICAgIHJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKICB9CgogIC8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMKICAvLyBTdXBwb3J0OiBJRSA8PTkgLSAxMSwgRWRnZSAxMiAtIDE1CiAgLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQogIGZ1bmN0aW9uIGNhbWVsQ2FzZShzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZShybXNQcmVmaXgsICJtcy0iKS5yZXBsYWNlKHJkYXNoQWxwaGEsIGZjYW1lbENhc2UpOwogIH0KICB2YXIgYWNjZXB0RGF0YSA9IGZ1bmN0aW9uIGFjY2VwdERhdGEob3duZXIpIHsKICAgIC8vIEFjY2VwdHMgb25seToKICAgIC8vICAtIE5vZGUKICAgIC8vICAgIC0gTm9kZS5FTEVNRU5UX05PREUKICAgIC8vICAgIC0gTm9kZS5ET0NVTUVOVF9OT0RFCiAgICAvLyAgLSBPYmplY3QKICAgIC8vICAgIC0gQW55CiAgICByZXR1cm4gb3duZXIubm9kZVR5cGUgPT09IDEgfHwgb3duZXIubm9kZVR5cGUgPT09IDkgfHwgIStvd25lci5ub2RlVHlwZTsKICB9OwogIGZ1bmN0aW9uIERhdGEoKSB7CiAgICB0aGlzLmV4cGFuZG8gPSBqUXVlcnkuZXhwYW5kbyArIERhdGEudWlkKys7CiAgfQogIERhdGEudWlkID0gMTsKICBEYXRhLnByb3RvdHlwZSA9IHsKICAgIGNhY2hlOiBmdW5jdGlvbiBjYWNoZShvd25lcikgewogICAgICAvLyBDaGVjayBpZiB0aGUgb3duZXIgb2JqZWN0IGFscmVhZHkgaGFzIGEgY2FjaGUKICAgICAgdmFyIHZhbHVlID0gb3duZXJbdGhpcy5leHBhbmRvXTsKCiAgICAgIC8vIElmIG5vdCwgY3JlYXRlIG9uZQogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgdmFsdWUgPSB7fTsKCiAgICAgICAgLy8gV2UgY2FuIGFjY2VwdCBkYXRhIGZvciBub24tZWxlbWVudCBub2RlcyBpbiBtb2Rlcm4gYnJvd3NlcnMsCiAgICAgICAgLy8gYnV0IHdlIHNob3VsZCBub3QsIHNlZSAjODMzNS4KICAgICAgICAvLyBBbHdheXMgcmV0dXJuIGFuIGVtcHR5IG9iamVjdC4KICAgICAgICBpZiAoYWNjZXB0RGF0YShvd25lcikpIHsKICAgICAgICAgIC8vIElmIGl0IGlzIGEgbm9kZSB1bmxpa2VseSB0byBiZSBzdHJpbmdpZnktZWQgb3IgbG9vcGVkIG92ZXIKICAgICAgICAgIC8vIHVzZSBwbGFpbiBhc3NpZ25tZW50CiAgICAgICAgICBpZiAob3duZXIubm9kZVR5cGUpIHsKICAgICAgICAgICAgb3duZXJbdGhpcy5leHBhbmRvXSA9IHZhbHVlOwoKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHNlY3VyZSBpdCBpbiBhIG5vbi1lbnVtZXJhYmxlIHByb3BlcnR5CiAgICAgICAgICAgIC8vIGNvbmZpZ3VyYWJsZSBtdXN0IGJlIHRydWUgdG8gYWxsb3cgdGhlIHByb3BlcnR5IHRvIGJlCiAgICAgICAgICAgIC8vIGRlbGV0ZWQgd2hlbiBkYXRhIGlzIHJlbW92ZWQKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgdGhpcy5leHBhbmRvLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSwKICAgIHNldDogZnVuY3Rpb24gc2V0KG93bmVyLCBkYXRhLCB2YWx1ZSkgewogICAgICB2YXIgcHJvcCwKICAgICAgICBjYWNoZSA9IHRoaXMuY2FjaGUob3duZXIpOwoKICAgICAgLy8gSGFuZGxlOiBbIG93bmVyLCBrZXksIHZhbHVlIF0gYXJncwogICAgICAvLyBBbHdheXMgdXNlIGNhbWVsQ2FzZSBrZXkgKGdoLTIyNTcpCiAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgICBjYWNoZVtjYW1lbENhc2UoZGF0YSldID0gdmFsdWU7CgogICAgICAgIC8vIEhhbmRsZTogWyBvd25lciwgeyBwcm9wZXJ0aWVzIH0gXSBhcmdzCiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ29weSB0aGUgcHJvcGVydGllcyBvbmUtYnktb25lIHRvIHRoZSBjYWNoZSBvYmplY3QKICAgICAgICBmb3IgKHByb3AgaW4gZGF0YSkgewogICAgICAgICAgY2FjaGVbY2FtZWxDYXNlKHByb3ApXSA9IGRhdGFbcHJvcF07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjYWNoZTsKICAgIH0sCiAgICBnZXQ6IGZ1bmN0aW9uIGdldChvd25lciwga2V5KSB7CiAgICAgIHJldHVybiBrZXkgPT09IHVuZGVmaW5lZCA/IHRoaXMuY2FjaGUob3duZXIpIDoKICAgICAgLy8gQWx3YXlzIHVzZSBjYW1lbENhc2Uga2V5IChnaC0yMjU3KQogICAgICBvd25lclt0aGlzLmV4cGFuZG9dICYmIG93bmVyW3RoaXMuZXhwYW5kb11bY2FtZWxDYXNlKGtleSldOwogICAgfSwKICAgIGFjY2VzczogZnVuY3Rpb24gYWNjZXNzKG93bmVyLCBrZXksIHZhbHVlKSB7CiAgICAgIC8vIEluIGNhc2VzIHdoZXJlIGVpdGhlcjoKICAgICAgLy8KICAgICAgLy8gICAxLiBObyBrZXkgd2FzIHNwZWNpZmllZAogICAgICAvLyAgIDIuIEEgc3RyaW5nIGtleSB3YXMgc3BlY2lmaWVkLCBidXQgbm8gdmFsdWUgcHJvdmlkZWQKICAgICAgLy8KICAgICAgLy8gVGFrZSB0aGUgInJlYWQiIHBhdGggYW5kIGFsbG93IHRoZSBnZXQgbWV0aG9kIHRvIGRldGVybWluZQogICAgICAvLyB3aGljaCB2YWx1ZSB0byByZXR1cm4sIHJlc3BlY3RpdmVseSBlaXRoZXI6CiAgICAgIC8vCiAgICAgIC8vICAgMS4gVGhlIGVudGlyZSBjYWNoZSBvYmplY3QKICAgICAgLy8gICAyLiBUaGUgZGF0YSBzdG9yZWQgYXQgdGhlIGtleQogICAgICAvLwogICAgICBpZiAoa2V5ID09PSB1bmRlZmluZWQgfHwga2V5ICYmIHR5cGVvZiBrZXkgPT09ICJzdHJpbmciICYmIHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXQob3duZXIsIGtleSk7CiAgICAgIH0KCiAgICAgIC8vIFdoZW4gdGhlIGtleSBpcyBub3QgYSBzdHJpbmcsIG9yIGJvdGggYSBrZXkgYW5kIHZhbHVlCiAgICAgIC8vIGFyZSBzcGVjaWZpZWQsIHNldCBvciBleHRlbmQgKGV4aXN0aW5nIG9iamVjdHMpIHdpdGggZWl0aGVyOgogICAgICAvLwogICAgICAvLyAgIDEuIEFuIG9iamVjdCBvZiBwcm9wZXJ0aWVzCiAgICAgIC8vICAgMi4gQSBrZXkgYW5kIHZhbHVlCiAgICAgIC8vCiAgICAgIHRoaXMuc2V0KG93bmVyLCBrZXksIHZhbHVlKTsKCiAgICAgIC8vIFNpbmNlIHRoZSAic2V0IiBwYXRoIGNhbiBoYXZlIHR3byBwb3NzaWJsZSBlbnRyeSBwb2ludHMKICAgICAgLy8gcmV0dXJuIHRoZSBleHBlY3RlZCBkYXRhIGJhc2VkIG9uIHdoaWNoIHBhdGggd2FzIHRha2VuWypdCiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiBrZXk7CiAgICB9LAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUob3duZXIsIGtleSkgewogICAgICB2YXIgaSwKICAgICAgICBjYWNoZSA9IG93bmVyW3RoaXMuZXhwYW5kb107CiAgICAgIGlmIChjYWNoZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBvZiBrZXlzCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoa2V5KSkgewogICAgICAgICAgLy8gSWYga2V5IGlzIGFuIGFycmF5IG9mIGtleXMuLi4KICAgICAgICAgIC8vIFdlIGFsd2F5cyBzZXQgY2FtZWxDYXNlIGtleXMsIHNvIHJlbW92ZSB0aGF0LgogICAgICAgICAga2V5ID0ga2V5Lm1hcChjYW1lbENhc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBrZXkgPSBjYW1lbENhc2Uoa2V5KTsKCiAgICAgICAgICAvLyBJZiBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzLCB1c2UgaXQuCiAgICAgICAgICAvLyBPdGhlcndpc2UsIGNyZWF0ZSBhbiBhcnJheSBieSBtYXRjaGluZyBub24td2hpdGVzcGFjZQogICAgICAgICAga2V5ID0ga2V5IGluIGNhY2hlID8gW2tleV0gOiBrZXkubWF0Y2gocm5vdGh0bWx3aGl0ZSkgfHwgW107CiAgICAgICAgfQogICAgICAgIGkgPSBrZXkubGVuZ3RoOwogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgIGRlbGV0ZSBjYWNoZVtrZXlbaV1dOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gUmVtb3ZlIHRoZSBleHBhbmRvIGlmIHRoZXJlJ3Mgbm8gbW9yZSBkYXRhCiAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCB8fCBqUXVlcnkuaXNFbXB0eU9iamVjdChjYWNoZSkpIHsKICAgICAgICAvLyBTdXBwb3J0OiBDaHJvbWUgPD0zNSAtIDQ1CiAgICAgICAgLy8gV2Via2l0ICYgQmxpbmsgcGVyZm9ybWFuY2Ugc3VmZmVycyB3aGVuIGRlbGV0aW5nIHByb3BlcnRpZXMKICAgICAgICAvLyBmcm9tIERPTSBub2Rlcywgc28gc2V0IHRvIHVuZGVmaW5lZCBpbnN0ZWFkCiAgICAgICAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9Mzc4NjA3IChidWcgcmVzdHJpY3RlZCkKICAgICAgICBpZiAob3duZXIubm9kZVR5cGUpIHsKICAgICAgICAgIG93bmVyW3RoaXMuZXhwYW5kb10gPSB1bmRlZmluZWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSBvd25lclt0aGlzLmV4cGFuZG9dOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGhhc0RhdGE6IGZ1bmN0aW9uIGhhc0RhdGEob3duZXIpIHsKICAgICAgdmFyIGNhY2hlID0gb3duZXJbdGhpcy5leHBhbmRvXTsKICAgICAgcmV0dXJuIGNhY2hlICE9PSB1bmRlZmluZWQgJiYgIWpRdWVyeS5pc0VtcHR5T2JqZWN0KGNhY2hlKTsKICAgIH0KICB9OwogIHZhciBkYXRhUHJpdiA9IG5ldyBEYXRhKCk7CiAgdmFyIGRhdGFVc2VyID0gbmV3IERhdGEoKTsKCiAgLy8JSW1wbGVtZW50YXRpb24gU3VtbWFyeQogIC8vCiAgLy8JMS4gRW5mb3JjZSBBUEkgc3VyZmFjZSBhbmQgc2VtYW50aWMgY29tcGF0aWJpbGl0eSB3aXRoIDEuOS54IGJyYW5jaAogIC8vCTIuIEltcHJvdmUgdGhlIG1vZHVsZSdzIG1haW50YWluYWJpbGl0eSBieSByZWR1Y2luZyB0aGUgc3RvcmFnZQogIC8vCQlwYXRocyB0byBhIHNpbmdsZSBtZWNoYW5pc20uCiAgLy8JMy4gVXNlIHRoZSBzYW1lIHNpbmdsZSBtZWNoYW5pc20gdG8gc3VwcG9ydCAicHJpdmF0ZSIgYW5kICJ1c2VyIiBkYXRhLgogIC8vCTQuIF9OZXZlcl8gZXhwb3NlICJwcml2YXRlIiBkYXRhIHRvIHVzZXIgY29kZSAoVE9ETzogRHJvcCBfZGF0YSwgX3JlbW92ZURhdGEpCiAgLy8JNS4gQXZvaWQgZXhwb3NpbmcgaW1wbGVtZW50YXRpb24gZGV0YWlscyBvbiB1c2VyIG9iamVjdHMgKGVnLiBleHBhbmRvIHByb3BlcnRpZXMpCiAgLy8JNi4gUHJvdmlkZSBhIGNsZWFyIHBhdGggZm9yIGltcGxlbWVudGF0aW9uIHVwZ3JhZGUgdG8gV2Vha01hcCBpbiAyMDE0CgogIHZhciByYnJhY2UgPSAvXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLAogICAgcm11bHRpRGFzaCA9IC9bQS1aXS9nOwogIGZ1bmN0aW9uIGdldERhdGEoZGF0YSkgewogICAgaWYgKGRhdGEgPT09ICJ0cnVlIikgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChkYXRhID09PSAiZmFsc2UiKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChkYXRhID09PSAibnVsbCIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKICAgIGlmIChkYXRhID09PSArZGF0YSArICIiKSB7CiAgICAgIHJldHVybiArZGF0YTsKICAgIH0KICAgIGlmIChyYnJhY2UudGVzdChkYXRhKSkgewogICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBmdW5jdGlvbiBkYXRhQXR0cihlbGVtLCBrZXksIGRhdGEpIHsKICAgIHZhciBuYW1lOwoKICAgIC8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKICAgIC8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQogICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCAmJiBlbGVtLm5vZGVUeXBlID09PSAxKSB7CiAgICAgIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2Uocm11bHRpRGFzaCwgIi0kJiIpLnRvTG93ZXJDYXNlKCk7CiAgICAgIGRhdGEgPSBlbGVtLmdldEF0dHJpYnV0ZShuYW1lKTsKICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICAgIHRyeSB7CiAgICAgICAgICBkYXRhID0gZ2V0RGF0YShkYXRhKTsKICAgICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgICAvLyBNYWtlIHN1cmUgd2Ugc2V0IHRoZSBkYXRhIHNvIGl0IGlzbid0IGNoYW5nZWQgbGF0ZXIKICAgICAgICBkYXRhVXNlci5zZXQoZWxlbSwga2V5LCBkYXRhKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkYXRhID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgalF1ZXJ5LmV4dGVuZCh7CiAgICBoYXNEYXRhOiBmdW5jdGlvbiBoYXNEYXRhKGVsZW0pIHsKICAgICAgcmV0dXJuIGRhdGFVc2VyLmhhc0RhdGEoZWxlbSkgfHwgZGF0YVByaXYuaGFzRGF0YShlbGVtKTsKICAgIH0sCiAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKGVsZW0sIG5hbWUsIF9kYXRhKSB7CiAgICAgIHJldHVybiBkYXRhVXNlci5hY2Nlc3MoZWxlbSwgbmFtZSwgX2RhdGEpOwogICAgfSwKICAgIHJlbW92ZURhdGE6IGZ1bmN0aW9uIHJlbW92ZURhdGEoZWxlbSwgbmFtZSkgewogICAgICBkYXRhVXNlci5yZW1vdmUoZWxlbSwgbmFtZSk7CiAgICB9LAogICAgLy8gVE9ETzogTm93IHRoYXQgYWxsIGNhbGxzIHRvIF9kYXRhIGFuZCBfcmVtb3ZlRGF0YSBoYXZlIGJlZW4gcmVwbGFjZWQKICAgIC8vIHdpdGggZGlyZWN0IGNhbGxzIHRvIGRhdGFQcml2IG1ldGhvZHMsIHRoZXNlIGNhbiBiZSBkZXByZWNhdGVkLgogICAgX2RhdGE6IGZ1bmN0aW9uIF9kYXRhKGVsZW0sIG5hbWUsIGRhdGEpIHsKICAgICAgcmV0dXJuIGRhdGFQcml2LmFjY2VzcyhlbGVtLCBuYW1lLCBkYXRhKTsKICAgIH0sCiAgICBfcmVtb3ZlRGF0YTogZnVuY3Rpb24gX3JlbW92ZURhdGEoZWxlbSwgbmFtZSkgewogICAgICBkYXRhUHJpdi5yZW1vdmUoZWxlbSwgbmFtZSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBkYXRhOiBmdW5jdGlvbiBkYXRhKGtleSwgdmFsdWUpIHsKICAgICAgdmFyIGksCiAgICAgICAgbmFtZSwKICAgICAgICBkYXRhLAogICAgICAgIGVsZW0gPSB0aGlzWzBdLAogICAgICAgIGF0dHJzID0gZWxlbSAmJiBlbGVtLmF0dHJpYnV0ZXM7CgogICAgICAvLyBHZXRzIGFsbCB2YWx1ZXMKICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKHRoaXMubGVuZ3RoKSB7CiAgICAgICAgICBkYXRhID0gZGF0YVVzZXIuZ2V0KGVsZW0pOwogICAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgIWRhdGFQcml2LmdldChlbGVtLCAiaGFzRGF0YUF0dHJzIikpIHsKICAgICAgICAgICAgaSA9IGF0dHJzLmxlbmd0aDsKICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDExIG9ubHkKICAgICAgICAgICAgICAvLyBUaGUgYXR0cnMgZWxlbWVudHMgY2FuIGJlIG51bGwgKCMxNDg5NCkKICAgICAgICAgICAgICBpZiAoYXR0cnNbaV0pIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBhdHRyc1tpXS5uYW1lOwogICAgICAgICAgICAgICAgaWYgKG5hbWUuaW5kZXhPZigiZGF0YS0iKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBuYW1lID0gY2FtZWxDYXNlKG5hbWUuc2xpY2UoNSkpOwogICAgICAgICAgICAgICAgICBkYXRhQXR0cihlbGVtLCBuYW1lLCBkYXRhW25hbWVdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YVByaXYuc2V0KGVsZW0sICJoYXNEYXRhQXR0cnMiLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgIH0KCiAgICAgIC8vIFNldHMgbXVsdGlwbGUgdmFsdWVzCiAgICAgIGlmIChfdHlwZW9mKGtleSkgPT09ICJvYmplY3QiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkYXRhVXNlci5zZXQodGhpcywga2V5KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gYWNjZXNzKHRoaXMsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIHZhciBkYXRhOwoKICAgICAgICAvLyBUaGUgY2FsbGluZyBqUXVlcnkgb2JqZWN0IChlbGVtZW50IG1hdGNoZXMpIGlzIG5vdCBlbXB0eQogICAgICAgIC8vIChhbmQgdGhlcmVmb3JlIGhhcyBhbiBlbGVtZW50IGFwcGVhcnMgYXQgdGhpc1sgMCBdKSBhbmQgdGhlCiAgICAgICAgLy8gYHZhbHVlYCBwYXJhbWV0ZXIgd2FzIG5vdCB1bmRlZmluZWQuIEFuIGVtcHR5IGpRdWVyeSBvYmplY3QKICAgICAgICAvLyB3aWxsIHJlc3VsdCBpbiBgdW5kZWZpbmVkYCBmb3IgZWxlbSA9IHRoaXNbIDAgXSB3aGljaCB3aWxsCiAgICAgICAgLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFuIGF0dGVtcHQgdG8gcmVhZCBhIGRhdGEgY2FjaGUgaXMgbWFkZS4KICAgICAgICBpZiAoZWxlbSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyBBdHRlbXB0IHRvIGdldCBkYXRhIGZyb20gdGhlIGNhY2hlCiAgICAgICAgICAvLyBUaGUga2V5IHdpbGwgYWx3YXlzIGJlIGNhbWVsQ2FzZWQgaW4gRGF0YQogICAgICAgICAgZGF0YSA9IGRhdGFVc2VyLmdldChlbGVtLCBrZXkpOwogICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBdHRlbXB0IHRvICJkaXNjb3ZlciIgdGhlIGRhdGEgaW4KICAgICAgICAgIC8vIEhUTUw1IGN1c3RvbSBkYXRhLSogYXR0cnMKICAgICAgICAgIGRhdGEgPSBkYXRhQXR0cihlbGVtLCBrZXkpOwogICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBXZSB0cmllZCByZWFsbHkgaGFyZCwgYnV0IHRoZSBkYXRhIGRvZXNuJ3QgZXhpc3QuCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBTZXQgdGhlIGRhdGEuLi4KICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gV2UgYWx3YXlzIHN0b3JlIHRoZSBjYW1lbENhc2VkIGtleQogICAgICAgICAgZGF0YVVzZXIuc2V0KHRoaXMsIGtleSwgdmFsdWUpOwogICAgICAgIH0pOwogICAgICB9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUpOwogICAgfSwKICAgIHJlbW92ZURhdGE6IGZ1bmN0aW9uIHJlbW92ZURhdGEoa2V5KSB7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGRhdGFVc2VyLnJlbW92ZSh0aGlzLCBrZXkpOwogICAgICB9KTsKICAgIH0KICB9KTsKICBqUXVlcnkuZXh0ZW5kKHsKICAgIHF1ZXVlOiBmdW5jdGlvbiBxdWV1ZShlbGVtLCB0eXBlLCBkYXRhKSB7CiAgICAgIHZhciBxdWV1ZTsKICAgICAgaWYgKGVsZW0pIHsKICAgICAgICB0eXBlID0gKHR5cGUgfHwgImZ4IikgKyAicXVldWUiOwogICAgICAgIHF1ZXVlID0gZGF0YVByaXYuZ2V0KGVsZW0sIHR5cGUpOwoKICAgICAgICAvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIGlmICghcXVldWUgfHwgQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgICBxdWV1ZSA9IGRhdGFQcml2LmFjY2VzcyhlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHF1ZXVlLnB1c2goZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBxdWV1ZSB8fCBbXTsKICAgICAgfQogICAgfSwKICAgIGRlcXVldWU6IGZ1bmN0aW9uIGRlcXVldWUoZWxlbSwgdHlwZSkgewogICAgICB0eXBlID0gdHlwZSB8fCAiZngiOwogICAgICB2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoZWxlbSwgdHlwZSksCiAgICAgICAgc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCiAgICAgICAgZm4gPSBxdWV1ZS5zaGlmdCgpLAogICAgICAgIGhvb2tzID0galF1ZXJ5Ll9xdWV1ZUhvb2tzKGVsZW0sIHR5cGUpLAogICAgICAgIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICAgalF1ZXJ5LmRlcXVldWUoZWxlbSwgdHlwZSk7CiAgICAgICAgfTsKCiAgICAgIC8vIElmIHRoZSBmeCBxdWV1ZSBpcyBkZXF1ZXVlZCwgYWx3YXlzIHJlbW92ZSB0aGUgcHJvZ3Jlc3Mgc2VudGluZWwKICAgICAgaWYgKGZuID09PSAiaW5wcm9ncmVzcyIpIHsKICAgICAgICBmbiA9IHF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgc3RhcnRMZW5ndGgtLTsKICAgICAgfQogICAgICBpZiAoZm4pIHsKICAgICAgICAvLyBBZGQgYSBwcm9ncmVzcyBzZW50aW5lbCB0byBwcmV2ZW50IHRoZSBmeCBxdWV1ZSBmcm9tIGJlaW5nCiAgICAgICAgLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAogICAgICAgIGlmICh0eXBlID09PSAiZngiKSB7CiAgICAgICAgICBxdWV1ZS51bnNoaWZ0KCJpbnByb2dyZXNzIik7CiAgICAgICAgfQoKICAgICAgICAvLyBDbGVhciB1cCB0aGUgbGFzdCBxdWV1ZSBzdG9wIGZ1bmN0aW9uCiAgICAgICAgZGVsZXRlIGhvb2tzLnN0b3A7CiAgICAgICAgZm4uY2FsbChlbGVtLCBuZXh0LCBob29rcyk7CiAgICAgIH0KICAgICAgaWYgKCFzdGFydExlbmd0aCAmJiBob29rcykgewogICAgICAgIGhvb2tzLmVtcHR5LmZpcmUoKTsKICAgICAgfQogICAgfSwKICAgIC8vIE5vdCBwdWJsaWMgLSBnZW5lcmF0ZSBhIHF1ZXVlSG9va3Mgb2JqZWN0LCBvciByZXR1cm4gdGhlIGN1cnJlbnQgb25lCiAgICBfcXVldWVIb29rczogZnVuY3Rpb24gX3F1ZXVlSG9va3MoZWxlbSwgdHlwZSkgewogICAgICB2YXIga2V5ID0gdHlwZSArICJxdWV1ZUhvb2tzIjsKICAgICAgcmV0dXJuIGRhdGFQcml2LmdldChlbGVtLCBrZXkpIHx8IGRhdGFQcml2LmFjY2VzcyhlbGVtLCBrZXksIHsKICAgICAgICBlbXB0eTogalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZGF0YVByaXYucmVtb3ZlKGVsZW0sIFt0eXBlICsgInF1ZXVlIiwga2V5XSk7CiAgICAgICAgfSkKICAgICAgfSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBxdWV1ZTogZnVuY3Rpb24gcXVldWUodHlwZSwgZGF0YSkgewogICAgICB2YXIgc2V0dGVyID0gMjsKICAgICAgaWYgKHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIikgewogICAgICAgIGRhdGEgPSB0eXBlOwogICAgICAgIHR5cGUgPSAiZngiOwogICAgICAgIHNldHRlci0tOwogICAgICB9CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgc2V0dGVyKSB7CiAgICAgICAgcmV0dXJuIGpRdWVyeS5xdWV1ZSh0aGlzWzBdLCB0eXBlKTsKICAgICAgfQogICAgICByZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8gdGhpcyA6IHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKHRoaXMsIHR5cGUsIGRhdGEpOwoKICAgICAgICAvLyBFbnN1cmUgYSBob29rcyBmb3IgdGhpcyBxdWV1ZQogICAgICAgIGpRdWVyeS5fcXVldWVIb29rcyh0aGlzLCB0eXBlKTsKICAgICAgICBpZiAodHlwZSA9PT0gImZ4IiAmJiBxdWV1ZVswXSAhPT0gImlucHJvZ3Jlc3MiKSB7CiAgICAgICAgICBqUXVlcnkuZGVxdWV1ZSh0aGlzLCB0eXBlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGRlcXVldWU6IGZ1bmN0aW9uIGRlcXVldWUodHlwZSkgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBqUXVlcnkuZGVxdWV1ZSh0aGlzLCB0eXBlKTsKICAgICAgfSk7CiAgICB9LAogICAgY2xlYXJRdWV1ZTogZnVuY3Rpb24gY2xlYXJRdWV1ZSh0eXBlKSB7CiAgICAgIHJldHVybiB0aGlzLnF1ZXVlKHR5cGUgfHwgImZ4IiwgW10pOwogICAgfSwKICAgIC8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKICAgIC8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQogICAgcHJvbWlzZTogZnVuY3Rpb24gcHJvbWlzZSh0eXBlLCBvYmopIHsKICAgICAgdmFyIHRtcCwKICAgICAgICBjb3VudCA9IDEsCiAgICAgICAgZGVmZXIgPSBqUXVlcnkuRGVmZXJyZWQoKSwKICAgICAgICBlbGVtZW50cyA9IHRoaXMsCiAgICAgICAgaSA9IHRoaXMubGVuZ3RoLAogICAgICAgIHJlc29sdmUgPSBmdW5jdGlvbiByZXNvbHZlKCkgewogICAgICAgICAgaWYgKCEgLS1jb3VudCkgewogICAgICAgICAgICBkZWZlci5yZXNvbHZlV2l0aChlbGVtZW50cywgW2VsZW1lbnRzXSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgaWYgKHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIikgewogICAgICAgIG9iaiA9IHR5cGU7CiAgICAgICAgdHlwZSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICB0eXBlID0gdHlwZSB8fCAiZngiOwogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdG1wID0gZGF0YVByaXYuZ2V0KGVsZW1lbnRzW2ldLCB0eXBlICsgInF1ZXVlSG9va3MiKTsKICAgICAgICBpZiAodG1wICYmIHRtcC5lbXB0eSkgewogICAgICAgICAgY291bnQrKzsKICAgICAgICAgIHRtcC5lbXB0eS5hZGQocmVzb2x2ZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc29sdmUoKTsKICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2Uob2JqKTsKICAgIH0KICB9KTsKICB2YXIgcG51bSA9IC9bKy1dPyg/OlxkKlwufClcZCsoPzpbZUVdWystXT9cZCt8KS8uc291cmNlOwogIHZhciByY3NzTnVtID0gbmV3IFJlZ0V4cCgiXig/OihbKy1dKT18KSgiICsgcG51bSArICIpKFthLXolXSopJCIsICJpIik7CiAgdmFyIGNzc0V4cGFuZCA9IFsiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0Il07CiAgdmFyIGRvY3VtZW50RWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICB2YXIgaXNBdHRhY2hlZCA9IGZ1bmN0aW9uIGlzQXR0YWNoZWQoZWxlbSkgewogICAgICByZXR1cm4galF1ZXJ5LmNvbnRhaW5zKGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSk7CiAgICB9LAogICAgY29tcG9zZWQgPSB7CiAgICAgIGNvbXBvc2VkOiB0cnVlCiAgICB9OwoKICAvLyBTdXBwb3J0OiBJRSA5IC0gMTErLCBFZGdlIDEyIC0gMTgrLCBpT1MgMTAuMCAtIDEwLjIgb25seQogIC8vIENoZWNrIGF0dGFjaG1lbnQgYWNyb3NzIHNoYWRvdyBET00gYm91bmRhcmllcyB3aGVuIHBvc3NpYmxlIChnaC0zNTA0KQogIC8vIFN1cHBvcnQ6IGlPUyAxMC4wLTEwLjIgb25seQogIC8vIEVhcmx5IGlPUyAxMCB2ZXJzaW9ucyBzdXBwb3J0IGBhdHRhY2hTaGFkb3dgIGJ1dCBub3QgYGdldFJvb3ROb2RlYCwKICAvLyBsZWFkaW5nIHRvIGVycm9ycy4gV2UgbmVlZCB0byBjaGVjayBmb3IgYGdldFJvb3ROb2RlYC4KICBpZiAoZG9jdW1lbnRFbGVtZW50LmdldFJvb3ROb2RlKSB7CiAgICBpc0F0dGFjaGVkID0gZnVuY3Rpb24gaXNBdHRhY2hlZChlbGVtKSB7CiAgICAgIHJldHVybiBqUXVlcnkuY29udGFpbnMoZWxlbS5vd25lckRvY3VtZW50LCBlbGVtKSB8fCBlbGVtLmdldFJvb3ROb2RlKGNvbXBvc2VkKSA9PT0gZWxlbS5vd25lckRvY3VtZW50OwogICAgfTsKICB9CiAgdmFyIGlzSGlkZGVuV2l0aGluVHJlZSA9IGZ1bmN0aW9uIGlzSGlkZGVuV2l0aGluVHJlZShlbGVtLCBlbCkgewogICAgLy8gaXNIaWRkZW5XaXRoaW5UcmVlIG1pZ2h0IGJlIGNhbGxlZCBmcm9tIGpRdWVyeSNmaWx0ZXIgZnVuY3Rpb247CiAgICAvLyBpbiB0aGF0IGNhc2UsIGVsZW1lbnQgd2lsbCBiZSBzZWNvbmQgYXJndW1lbnQKICAgIGVsZW0gPSBlbCB8fCBlbGVtOwoKICAgIC8vIElubGluZSBzdHlsZSB0cnVtcHMgYWxsCiAgICByZXR1cm4gZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJgogICAgLy8gT3RoZXJ3aXNlLCBjaGVjayBjb21wdXRlZCBzdHlsZQogICAgLy8gU3VwcG9ydDogRmlyZWZveCA8PTQzIC0gNDUKICAgIC8vIERpc2Nvbm5lY3RlZCBlbGVtZW50cyBjYW4gaGF2ZSBjb21wdXRlZCBkaXNwbGF5OiBub25lLCBzbyBmaXJzdCBjb25maXJtIHRoYXQgZWxlbSBpcwogICAgLy8gaW4gdGhlIGRvY3VtZW50LgogICAgaXNBdHRhY2hlZChlbGVtKSAmJiBqUXVlcnkuY3NzKGVsZW0sICJkaXNwbGF5IikgPT09ICJub25lIjsKICB9OwogIGZ1bmN0aW9uIGFkanVzdENTUyhlbGVtLCBwcm9wLCB2YWx1ZVBhcnRzLCB0d2VlbikgewogICAgdmFyIGFkanVzdGVkLAogICAgICBzY2FsZSwKICAgICAgbWF4SXRlcmF0aW9ucyA9IDIwLAogICAgICBjdXJyZW50VmFsdWUgPSB0d2VlbiA/IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdHdlZW4uY3VyKCk7CiAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGpRdWVyeS5jc3MoZWxlbSwgcHJvcCwgIiIpOwogICAgICB9LAogICAgICBpbml0aWFsID0gY3VycmVudFZhbHVlKCksCiAgICAgIHVuaXQgPSB2YWx1ZVBhcnRzICYmIHZhbHVlUGFydHNbM10gfHwgKGpRdWVyeS5jc3NOdW1iZXJbcHJvcF0gPyAiIiA6ICJweCIpLAogICAgICAvLyBTdGFydGluZyB2YWx1ZSBjb21wdXRhdGlvbiBpcyByZXF1aXJlZCBmb3IgcG90ZW50aWFsIHVuaXQgbWlzbWF0Y2hlcwogICAgICBpbml0aWFsSW5Vbml0ID0gZWxlbS5ub2RlVHlwZSAmJiAoalF1ZXJ5LmNzc051bWJlcltwcm9wXSB8fCB1bml0ICE9PSAicHgiICYmICtpbml0aWFsKSAmJiByY3NzTnVtLmV4ZWMoalF1ZXJ5LmNzcyhlbGVtLCBwcm9wKSk7CiAgICBpZiAoaW5pdGlhbEluVW5pdCAmJiBpbml0aWFsSW5Vbml0WzNdICE9PSB1bml0KSB7CiAgICAgIC8vIFN1cHBvcnQ6IEZpcmVmb3ggPD01NAogICAgICAvLyBIYWx2ZSB0aGUgaXRlcmF0aW9uIHRhcmdldCB2YWx1ZSB0byBwcmV2ZW50IGludGVyZmVyZW5jZSBmcm9tIENTUyB1cHBlciBib3VuZHMgKGdoLTIxNDQpCiAgICAgIGluaXRpYWwgPSBpbml0aWFsIC8gMjsKCiAgICAgIC8vIFRydXN0IHVuaXRzIHJlcG9ydGVkIGJ5IGpRdWVyeS5jc3MKICAgICAgdW5pdCA9IHVuaXQgfHwgaW5pdGlhbEluVW5pdFszXTsKCiAgICAgIC8vIEl0ZXJhdGl2ZWx5IGFwcHJveGltYXRlIGZyb20gYSBub256ZXJvIHN0YXJ0aW5nIHBvaW50CiAgICAgIGluaXRpYWxJblVuaXQgPSAraW5pdGlhbCB8fCAxOwogICAgICB3aGlsZSAobWF4SXRlcmF0aW9ucy0tKSB7CiAgICAgICAgLy8gRXZhbHVhdGUgYW5kIHVwZGF0ZSBvdXIgYmVzdCBndWVzcyAoZG91YmxpbmcgZ3Vlc3NlcyB0aGF0IHplcm8gb3V0KS4KICAgICAgICAvLyBGaW5pc2ggaWYgdGhlIHNjYWxlIGVxdWFscyBvciBjcm9zc2VzIDEgKG1ha2luZyB0aGUgb2xkKm5ldyBwcm9kdWN0IG5vbi1wb3NpdGl2ZSkuCiAgICAgICAgalF1ZXJ5LnN0eWxlKGVsZW0sIHByb3AsIGluaXRpYWxJblVuaXQgKyB1bml0KTsKICAgICAgICBpZiAoKDEgLSBzY2FsZSkgKiAoMSAtIChzY2FsZSA9IGN1cnJlbnRWYWx1ZSgpIC8gaW5pdGlhbCB8fCAwLjUpKSA8PSAwKSB7CiAgICAgICAgICBtYXhJdGVyYXRpb25zID0gMDsKICAgICAgICB9CiAgICAgICAgaW5pdGlhbEluVW5pdCA9IGluaXRpYWxJblVuaXQgLyBzY2FsZTsKICAgICAgfQogICAgICBpbml0aWFsSW5Vbml0ID0gaW5pdGlhbEluVW5pdCAqIDI7CiAgICAgIGpRdWVyeS5zdHlsZShlbGVtLCBwcm9wLCBpbml0aWFsSW5Vbml0ICsgdW5pdCk7CgogICAgICAvLyBNYWtlIHN1cmUgd2UgdXBkYXRlIHRoZSB0d2VlbiBwcm9wZXJ0aWVzIGxhdGVyIG9uCiAgICAgIHZhbHVlUGFydHMgPSB2YWx1ZVBhcnRzIHx8IFtdOwogICAgfQogICAgaWYgKHZhbHVlUGFydHMpIHsKICAgICAgaW5pdGlhbEluVW5pdCA9ICtpbml0aWFsSW5Vbml0IHx8ICtpbml0aWFsIHx8IDA7CgogICAgICAvLyBBcHBseSByZWxhdGl2ZSBvZmZzZXQgKCs9Ly09KSBpZiBzcGVjaWZpZWQKICAgICAgYWRqdXN0ZWQgPSB2YWx1ZVBhcnRzWzFdID8gaW5pdGlhbEluVW5pdCArICh2YWx1ZVBhcnRzWzFdICsgMSkgKiB2YWx1ZVBhcnRzWzJdIDogK3ZhbHVlUGFydHNbMl07CiAgICAgIGlmICh0d2VlbikgewogICAgICAgIHR3ZWVuLnVuaXQgPSB1bml0OwogICAgICAgIHR3ZWVuLnN0YXJ0ID0gaW5pdGlhbEluVW5pdDsKICAgICAgICB0d2Vlbi5lbmQgPSBhZGp1c3RlZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGFkanVzdGVkOwogIH0KICB2YXIgZGVmYXVsdERpc3BsYXlNYXAgPSB7fTsKICBmdW5jdGlvbiBnZXREZWZhdWx0RGlzcGxheShlbGVtKSB7CiAgICB2YXIgdGVtcCwKICAgICAgZG9jID0gZWxlbS5vd25lckRvY3VtZW50LAogICAgICBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUsCiAgICAgIGRpc3BsYXkgPSBkZWZhdWx0RGlzcGxheU1hcFtub2RlTmFtZV07CiAgICBpZiAoZGlzcGxheSkgewogICAgICByZXR1cm4gZGlzcGxheTsKICAgIH0KICAgIHRlbXAgPSBkb2MuYm9keS5hcHBlbmRDaGlsZChkb2MuY3JlYXRlRWxlbWVudChub2RlTmFtZSkpOwogICAgZGlzcGxheSA9IGpRdWVyeS5jc3ModGVtcCwgImRpc3BsYXkiKTsKICAgIHRlbXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0ZW1wKTsKICAgIGlmIChkaXNwbGF5ID09PSAibm9uZSIpIHsKICAgICAgZGlzcGxheSA9ICJibG9jayI7CiAgICB9CiAgICBkZWZhdWx0RGlzcGxheU1hcFtub2RlTmFtZV0gPSBkaXNwbGF5OwogICAgcmV0dXJuIGRpc3BsYXk7CiAgfQogIGZ1bmN0aW9uIHNob3dIaWRlKGVsZW1lbnRzLCBzaG93KSB7CiAgICB2YXIgZGlzcGxheSwKICAgICAgZWxlbSwKICAgICAgdmFsdWVzID0gW10sCiAgICAgIGluZGV4ID0gMCwKICAgICAgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOwoKICAgIC8vIERldGVybWluZSBuZXcgZGlzcGxheSB2YWx1ZSBmb3IgZWxlbWVudHMgdGhhdCBuZWVkIHRvIGNoYW5nZQogICAgZm9yICg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIGVsZW0gPSBlbGVtZW50c1tpbmRleF07CiAgICAgIGlmICghZWxlbS5zdHlsZSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgLy8gU2luY2Ugd2UgZm9yY2UgdmlzaWJpbGl0eSB1cG9uIGNhc2NhZGUtaGlkZGVuIGVsZW1lbnRzLCBhbiBpbW1lZGlhdGUgKGFuZCBzbG93KQogICAgICAgIC8vIGNoZWNrIGlzIHJlcXVpcmVkIGluIHRoaXMgZmlyc3QgbG9vcCB1bmxlc3Mgd2UgaGF2ZSBhIG5vbmVtcHR5IGRpc3BsYXkgdmFsdWUgKGVpdGhlcgogICAgICAgIC8vIGlubGluZSBvciBhYm91dC10by1iZS1yZXN0b3JlZCkKICAgICAgICBpZiAoZGlzcGxheSA9PT0gIm5vbmUiKSB7CiAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gZGF0YVByaXYuZ2V0KGVsZW0sICJkaXNwbGF5IikgfHwgbnVsbDsKICAgICAgICAgIGlmICghdmFsdWVzW2luZGV4XSkgewogICAgICAgICAgICBlbGVtLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgJiYgaXNIaWRkZW5XaXRoaW5UcmVlKGVsZW0pKSB7CiAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gZ2V0RGVmYXVsdERpc3BsYXkoZWxlbSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChkaXNwbGF5ICE9PSAibm9uZSIpIHsKICAgICAgICAgIHZhbHVlc1tpbmRleF0gPSAibm9uZSI7CgogICAgICAgICAgLy8gUmVtZW1iZXIgd2hhdCB3ZSdyZSBvdmVyd3JpdGluZwogICAgICAgICAgZGF0YVByaXYuc2V0KGVsZW0sICJkaXNwbGF5IiwgZGlzcGxheSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gU2V0IHRoZSBkaXNwbGF5IG9mIHRoZSBlbGVtZW50cyBpbiBhIHNlY29uZCBsb29wIHRvIGF2b2lkIGNvbnN0YW50IHJlZmxvdwogICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIGlmICh2YWx1ZXNbaW5kZXhdICE9IG51bGwpIHsKICAgICAgICBlbGVtZW50c1tpbmRleF0uc3R5bGUuZGlzcGxheSA9IHZhbHVlc1tpbmRleF07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbGVtZW50czsKICB9CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICByZXR1cm4gc2hvd0hpZGUodGhpcywgdHJ1ZSk7CiAgICB9LAogICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgcmV0dXJuIHNob3dIaWRlKHRoaXMpOwogICAgfSwKICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHN0YXRlKSB7CiAgICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09ICJib29sZWFuIikgewogICAgICAgIHJldHVybiBzdGF0ZSA/IHRoaXMuc2hvdygpIDogdGhpcy5oaWRlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGlzSGlkZGVuV2l0aGluVHJlZSh0aGlzKSkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLnNob3coKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLmhpZGUoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwogIHZhciByY2hlY2thYmxlVHlwZSA9IC9eKD86Y2hlY2tib3h8cmFkaW8pJC9pOwogIHZhciBydGFnTmFtZSA9IC88KFthLXpdW15cL1wwPlx4MjBcdFxyXG5cZl0qKS9pOwogIHZhciByc2NyaXB0VHlwZSA9IC9eJHxebW9kdWxlJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaTsKICAoZnVuY3Rpb24gKCkgewogICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAogICAgICBkaXYgPSBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSksCiAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKCiAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDQuMCAtIDQuMyBvbmx5CiAgICAvLyBDaGVjayBzdGF0ZSBsb3N0IGlmIHRoZSBuYW1lIGlzIHNldCAoIzExMjE3KQogICAgLy8gU3VwcG9ydDogV2luZG93cyBXZWIgQXBwcyAoV1dBKQogICAgLy8gYG5hbWVgIGFuZCBgdHlwZWAgbXVzdCB1c2UgLnNldEF0dHJpYnV0ZSBmb3IgV1dBICgjMTQ5MDEpCiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAicmFkaW8iKTsKICAgIGlucHV0LnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsICJjaGVja2VkIik7CiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoIm5hbWUiLCAidCIpOwogICAgZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKCiAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDw9NC4xIG9ubHkKICAgIC8vIE9sZGVyIFdlYktpdCBkb2Vzbid0IGNsb25lIGNoZWNrZWQgc3RhdGUgY29ycmVjdGx5IGluIGZyYWdtZW50cwogICAgc3VwcG9ydC5jaGVja0Nsb25lID0gZGl2LmNsb25lTm9kZSh0cnVlKS5jbG9uZU5vZGUodHJ1ZSkubGFzdENoaWxkLmNoZWNrZWQ7CgogICAgLy8gU3VwcG9ydDogSUUgPD0xMSBvbmx5CiAgICAvLyBNYWtlIHN1cmUgdGV4dGFyZWEgKGFuZCBjaGVja2JveCkgZGVmYXVsdFZhbHVlIGlzIHByb3Blcmx5IGNsb25lZAogICAgZGl2LmlubmVySFRNTCA9ICI8dGV4dGFyZWE+eDwvdGV4dGFyZWE+IjsKICAgIHN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSAhIWRpdi5jbG9uZU5vZGUodHJ1ZSkubGFzdENoaWxkLmRlZmF1bHRWYWx1ZTsKCiAgICAvLyBTdXBwb3J0OiBJRSA8PTkgb25seQogICAgLy8gSUUgPD05IHJlcGxhY2VzIDxvcHRpb24+IHRhZ3Mgd2l0aCB0aGVpciBjb250ZW50cyB3aGVuIGluc2VydGVkIG91dHNpZGUgb2YKICAgIC8vIHRoZSBzZWxlY3QgZWxlbWVudC4KICAgIGRpdi5pbm5lckhUTUwgPSAiPG9wdGlvbj48L29wdGlvbj4iOwogICAgc3VwcG9ydC5vcHRpb24gPSAhIWRpdi5sYXN0Q2hpbGQ7CiAgfSkoKTsKCiAgLy8gV2UgaGF2ZSB0byBjbG9zZSB0aGVzZSB0YWdzIHRvIHN1cHBvcnQgWEhUTUwgKCMxMzIwMCkKICB2YXIgd3JhcE1hcCA9IHsKICAgIC8vIFhIVE1MIHBhcnNlcnMgZG8gbm90IG1hZ2ljYWxseSBpbnNlcnQgZWxlbWVudHMgaW4gdGhlCiAgICAvLyBzYW1lIHdheSB0aGF0IHRhZyBzb3VwIHBhcnNlcnMgZG8uIFNvIHdlIGNhbm5vdCBzaG9ydGVuCiAgICAvLyB0aGlzIGJ5IG9taXR0aW5nIDx0Ym9keT4gb3Igb3RoZXIgcmVxdWlyZWQgZWxlbWVudHMuCiAgICB0aGVhZDogWzEsICI8dGFibGU+IiwgIjwvdGFibGU+Il0sCiAgICBjb2w6IFsyLCAiPHRhYmxlPjxjb2xncm91cD4iLCAiPC9jb2xncm91cD48L3RhYmxlPiJdLAogICAgdHI6IFsyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiJdLAogICAgdGQ6IFszLCAiPHRhYmxlPjx0Ym9keT48dHI+IiwgIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLAogICAgX2RlZmF1bHQ6IFswLCAiIiwgIiJdCiAgfTsKICB3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkOwogIHdyYXBNYXAudGggPSB3cmFwTWFwLnRkOwoKICAvLyBTdXBwb3J0OiBJRSA8PTkgb25seQogIGlmICghc3VwcG9ydC5vcHRpb24pIHsKICAgIHdyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbiA9IFsxLCAiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iXTsKICB9CiAgZnVuY3Rpb24gZ2V0QWxsKGNvbnRleHQsIHRhZykgewogICAgLy8gU3VwcG9ydDogSUUgPD05IC0gMTEgb25seQogICAgLy8gVXNlIHR5cGVvZiB0byBhdm9pZCB6ZXJvLWFyZ3VtZW50IG1ldGhvZCBpbnZvY2F0aW9uIG9uIGhvc3Qgb2JqZWN0cyAoIzE1MTUxKQogICAgdmFyIHJldDsKICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgcmV0ID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWcgfHwgIioiKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgcmV0ID0gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKHRhZyB8fCAiKiIpOwogICAgfSBlbHNlIHsKICAgICAgcmV0ID0gW107CiAgICB9CiAgICBpZiAodGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIG5vZGVOYW1lKGNvbnRleHQsIHRhZykpIHsKICAgICAgcmV0dXJuIGpRdWVyeS5tZXJnZShbY29udGV4dF0sIHJldCk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KCiAgLy8gTWFyayBzY3JpcHRzIGFzIGhhdmluZyBhbHJlYWR5IGJlZW4gZXZhbHVhdGVkCiAgZnVuY3Rpb24gc2V0R2xvYmFsRXZhbChlbGVtcywgcmVmRWxlbWVudHMpIHsKICAgIHZhciBpID0gMCwKICAgICAgbCA9IGVsZW1zLmxlbmd0aDsKICAgIGZvciAoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGRhdGFQcml2LnNldChlbGVtc1tpXSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgZGF0YVByaXYuZ2V0KHJlZkVsZW1lbnRzW2ldLCAiZ2xvYmFsRXZhbCIpKTsKICAgIH0KICB9CiAgdmFyIHJodG1sID0gLzx8JiM/XHcrOy87CiAgZnVuY3Rpb24gYnVpbGRGcmFnbWVudChlbGVtcywgY29udGV4dCwgc2NyaXB0cywgc2VsZWN0aW9uLCBpZ25vcmVkKSB7CiAgICB2YXIgZWxlbSwKICAgICAgdG1wLAogICAgICB0YWcsCiAgICAgIHdyYXAsCiAgICAgIGF0dGFjaGVkLAogICAgICBqLAogICAgICBmcmFnbWVudCA9IGNvbnRleHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAogICAgICBub2RlcyA9IFtdLAogICAgICBpID0gMCwKICAgICAgbCA9IGVsZW1zLmxlbmd0aDsKICAgIGZvciAoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGVsZW0gPSBlbGVtc1tpXTsKICAgICAgaWYgKGVsZW0gfHwgZWxlbSA9PT0gMCkgewogICAgICAgIC8vIEFkZCBub2RlcyBkaXJlY3RseQogICAgICAgIGlmICh0b1R5cGUoZWxlbSkgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDw9NC4wIG9ubHksIFBoYW50b21KUyAxIG9ubHkKICAgICAgICAgIC8vIHB1c2guYXBwbHkoXywgYXJyYXlsaWtlKSB0aHJvd3Mgb24gYW5jaWVudCBXZWJLaXQKICAgICAgICAgIGpRdWVyeS5tZXJnZShub2RlcywgZWxlbS5ub2RlVHlwZSA/IFtlbGVtXSA6IGVsZW0pOwoKICAgICAgICAgIC8vIENvbnZlcnQgbm9uLWh0bWwgaW50byBhIHRleHQgbm9kZQogICAgICAgIH0gZWxzZSBpZiAoIXJodG1sLnRlc3QoZWxlbSkpIHsKICAgICAgICAgIG5vZGVzLnB1c2goY29udGV4dC5jcmVhdGVUZXh0Tm9kZShlbGVtKSk7CgogICAgICAgICAgLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRtcCA9IHRtcCB8fCBmcmFnbWVudC5hcHBlbmRDaGlsZChjb250ZXh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTsKCiAgICAgICAgICAvLyBEZXNlcmlhbGl6ZSBhIHN0YW5kYXJkIHJlcHJlc2VudGF0aW9uCiAgICAgICAgICB0YWcgPSAocnRhZ05hbWUuZXhlYyhlbGVtKSB8fCBbIiIsICIiXSlbMV0udG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHdyYXAgPSB3cmFwTWFwW3RhZ10gfHwgd3JhcE1hcC5fZGVmYXVsdDsKICAgICAgICAgIHRtcC5pbm5lckhUTUwgPSB3cmFwWzFdICsgalF1ZXJ5Lmh0bWxQcmVmaWx0ZXIoZWxlbSkgKyB3cmFwWzJdOwoKICAgICAgICAgIC8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAogICAgICAgICAgaiA9IHdyYXBbMF07CiAgICAgICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgICAgIHRtcCA9IHRtcC5sYXN0Q2hpbGQ7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gU3VwcG9ydDogQW5kcm9pZCA8PTQuMCBvbmx5LCBQaGFudG9tSlMgMSBvbmx5CiAgICAgICAgICAvLyBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzIG9uIGFuY2llbnQgV2ViS2l0CiAgICAgICAgICBqUXVlcnkubWVyZ2Uobm9kZXMsIHRtcC5jaGlsZE5vZGVzKTsKCiAgICAgICAgICAvLyBSZW1lbWJlciB0aGUgdG9wLWxldmVsIGNvbnRhaW5lcgogICAgICAgICAgdG1wID0gZnJhZ21lbnQuZmlyc3RDaGlsZDsKCiAgICAgICAgICAvLyBFbnN1cmUgdGhlIGNyZWF0ZWQgbm9kZXMgYXJlIG9ycGhhbmVkICgjMTIzOTIpCiAgICAgICAgICB0bXAudGV4dENvbnRlbnQgPSAiIjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBSZW1vdmUgd3JhcHBlciBmcm9tIGZyYWdtZW50CiAgICBmcmFnbWVudC50ZXh0Q29udGVudCA9ICIiOwogICAgaSA9IDA7CiAgICB3aGlsZSAoZWxlbSA9IG5vZGVzW2krK10pIHsKICAgICAgLy8gU2tpcCBlbGVtZW50cyBhbHJlYWR5IGluIHRoZSBjb250ZXh0IGNvbGxlY3Rpb24gKHRyYWMtNDA4NykKICAgICAgaWYgKHNlbGVjdGlvbiAmJiBqUXVlcnkuaW5BcnJheShlbGVtLCBzZWxlY3Rpb24pID4gLTEpIHsKICAgICAgICBpZiAoaWdub3JlZCkgewogICAgICAgICAgaWdub3JlZC5wdXNoKGVsZW0pOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBhdHRhY2hlZCA9IGlzQXR0YWNoZWQoZWxlbSk7CgogICAgICAvLyBBcHBlbmQgdG8gZnJhZ21lbnQKICAgICAgdG1wID0gZ2V0QWxsKGZyYWdtZW50LmFwcGVuZENoaWxkKGVsZW0pLCAic2NyaXB0Iik7CgogICAgICAvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CiAgICAgIGlmIChhdHRhY2hlZCkgewogICAgICAgIHNldEdsb2JhbEV2YWwodG1wKTsKICAgICAgfQoKICAgICAgLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwogICAgICBpZiAoc2NyaXB0cykgewogICAgICAgIGogPSAwOwogICAgICAgIHdoaWxlIChlbGVtID0gdG1wW2orK10pIHsKICAgICAgICAgIGlmIChyc2NyaXB0VHlwZS50ZXN0KGVsZW0udHlwZSB8fCAiIikpIHsKICAgICAgICAgICAgc2NyaXB0cy5wdXNoKGVsZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGZyYWdtZW50OwogIH0KICB2YXIgcmtleUV2ZW50ID0gL15rZXkvLAogICAgcm1vdXNlRXZlbnQgPSAvXig/Om1vdXNlfHBvaW50ZXJ8Y29udGV4dG1lbnV8ZHJhZ3xkcm9wKXxjbGljay8sCiAgICBydHlwZW5hbWVzcGFjZSA9IC9eKFteLl0qKSg/OlwuKC4rKXwpLzsKICBmdW5jdGlvbiByZXR1cm5UcnVlKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGZ1bmN0aW9uIHJldHVybkZhbHNlKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8gU3VwcG9ydDogSUUgPD05IC0gMTErCiAgLy8gZm9jdXMoKSBhbmQgYmx1cigpIGFyZSBhc3luY2hyb25vdXMsIGV4Y2VwdCB3aGVuIHRoZXkgYXJlIG5vLW9wLgogIC8vIFNvIGV4cGVjdCBmb2N1cyB0byBiZSBzeW5jaHJvbm91cyB3aGVuIHRoZSBlbGVtZW50IGlzIGFscmVhZHkgYWN0aXZlLAogIC8vIGFuZCBibHVyIHRvIGJlIHN5bmNocm9ub3VzIHdoZW4gdGhlIGVsZW1lbnQgaXMgbm90IGFscmVhZHkgYWN0aXZlLgogIC8vIChmb2N1cyBhbmQgYmx1ciBhcmUgYWx3YXlzIHN5bmNocm9ub3VzIGluIG90aGVyIHN1cHBvcnRlZCBicm93c2VycywKICAvLyB0aGlzIGp1c3QgZGVmaW5lcyB3aGVuIHdlIGNhbiBjb3VudCBvbiBpdCkuCiAgZnVuY3Rpb24gZXhwZWN0U3luYyhlbGVtLCB0eXBlKSB7CiAgICByZXR1cm4gZWxlbSA9PT0gc2FmZUFjdGl2ZUVsZW1lbnQoKSA9PT0gKHR5cGUgPT09ICJmb2N1cyIpOwogIH0KCiAgLy8gU3VwcG9ydDogSUUgPD05IG9ubHkKICAvLyBBY2Nlc3NpbmcgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBjYW4gdGhyb3cgdW5leHBlY3RlZGx5CiAgLy8gaHR0cHM6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEzMzkzCiAgZnVuY3Rpb24gc2FmZUFjdGl2ZUVsZW1lbnQoKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgIH0gY2F0Y2ggKGVycikge30KICB9CiAgZnVuY3Rpb24gX29uKGVsZW0sIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4sIG9uZSkgewogICAgdmFyIG9yaWdGbiwgdHlwZTsKCiAgICAvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKICAgIGlmIChfdHlwZW9mKHR5cGVzKSA9PT0gIm9iamVjdCIpIHsKICAgICAgLy8gKCB0eXBlcy1PYmplY3QsIHNlbGVjdG9yLCBkYXRhICkKICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIpIHsKICAgICAgICAvLyAoIHR5cGVzLU9iamVjdCwgZGF0YSApCiAgICAgICAgZGF0YSA9IGRhdGEgfHwgc2VsZWN0b3I7CiAgICAgICAgc2VsZWN0b3IgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZm9yICh0eXBlIGluIHR5cGVzKSB7CiAgICAgICAgX29uKGVsZW0sIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1t0eXBlXSwgb25lKTsKICAgICAgfQogICAgICByZXR1cm4gZWxlbTsKICAgIH0KICAgIGlmIChkYXRhID09IG51bGwgJiYgZm4gPT0gbnVsbCkgewogICAgICAvLyAoIHR5cGVzLCBmbiApCiAgICAgIGZuID0gc2VsZWN0b3I7CiAgICAgIGRhdGEgPSBzZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgIH0gZWxzZSBpZiAoZm4gPT0gbnVsbCkgewogICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIikgewogICAgICAgIC8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCiAgICAgICAgZm4gPSBkYXRhOwogICAgICAgIGRhdGEgPSB1bmRlZmluZWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gKCB0eXBlcywgZGF0YSwgZm4gKQogICAgICAgIGZuID0gZGF0YTsKICAgICAgICBkYXRhID0gc2VsZWN0b3I7CiAgICAgICAgc2VsZWN0b3IgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0KICAgIGlmIChmbiA9PT0gZmFsc2UpIHsKICAgICAgZm4gPSByZXR1cm5GYWxzZTsKICAgIH0gZWxzZSBpZiAoIWZuKSB7CiAgICAgIHJldHVybiBlbGVtOwogICAgfQogICAgaWYgKG9uZSA9PT0gMSkgewogICAgICBvcmlnRm4gPSBmbjsKICAgICAgZm4gPSBmdW5jdGlvbiBmbihldmVudCkgewogICAgICAgIC8vIENhbiB1c2UgYW4gZW1wdHkgc2V0LCBzaW5jZSBldmVudCBjb250YWlucyB0aGUgaW5mbwogICAgICAgIGpRdWVyeSgpLm9mZihldmVudCk7CiAgICAgICAgcmV0dXJuIG9yaWdGbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwoKICAgICAgLy8gVXNlIHNhbWUgZ3VpZCBzbyBjYWxsZXIgY2FuIHJlbW92ZSB1c2luZyBvcmlnRm4KICAgICAgZm4uZ3VpZCA9IG9yaWdGbi5ndWlkIHx8IChvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKyspOwogICAgfQogICAgcmV0dXJuIGVsZW0uZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIGpRdWVyeS5ldmVudC5hZGQodGhpcywgdHlwZXMsIGZuLCBkYXRhLCBzZWxlY3Rvcik7CiAgICB9KTsKICB9CgogIC8qCiAgKiBIZWxwZXIgZnVuY3Rpb25zIGZvciBtYW5hZ2luZyBldmVudHMgLS0gbm90IHBhcnQgb2YgdGhlIHB1YmxpYyBpbnRlcmZhY2UuCiAgKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogICovCiAgalF1ZXJ5LmV2ZW50ID0gewogICAgZ2xvYmFsOiB7fSwKICAgIGFkZDogZnVuY3Rpb24gYWRkKGVsZW0sIHR5cGVzLCBoYW5kbGVyLCBkYXRhLCBzZWxlY3RvcikgewogICAgICB2YXIgaGFuZGxlT2JqSW4sCiAgICAgICAgZXZlbnRIYW5kbGUsCiAgICAgICAgdG1wLAogICAgICAgIGV2ZW50cywKICAgICAgICB0LAogICAgICAgIGhhbmRsZU9iaiwKICAgICAgICBzcGVjaWFsLAogICAgICAgIGhhbmRsZXJzLAogICAgICAgIHR5cGUsCiAgICAgICAgbmFtZXNwYWNlcywKICAgICAgICBvcmlnVHlwZSwKICAgICAgICBlbGVtRGF0YSA9IGRhdGFQcml2LmdldChlbGVtKTsKCiAgICAgIC8vIE9ubHkgYXR0YWNoIGV2ZW50cyB0byBvYmplY3RzIHRoYXQgYWNjZXB0IGRhdGEKICAgICAgaWYgKCFhY2NlcHREYXRhKGVsZW0pKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYW4gb2JqZWN0IG9mIGN1c3RvbSBkYXRhIGluIGxpZXUgb2YgdGhlIGhhbmRsZXIKICAgICAgaWYgKGhhbmRsZXIuaGFuZGxlcikgewogICAgICAgIGhhbmRsZU9iakluID0gaGFuZGxlcjsKICAgICAgICBoYW5kbGVyID0gaGFuZGxlT2JqSW4uaGFuZGxlcjsKICAgICAgICBzZWxlY3RvciA9IGhhbmRsZU9iakluLnNlbGVjdG9yOwogICAgICB9CgogICAgICAvLyBFbnN1cmUgdGhhdCBpbnZhbGlkIHNlbGVjdG9ycyB0aHJvdyBleGNlcHRpb25zIGF0IGF0dGFjaCB0aW1lCiAgICAgIC8vIEV2YWx1YXRlIGFnYWluc3QgZG9jdW1lbnRFbGVtZW50IGluIGNhc2UgZWxlbSBpcyBhIG5vbi1lbGVtZW50IG5vZGUgKGUuZy4sIGRvY3VtZW50KQogICAgICBpZiAoc2VsZWN0b3IpIHsKICAgICAgICBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoZG9jdW1lbnRFbGVtZW50LCBzZWxlY3Rvcik7CiAgICAgIH0KCiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBoYW5kbGVyIGhhcyBhIHVuaXF1ZSBJRCwgdXNlZCB0byBmaW5kL3JlbW92ZSBpdCBsYXRlcgogICAgICBpZiAoIWhhbmRsZXIuZ3VpZCkgewogICAgICAgIGhhbmRsZXIuZ3VpZCA9IGpRdWVyeS5ndWlkKys7CiAgICAgIH0KCiAgICAgIC8vIEluaXQgdGhlIGVsZW1lbnQncyBldmVudCBzdHJ1Y3R1cmUgYW5kIG1haW4gaGFuZGxlciwgaWYgdGhpcyBpcyB0aGUgZmlyc3QKICAgICAgaWYgKCEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSkgewogICAgICAgIGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KICAgICAgaWYgKCEoZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUpKSB7CiAgICAgICAgZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgLy8gRGlzY2FyZCB0aGUgc2Vjb25kIGV2ZW50IG9mIGEgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoKSBhbmQKICAgICAgICAgIC8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKICAgICAgICAgIHJldHVybiB0eXBlb2YgalF1ZXJ5ICE9PSAidW5kZWZpbmVkIiAmJiBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUgPyBqUXVlcnkuZXZlbnQuZGlzcGF0Y2guYXBwbHkoZWxlbSwgYXJndW1lbnRzKSA6IHVuZGVmaW5lZDsKICAgICAgICB9OwogICAgICB9CgogICAgICAvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCiAgICAgIHR5cGVzID0gKHR5cGVzIHx8ICIiKS5tYXRjaChybm90aHRtbHdoaXRlKSB8fCBbIiJdOwogICAgICB0ID0gdHlwZXMubGVuZ3RoOwogICAgICB3aGlsZSAodC0tKSB7CiAgICAgICAgdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyh0eXBlc1t0XSkgfHwgW107CiAgICAgICAgdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwogICAgICAgIG5hbWVzcGFjZXMgPSAodG1wWzJdIHx8ICIiKS5zcGxpdCgiLiIpLnNvcnQoKTsKCiAgICAgICAgLy8gVGhlcmUgKm11c3QqIGJlIGEgdHlwZSwgbm8gYXR0YWNoaW5nIG5hbWVzcGFjZS1vbmx5IGhhbmRsZXJzCiAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIElmIGV2ZW50IGNoYW5nZXMgaXRzIHR5cGUsIHVzZSB0aGUgc3BlY2lhbCBldmVudCBoYW5kbGVycyBmb3IgdGhlIGNoYW5nZWQgdHlwZQogICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCB7fTsKCiAgICAgICAgLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCiAgICAgICAgdHlwZSA9IChzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSkgfHwgdHlwZTsKCiAgICAgICAgLy8gVXBkYXRlIHNwZWNpYWwgYmFzZWQgb24gbmV3bHkgcmVzZXQgdHlwZQogICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCB7fTsKCiAgICAgICAgLy8gaGFuZGxlT2JqIGlzIHBhc3NlZCB0byBhbGwgZXZlbnQgaGFuZGxlcnMKICAgICAgICBoYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICBvcmlnVHlwZTogb3JpZ1R5cGUsCiAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgaGFuZGxlcjogaGFuZGxlciwKICAgICAgICAgIGd1aWQ6IGhhbmRsZXIuZ3VpZCwKICAgICAgICAgIHNlbGVjdG9yOiBzZWxlY3RvciwKICAgICAgICAgIG5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3Qoc2VsZWN0b3IpLAogICAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2VzLmpvaW4oIi4iKQogICAgICAgIH0sIGhhbmRsZU9iakluKTsKCiAgICAgICAgLy8gSW5pdCB0aGUgZXZlbnQgaGFuZGxlciBxdWV1ZSBpZiB3ZSdyZSB0aGUgZmlyc3QKICAgICAgICBpZiAoIShoYW5kbGVycyA9IGV2ZW50c1t0eXBlXSkpIHsKICAgICAgICAgIGhhbmRsZXJzID0gZXZlbnRzW3R5cGVdID0gW107CiAgICAgICAgICBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50ID0gMDsKCiAgICAgICAgICAvLyBPbmx5IHVzZSBhZGRFdmVudExpc3RlbmVyIGlmIHRoZSBzcGVjaWFsIGV2ZW50cyBoYW5kbGVyIHJldHVybnMgZmFsc2UKICAgICAgICAgIGlmICghc3BlY2lhbC5zZXR1cCB8fCBzcGVjaWFsLnNldHVwLmNhbGwoZWxlbSwgZGF0YSwgbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUpID09PSBmYWxzZSkgewogICAgICAgICAgICBpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGV2ZW50SGFuZGxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc3BlY2lhbC5hZGQpIHsKICAgICAgICAgIHNwZWNpYWwuYWRkLmNhbGwoZWxlbSwgaGFuZGxlT2JqKTsKICAgICAgICAgIGlmICghaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCkgewogICAgICAgICAgICBoYW5kbGVPYmouaGFuZGxlci5ndWlkID0gaGFuZGxlci5ndWlkOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIHRvIHRoZSBlbGVtZW50J3MgaGFuZGxlciBsaXN0LCBkZWxlZ2F0ZXMgaW4gZnJvbnQKICAgICAgICBpZiAoc2VsZWN0b3IpIHsKICAgICAgICAgIGhhbmRsZXJzLnNwbGljZShoYW5kbGVycy5kZWxlZ2F0ZUNvdW50KyssIDAsIGhhbmRsZU9iaik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhhbmRsZXJzLnB1c2goaGFuZGxlT2JqKTsKICAgICAgICB9CgogICAgICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggZXZlbnRzIGhhdmUgZXZlciBiZWVuIHVzZWQsIGZvciBldmVudCBvcHRpbWl6YXRpb24KICAgICAgICBqUXVlcnkuZXZlbnQuZ2xvYmFsW3R5cGVdID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIC8vIERldGFjaCBhbiBldmVudCBvciBzZXQgb2YgZXZlbnRzIGZyb20gYW4gZWxlbWVudAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcykgewogICAgICB2YXIgaiwKICAgICAgICBvcmlnQ291bnQsCiAgICAgICAgdG1wLAogICAgICAgIGV2ZW50cywKICAgICAgICB0LAogICAgICAgIGhhbmRsZU9iaiwKICAgICAgICBzcGVjaWFsLAogICAgICAgIGhhbmRsZXJzLAogICAgICAgIHR5cGUsCiAgICAgICAgbmFtZXNwYWNlcywKICAgICAgICBvcmlnVHlwZSwKICAgICAgICBlbGVtRGF0YSA9IGRhdGFQcml2Lmhhc0RhdGEoZWxlbSkgJiYgZGF0YVByaXYuZ2V0KGVsZW0pOwogICAgICBpZiAoIWVsZW1EYXRhIHx8ICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZAogICAgICB0eXBlcyA9ICh0eXBlcyB8fCAiIikubWF0Y2gocm5vdGh0bWx3aGl0ZSkgfHwgWyIiXTsKICAgICAgdCA9IHR5cGVzLmxlbmd0aDsKICAgICAgd2hpbGUgKHQtLSkgewogICAgICAgIHRtcCA9IHJ0eXBlbmFtZXNwYWNlLmV4ZWModHlwZXNbdF0pIHx8IFtdOwogICAgICAgIHR5cGUgPSBvcmlnVHlwZSA9IHRtcFsxXTsKICAgICAgICBuYW1lc3BhY2VzID0gKHRtcFsyXSB8fCAiIikuc3BsaXQoIi4iKS5zb3J0KCk7CgogICAgICAgIC8vIFVuYmluZCBhbGwgZXZlbnRzIChvbiB0aGlzIG5hbWVzcGFjZSwgaWYgcHJvdmlkZWQpIGZvciB0aGUgZWxlbWVudAogICAgICAgIGlmICghdHlwZSkgewogICAgICAgICAgZm9yICh0eXBlIGluIGV2ZW50cykgewogICAgICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKGVsZW0sIHR5cGUgKyB0eXBlc1t0XSwgaGFuZGxlciwgc2VsZWN0b3IsIHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCB7fTsKICAgICAgICB0eXBlID0gKHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlKSB8fCB0eXBlOwogICAgICAgIGhhbmRsZXJzID0gZXZlbnRzW3R5cGVdIHx8IFtdOwogICAgICAgIHRtcCA9IHRtcFsyXSAmJiBuZXcgUmVnRXhwKCIoXnxcXC4pIiArIG5hbWVzcGFjZXMuam9pbigiXFwuKD86LipcXC58KSIpICsgIihcXC58JCkiKTsKCiAgICAgICAgLy8gUmVtb3ZlIG1hdGNoaW5nIGV2ZW50cwogICAgICAgIG9yaWdDb3VudCA9IGogPSBoYW5kbGVycy5sZW5ndGg7CiAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgaGFuZGxlT2JqID0gaGFuZGxlcnNbal07CiAgICAgICAgICBpZiAoKG1hcHBlZFR5cGVzIHx8IG9yaWdUeXBlID09PSBoYW5kbGVPYmoub3JpZ1R5cGUpICYmICghaGFuZGxlciB8fCBoYW5kbGVyLmd1aWQgPT09IGhhbmRsZU9iai5ndWlkKSAmJiAoIXRtcCB8fCB0bXAudGVzdChoYW5kbGVPYmoubmFtZXNwYWNlKSkgJiYgKCFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvcikpIHsKICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKGosIDEpOwogICAgICAgICAgICBpZiAoaGFuZGxlT2JqLnNlbGVjdG9yKSB7CiAgICAgICAgICAgICAgaGFuZGxlcnMuZGVsZWdhdGVDb3VudC0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzcGVjaWFsLnJlbW92ZSkgewogICAgICAgICAgICAgIHNwZWNpYWwucmVtb3ZlLmNhbGwoZWxlbSwgaGFuZGxlT2JqKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3ZlIGdlbmVyaWMgZXZlbnQgaGFuZGxlciBpZiB3ZSByZW1vdmVkIHNvbWV0aGluZyBhbmQgbm8gbW9yZSBoYW5kbGVycyBleGlzdAogICAgICAgIC8vIChhdm9pZHMgcG90ZW50aWFsIGZvciBlbmRsZXNzIHJlY3Vyc2lvbiBkdXJpbmcgcmVtb3ZhbCBvZiBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzKQogICAgICAgIGlmIChvcmlnQ291bnQgJiYgIWhhbmRsZXJzLmxlbmd0aCkgewogICAgICAgICAgaWYgKCFzcGVjaWFsLnRlYXJkb3duIHx8IHNwZWNpYWwudGVhcmRvd24uY2FsbChlbGVtLCBuYW1lc3BhY2VzLCBlbGVtRGF0YS5oYW5kbGUpID09PSBmYWxzZSkgewogICAgICAgICAgICBqUXVlcnkucmVtb3ZlRXZlbnQoZWxlbSwgdHlwZSwgZWxlbURhdGEuaGFuZGxlKTsKICAgICAgICAgIH0KICAgICAgICAgIGRlbGV0ZSBldmVudHNbdHlwZV07CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBSZW1vdmUgZGF0YSBhbmQgdGhlIGV4cGFuZG8gaWYgaXQncyBubyBsb25nZXIgdXNlZAogICAgICBpZiAoalF1ZXJ5LmlzRW1wdHlPYmplY3QoZXZlbnRzKSkgewogICAgICAgIGRhdGFQcml2LnJlbW92ZShlbGVtLCAiaGFuZGxlIGV2ZW50cyIpOwogICAgICB9CiAgICB9LAogICAgZGlzcGF0Y2g6IGZ1bmN0aW9uIGRpc3BhdGNoKG5hdGl2ZUV2ZW50KSB7CiAgICAgIHZhciBpLAogICAgICAgIGosCiAgICAgICAgcmV0LAogICAgICAgIG1hdGNoZWQsCiAgICAgICAgaGFuZGxlT2JqLAogICAgICAgIGhhbmRsZXJRdWV1ZSwKICAgICAgICBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGgpLAogICAgICAgIC8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAogICAgICAgIGV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeChuYXRpdmVFdmVudCksCiAgICAgICAgaGFuZGxlcnMgPSAoZGF0YVByaXYuZ2V0KHRoaXMsICJldmVudHMiKSB8fCBPYmplY3QuY3JlYXRlKG51bGwpKVtldmVudC50eXBlXSB8fCBbXSwKICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbZXZlbnQudHlwZV0gfHwge307CgogICAgICAvLyBVc2UgdGhlIGZpeC1lZCBqUXVlcnkuRXZlbnQgcmF0aGVyIHRoYW4gdGhlIChyZWFkLW9ubHkpIG5hdGl2ZSBldmVudAogICAgICBhcmdzWzBdID0gZXZlbnQ7CiAgICAgIGZvciAoaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldOwogICAgICB9CiAgICAgIGV2ZW50LmRlbGVnYXRlVGFyZ2V0ID0gdGhpczsKCiAgICAgIC8vIENhbGwgdGhlIHByZURpc3BhdGNoIGhvb2sgZm9yIHRoZSBtYXBwZWQgdHlwZSwgYW5kIGxldCBpdCBiYWlsIGlmIGRlc2lyZWQKICAgICAgaWYgKHNwZWNpYWwucHJlRGlzcGF0Y2ggJiYgc3BlY2lhbC5wcmVEaXNwYXRjaC5jYWxsKHRoaXMsIGV2ZW50KSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIERldGVybWluZSBoYW5kbGVycwogICAgICBoYW5kbGVyUXVldWUgPSBqUXVlcnkuZXZlbnQuaGFuZGxlcnMuY2FsbCh0aGlzLCBldmVudCwgaGFuZGxlcnMpOwoKICAgICAgLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKICAgICAgaSA9IDA7CiAgICAgIHdoaWxlICgobWF0Y2hlZCA9IGhhbmRsZXJRdWV1ZVtpKytdKSAmJiAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgewogICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CiAgICAgICAgaiA9IDA7CiAgICAgICAgd2hpbGUgKChoYW5kbGVPYmogPSBtYXRjaGVkLmhhbmRsZXJzW2orK10pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpKSB7CiAgICAgICAgICAvLyBJZiB0aGUgZXZlbnQgaXMgbmFtZXNwYWNlZCwgdGhlbiBlYWNoIGhhbmRsZXIgaXMgb25seSBpbnZva2VkIGlmIGl0IGlzCiAgICAgICAgICAvLyBzcGVjaWFsbHkgdW5pdmVyc2FsIG9yIGl0cyBuYW1lc3BhY2VzIGFyZSBhIHN1cGVyc2V0IG9mIHRoZSBldmVudCdzLgogICAgICAgICAgaWYgKCFldmVudC5ybmFtZXNwYWNlIHx8IGhhbmRsZU9iai5uYW1lc3BhY2UgPT09IGZhbHNlIHx8IGV2ZW50LnJuYW1lc3BhY2UudGVzdChoYW5kbGVPYmoubmFtZXNwYWNlKSkgewogICAgICAgICAgICBldmVudC5oYW5kbGVPYmogPSBoYW5kbGVPYmo7CiAgICAgICAgICAgIGV2ZW50LmRhdGEgPSBoYW5kbGVPYmouZGF0YTsKICAgICAgICAgICAgcmV0ID0gKChqUXVlcnkuZXZlbnQuc3BlY2lhbFtoYW5kbGVPYmoub3JpZ1R5cGVdIHx8IHt9KS5oYW5kbGUgfHwgaGFuZGxlT2JqLmhhbmRsZXIpLmFwcGx5KG1hdGNoZWQuZWxlbSwgYXJncyk7CiAgICAgICAgICAgIGlmIChyZXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmICgoZXZlbnQucmVzdWx0ID0gcmV0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIENhbGwgdGhlIHBvc3REaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUKICAgICAgaWYgKHNwZWNpYWwucG9zdERpc3BhdGNoKSB7CiAgICAgICAgc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCh0aGlzLCBldmVudCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGV2ZW50LnJlc3VsdDsKICAgIH0sCiAgICBoYW5kbGVyczogZnVuY3Rpb24gaGFuZGxlcnMoZXZlbnQsIF9oYW5kbGVycykgewogICAgICB2YXIgaSwKICAgICAgICBoYW5kbGVPYmosCiAgICAgICAgc2VsLAogICAgICAgIG1hdGNoZWRIYW5kbGVycywKICAgICAgICBtYXRjaGVkU2VsZWN0b3JzLAogICAgICAgIGhhbmRsZXJRdWV1ZSA9IFtdLAogICAgICAgIGRlbGVnYXRlQ291bnQgPSBfaGFuZGxlcnMuZGVsZWdhdGVDb3VudCwKICAgICAgICBjdXIgPSBldmVudC50YXJnZXQ7CgogICAgICAvLyBGaW5kIGRlbGVnYXRlIGhhbmRsZXJzCiAgICAgIGlmIChkZWxlZ2F0ZUNvdW50ICYmCiAgICAgIC8vIFN1cHBvcnQ6IElFIDw9OQogICAgICAvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAodHJhYy0xMzE4MCkKICAgICAgY3VyLm5vZGVUeXBlICYmCiAgICAgIC8vIFN1cHBvcnQ6IEZpcmVmb3ggPD00MgogICAgICAvLyBTdXBwcmVzcyBzcGVjLXZpb2xhdGluZyBjbGlja3MgaW5kaWNhdGluZyBhIG5vbi1wcmltYXJ5IHBvaW50ZXIgYnV0dG9uICh0cmFjLTM4NjEpCiAgICAgIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMy1FdmVudHMvI2V2ZW50LXR5cGUtY2xpY2sKICAgICAgLy8gU3VwcG9ydDogSUUgMTEgb25seQogICAgICAvLyAuLi5idXQgbm90IGFycm93IGtleSAiY2xpY2tzIiBvZiByYWRpbyBpbnB1dHMsIHdoaWNoIGNhbiBoYXZlIGBidXR0b25gIC0xIChnaC0yMzQzKQogICAgICAhKGV2ZW50LnR5cGUgPT09ICJjbGljayIgJiYgZXZlbnQuYnV0dG9uID49IDEpKSB7CiAgICAgICAgZm9yICg7IGN1ciAhPT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcykgewogICAgICAgICAgLy8gRG9uJ3QgY2hlY2sgbm9uLWVsZW1lbnRzICgjMTMyMDgpCiAgICAgICAgICAvLyBEb24ndCBwcm9jZXNzIGNsaWNrcyBvbiBkaXNhYmxlZCBlbGVtZW50cyAoIzY5MTEsICM4MTY1LCAjMTEzODIsICMxMTc2NCkKICAgICAgICAgIGlmIChjdXIubm9kZVR5cGUgPT09IDEgJiYgIShldmVudC50eXBlID09PSAiY2xpY2siICYmIGN1ci5kaXNhYmxlZCA9PT0gdHJ1ZSkpIHsKICAgICAgICAgICAgbWF0Y2hlZEhhbmRsZXJzID0gW107CiAgICAgICAgICAgIG1hdGNoZWRTZWxlY3RvcnMgPSB7fTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRlbGVnYXRlQ291bnQ7IGkrKykgewogICAgICAgICAgICAgIGhhbmRsZU9iaiA9IF9oYW5kbGVyc1tpXTsKCiAgICAgICAgICAgICAgLy8gRG9uJ3QgY29uZmxpY3Qgd2l0aCBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKCMxMzIwMykKICAgICAgICAgICAgICBzZWwgPSBoYW5kbGVPYmouc2VsZWN0b3IgKyAiICI7CiAgICAgICAgICAgICAgaWYgKG1hdGNoZWRTZWxlY3RvcnNbc2VsXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBtYXRjaGVkU2VsZWN0b3JzW3NlbF0gPSBoYW5kbGVPYmoubmVlZHNDb250ZXh0ID8galF1ZXJ5KHNlbCwgdGhpcykuaW5kZXgoY3VyKSA+IC0xIDogalF1ZXJ5LmZpbmQoc2VsLCB0aGlzLCBudWxsLCBbY3VyXSkubGVuZ3RoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAobWF0Y2hlZFNlbGVjdG9yc1tzZWxdKSB7CiAgICAgICAgICAgICAgICBtYXRjaGVkSGFuZGxlcnMucHVzaChoYW5kbGVPYmopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWF0Y2hlZEhhbmRsZXJzLmxlbmd0aCkgewogICAgICAgICAgICAgIGhhbmRsZXJRdWV1ZS5wdXNoKHsKICAgICAgICAgICAgICAgIGVsZW06IGN1ciwKICAgICAgICAgICAgICAgIGhhbmRsZXJzOiBtYXRjaGVkSGFuZGxlcnMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gQWRkIHRoZSByZW1haW5pbmcgKGRpcmVjdGx5LWJvdW5kKSBoYW5kbGVycwogICAgICBjdXIgPSB0aGlzOwogICAgICBpZiAoZGVsZWdhdGVDb3VudCA8IF9oYW5kbGVycy5sZW5ndGgpIHsKICAgICAgICBoYW5kbGVyUXVldWUucHVzaCh7CiAgICAgICAgICBlbGVtOiBjdXIsCiAgICAgICAgICBoYW5kbGVyczogX2hhbmRsZXJzLnNsaWNlKGRlbGVnYXRlQ291bnQpCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGhhbmRsZXJRdWV1ZTsKICAgIH0sCiAgICBhZGRQcm9wOiBmdW5jdGlvbiBhZGRQcm9wKG5hbWUsIGhvb2spIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGpRdWVyeS5FdmVudC5wcm90b3R5cGUsIG5hbWUsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGlzRnVuY3Rpb24oaG9vaykgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodGhpcy5vcmlnaW5hbEV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiBob29rKHRoaXMub3JpZ2luYWxFdmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh0aGlzLm9yaWdpbmFsRXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luYWxFdmVudFtuYW1lXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgbmFtZSwgewogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZml4OiBmdW5jdGlvbiBmaXgob3JpZ2luYWxFdmVudCkgewogICAgICByZXR1cm4gb3JpZ2luYWxFdmVudFtqUXVlcnkuZXhwYW5kb10gPyBvcmlnaW5hbEV2ZW50IDogbmV3IGpRdWVyeS5FdmVudChvcmlnaW5hbEV2ZW50KTsKICAgIH0sCiAgICBzcGVjaWFsOiB7CiAgICAgIGxvYWQ6IHsKICAgICAgICAvLyBQcmV2ZW50IHRyaWdnZXJlZCBpbWFnZS5sb2FkIGV2ZW50cyBmcm9tIGJ1YmJsaW5nIHRvIHdpbmRvdy5sb2FkCiAgICAgICAgbm9CdWJibGU6IHRydWUKICAgICAgfSwKICAgICAgY2xpY2s6IHsKICAgICAgICAvLyBVdGlsaXplIG5hdGl2ZSBldmVudCB0byBlbnN1cmUgY29ycmVjdCBzdGF0ZSBmb3IgY2hlY2thYmxlIGlucHV0cwogICAgICAgIHNldHVwOiBmdW5jdGlvbiBzZXR1cChkYXRhKSB7CiAgICAgICAgICAvLyBGb3IgbXV0dWFsIGNvbXByZXNzaWJpbGl0eSB3aXRoIF9kZWZhdWx0LCByZXBsYWNlIGB0aGlzYCBhY2Nlc3Mgd2l0aCBhIGxvY2FsIHZhci4KICAgICAgICAgIC8vIGB8fCBkYXRhYCBpcyBkZWFkIGNvZGUgbWVhbnQgb25seSB0byBwcmVzZXJ2ZSB0aGUgdmFyaWFibGUgdGhyb3VnaCBtaW5pZmljYXRpb24uCiAgICAgICAgICB2YXIgZWwgPSB0aGlzIHx8IGRhdGE7CgogICAgICAgICAgLy8gQ2xhaW0gdGhlIGZpcnN0IGhhbmRsZXIKICAgICAgICAgIGlmIChyY2hlY2thYmxlVHlwZS50ZXN0KGVsLnR5cGUpICYmIGVsLmNsaWNrICYmIG5vZGVOYW1lKGVsLCAiaW5wdXQiKSkgewogICAgICAgICAgICAvLyBkYXRhUHJpdi5zZXQoIGVsLCAiY2xpY2siLCAuLi4gKQogICAgICAgICAgICBsZXZlcmFnZU5hdGl2ZShlbCwgImNsaWNrIiwgcmV0dXJuVHJ1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIHRvIGFsbG93IG5vcm1hbCBwcm9jZXNzaW5nIGluIHRoZSBjYWxsZXIKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAogICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uIHRyaWdnZXIoZGF0YSkgewogICAgICAgICAgLy8gRm9yIG11dHVhbCBjb21wcmVzc2liaWxpdHkgd2l0aCBfZGVmYXVsdCwgcmVwbGFjZSBgdGhpc2AgYWNjZXNzIHdpdGggYSBsb2NhbCB2YXIuCiAgICAgICAgICAvLyBgfHwgZGF0YWAgaXMgZGVhZCBjb2RlIG1lYW50IG9ubHkgdG8gcHJlc2VydmUgdGhlIHZhcmlhYmxlIHRocm91Z2ggbWluaWZpY2F0aW9uLgogICAgICAgICAgdmFyIGVsID0gdGhpcyB8fCBkYXRhOwoKICAgICAgICAgIC8vIEZvcmNlIHNldHVwIGJlZm9yZSB0cmlnZ2VyaW5nIGEgY2xpY2sKICAgICAgICAgIGlmIChyY2hlY2thYmxlVHlwZS50ZXN0KGVsLnR5cGUpICYmIGVsLmNsaWNrICYmIG5vZGVOYW1lKGVsLCAiaW5wdXQiKSkgewogICAgICAgICAgICBsZXZlcmFnZU5hdGl2ZShlbCwgImNsaWNrIik7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gUmV0dXJuIG5vbi1mYWxzZSB0byBhbGxvdyBub3JtYWwgZXZlbnQtcGF0aCBwcm9wYWdhdGlvbgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKICAgICAgICAvLyBGb3IgY3Jvc3MtYnJvd3NlciBjb25zaXN0ZW5jeSwgc3VwcHJlc3MgbmF0aXZlIC5jbGljaygpIG9uIGxpbmtzCiAgICAgICAgLy8gQWxzbyBwcmV2ZW50IGl0IGlmIHdlJ3JlIGN1cnJlbnRseSBpbnNpZGUgYSBsZXZlcmFnZWQgbmF0aXZlLWV2ZW50IHN0YWNrCiAgICAgICAgX2RlZmF1bHQ6IGZ1bmN0aW9uIF9kZWZhdWx0KGV2ZW50KSB7CiAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgcmV0dXJuIHJjaGVja2FibGVUeXBlLnRlc3QodGFyZ2V0LnR5cGUpICYmIHRhcmdldC5jbGljayAmJiBub2RlTmFtZSh0YXJnZXQsICJpbnB1dCIpICYmIGRhdGFQcml2LmdldCh0YXJnZXQsICJjbGljayIpIHx8IG5vZGVOYW1lKHRhcmdldCwgImEiKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJlZm9yZXVubG9hZDogewogICAgICAgIHBvc3REaXNwYXRjaDogZnVuY3Rpb24gcG9zdERpc3BhdGNoKGV2ZW50KSB7CiAgICAgICAgICAvLyBTdXBwb3J0OiBGaXJlZm94IDIwKwogICAgICAgICAgLy8gRmlyZWZveCBkb2Vzbid0IGFsZXJ0IGlmIHRoZSByZXR1cm5WYWx1ZSBmaWVsZCBpcyBub3Qgc2V0LgogICAgICAgICAgaWYgKGV2ZW50LnJlc3VsdCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50Lm9yaWdpbmFsRXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudC5yZXR1cm5WYWx1ZSA9IGV2ZW50LnJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBFbnN1cmUgdGhlIHByZXNlbmNlIG9mIGFuIGV2ZW50IGxpc3RlbmVyIHRoYXQgaGFuZGxlcyBtYW51YWxseS10cmlnZ2VyZWQKICAvLyBzeW50aGV0aWMgZXZlbnRzIGJ5IGludGVycnVwdGluZyBwcm9ncmVzcyB1bnRpbCByZWludm9rZWQgaW4gcmVzcG9uc2UgdG8KICAvLyAqbmF0aXZlKiBldmVudHMgdGhhdCBpdCBmaXJlcyBkaXJlY3RseSwgZW5zdXJpbmcgdGhhdCBzdGF0ZSBjaGFuZ2VzIGhhdmUKICAvLyBhbHJlYWR5IG9jY3VycmVkIGJlZm9yZSBvdGhlciBsaXN0ZW5lcnMgYXJlIGludm9rZWQuCiAgZnVuY3Rpb24gbGV2ZXJhZ2VOYXRpdmUoZWwsIHR5cGUsIGV4cGVjdFN5bmMpIHsKICAgIC8vIE1pc3NpbmcgZXhwZWN0U3luYyBpbmRpY2F0ZXMgYSB0cmlnZ2VyIGNhbGwsIHdoaWNoIG11c3QgZm9yY2Ugc2V0dXAgdGhyb3VnaCBqUXVlcnkuZXZlbnQuYWRkCiAgICBpZiAoIWV4cGVjdFN5bmMpIHsKICAgICAgaWYgKGRhdGFQcml2LmdldChlbCwgdHlwZSkgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGpRdWVyeS5ldmVudC5hZGQoZWwsIHR5cGUsIHJldHVyblRydWUpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBSZWdpc3RlciB0aGUgY29udHJvbGxlciBhcyBhIHNwZWNpYWwgdW5pdmVyc2FsIGhhbmRsZXIgZm9yIGFsbCBldmVudCBuYW1lc3BhY2VzCiAgICBkYXRhUHJpdi5zZXQoZWwsIHR5cGUsIGZhbHNlKTsKICAgIGpRdWVyeS5ldmVudC5hZGQoZWwsIHR5cGUsIHsKICAgICAgbmFtZXNwYWNlOiBmYWxzZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihldmVudCkgewogICAgICAgIHZhciBub3RBc3luYywKICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgIHNhdmVkID0gZGF0YVByaXYuZ2V0KHRoaXMsIHR5cGUpOwogICAgICAgIGlmIChldmVudC5pc1RyaWdnZXIgJiAxICYmIHRoaXNbdHlwZV0pIHsKICAgICAgICAgIC8vIEludGVycnVwdCBwcm9jZXNzaW5nIG9mIHRoZSBvdXRlciBzeW50aGV0aWMgLnRyaWdnZXIoKWVkIGV2ZW50CiAgICAgICAgICAvLyBTYXZlZCBkYXRhIHNob3VsZCBiZSBmYWxzZSBpbiBzdWNoIGNhc2VzLCBidXQgbWlnaHQgYmUgYSBsZWZ0b3ZlciBjYXB0dXJlIG9iamVjdAogICAgICAgICAgLy8gZnJvbSBhbiBhc3luYyBuYXRpdmUgaGFuZGxlciAoZ2gtNDM1MCkKICAgICAgICAgIGlmICghc2F2ZWQubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIFN0b3JlIGFyZ3VtZW50cyBmb3IgdXNlIHdoZW4gaGFuZGxpbmcgdGhlIGlubmVyIG5hdGl2ZSBldmVudAogICAgICAgICAgICAvLyBUaGVyZSB3aWxsIGFsd2F5cyBiZSBhdCBsZWFzdCBvbmUgYXJndW1lbnQgKGFuIGV2ZW50IG9iamVjdCksIHNvIHRoaXMgYXJyYXkKICAgICAgICAgICAgLy8gd2lsbCBub3QgYmUgY29uZnVzZWQgd2l0aCBhIGxlZnRvdmVyIGNhcHR1cmUgb2JqZWN0LgogICAgICAgICAgICBzYXZlZCA9IF9zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgICAgIGRhdGFQcml2LnNldCh0aGlzLCB0eXBlLCBzYXZlZCk7CgogICAgICAgICAgICAvLyBUcmlnZ2VyIHRoZSBuYXRpdmUgZXZlbnQgYW5kIGNhcHR1cmUgaXRzIHJlc3VsdAogICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PTkgLSAxMSsKICAgICAgICAgICAgLy8gZm9jdXMoKSBhbmQgYmx1cigpIGFyZSBhc3luY2hyb25vdXMKICAgICAgICAgICAgbm90QXN5bmMgPSBleHBlY3RTeW5jKHRoaXMsIHR5cGUpOwogICAgICAgICAgICB0aGlzW3R5cGVdKCk7CiAgICAgICAgICAgIHJlc3VsdCA9IGRhdGFQcml2LmdldCh0aGlzLCB0eXBlKTsKICAgICAgICAgICAgaWYgKHNhdmVkICE9PSByZXN1bHQgfHwgbm90QXN5bmMpIHsKICAgICAgICAgICAgICBkYXRhUHJpdi5zZXQodGhpcywgdHlwZSwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc3VsdCA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzYXZlZCAhPT0gcmVzdWx0KSB7CiAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSBvdXRlciBzeW50aGV0aWMgZXZlbnQKICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIHJldHVybiByZXN1bHQudmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYW4gaW5uZXIgc3ludGhldGljIGV2ZW50IGZvciBhbiBldmVudCB3aXRoIGEgYnViYmxpbmcgc3Vycm9nYXRlCiAgICAgICAgICAgIC8vIChmb2N1cyBvciBibHVyKSwgYXNzdW1lIHRoYXQgdGhlIHN1cnJvZ2F0ZSBhbHJlYWR5IHByb3BhZ2F0ZWQgZnJvbSB0cmlnZ2VyaW5nIHRoZQogICAgICAgICAgICAvLyBuYXRpdmUgZXZlbnQgYW5kIHByZXZlbnQgdGhhdCBmcm9tIGhhcHBlbmluZyBhZ2FpbiBoZXJlLgogICAgICAgICAgICAvLyBUaGlzIHRlY2huaWNhbGx5IGdldHMgdGhlIG9yZGVyaW5nIHdyb25nIHcuci50LiB0byBgLnRyaWdnZXIoKWAgKGluIHdoaWNoIHRoZQogICAgICAgICAgICAvLyBidWJibGluZyBzdXJyb2dhdGUgcHJvcGFnYXRlcyAqYWZ0ZXIqIHRoZSBub24tYnViYmxpbmcgYmFzZSksIGJ1dCB0aGF0IHNlZW1zCiAgICAgICAgICAgIC8vIGxlc3MgYmFkIHRoYW4gZHVwbGljYXRpb24uCiAgICAgICAgICB9IGVsc2UgaWYgKChqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCB7fSkuZGVsZWdhdGVUeXBlKSB7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBuYXRpdmUgZXZlbnQgdHJpZ2dlcmVkIGFib3ZlLCBldmVyeXRoaW5nIGlzIG5vdyBpbiBvcmRlcgogICAgICAgICAgLy8gRmlyZSBhbiBpbm5lciBzeW50aGV0aWMgZXZlbnQgd2l0aCB0aGUgb3JpZ2luYWwgYXJndW1lbnRzCiAgICAgICAgfSBlbHNlIGlmIChzYXZlZC5sZW5ndGgpIHsKICAgICAgICAgIC8vIC4uLmFuZCBjYXB0dXJlIHRoZSByZXN1bHQKICAgICAgICAgIGRhdGFQcml2LnNldCh0aGlzLCB0eXBlLCB7CiAgICAgICAgICAgIHZhbHVlOiBqUXVlcnkuZXZlbnQudHJpZ2dlcigKICAgICAgICAgICAgLy8gU3VwcG9ydDogSUUgPD05IC0gMTErCiAgICAgICAgICAgIC8vIEV4dGVuZCB3aXRoIHRoZSBwcm90b3R5cGUgdG8gcmVzZXQgdGhlIGFib3ZlIHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpCiAgICAgICAgICAgIGpRdWVyeS5leHRlbmQoc2F2ZWRbMF0sIGpRdWVyeS5FdmVudC5wcm90b3R5cGUpLCBzYXZlZC5zbGljZSgxKSwgdGhpcykKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIEFib3J0IGhhbmRsaW5nIG9mIHRoZSBuYXRpdmUgZXZlbnQKICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQogIGpRdWVyeS5yZW1vdmVFdmVudCA9IGZ1bmN0aW9uIChlbGVtLCB0eXBlLCBoYW5kbGUpIHsKICAgIC8vIFRoaXMgImlmIiBpcyBuZWVkZWQgZm9yIHBsYWluIG9iamVjdHMKICAgIGlmIChlbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsKICAgICAgZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZSk7CiAgICB9CiAgfTsKICBqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiAoc3JjLCBwcm9wcykgewogICAgLy8gQWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0IHRoZSAnbmV3JyBrZXl3b3JkCiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50KSkgewogICAgICByZXR1cm4gbmV3IGpRdWVyeS5FdmVudChzcmMsIHByb3BzKTsKICAgIH0KCiAgICAvLyBFdmVudCBvYmplY3QKICAgIGlmIChzcmMgJiYgc3JjLnR5cGUpIHsKICAgICAgdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOwogICAgICB0aGlzLnR5cGUgPSBzcmMudHlwZTsKCiAgICAgIC8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCiAgICAgIC8vIGJ5IGEgaGFuZGxlciBsb3dlciBkb3duIHRoZSB0cmVlOyByZWZsZWN0IHRoZSBjb3JyZWN0IHZhbHVlLgogICAgICB0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5kZWZhdWx0UHJldmVudGVkID09PSB1bmRlZmluZWQgJiYKICAgICAgLy8gU3VwcG9ydDogQW5kcm9pZCA8PTIuMyBvbmx5CiAgICAgIHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgPyByZXR1cm5UcnVlIDogcmV0dXJuRmFsc2U7CgogICAgICAvLyBDcmVhdGUgdGFyZ2V0IHByb3BlcnRpZXMKICAgICAgLy8gU3VwcG9ydDogU2FmYXJpIDw9NiAtIDcgb25seQogICAgICAvLyBUYXJnZXQgc2hvdWxkIG5vdCBiZSBhIHRleHQgbm9kZSAoIzUwNCwgIzEzMTQzKQogICAgICB0aGlzLnRhcmdldCA9IHNyYy50YXJnZXQgJiYgc3JjLnRhcmdldC5ub2RlVHlwZSA9PT0gMyA/IHNyYy50YXJnZXQucGFyZW50Tm9kZSA6IHNyYy50YXJnZXQ7CiAgICAgIHRoaXMuY3VycmVudFRhcmdldCA9IHNyYy5jdXJyZW50VGFyZ2V0OwogICAgICB0aGlzLnJlbGF0ZWRUYXJnZXQgPSBzcmMucmVsYXRlZFRhcmdldDsKCiAgICAgIC8vIEV2ZW50IHR5cGUKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudHlwZSA9IHNyYzsKICAgIH0KCiAgICAvLyBQdXQgZXhwbGljaXRseSBwcm92aWRlZCBwcm9wZXJ0aWVzIG9udG8gdGhlIGV2ZW50IG9iamVjdAogICAgaWYgKHByb3BzKSB7CiAgICAgIGpRdWVyeS5leHRlbmQodGhpcywgcHJvcHMpOwogICAgfQoKICAgIC8vIENyZWF0ZSBhIHRpbWVzdGFtcCBpZiBpbmNvbWluZyBldmVudCBkb2Vzbid0IGhhdmUgb25lCiAgICB0aGlzLnRpbWVTdGFtcCA9IHNyYyAmJiBzcmMudGltZVN0YW1wIHx8IERhdGUubm93KCk7CgogICAgLy8gTWFyayBpdCBhcyBmaXhlZAogICAgdGhpc1tqUXVlcnkuZXhwYW5kb10gPSB0cnVlOwogIH07CgogIC8vIGpRdWVyeS5FdmVudCBpcyBiYXNlZCBvbiBET00zIEV2ZW50cyBhcyBzcGVjaWZpZWQgYnkgdGhlIEVDTUFTY3JpcHQgTGFuZ3VhZ2UgQmluZGluZwogIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDAzL1dELURPTS1MZXZlbC0zLUV2ZW50cy0yMDAzMDMzMS9lY21hLXNjcmlwdC1iaW5kaW5nLmh0bWwKICBqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewogICAgY29uc3RydWN0b3I6IGpRdWVyeS5FdmVudCwKICAgIGlzRGVmYXVsdFByZXZlbnRlZDogcmV0dXJuRmFsc2UsCiAgICBpc1Byb3BhZ2F0aW9uU3RvcHBlZDogcmV0dXJuRmFsc2UsCiAgICBpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDogcmV0dXJuRmFsc2UsCiAgICBpc1NpbXVsYXRlZDogZmFsc2UsCiAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gcHJldmVudERlZmF1bHQoKSB7CiAgICAgIHZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwogICAgICB0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHJldHVyblRydWU7CiAgICAgIGlmIChlICYmICF0aGlzLmlzU2ltdWxhdGVkKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oKSB7CiAgICAgIHZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwogICAgICB0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKICAgICAgaWYgKGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQpIHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB9CiAgICB9LAogICAgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbiBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSB7CiAgICAgIHZhciBlID0gdGhpcy5vcmlnaW5hbEV2ZW50OwogICAgICB0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKICAgICAgaWYgKGUgJiYgIXRoaXMuaXNTaW11bGF0ZWQpIHsKICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICB9CiAgICAgIHRoaXMuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9CiAgfTsKCiAgLy8gSW5jbHVkZXMgYWxsIGNvbW1vbiBldmVudCBwcm9wcyBpbmNsdWRpbmcgS2V5RXZlbnQgYW5kIE1vdXNlRXZlbnQgc3BlY2lmaWMgcHJvcHMKICBqUXVlcnkuZWFjaCh7CiAgICBhbHRLZXk6IHRydWUsCiAgICBidWJibGVzOiB0cnVlLAogICAgY2FuY2VsYWJsZTogdHJ1ZSwKICAgIGNoYW5nZWRUb3VjaGVzOiB0cnVlLAogICAgY3RybEtleTogdHJ1ZSwKICAgIGRldGFpbDogdHJ1ZSwKICAgIGV2ZW50UGhhc2U6IHRydWUsCiAgICBtZXRhS2V5OiB0cnVlLAogICAgcGFnZVg6IHRydWUsCiAgICBwYWdlWTogdHJ1ZSwKICAgIHNoaWZ0S2V5OiB0cnVlLAogICAgdmlldzogdHJ1ZSwKICAgICJjaGFyIjogdHJ1ZSwKICAgIGNvZGU6IHRydWUsCiAgICBjaGFyQ29kZTogdHJ1ZSwKICAgIGtleTogdHJ1ZSwKICAgIGtleUNvZGU6IHRydWUsCiAgICBidXR0b246IHRydWUsCiAgICBidXR0b25zOiB0cnVlLAogICAgY2xpZW50WDogdHJ1ZSwKICAgIGNsaWVudFk6IHRydWUsCiAgICBvZmZzZXRYOiB0cnVlLAogICAgb2Zmc2V0WTogdHJ1ZSwKICAgIHBvaW50ZXJJZDogdHJ1ZSwKICAgIHBvaW50ZXJUeXBlOiB0cnVlLAogICAgc2NyZWVuWDogdHJ1ZSwKICAgIHNjcmVlblk6IHRydWUsCiAgICB0YXJnZXRUb3VjaGVzOiB0cnVlLAogICAgdG9FbGVtZW50OiB0cnVlLAogICAgdG91Y2hlczogdHJ1ZSwKICAgIHdoaWNoOiBmdW5jdGlvbiB3aGljaChldmVudCkgewogICAgICB2YXIgYnV0dG9uID0gZXZlbnQuYnV0dG9uOwoKICAgICAgLy8gQWRkIHdoaWNoIGZvciBrZXkgZXZlbnRzCiAgICAgIGlmIChldmVudC53aGljaCA9PSBudWxsICYmIHJrZXlFdmVudC50ZXN0KGV2ZW50LnR5cGUpKSB7CiAgICAgICAgcmV0dXJuIGV2ZW50LmNoYXJDb2RlICE9IG51bGwgPyBldmVudC5jaGFyQ29kZSA6IGV2ZW50LmtleUNvZGU7CiAgICAgIH0KCiAgICAgIC8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT09IGxlZnQ7IDIgPT09IG1pZGRsZTsgMyA9PT0gcmlnaHQKICAgICAgaWYgKCFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCAmJiBybW91c2VFdmVudC50ZXN0KGV2ZW50LnR5cGUpKSB7CiAgICAgICAgaWYgKGJ1dHRvbiAmIDEpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICBpZiAoYnV0dG9uICYgMikgewogICAgICAgICAgcmV0dXJuIDM7CiAgICAgICAgfQogICAgICAgIGlmIChidXR0b24gJiA0KSB7CiAgICAgICAgICByZXR1cm4gMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgcmV0dXJuIGV2ZW50LndoaWNoOwogICAgfQogIH0sIGpRdWVyeS5ldmVudC5hZGRQcm9wKTsKICBqUXVlcnkuZWFjaCh7CiAgICBmb2N1czogImZvY3VzaW4iLAogICAgYmx1cjogImZvY3Vzb3V0IgogIH0sIGZ1bmN0aW9uICh0eXBlLCBkZWxlZ2F0ZVR5cGUpIHsKICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsW3R5cGVdID0gewogICAgICAvLyBVdGlsaXplIG5hdGl2ZSBldmVudCBpZiBwb3NzaWJsZSBzbyBibHVyL2ZvY3VzIHNlcXVlbmNlIGlzIGNvcnJlY3QKICAgICAgc2V0dXA6IGZ1bmN0aW9uIHNldHVwKCkgewogICAgICAgIC8vIENsYWltIHRoZSBmaXJzdCBoYW5kbGVyCiAgICAgICAgLy8gZGF0YVByaXYuc2V0KCB0aGlzLCAiZm9jdXMiLCAuLi4gKQogICAgICAgIC8vIGRhdGFQcml2LnNldCggdGhpcywgImJsdXIiLCAuLi4gKQogICAgICAgIGxldmVyYWdlTmF0aXZlKHRoaXMsIHR5cGUsIGV4cGVjdFN5bmMpOwoKICAgICAgICAvLyBSZXR1cm4gZmFsc2UgdG8gYWxsb3cgbm9ybWFsIHByb2Nlc3NpbmcgaW4gdGhlIGNhbGxlcgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgICAgdHJpZ2dlcjogZnVuY3Rpb24gdHJpZ2dlcigpIHsKICAgICAgICAvLyBGb3JjZSBzZXR1cCBiZWZvcmUgdHJpZ2dlcgogICAgICAgIGxldmVyYWdlTmF0aXZlKHRoaXMsIHR5cGUpOwoKICAgICAgICAvLyBSZXR1cm4gbm9uLWZhbHNlIHRvIGFsbG93IG5vcm1hbCBldmVudC1wYXRoIHByb3BhZ2F0aW9uCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0sCiAgICAgIGRlbGVnYXRlVHlwZTogZGVsZWdhdGVUeXBlCiAgICB9OwogIH0pOwoKICAvLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKICAvLyBzbyB0aGF0IGV2ZW50IGRlbGVnYXRpb24gd29ya3MgaW4galF1ZXJ5LgogIC8vIERvIHRoZSBzYW1lIGZvciBwb2ludGVyZW50ZXIvcG9pbnRlcmxlYXZlIGFuZCBwb2ludGVyb3Zlci9wb2ludGVyb3V0CiAgLy8KICAvLyBTdXBwb3J0OiBTYWZhcmkgNyBvbmx5CiAgLy8gU2FmYXJpIHNlbmRzIG1vdXNlZW50ZXIgdG9vIG9mdGVuOyBzZWU6CiAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9NDcwMjU4CiAgLy8gZm9yIHRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgYnVnIChpdCBleGlzdGVkIGluIG9sZGVyIENocm9tZSB2ZXJzaW9ucyBhcyB3ZWxsKS4KICBqUXVlcnkuZWFjaCh7CiAgICBtb3VzZWVudGVyOiAibW91c2VvdmVyIiwKICAgIG1vdXNlbGVhdmU6ICJtb3VzZW91dCIsCiAgICBwb2ludGVyZW50ZXI6ICJwb2ludGVyb3ZlciIsCiAgICBwb2ludGVybGVhdmU6ICJwb2ludGVyb3V0IgogIH0sIGZ1bmN0aW9uIChvcmlnLCBmaXgpIHsKICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsW29yaWddID0gewogICAgICBkZWxlZ2F0ZVR5cGU6IGZpeCwKICAgICAgYmluZFR5cGU6IGZpeCwKICAgICAgaGFuZGxlOiBmdW5jdGlvbiBoYW5kbGUoZXZlbnQpIHsKICAgICAgICB2YXIgcmV0LAogICAgICAgICAgdGFyZ2V0ID0gdGhpcywKICAgICAgICAgIHJlbGF0ZWQgPSBldmVudC5yZWxhdGVkVGFyZ2V0LAogICAgICAgICAgaGFuZGxlT2JqID0gZXZlbnQuaGFuZGxlT2JqOwoKICAgICAgICAvLyBGb3IgbW91c2VlbnRlci9sZWF2ZSBjYWxsIHRoZSBoYW5kbGVyIGlmIHJlbGF0ZWQgaXMgb3V0c2lkZSB0aGUgdGFyZ2V0LgogICAgICAgIC8vIE5COiBObyByZWxhdGVkVGFyZ2V0IGlmIHRoZSBtb3VzZSBsZWZ0L2VudGVyZWQgdGhlIGJyb3dzZXIgd2luZG93CiAgICAgICAgaWYgKCFyZWxhdGVkIHx8IHJlbGF0ZWQgIT09IHRhcmdldCAmJiAhalF1ZXJ5LmNvbnRhaW5zKHRhcmdldCwgcmVsYXRlZCkpIHsKICAgICAgICAgIGV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CiAgICAgICAgICByZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgZXZlbnQudHlwZSA9IGZpeDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfQogICAgfTsKICB9KTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIG9uOiBmdW5jdGlvbiBvbih0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuKSB7CiAgICAgIHJldHVybiBfb24odGhpcywgdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbik7CiAgICB9LAogICAgb25lOiBmdW5jdGlvbiBvbmUodHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbikgewogICAgICByZXR1cm4gX29uKHRoaXMsIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4sIDEpOwogICAgfSwKICAgIG9mZjogZnVuY3Rpb24gb2ZmKHR5cGVzLCBzZWxlY3RvciwgZm4pIHsKICAgICAgdmFyIGhhbmRsZU9iaiwgdHlwZTsKICAgICAgaWYgKHR5cGVzICYmIHR5cGVzLnByZXZlbnREZWZhdWx0ICYmIHR5cGVzLmhhbmRsZU9iaikgewogICAgICAgIC8vICggZXZlbnQgKSAgZGlzcGF0Y2hlZCBqUXVlcnkuRXZlbnQKICAgICAgICBoYW5kbGVPYmogPSB0eXBlcy5oYW5kbGVPYmo7CiAgICAgICAgalF1ZXJ5KHR5cGVzLmRlbGVnYXRlVGFyZ2V0KS5vZmYoaGFuZGxlT2JqLm5hbWVzcGFjZSA/IGhhbmRsZU9iai5vcmlnVHlwZSArICIuIiArIGhhbmRsZU9iai5uYW1lc3BhY2UgOiBoYW5kbGVPYmoub3JpZ1R5cGUsIGhhbmRsZU9iai5zZWxlY3RvciwgaGFuZGxlT2JqLmhhbmRsZXIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIGlmIChfdHlwZW9mKHR5cGVzKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAvLyAoIHR5cGVzLW9iamVjdCBbLCBzZWxlY3Rvcl0gKQogICAgICAgIGZvciAodHlwZSBpbiB0eXBlcykgewogICAgICAgICAgdGhpcy5vZmYodHlwZSwgc2VsZWN0b3IsIHR5cGVzW3R5cGVdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgaWYgKHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAvLyAoIHR5cGVzIFssIGZuXSApCiAgICAgICAgZm4gPSBzZWxlY3RvcjsKICAgICAgICBzZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBpZiAoZm4gPT09IGZhbHNlKSB7CiAgICAgICAgZm4gPSByZXR1cm5GYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBqUXVlcnkuZXZlbnQucmVtb3ZlKHRoaXMsIHR5cGVzLCBmbiwgc2VsZWN0b3IpOwogICAgICB9KTsKICAgIH0KICB9KTsKICB2YXIKICAgIC8vIFN1cHBvcnQ6IElFIDw9MTAgLSAxMSwgRWRnZSAxMiAtIDEzIG9ubHkKICAgIC8vIEluIElFL0VkZ2UgdXNpbmcgcmVnZXggZ3JvdXBzIGhlcmUgY2F1c2VzIHNldmVyZSBzbG93ZG93bnMuCiAgICAvLyBTZWUgaHR0cHM6Ly9jb25uZWN0Lm1pY3Jvc29mdC5jb20vSUUvZmVlZGJhY2svZGV0YWlscy8xNzM2NTEyLwogICAgcm5vSW5uZXJodG1sID0gLzxzY3JpcHR8PHN0eWxlfDxsaW5rL2ksCiAgICAvLyBjaGVja2VkPSJjaGVja2VkIiBvciBjaGVja2VkCiAgICByY2hlY2tlZCA9IC9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLAogICAgcmNsZWFuU2NyaXB0ID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nOwoKICAvLyBQcmVmZXIgYSB0Ym9keSBvdmVyIGl0cyBwYXJlbnQgdGFibGUgZm9yIGNvbnRhaW5pbmcgbmV3IHJvd3MKICBmdW5jdGlvbiBtYW5pcHVsYXRpb25UYXJnZXQoZWxlbSwgY29udGVudCkgewogICAgaWYgKG5vZGVOYW1lKGVsZW0sICJ0YWJsZSIpICYmIG5vZGVOYW1lKGNvbnRlbnQubm9kZVR5cGUgIT09IDExID8gY29udGVudCA6IGNvbnRlbnQuZmlyc3RDaGlsZCwgInRyIikpIHsKICAgICAgcmV0dXJuIGpRdWVyeShlbGVtKS5jaGlsZHJlbigidGJvZHkiKVswXSB8fCBlbGVtOwogICAgfQogICAgcmV0dXJuIGVsZW07CiAgfQoKICAvLyBSZXBsYWNlL3Jlc3RvcmUgdGhlIHR5cGUgYXR0cmlidXRlIG9mIHNjcmlwdCBlbGVtZW50cyBmb3Igc2FmZSBET00gbWFuaXB1bGF0aW9uCiAgZnVuY3Rpb24gZGlzYWJsZVNjcmlwdChlbGVtKSB7CiAgICBlbGVtLnR5cGUgPSAoZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSAhPT0gbnVsbCkgKyAiLyIgKyBlbGVtLnR5cGU7CiAgICByZXR1cm4gZWxlbTsKICB9CiAgZnVuY3Rpb24gcmVzdG9yZVNjcmlwdChlbGVtKSB7CiAgICBpZiAoKGVsZW0udHlwZSB8fCAiIikuc2xpY2UoMCwgNSkgPT09ICJ0cnVlLyIpIHsKICAgICAgZWxlbS50eXBlID0gZWxlbS50eXBlLnNsaWNlKDUpOwogICAgfSBlbHNlIHsKICAgICAgZWxlbS5yZW1vdmVBdHRyaWJ1dGUoInR5cGUiKTsKICAgIH0KICAgIHJldHVybiBlbGVtOwogIH0KICBmdW5jdGlvbiBjbG9uZUNvcHlFdmVudChzcmMsIGRlc3QpIHsKICAgIHZhciBpLCBsLCB0eXBlLCBwZGF0YU9sZCwgdWRhdGFPbGQsIHVkYXRhQ3VyLCBldmVudHM7CiAgICBpZiAoZGVzdC5ub2RlVHlwZSAhPT0gMSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gMS4gQ29weSBwcml2YXRlIGRhdGE6IGV2ZW50cywgaGFuZGxlcnMsIGV0Yy4KICAgIGlmIChkYXRhUHJpdi5oYXNEYXRhKHNyYykpIHsKICAgICAgcGRhdGFPbGQgPSBkYXRhUHJpdi5nZXQoc3JjKTsKICAgICAgZXZlbnRzID0gcGRhdGFPbGQuZXZlbnRzOwogICAgICBpZiAoZXZlbnRzKSB7CiAgICAgICAgZGF0YVByaXYucmVtb3ZlKGRlc3QsICJoYW5kbGUgZXZlbnRzIik7CiAgICAgICAgZm9yICh0eXBlIGluIGV2ZW50cykgewogICAgICAgICAgZm9yIChpID0gMCwgbCA9IGV2ZW50c1t0eXBlXS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LmFkZChkZXN0LCB0eXBlLCBldmVudHNbdHlwZV1baV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIDIuIENvcHkgdXNlciBkYXRhCiAgICBpZiAoZGF0YVVzZXIuaGFzRGF0YShzcmMpKSB7CiAgICAgIHVkYXRhT2xkID0gZGF0YVVzZXIuYWNjZXNzKHNyYyk7CiAgICAgIHVkYXRhQ3VyID0galF1ZXJ5LmV4dGVuZCh7fSwgdWRhdGFPbGQpOwogICAgICBkYXRhVXNlci5zZXQoZGVzdCwgdWRhdGFDdXIpOwogICAgfQogIH0KCiAgLy8gRml4IElFIGJ1Z3MsIHNlZSBzdXBwb3J0IHRlc3RzCiAgZnVuY3Rpb24gZml4SW5wdXQoc3JjLCBkZXN0KSB7CiAgICB2YXIgbm9kZU5hbWUgPSBkZXN0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgogICAgLy8gRmFpbHMgdG8gcGVyc2lzdCB0aGUgY2hlY2tlZCBzdGF0ZSBvZiBhIGNsb25lZCBjaGVja2JveCBvciByYWRpbyBidXR0b24uCiAgICBpZiAobm9kZU5hbWUgPT09ICJpbnB1dCIgJiYgcmNoZWNrYWJsZVR5cGUudGVzdChzcmMudHlwZSkpIHsKICAgICAgZGVzdC5jaGVja2VkID0gc3JjLmNoZWNrZWQ7CgogICAgICAvLyBGYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZCBzdGF0ZSB3aGVuIGNsb25pbmcgb3B0aW9ucwogICAgfSBlbHNlIGlmIChub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIikgewogICAgICBkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGRvbU1hbmlwKGNvbGxlY3Rpb24sIGFyZ3MsIGNhbGxiYWNrLCBpZ25vcmVkKSB7CiAgICAvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCiAgICBhcmdzID0gZmxhdChhcmdzKTsKICAgIHZhciBmcmFnbWVudCwKICAgICAgZmlyc3QsCiAgICAgIHNjcmlwdHMsCiAgICAgIGhhc1NjcmlwdHMsCiAgICAgIG5vZGUsCiAgICAgIGRvYywKICAgICAgaSA9IDAsCiAgICAgIGwgPSBjb2xsZWN0aW9uLmxlbmd0aCwKICAgICAgaU5vQ2xvbmUgPSBsIC0gMSwKICAgICAgdmFsdWUgPSBhcmdzWzBdLAogICAgICB2YWx1ZUlzRnVuY3Rpb24gPSBpc0Z1bmN0aW9uKHZhbHVlKTsKCiAgICAvLyBXZSBjYW4ndCBjbG9uZU5vZGUgZnJhZ21lbnRzIHRoYXQgY29udGFpbiBjaGVja2VkLCBpbiBXZWJLaXQKICAgIGlmICh2YWx1ZUlzRnVuY3Rpb24gfHwgbCA+IDEgJiYgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiAhc3VwcG9ydC5jaGVja0Nsb25lICYmIHJjaGVja2VkLnRlc3QodmFsdWUpKSB7CiAgICAgIHJldHVybiBjb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgdmFyIHNlbGYgPSBjb2xsZWN0aW9uLmVxKGluZGV4KTsKICAgICAgICBpZiAodmFsdWVJc0Z1bmN0aW9uKSB7CiAgICAgICAgICBhcmdzWzBdID0gdmFsdWUuY2FsbCh0aGlzLCBpbmRleCwgc2VsZi5odG1sKCkpOwogICAgICAgIH0KICAgICAgICBkb21NYW5pcChzZWxmLCBhcmdzLCBjYWxsYmFjaywgaWdub3JlZCk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKGwpIHsKICAgICAgZnJhZ21lbnQgPSBidWlsZEZyYWdtZW50KGFyZ3MsIGNvbGxlY3Rpb25bMF0ub3duZXJEb2N1bWVudCwgZmFsc2UsIGNvbGxlY3Rpb24sIGlnbm9yZWQpOwogICAgICBmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CiAgICAgIGlmIChmcmFnbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIGZyYWdtZW50ID0gZmlyc3Q7CiAgICAgIH0KCiAgICAgIC8vIFJlcXVpcmUgZWl0aGVyIG5ldyBjb250ZW50IG9yIGFuIGludGVyZXN0IGluIGlnbm9yZWQgZWxlbWVudHMgdG8gaW52b2tlIHRoZSBjYWxsYmFjawogICAgICBpZiAoZmlyc3QgfHwgaWdub3JlZCkgewogICAgICAgIHNjcmlwdHMgPSBqUXVlcnkubWFwKGdldEFsbChmcmFnbWVudCwgInNjcmlwdCIpLCBkaXNhYmxlU2NyaXB0KTsKICAgICAgICBoYXNTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGg7CgogICAgICAgIC8vIFVzZSB0aGUgb3JpZ2luYWwgZnJhZ21lbnQgZm9yIHRoZSBsYXN0IGl0ZW0KICAgICAgICAvLyBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXAKICAgICAgICAvLyBiZWluZyBlbXB0aWVkIGluY29ycmVjdGx5IGluIGNlcnRhaW4gc2l0dWF0aW9ucyAoIzgwNzApLgogICAgICAgIGZvciAoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBub2RlID0gZnJhZ21lbnQ7CiAgICAgICAgICBpZiAoaSAhPT0gaU5vQ2xvbmUpIHsKICAgICAgICAgICAgbm9kZSA9IGpRdWVyeS5jbG9uZShub2RlLCB0cnVlLCB0cnVlKTsKCiAgICAgICAgICAgIC8vIEtlZXAgcmVmZXJlbmNlcyB0byBjbG9uZWQgc2NyaXB0cyBmb3IgbGF0ZXIgcmVzdG9yYXRpb24KICAgICAgICAgICAgaWYgKGhhc1NjcmlwdHMpIHsKICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDw9NC4wIG9ubHksIFBoYW50b21KUyAxIG9ubHkKICAgICAgICAgICAgICAvLyBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzIG9uIGFuY2llbnQgV2ViS2l0CiAgICAgICAgICAgICAgalF1ZXJ5Lm1lcmdlKHNjcmlwdHMsIGdldEFsbChub2RlLCAic2NyaXB0IikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjYWxsYmFjay5jYWxsKGNvbGxlY3Rpb25baV0sIG5vZGUsIGkpOwogICAgICAgIH0KICAgICAgICBpZiAoaGFzU2NyaXB0cykgewogICAgICAgICAgZG9jID0gc2NyaXB0c1tzY3JpcHRzLmxlbmd0aCAtIDFdLm93bmVyRG9jdW1lbnQ7CgogICAgICAgICAgLy8gUmVlbmFibGUgc2NyaXB0cwogICAgICAgICAgalF1ZXJ5Lm1hcChzY3JpcHRzLCByZXN0b3JlU2NyaXB0KTsKCiAgICAgICAgICAvLyBFdmFsdWF0ZSBleGVjdXRhYmxlIHNjcmlwdHMgb24gZmlyc3QgZG9jdW1lbnQgaW5zZXJ0aW9uCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaGFzU2NyaXB0czsgaSsrKSB7CiAgICAgICAgICAgIG5vZGUgPSBzY3JpcHRzW2ldOwogICAgICAgICAgICBpZiAocnNjcmlwdFR5cGUudGVzdChub2RlLnR5cGUgfHwgIiIpICYmICFkYXRhUHJpdi5hY2Nlc3Mobm9kZSwgImdsb2JhbEV2YWwiKSAmJiBqUXVlcnkuY29udGFpbnMoZG9jLCBub2RlKSkgewogICAgICAgICAgICAgIGlmIChub2RlLnNyYyAmJiAobm9kZS50eXBlIHx8ICIiKS50b0xvd2VyQ2FzZSgpICE9PSAibW9kdWxlIikgewogICAgICAgICAgICAgICAgLy8gT3B0aW9uYWwgQUpBWCBkZXBlbmRlbmN5LCBidXQgd29uJ3QgcnVuIHNjcmlwdHMgaWYgbm90IHByZXNlbnQKICAgICAgICAgICAgICAgIGlmIChqUXVlcnkuX2V2YWxVcmwgJiYgIW5vZGUubm9Nb2R1bGUpIHsKICAgICAgICAgICAgICAgICAgalF1ZXJ5Ll9ldmFsVXJsKG5vZGUuc3JjLCB7CiAgICAgICAgICAgICAgICAgICAgbm9uY2U6IG5vZGUubm9uY2UgfHwgbm9kZS5nZXRBdHRyaWJ1dGUoIm5vbmNlIikKICAgICAgICAgICAgICAgICAgfSwgZG9jKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgRE9NRXZhbChub2RlLnRleHRDb250ZW50LnJlcGxhY2UocmNsZWFuU2NyaXB0LCAiIiksIG5vZGUsIGRvYyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gY29sbGVjdGlvbjsKICB9CiAgZnVuY3Rpb24gX3JlbW92ZShlbGVtLCBzZWxlY3Rvciwga2VlcERhdGEpIHsKICAgIHZhciBub2RlLAogICAgICBub2RlcyA9IHNlbGVjdG9yID8galF1ZXJ5LmZpbHRlcihzZWxlY3RvciwgZWxlbSkgOiBlbGVtLAogICAgICBpID0gMDsKICAgIGZvciAoOyAobm9kZSA9IG5vZGVzW2ldKSAhPSBudWxsOyBpKyspIHsKICAgICAgaWYgKCFrZWVwRGF0YSAmJiBub2RlLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgalF1ZXJ5LmNsZWFuRGF0YShnZXRBbGwobm9kZSkpOwogICAgICB9CiAgICAgIGlmIChub2RlLnBhcmVudE5vZGUpIHsKICAgICAgICBpZiAoa2VlcERhdGEgJiYgaXNBdHRhY2hlZChub2RlKSkgewogICAgICAgICAgc2V0R2xvYmFsRXZhbChnZXRBbGwobm9kZSwgInNjcmlwdCIpKTsKICAgICAgICB9CiAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZWxlbTsKICB9CiAgalF1ZXJ5LmV4dGVuZCh7CiAgICBodG1sUHJlZmlsdGVyOiBmdW5jdGlvbiBodG1sUHJlZmlsdGVyKGh0bWwpIHsKICAgICAgcmV0dXJuIGh0bWw7CiAgICB9LAogICAgY2xvbmU6IGZ1bmN0aW9uIGNsb25lKGVsZW0sIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzKSB7CiAgICAgIHZhciBpLAogICAgICAgIGwsCiAgICAgICAgc3JjRWxlbWVudHMsCiAgICAgICAgZGVzdEVsZW1lbnRzLAogICAgICAgIGNsb25lID0gZWxlbS5jbG9uZU5vZGUodHJ1ZSksCiAgICAgICAgaW5QYWdlID0gaXNBdHRhY2hlZChlbGVtKTsKCiAgICAgIC8vIEZpeCBJRSBjbG9uaW5nIGlzc3VlcwogICAgICBpZiAoIXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgJiYgKGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgZWxlbS5ub2RlVHlwZSA9PT0gMTEpICYmICFqUXVlcnkuaXNYTUxEb2MoZWxlbSkpIHsKICAgICAgICAvLyBXZSBlc2NoZXcgU2l6emxlIGhlcmUgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnM6IGh0dHBzOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKICAgICAgICBkZXN0RWxlbWVudHMgPSBnZXRBbGwoY2xvbmUpOwogICAgICAgIHNyY0VsZW1lbnRzID0gZ2V0QWxsKGVsZW0pOwogICAgICAgIGZvciAoaSA9IDAsIGwgPSBzcmNFbGVtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGZpeElucHV0KHNyY0VsZW1lbnRzW2ldLCBkZXN0RWxlbWVudHNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gQ29weSB0aGUgZXZlbnRzIGZyb20gdGhlIG9yaWdpbmFsIHRvIHRoZSBjbG9uZQogICAgICBpZiAoZGF0YUFuZEV2ZW50cykgewogICAgICAgIGlmIChkZWVwRGF0YUFuZEV2ZW50cykgewogICAgICAgICAgc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoZWxlbSk7CiAgICAgICAgICBkZXN0RWxlbWVudHMgPSBkZXN0RWxlbWVudHMgfHwgZ2V0QWxsKGNsb25lKTsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBzcmNFbGVtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgY2xvbmVDb3B5RXZlbnQoc3JjRWxlbWVudHNbaV0sIGRlc3RFbGVtZW50c1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNsb25lQ29weUV2ZW50KGVsZW0sIGNsb25lKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIFByZXNlcnZlIHNjcmlwdCBldmFsdWF0aW9uIGhpc3RvcnkKICAgICAgZGVzdEVsZW1lbnRzID0gZ2V0QWxsKGNsb25lLCAic2NyaXB0Iik7CiAgICAgIGlmIChkZXN0RWxlbWVudHMubGVuZ3RoID4gMCkgewogICAgICAgIHNldEdsb2JhbEV2YWwoZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbChlbGVtLCAic2NyaXB0IikpOwogICAgICB9CgogICAgICAvLyBSZXR1cm4gdGhlIGNsb25lZCBzZXQKICAgICAgcmV0dXJuIGNsb25lOwogICAgfSwKICAgIGNsZWFuRGF0YTogZnVuY3Rpb24gY2xlYW5EYXRhKGVsZW1zKSB7CiAgICAgIHZhciBkYXRhLAogICAgICAgIGVsZW0sCiAgICAgICAgdHlwZSwKICAgICAgICBzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWwsCiAgICAgICAgaSA9IDA7CiAgICAgIGZvciAoOyAoZWxlbSA9IGVsZW1zW2ldKSAhPT0gdW5kZWZpbmVkOyBpKyspIHsKICAgICAgICBpZiAoYWNjZXB0RGF0YShlbGVtKSkgewogICAgICAgICAgaWYgKGRhdGEgPSBlbGVtW2RhdGFQcml2LmV4cGFuZG9dKSB7CiAgICAgICAgICAgIGlmIChkYXRhLmV2ZW50cykgewogICAgICAgICAgICAgIGZvciAodHlwZSBpbiBkYXRhLmV2ZW50cykgewogICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxbdHlwZV0pIHsKICAgICAgICAgICAgICAgICAgalF1ZXJ5LmV2ZW50LnJlbW92ZShlbGVtLCB0eXBlKTsKCiAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBzaG9ydGN1dCB0byBhdm9pZCBqUXVlcnkuZXZlbnQucmVtb3ZlJ3Mgb3ZlcmhlYWQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVFdmVudChlbGVtLCB0eXBlLCBkYXRhLmhhbmRsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTdXBwb3J0OiBDaHJvbWUgPD0zNSAtIDQ1KwogICAgICAgICAgICAvLyBBc3NpZ24gdW5kZWZpbmVkIGluc3RlYWQgb2YgdXNpbmcgZGVsZXRlLCBzZWUgRGF0YSNyZW1vdmUKICAgICAgICAgICAgZWxlbVtkYXRhUHJpdi5leHBhbmRvXSA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChlbGVtW2RhdGFVc2VyLmV4cGFuZG9dKSB7CiAgICAgICAgICAgIC8vIFN1cHBvcnQ6IENocm9tZSA8PTM1IC0gNDUrCiAgICAgICAgICAgIC8vIEFzc2lnbiB1bmRlZmluZWQgaW5zdGVhZCBvZiB1c2luZyBkZWxldGUsIHNlZSBEYXRhI3JlbW92ZQogICAgICAgICAgICBlbGVtW2RhdGFVc2VyLmV4cGFuZG9dID0gdW5kZWZpbmVkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwogIGpRdWVyeS5mbi5leHRlbmQoewogICAgZGV0YWNoOiBmdW5jdGlvbiBkZXRhY2goc2VsZWN0b3IpIHsKICAgICAgcmV0dXJuIF9yZW1vdmUodGhpcywgc2VsZWN0b3IsIHRydWUpOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiBfcmVtb3ZlKHRoaXMsIHNlbGVjdG9yKTsKICAgIH0sCiAgICB0ZXh0OiBmdW5jdGlvbiB0ZXh0KHZhbHVlKSB7CiAgICAgIHJldHVybiBhY2Nlc3ModGhpcywgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyBqUXVlcnkudGV4dCh0aGlzKSA6IHRoaXMuZW1wdHkoKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkpIHsKICAgICAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCk7CiAgICB9LAogICAgYXBwZW5kOiBmdW5jdGlvbiBhcHBlbmQoKSB7CiAgICAgIHJldHVybiBkb21NYW5pcCh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgaWYgKHRoaXMubm9kZVR5cGUgPT09IDEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gMTEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gOSkgewogICAgICAgICAgdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCh0aGlzLCBlbGVtKTsKICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChlbGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHByZXBlbmQ6IGZ1bmN0aW9uIHByZXBlbmQoKSB7CiAgICAgIHJldHVybiBkb21NYW5pcCh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgaWYgKHRoaXMubm9kZVR5cGUgPT09IDEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gMTEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gOSkgewogICAgICAgICAgdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCh0aGlzLCBlbGVtKTsKICAgICAgICAgIHRhcmdldC5pbnNlcnRCZWZvcmUoZWxlbSwgdGFyZ2V0LmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYmVmb3JlOiBmdW5jdGlvbiBiZWZvcmUoKSB7CiAgICAgIHJldHVybiBkb21NYW5pcCh0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSkgewogICAgICAgICAgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtLCB0aGlzKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGFmdGVyOiBmdW5jdGlvbiBhZnRlcigpIHsKICAgICAgcmV0dXJuIGRvbU1hbmlwKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICBpZiAodGhpcy5wYXJlbnROb2RlKSB7CiAgICAgICAgICB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW0sIHRoaXMubmV4dFNpYmxpbmcpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZW1wdHk6IGZ1bmN0aW9uIGVtcHR5KCkgewogICAgICB2YXIgZWxlbSwKICAgICAgICBpID0gMDsKICAgICAgZm9yICg7IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrKSB7CiAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICAgIC8vIFByZXZlbnQgbWVtb3J5IGxlYWtzCiAgICAgICAgICBqUXVlcnkuY2xlYW5EYXRhKGdldEFsbChlbGVtLCBmYWxzZSkpOwoKICAgICAgICAgIC8vIFJlbW92ZSBhbnkgcmVtYWluaW5nIG5vZGVzCiAgICAgICAgICBlbGVtLnRleHRDb250ZW50ID0gIiI7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZShkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cykgewogICAgICBkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwogICAgICBkZWVwRGF0YUFuZEV2ZW50cyA9IGRlZXBEYXRhQW5kRXZlbnRzID09IG51bGwgPyBkYXRhQW5kRXZlbnRzIDogZGVlcERhdGFBbmRFdmVudHM7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGpRdWVyeS5jbG9uZSh0aGlzLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyk7CiAgICAgIH0pOwogICAgfSwKICAgIGh0bWw6IGZ1bmN0aW9uIGh0bWwodmFsdWUpIHsKICAgICAgcmV0dXJuIGFjY2Vzcyh0aGlzLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB2YXIgZWxlbSA9IHRoaXNbMF0gfHwge30sCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGwgPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiBlbGVtLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICByZXR1cm4gZWxlbS5pbm5lckhUTUw7CiAgICAgICAgfQoKICAgICAgICAvLyBTZWUgaWYgd2UgY2FuIHRha2UgYSBzaG9ydGN1dCBhbmQganVzdCB1c2UgaW5uZXJIVE1MCiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgIXJub0lubmVyaHRtbC50ZXN0KHZhbHVlKSAmJiAhd3JhcE1hcFsocnRhZ05hbWUuZXhlYyh2YWx1ZSkgfHwgWyIiLCAiIl0pWzFdLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICB2YWx1ZSA9IGpRdWVyeS5odG1sUHJlZmlsdGVyKHZhbHVlKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgZWxlbSA9IHRoaXNbaV0gfHwge307CgogICAgICAgICAgICAgIC8vIFJlbW92ZSBlbGVtZW50IG5vZGVzIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrcwogICAgICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBqUXVlcnkuY2xlYW5EYXRhKGdldEFsbChlbGVtLCBmYWxzZSkpOwogICAgICAgICAgICAgICAgZWxlbS5pbm5lckhUTUwgPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxlbSA9IDA7CgogICAgICAgICAgICAvLyBJZiB1c2luZyBpbm5lckhUTUwgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgdXNlIHRoZSBmYWxsYmFjayBtZXRob2QKICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQogICAgICAgIGlmIChlbGVtKSB7CiAgICAgICAgICB0aGlzLmVtcHR5KCkuYXBwZW5kKHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0sCiAgICByZXBsYWNlV2l0aDogZnVuY3Rpb24gcmVwbGFjZVdpdGgoKSB7CiAgICAgIHZhciBpZ25vcmVkID0gW107CgogICAgICAvLyBNYWtlIHRoZSBjaGFuZ2VzLCByZXBsYWNpbmcgZWFjaCBub24taWdub3JlZCBjb250ZXh0IGVsZW1lbnQgd2l0aCB0aGUgbmV3IGNvbnRlbnQKICAgICAgcmV0dXJuIGRvbU1hbmlwKHRoaXMsIGFyZ3VtZW50cywgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlOwogICAgICAgIGlmIChqUXVlcnkuaW5BcnJheSh0aGlzLCBpZ25vcmVkKSA8IDApIHsKICAgICAgICAgIGpRdWVyeS5jbGVhbkRhdGEoZ2V0QWxsKHRoaXMpKTsKICAgICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZChlbGVtLCB0aGlzKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZvcmNlIGNhbGxiYWNrIGludm9jYXRpb24KICAgICAgfSwgaWdub3JlZCk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmVhY2goewogICAgYXBwZW5kVG86ICJhcHBlbmQiLAogICAgcHJlcGVuZFRvOiAicHJlcGVuZCIsCiAgICBpbnNlcnRCZWZvcmU6ICJiZWZvcmUiLAogICAgaW5zZXJ0QWZ0ZXI6ICJhZnRlciIsCiAgICByZXBsYWNlQWxsOiAicmVwbGFjZVdpdGgiCiAgfSwgZnVuY3Rpb24gKG5hbWUsIG9yaWdpbmFsKSB7CiAgICBqUXVlcnkuZm5bbmFtZV0gPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHsKICAgICAgdmFyIGVsZW1zLAogICAgICAgIHJldCA9IFtdLAogICAgICAgIGluc2VydCA9IGpRdWVyeShzZWxlY3RvciksCiAgICAgICAgbGFzdCA9IGluc2VydC5sZW5ndGggLSAxLAogICAgICAgIGkgPSAwOwogICAgICBmb3IgKDsgaSA8PSBsYXN0OyBpKyspIHsKICAgICAgICBlbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSh0cnVlKTsKICAgICAgICBqUXVlcnkoaW5zZXJ0W2ldKVtvcmlnaW5hbF0oZWxlbXMpOwoKICAgICAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDw9NC4wIG9ubHksIFBoYW50b21KUyAxIG9ubHkKICAgICAgICAvLyAuZ2V0KCkgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzIG9uIGFuY2llbnQgV2ViS2l0CiAgICAgICAgcHVzaC5hcHBseShyZXQsIGVsZW1zLmdldCgpKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wdXNoU3RhY2socmV0KTsKICAgIH07CiAgfSk7CiAgdmFyIHJudW1ub25weCA9IG5ldyBSZWdFeHAoIl4oIiArIHBudW0gKyAiKSg/IXB4KVthLXolXSskIiwgImkiKTsKICB2YXIgZ2V0U3R5bGVzID0gZnVuY3Rpb24gZ2V0U3R5bGVzKGVsZW0pIHsKICAgIC8vIFN1cHBvcnQ6IElFIDw9MTEgb25seSwgRmlyZWZveCA8PTMwICgjMTUwOTgsICMxNDE1MCkKICAgIC8vIElFIHRocm93cyBvbiBlbGVtZW50cyBjcmVhdGVkIGluIHBvcHVwcwogICAgLy8gRkYgbWVhbndoaWxlIHRocm93cyBvbiBmcmFtZSBlbGVtZW50cyB0aHJvdWdoICJkZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlIgogICAgdmFyIHZpZXcgPSBlbGVtLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7CiAgICBpZiAoIXZpZXcgfHwgIXZpZXcub3BlbmVyKSB7CiAgICAgIHZpZXcgPSB3aW5kb3c7CiAgICB9CiAgICByZXR1cm4gdmlldy5nZXRDb21wdXRlZFN0eWxlKGVsZW0pOwogIH07CiAgdmFyIHN3YXAgPSBmdW5jdGlvbiBzd2FwKGVsZW0sIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICB2YXIgcmV0LAogICAgICBuYW1lLAogICAgICBvbGQgPSB7fTsKCiAgICAvLyBSZW1lbWJlciB0aGUgb2xkIHZhbHVlcywgYW5kIGluc2VydCB0aGUgbmV3IG9uZXMKICAgIGZvciAobmFtZSBpbiBvcHRpb25zKSB7CiAgICAgIG9sZFtuYW1lXSA9IGVsZW0uc3R5bGVbbmFtZV07CiAgICAgIGVsZW0uc3R5bGVbbmFtZV0gPSBvcHRpb25zW25hbWVdOwogICAgfQogICAgcmV0ID0gY2FsbGJhY2suY2FsbChlbGVtKTsKCiAgICAvLyBSZXZlcnQgdGhlIG9sZCB2YWx1ZXMKICAgIGZvciAobmFtZSBpbiBvcHRpb25zKSB7CiAgICAgIGVsZW0uc3R5bGVbbmFtZV0gPSBvbGRbbmFtZV07CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH07CiAgdmFyIHJib3hTdHlsZSA9IG5ldyBSZWdFeHAoY3NzRXhwYW5kLmpvaW4oInwiKSwgImkiKTsKICAoZnVuY3Rpb24gKCkgewogICAgLy8gRXhlY3V0aW5nIGJvdGggcGl4ZWxQb3NpdGlvbiAmIGJveFNpemluZ1JlbGlhYmxlIHRlc3RzIHJlcXVpcmUgb25seSBvbmUgbGF5b3V0CiAgICAvLyBzbyB0aGV5J3JlIGV4ZWN1dGVkIGF0IHRoZSBzYW1lIHRpbWUgdG8gc2F2ZSB0aGUgc2Vjb25kIGNvbXB1dGF0aW9uLgogICAgZnVuY3Rpb24gY29tcHV0ZVN0eWxlVGVzdHMoKSB7CiAgICAgIC8vIFRoaXMgaXMgYSBzaW5nbGV0b24sIHdlIG5lZWQgdG8gZXhlY3V0ZSBpdCBvbmx5IG9uY2UKICAgICAgaWYgKCFkaXYpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246YWJzb2x1dGU7bGVmdDotMTExMTFweDt3aWR0aDo2MHB4OyIgKyAibWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIjsKICAgICAgZGl2LnN0eWxlLmNzc1RleHQgPSAicG9zaXRpb246cmVsYXRpdmU7ZGlzcGxheTpibG9jaztib3gtc2l6aW5nOmJvcmRlci1ib3g7b3ZlcmZsb3c6c2Nyb2xsOyIgKyAibWFyZ2luOmF1dG87Ym9yZGVyOjFweDtwYWRkaW5nOjFweDsiICsgIndpZHRoOjYwJTt0b3A6MSUiOwogICAgICBkb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoY29udGFpbmVyKS5hcHBlbmRDaGlsZChkaXYpOwogICAgICB2YXIgZGl2U3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShkaXYpOwogICAgICBwaXhlbFBvc2l0aW9uVmFsID0gZGl2U3R5bGUudG9wICE9PSAiMSUiOwoKICAgICAgLy8gU3VwcG9ydDogQW5kcm9pZCA0LjAgLSA0LjMgb25seSwgRmlyZWZveCA8PTMgLSA0NAogICAgICByZWxpYWJsZU1hcmdpbkxlZnRWYWwgPSByb3VuZFBpeGVsTWVhc3VyZXMoZGl2U3R5bGUubWFyZ2luTGVmdCkgPT09IDEyOwoKICAgICAgLy8gU3VwcG9ydDogQW5kcm9pZCA0LjAgLSA0LjMgb25seSwgU2FmYXJpIDw9OS4xIC0gMTAuMSwgaU9TIDw9Ny4wIC0gOS4zCiAgICAgIC8vIFNvbWUgc3R5bGVzIGNvbWUgYmFjayB3aXRoIHBlcmNlbnRhZ2UgdmFsdWVzLCBldmVuIHRob3VnaCB0aGV5IHNob3VsZG4ndAogICAgICBkaXYuc3R5bGUucmlnaHQgPSAiNjAlIjsKICAgICAgcGl4ZWxCb3hTdHlsZXNWYWwgPSByb3VuZFBpeGVsTWVhc3VyZXMoZGl2U3R5bGUucmlnaHQpID09PSAzNjsKCiAgICAgIC8vIFN1cHBvcnQ6IElFIDkgLSAxMSBvbmx5CiAgICAgIC8vIERldGVjdCBtaXNyZXBvcnRpbmcgb2YgY29udGVudCBkaW1lbnNpb25zIGZvciBib3gtc2l6aW5nOmJvcmRlci1ib3ggZWxlbWVudHMKICAgICAgYm94U2l6aW5nUmVsaWFibGVWYWwgPSByb3VuZFBpeGVsTWVhc3VyZXMoZGl2U3R5bGUud2lkdGgpID09PSAzNjsKCiAgICAgIC8vIFN1cHBvcnQ6IElFIDkgb25seQogICAgICAvLyBEZXRlY3Qgb3ZlcmZsb3c6c2Nyb2xsIHNjcmV3aW5lc3MgKGdoLTM2OTkpCiAgICAgIC8vIFN1cHBvcnQ6IENocm9tZSA8PTY0CiAgICAgIC8vIERvbid0IGdldCB0cmlja2VkIHdoZW4gem9vbSBhZmZlY3RzIG9mZnNldFdpZHRoIChnaC00MDI5KQogICAgICBkaXYuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICBzY3JvbGxib3hTaXplVmFsID0gcm91bmRQaXhlbE1lYXN1cmVzKGRpdi5vZmZzZXRXaWR0aCAvIDMpID09PSAxMjsKICAgICAgZG9jdW1lbnRFbGVtZW50LnJlbW92ZUNoaWxkKGNvbnRhaW5lcik7CgogICAgICAvLyBOdWxsaWZ5IHRoZSBkaXYgc28gaXQgd291bGRuJ3QgYmUgc3RvcmVkIGluIHRoZSBtZW1vcnkgYW5kCiAgICAgIC8vIGl0IHdpbGwgYWxzbyBiZSBhIHNpZ24gdGhhdCBjaGVja3MgYWxyZWFkeSBwZXJmb3JtZWQKICAgICAgZGl2ID0gbnVsbDsKICAgIH0KICAgIGZ1bmN0aW9uIHJvdW5kUGl4ZWxNZWFzdXJlcyhtZWFzdXJlKSB7CiAgICAgIHJldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQobWVhc3VyZSkpOwogICAgfQogICAgdmFyIHBpeGVsUG9zaXRpb25WYWwsCiAgICAgIGJveFNpemluZ1JlbGlhYmxlVmFsLAogICAgICBzY3JvbGxib3hTaXplVmFsLAogICAgICBwaXhlbEJveFN0eWxlc1ZhbCwKICAgICAgcmVsaWFibGVUckRpbWVuc2lvbnNWYWwsCiAgICAgIHJlbGlhYmxlTWFyZ2luTGVmdFZhbCwKICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksCiAgICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKICAgIC8vIEZpbmlzaCBlYXJseSBpbiBsaW1pdGVkIChub24tYnJvd3NlcikgZW52aXJvbm1lbnRzCiAgICBpZiAoIWRpdi5zdHlsZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gU3VwcG9ydDogSUUgPD05IC0gMTEgb25seQogICAgLy8gU3R5bGUgb2YgY2xvbmVkIGVsZW1lbnQgYWZmZWN0cyBzb3VyY2UgZWxlbWVudCBjbG9uZWQgKCM4OTA4KQogICAgZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID0gImNvbnRlbnQtYm94IjsKICAgIGRpdi5jbG9uZU5vZGUodHJ1ZSkuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiIjsKICAgIHN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlID0gZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID09PSAiY29udGVudC1ib3giOwogICAgalF1ZXJ5LmV4dGVuZChzdXBwb3J0LCB7CiAgICAgIGJveFNpemluZ1JlbGlhYmxlOiBmdW5jdGlvbiBib3hTaXppbmdSZWxpYWJsZSgpIHsKICAgICAgICBjb21wdXRlU3R5bGVUZXN0cygpOwogICAgICAgIHJldHVybiBib3hTaXppbmdSZWxpYWJsZVZhbDsKICAgICAgfSwKICAgICAgcGl4ZWxCb3hTdHlsZXM6IGZ1bmN0aW9uIHBpeGVsQm94U3R5bGVzKCkgewogICAgICAgIGNvbXB1dGVTdHlsZVRlc3RzKCk7CiAgICAgICAgcmV0dXJuIHBpeGVsQm94U3R5bGVzVmFsOwogICAgICB9LAogICAgICBwaXhlbFBvc2l0aW9uOiBmdW5jdGlvbiBwaXhlbFBvc2l0aW9uKCkgewogICAgICAgIGNvbXB1dGVTdHlsZVRlc3RzKCk7CiAgICAgICAgcmV0dXJuIHBpeGVsUG9zaXRpb25WYWw7CiAgICAgIH0sCiAgICAgIHJlbGlhYmxlTWFyZ2luTGVmdDogZnVuY3Rpb24gcmVsaWFibGVNYXJnaW5MZWZ0KCkgewogICAgICAgIGNvbXB1dGVTdHlsZVRlc3RzKCk7CiAgICAgICAgcmV0dXJuIHJlbGlhYmxlTWFyZ2luTGVmdFZhbDsKICAgICAgfSwKICAgICAgc2Nyb2xsYm94U2l6ZTogZnVuY3Rpb24gc2Nyb2xsYm94U2l6ZSgpIHsKICAgICAgICBjb21wdXRlU3R5bGVUZXN0cygpOwogICAgICAgIHJldHVybiBzY3JvbGxib3hTaXplVmFsOwogICAgICB9LAogICAgICAvLyBTdXBwb3J0OiBJRSA5IC0gMTErLCBFZGdlIDE1IC0gMTgrCiAgICAgIC8vIElFL0VkZ2UgbWlzcmVwb3J0IGBnZXRDb21wdXRlZFN0eWxlYCBvZiB0YWJsZSByb3dzIHdpdGggd2lkdGgvaGVpZ2h0CiAgICAgIC8vIHNldCBpbiBDU1Mgd2hpbGUgYG9mZnNldCpgIHByb3BlcnRpZXMgcmVwb3J0IGNvcnJlY3QgdmFsdWVzLgogICAgICAvLyBCZWhhdmlvciBpbiBJRSA5IGlzIG1vcmUgc3VidGxlIHRoYW4gaW4gbmV3ZXIgdmVyc2lvbnMgJiBpdCBwYXNzZXMKICAgICAgLy8gc29tZSB2ZXJzaW9ucyBvZiB0aGlzIHRlc3Q7IG1ha2Ugc3VyZSBub3QgdG8gbWFrZSBpdCBwYXNzIHRoZXJlIQogICAgICByZWxpYWJsZVRyRGltZW5zaW9uczogZnVuY3Rpb24gcmVsaWFibGVUckRpbWVuc2lvbnMoKSB7CiAgICAgICAgdmFyIHRhYmxlLCB0ciwgdHJDaGlsZCwgdHJTdHlsZTsKICAgICAgICBpZiAocmVsaWFibGVUckRpbWVuc2lvbnNWYWwgPT0gbnVsbCkgewogICAgICAgICAgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpOwogICAgICAgICAgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpOwogICAgICAgICAgdHJDaGlsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgdGFibGUuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4IjsKICAgICAgICAgIHRyLnN0eWxlLmhlaWdodCA9ICIxcHgiOwogICAgICAgICAgdHJDaGlsZC5zdHlsZS5oZWlnaHQgPSAiOXB4IjsKICAgICAgICAgIGRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0YWJsZSkuYXBwZW5kQ2hpbGQodHIpLmFwcGVuZENoaWxkKHRyQ2hpbGQpOwogICAgICAgICAgdHJTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRyKTsKICAgICAgICAgIHJlbGlhYmxlVHJEaW1lbnNpb25zVmFsID0gcGFyc2VJbnQodHJTdHlsZS5oZWlnaHQpID4gMzsKICAgICAgICAgIGRvY3VtZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0YWJsZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWxpYWJsZVRyRGltZW5zaW9uc1ZhbDsKICAgICAgfQogICAgfSk7CiAgfSkoKTsKICBmdW5jdGlvbiBjdXJDU1MoZWxlbSwgbmFtZSwgY29tcHV0ZWQpIHsKICAgIHZhciB3aWR0aCwKICAgICAgbWluV2lkdGgsCiAgICAgIG1heFdpZHRoLAogICAgICByZXQsCiAgICAgIC8vIFN1cHBvcnQ6IEZpcmVmb3ggNTErCiAgICAgIC8vIFJldHJpZXZpbmcgc3R5bGUgYmVmb3JlIGNvbXB1dGVkIHNvbWVob3cKICAgICAgLy8gZml4ZXMgYW4gaXNzdWUgd2l0aCBnZXR0aW5nIHdyb25nIHZhbHVlcwogICAgICAvLyBvbiBkZXRhY2hlZCBlbGVtZW50cwogICAgICBzdHlsZSA9IGVsZW0uc3R5bGU7CiAgICBjb21wdXRlZCA9IGNvbXB1dGVkIHx8IGdldFN0eWxlcyhlbGVtKTsKCiAgICAvLyBnZXRQcm9wZXJ0eVZhbHVlIGlzIG5lZWRlZCBmb3I6CiAgICAvLyAgIC5jc3MoJ2ZpbHRlcicpIChJRSA5IG9ubHksICMxMjUzNykKICAgIC8vICAgLmNzcygnLS1jdXN0b21Qcm9wZXJ0eSkgKCMzMTQ0KQogICAgaWYgKGNvbXB1dGVkKSB7CiAgICAgIHJldCA9IGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUobmFtZSkgfHwgY29tcHV0ZWRbbmFtZV07CiAgICAgIGlmIChyZXQgPT09ICIiICYmICFpc0F0dGFjaGVkKGVsZW0pKSB7CiAgICAgICAgcmV0ID0galF1ZXJ5LnN0eWxlKGVsZW0sIG5hbWUpOwogICAgICB9CgogICAgICAvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgogICAgICAvLyBBbmRyb2lkIEJyb3dzZXIgcmV0dXJucyBwZXJjZW50YWdlIGZvciBzb21lIHZhbHVlcywKICAgICAgLy8gYnV0IHdpZHRoIHNlZW1zIHRvIGJlIHJlbGlhYmx5IHBpeGVscy4KICAgICAgLy8gVGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOgogICAgICAvLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3Nzb20vI3Jlc29sdmVkLXZhbHVlcwogICAgICBpZiAoIXN1cHBvcnQucGl4ZWxCb3hTdHlsZXMoKSAmJiBybnVtbm9ucHgudGVzdChyZXQpICYmIHJib3hTdHlsZS50ZXN0KG5hbWUpKSB7CiAgICAgICAgLy8gUmVtZW1iZXIgdGhlIG9yaWdpbmFsIHZhbHVlcwogICAgICAgIHdpZHRoID0gc3R5bGUud2lkdGg7CiAgICAgICAgbWluV2lkdGggPSBzdHlsZS5taW5XaWR0aDsKICAgICAgICBtYXhXaWR0aCA9IHN0eWxlLm1heFdpZHRoOwoKICAgICAgICAvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CiAgICAgICAgc3R5bGUubWluV2lkdGggPSBzdHlsZS5tYXhXaWR0aCA9IHN0eWxlLndpZHRoID0gcmV0OwogICAgICAgIHJldCA9IGNvbXB1dGVkLndpZHRoOwoKICAgICAgICAvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCiAgICAgICAgc3R5bGUud2lkdGggPSB3aWR0aDsKICAgICAgICBzdHlsZS5taW5XaWR0aCA9IG1pbldpZHRoOwogICAgICAgIHN0eWxlLm1heFdpZHRoID0gbWF4V2lkdGg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXQgIT09IHVuZGVmaW5lZCA/CiAgICAvLyBTdXBwb3J0OiBJRSA8PTkgLSAxMSBvbmx5CiAgICAvLyBJRSByZXR1cm5zIHpJbmRleCB2YWx1ZSBhcyBhbiBpbnRlZ2VyLgogICAgcmV0ICsgIiIgOiByZXQ7CiAgfQogIGZ1bmN0aW9uIGFkZEdldEhvb2tJZihjb25kaXRpb25GbiwgaG9va0ZuKSB7CiAgICAvLyBEZWZpbmUgdGhlIGhvb2ssIHdlJ2xsIGNoZWNrIG9uIHRoZSBmaXJzdCBydW4gaWYgaXQncyByZWFsbHkgbmVlZGVkLgogICAgcmV0dXJuIHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgaWYgKGNvbmRpdGlvbkZuKCkpIHsKICAgICAgICAgIC8vIEhvb2sgbm90IG5lZWRlZCAob3IgaXQncyBub3QgcG9zc2libGUgdG8gdXNlIGl0IGR1ZQogICAgICAgICAgLy8gdG8gbWlzc2luZyBkZXBlbmRlbmN5KSwgcmVtb3ZlIGl0LgogICAgICAgICAgZGVsZXRlIHRoaXMuZ2V0OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gSG9vayBuZWVkZWQ7IHJlZGVmaW5lIGl0IHNvIHRoYXQgdGhlIHN1cHBvcnQgdGVzdCBpcyBub3QgZXhlY3V0ZWQgYWdhaW4uCiAgICAgICAgcmV0dXJuICh0aGlzLmdldCA9IGhvb2tGbikuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9CiAgdmFyIGNzc1ByZWZpeGVzID0gWyJXZWJraXQiLCAiTW96IiwgIm1zIl0sCiAgICBlbXB0eVN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUsCiAgICB2ZW5kb3JQcm9wcyA9IHt9OwoKICAvLyBSZXR1cm4gYSB2ZW5kb3ItcHJlZml4ZWQgcHJvcGVydHkgb3IgdW5kZWZpbmVkCiAgZnVuY3Rpb24gdmVuZG9yUHJvcE5hbWUobmFtZSkgewogICAgLy8gQ2hlY2sgZm9yIHZlbmRvciBwcmVmaXhlZCBuYW1lcwogICAgdmFyIGNhcE5hbWUgPSBuYW1lWzBdLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpLAogICAgICBpID0gY3NzUHJlZml4ZXMubGVuZ3RoOwogICAgd2hpbGUgKGktLSkgewogICAgICBuYW1lID0gY3NzUHJlZml4ZXNbaV0gKyBjYXBOYW1lOwogICAgICBpZiAobmFtZSBpbiBlbXB0eVN0eWxlKSB7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIFJldHVybiBhIHBvdGVudGlhbGx5LW1hcHBlZCBqUXVlcnkuY3NzUHJvcHMgb3IgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CiAgZnVuY3Rpb24gZmluYWxQcm9wTmFtZShuYW1lKSB7CiAgICB2YXIgZmluYWwgPSBqUXVlcnkuY3NzUHJvcHNbbmFtZV0gfHwgdmVuZG9yUHJvcHNbbmFtZV07CiAgICBpZiAoZmluYWwpIHsKICAgICAgcmV0dXJuIGZpbmFsOwogICAgfQogICAgaWYgKG5hbWUgaW4gZW1wdHlTdHlsZSkgewogICAgICByZXR1cm4gbmFtZTsKICAgIH0KICAgIHJldHVybiB2ZW5kb3JQcm9wc1tuYW1lXSA9IHZlbmRvclByb3BOYW1lKG5hbWUpIHx8IG5hbWU7CiAgfQogIHZhcgogICAgLy8gU3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZQogICAgLy8gZXhjZXB0ICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iCiAgICAvLyBTZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkKICAgIHJkaXNwbGF5c3dhcCA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywKICAgIHJjdXN0b21Qcm9wID0gL14tLS8sCiAgICBjc3NTaG93ID0gewogICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgIGRpc3BsYXk6ICJibG9jayIKICAgIH0sCiAgICBjc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CiAgICAgIGxldHRlclNwYWNpbmc6ICIwIiwKICAgICAgZm9udFdlaWdodDogIjQwMCIKICAgIH07CiAgZnVuY3Rpb24gc2V0UG9zaXRpdmVOdW1iZXIoX2VsZW0sIHZhbHVlLCBzdWJ0cmFjdCkgewogICAgLy8gQW55IHJlbGF0aXZlICgrLy0pIHZhbHVlcyBoYXZlIGFscmVhZHkgYmVlbgogICAgLy8gbm9ybWFsaXplZCBhdCB0aGlzIHBvaW50CiAgICB2YXIgbWF0Y2hlcyA9IHJjc3NOdW0uZXhlYyh2YWx1ZSk7CiAgICByZXR1cm4gbWF0Y2hlcyA/CiAgICAvLyBHdWFyZCBhZ2FpbnN0IHVuZGVmaW5lZCAic3VidHJhY3QiLCBlLmcuLCB3aGVuIHVzZWQgYXMgaW4gY3NzSG9va3MKICAgIE1hdGgubWF4KDAsIG1hdGNoZXNbMl0gLSAoc3VidHJhY3QgfHwgMCkpICsgKG1hdGNoZXNbM10gfHwgInB4IikgOiB2YWx1ZTsKICB9CiAgZnVuY3Rpb24gYm94TW9kZWxBZGp1c3RtZW50KGVsZW0sIGRpbWVuc2lvbiwgYm94LCBpc0JvcmRlckJveCwgc3R5bGVzLCBjb21wdXRlZFZhbCkgewogICAgdmFyIGkgPSBkaW1lbnNpb24gPT09ICJ3aWR0aCIgPyAxIDogMCwKICAgICAgZXh0cmEgPSAwLAogICAgICBkZWx0YSA9IDA7CgogICAgLy8gQWRqdXN0bWVudCBtYXkgbm90IGJlIG5lY2Vzc2FyeQogICAgaWYgKGJveCA9PT0gKGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIpKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZm9yICg7IGkgPCA0OyBpICs9IDIpIHsKICAgICAgLy8gQm90aCBib3ggbW9kZWxzIGV4Y2x1ZGUgbWFyZ2luCiAgICAgIGlmIChib3ggPT09ICJtYXJnaW4iKSB7CiAgICAgICAgZGVsdGEgKz0galF1ZXJ5LmNzcyhlbGVtLCBib3ggKyBjc3NFeHBhbmRbaV0sIHRydWUsIHN0eWxlcyk7CiAgICAgIH0KCiAgICAgIC8vIElmIHdlIGdldCBoZXJlIHdpdGggYSBjb250ZW50LWJveCwgd2UncmUgc2Vla2luZyAicGFkZGluZyIgb3IgImJvcmRlciIgb3IgIm1hcmdpbiIKICAgICAgaWYgKCFpc0JvcmRlckJveCkgewogICAgICAgIC8vIEFkZCBwYWRkaW5nCiAgICAgICAgZGVsdGEgKz0galF1ZXJ5LmNzcyhlbGVtLCAicGFkZGluZyIgKyBjc3NFeHBhbmRbaV0sIHRydWUsIHN0eWxlcyk7CgogICAgICAgIC8vIEZvciAiYm9yZGVyIiBvciAibWFyZ2luIiwgYWRkIGJvcmRlcgogICAgICAgIGlmIChib3ggIT09ICJwYWRkaW5nIikgewogICAgICAgICAgZGVsdGEgKz0galF1ZXJ5LmNzcyhlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFtpXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyk7CgogICAgICAgICAgLy8gQnV0IHN0aWxsIGtlZXAgdHJhY2sgb2YgaXQgb3RoZXJ3aXNlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4dHJhICs9IGpRdWVyeS5jc3MoZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbaV0gKyAiV2lkdGgiLCB0cnVlLCBzdHlsZXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgd2UgZ2V0IGhlcmUgd2l0aCBhIGJvcmRlci1ib3ggKGNvbnRlbnQgKyBwYWRkaW5nICsgYm9yZGVyKSwgd2UncmUgc2Vla2luZyAiY29udGVudCIgb3IKICAgICAgICAvLyAicGFkZGluZyIgb3IgIm1hcmdpbiIKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBGb3IgImNvbnRlbnQiLCBzdWJ0cmFjdCBwYWRkaW5nCiAgICAgICAgaWYgKGJveCA9PT0gImNvbnRlbnQiKSB7CiAgICAgICAgICBkZWx0YSAtPSBqUXVlcnkuY3NzKGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFtpXSwgdHJ1ZSwgc3R5bGVzKTsKICAgICAgICB9CgogICAgICAgIC8vIEZvciAiY29udGVudCIgb3IgInBhZGRpbmciLCBzdWJ0cmFjdCBib3JkZXIKICAgICAgICBpZiAoYm94ICE9PSAibWFyZ2luIikgewogICAgICAgICAgZGVsdGEgLT0galF1ZXJ5LmNzcyhlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFtpXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gQWNjb3VudCBmb3IgcG9zaXRpdmUgY29udGVudC1ib3ggc2Nyb2xsIGd1dHRlciB3aGVuIHJlcXVlc3RlZCBieSBwcm92aWRpbmcgY29tcHV0ZWRWYWwKICAgIGlmICghaXNCb3JkZXJCb3ggJiYgY29tcHV0ZWRWYWwgPj0gMCkgewogICAgICAvLyBvZmZzZXRXaWR0aC9vZmZzZXRIZWlnaHQgaXMgYSByb3VuZGVkIHN1bSBvZiBjb250ZW50LCBwYWRkaW5nLCBzY3JvbGwgZ3V0dGVyLCBhbmQgYm9yZGVyCiAgICAgIC8vIEFzc3VtaW5nIGludGVnZXIgc2Nyb2xsIGd1dHRlciwgc3VidHJhY3QgdGhlIHJlc3QgYW5kIHJvdW5kIGRvd24KICAgICAgZGVsdGEgKz0gTWF0aC5tYXgoMCwgTWF0aC5jZWlsKGVsZW1bIm9mZnNldCIgKyBkaW1lbnNpb25bMF0udG9VcHBlckNhc2UoKSArIGRpbWVuc2lvbi5zbGljZSgxKV0gLSBjb21wdXRlZFZhbCAtIGRlbHRhIC0gZXh0cmEgLSAwLjUKCiAgICAgIC8vIElmIG9mZnNldFdpZHRoL29mZnNldEhlaWdodCBpcyB1bmtub3duLCB0aGVuIHdlIGNhbid0IGRldGVybWluZSBjb250ZW50LWJveCBzY3JvbGwgZ3V0dGVyCiAgICAgIC8vIFVzZSBhbiBleHBsaWNpdCB6ZXJvIHRvIGF2b2lkIE5hTiAoZ2gtMzk2NCkKICAgICAgKSkgfHwgMDsKICAgIH0KICAgIHJldHVybiBkZWx0YTsKICB9CiAgZnVuY3Rpb24gZ2V0V2lkdGhPckhlaWdodChlbGVtLCBkaW1lbnNpb24sIGV4dHJhKSB7CiAgICAvLyBTdGFydCB3aXRoIGNvbXB1dGVkIHN0eWxlCiAgICB2YXIgc3R5bGVzID0gZ2V0U3R5bGVzKGVsZW0pLAogICAgICAvLyBUbyBhdm9pZCBmb3JjaW5nIGEgcmVmbG93LCBvbmx5IGZldGNoIGJveFNpemluZyBpZiB3ZSBuZWVkIGl0IChnaC00MzIyKS4KICAgICAgLy8gRmFrZSBjb250ZW50LWJveCB1bnRpbCB3ZSBrbm93IGl0J3MgbmVlZGVkIHRvIGtub3cgdGhlIHRydWUgdmFsdWUuCiAgICAgIGJveFNpemluZ05lZWRlZCA9ICFzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgZXh0cmEsCiAgICAgIGlzQm9yZGVyQm94ID0gYm94U2l6aW5nTmVlZGVkICYmIGpRdWVyeS5jc3MoZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMpID09PSAiYm9yZGVyLWJveCIsCiAgICAgIHZhbHVlSXNCb3JkZXJCb3ggPSBpc0JvcmRlckJveCwKICAgICAgdmFsID0gY3VyQ1NTKGVsZW0sIGRpbWVuc2lvbiwgc3R5bGVzKSwKICAgICAgb2Zmc2V0UHJvcCA9ICJvZmZzZXQiICsgZGltZW5zaW9uWzBdLnRvVXBwZXJDYXNlKCkgKyBkaW1lbnNpb24uc2xpY2UoMSk7CgogICAgLy8gU3VwcG9ydDogRmlyZWZveCA8PTU0CiAgICAvLyBSZXR1cm4gYSBjb25mb3VuZGluZyBub24tcGl4ZWwgdmFsdWUgb3IgZmVpZ24gaWdub3JhbmNlLCBhcyBhcHByb3ByaWF0ZS4KICAgIGlmIChybnVtbm9ucHgudGVzdCh2YWwpKSB7CiAgICAgIGlmICghZXh0cmEpIHsKICAgICAgICByZXR1cm4gdmFsOwogICAgICB9CiAgICAgIHZhbCA9ICJhdXRvIjsKICAgIH0KCiAgICAvLyBTdXBwb3J0OiBJRSA5IC0gMTEgb25seQogICAgLy8gVXNlIG9mZnNldFdpZHRoL29mZnNldEhlaWdodCBmb3Igd2hlbiBib3ggc2l6aW5nIGlzIHVucmVsaWFibGUuCiAgICAvLyBJbiB0aG9zZSBjYXNlcywgdGhlIGNvbXB1dGVkIHZhbHVlIGNhbiBiZSB0cnVzdGVkIHRvIGJlIGJvcmRlci1ib3guCiAgICBpZiAoKCFzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlKCkgJiYgaXNCb3JkZXJCb3ggfHwKICAgIC8vIFN1cHBvcnQ6IElFIDEwIC0gMTErLCBFZGdlIDE1IC0gMTgrCiAgICAvLyBJRS9FZGdlIG1pc3JlcG9ydCBgZ2V0Q29tcHV0ZWRTdHlsZWAgb2YgdGFibGUgcm93cyB3aXRoIHdpZHRoL2hlaWdodAogICAgLy8gc2V0IGluIENTUyB3aGlsZSBgb2Zmc2V0KmAgcHJvcGVydGllcyByZXBvcnQgY29ycmVjdCB2YWx1ZXMuCiAgICAvLyBJbnRlcmVzdGluZ2x5LCBpbiBzb21lIGNhc2VzIElFIDkgZG9lc24ndCBzdWZmZXIgZnJvbSB0aGlzIGlzc3VlLgogICAgIXN1cHBvcnQucmVsaWFibGVUckRpbWVuc2lvbnMoKSAmJiBub2RlTmFtZShlbGVtLCAidHIiKSB8fAogICAgLy8gRmFsbCBiYWNrIHRvIG9mZnNldFdpZHRoL29mZnNldEhlaWdodCB3aGVuIHZhbHVlIGlzICJhdXRvIgogICAgLy8gVGhpcyBoYXBwZW5zIGZvciBpbmxpbmUgZWxlbWVudHMgd2l0aCBubyBleHBsaWNpdCBzZXR0aW5nIChnaC0zNTcxKQogICAgdmFsID09PSAiYXV0byIgfHwKICAgIC8vIFN1cHBvcnQ6IEFuZHJvaWQgPD00LjEgLSA0LjMgb25seQogICAgLy8gQWxzbyB1c2Ugb2Zmc2V0V2lkdGgvb2Zmc2V0SGVpZ2h0IGZvciBtaXNyZXBvcnRlZCBpbmxpbmUgZGltZW5zaW9ucyAoZ2gtMzYwMikKICAgICFwYXJzZUZsb2F0KHZhbCkgJiYgalF1ZXJ5LmNzcyhlbGVtLCAiZGlzcGxheSIsIGZhbHNlLCBzdHlsZXMpID09PSAiaW5saW5lIikgJiYKICAgIC8vIE1ha2Ugc3VyZSB0aGUgZWxlbWVudCBpcyB2aXNpYmxlICYgY29ubmVjdGVkCiAgICBlbGVtLmdldENsaWVudFJlY3RzKCkubGVuZ3RoKSB7CiAgICAgIGlzQm9yZGVyQm94ID0galF1ZXJ5LmNzcyhlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcykgPT09ICJib3JkZXItYm94IjsKCiAgICAgIC8vIFdoZXJlIGF2YWlsYWJsZSwgb2Zmc2V0V2lkdGgvb2Zmc2V0SGVpZ2h0IGFwcHJveGltYXRlIGJvcmRlciBib3ggZGltZW5zaW9ucy4KICAgICAgLy8gV2hlcmUgbm90IGF2YWlsYWJsZSAoZS5nLiwgU1ZHKSwgYXNzdW1lIHVucmVsaWFibGUgYm94LXNpemluZyBhbmQgaW50ZXJwcmV0IHRoZQogICAgICAvLyByZXRyaWV2ZWQgdmFsdWUgYXMgYSBjb250ZW50IGJveCBkaW1lbnNpb24uCiAgICAgIHZhbHVlSXNCb3JkZXJCb3ggPSBvZmZzZXRQcm9wIGluIGVsZW07CiAgICAgIGlmICh2YWx1ZUlzQm9yZGVyQm94KSB7CiAgICAgICAgdmFsID0gZWxlbVtvZmZzZXRQcm9wXTsKICAgICAgfQogICAgfQoKICAgIC8vIE5vcm1hbGl6ZSAiIiBhbmQgYXV0bwogICAgdmFsID0gcGFyc2VGbG9hdCh2YWwpIHx8IDA7CgogICAgLy8gQWRqdXN0IGZvciB0aGUgZWxlbWVudCdzIGJveCBtb2RlbAogICAgcmV0dXJuIHZhbCArIGJveE1vZGVsQWRqdXN0bWVudChlbGVtLCBkaW1lbnNpb24sIGV4dHJhIHx8IChpc0JvcmRlckJveCA/ICJib3JkZXIiIDogImNvbnRlbnQiKSwgdmFsdWVJc0JvcmRlckJveCwgc3R5bGVzLAogICAgLy8gUHJvdmlkZSB0aGUgY3VycmVudCBjb21wdXRlZCBzaXplIHRvIHJlcXVlc3Qgc2Nyb2xsIGd1dHRlciBjYWxjdWxhdGlvbiAoZ2gtMzU4OSkKICAgIHZhbCkgKyAicHgiOwogIH0KICBqUXVlcnkuZXh0ZW5kKHsKICAgIC8vIEFkZCBpbiBzdHlsZSBwcm9wZXJ0eSBob29rcyBmb3Igb3ZlcnJpZGluZyB0aGUgZGVmYXVsdAogICAgLy8gYmVoYXZpb3Igb2YgZ2V0dGluZyBhbmQgc2V0dGluZyBhIHN0eWxlIHByb3BlcnR5CiAgICBjc3NIb29rczogewogICAgICBvcGFjaXR5OiB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSwgY29tcHV0ZWQpIHsKICAgICAgICAgIGlmIChjb21wdXRlZCkgewogICAgICAgICAgICAvLyBXZSBzaG91bGQgYWx3YXlzIGdldCBhIG51bWJlciBiYWNrIGZyb20gb3BhY2l0eQogICAgICAgICAgICB2YXIgcmV0ID0gY3VyQ1NTKGVsZW0sICJvcGFjaXR5Iik7CiAgICAgICAgICAgIHJldHVybiByZXQgPT09ICIiID8gIjEiIDogcmV0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIERvbid0IGF1dG9tYXRpY2FsbHkgYWRkICJweCIgdG8gdGhlc2UgcG9zc2libHktdW5pdGxlc3MgcHJvcGVydGllcwogICAgY3NzTnVtYmVyOiB7CiAgICAgICJhbmltYXRpb25JdGVyYXRpb25Db3VudCI6IHRydWUsCiAgICAgICJjb2x1bW5Db3VudCI6IHRydWUsCiAgICAgICJmaWxsT3BhY2l0eSI6IHRydWUsCiAgICAgICJmbGV4R3JvdyI6IHRydWUsCiAgICAgICJmbGV4U2hyaW5rIjogdHJ1ZSwKICAgICAgImZvbnRXZWlnaHQiOiB0cnVlLAogICAgICAiZ3JpZEFyZWEiOiB0cnVlLAogICAgICAiZ3JpZENvbHVtbiI6IHRydWUsCiAgICAgICJncmlkQ29sdW1uRW5kIjogdHJ1ZSwKICAgICAgImdyaWRDb2x1bW5TdGFydCI6IHRydWUsCiAgICAgICJncmlkUm93IjogdHJ1ZSwKICAgICAgImdyaWRSb3dFbmQiOiB0cnVlLAogICAgICAiZ3JpZFJvd1N0YXJ0IjogdHJ1ZSwKICAgICAgImxpbmVIZWlnaHQiOiB0cnVlLAogICAgICAib3BhY2l0eSI6IHRydWUsCiAgICAgICJvcmRlciI6IHRydWUsCiAgICAgICJvcnBoYW5zIjogdHJ1ZSwKICAgICAgIndpZG93cyI6IHRydWUsCiAgICAgICJ6SW5kZXgiOiB0cnVlLAogICAgICAiem9vbSI6IHRydWUKICAgIH0sCiAgICAvLyBBZGQgaW4gcHJvcGVydGllcyB3aG9zZSBuYW1lcyB5b3Ugd2lzaCB0byBmaXggYmVmb3JlCiAgICAvLyBzZXR0aW5nIG9yIGdldHRpbmcgdGhlIHZhbHVlCiAgICBjc3NQcm9wczoge30sCiAgICAvLyBHZXQgYW5kIHNldCB0aGUgc3R5bGUgcHJvcGVydHkgb24gYSBET00gTm9kZQogICAgc3R5bGU6IGZ1bmN0aW9uIHN0eWxlKGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSkgewogICAgICAvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKICAgICAgaWYgKCFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCiAgICAgIHZhciByZXQsCiAgICAgICAgdHlwZSwKICAgICAgICBob29rcywKICAgICAgICBvcmlnTmFtZSA9IGNhbWVsQ2FzZShuYW1lKSwKICAgICAgICBpc0N1c3RvbVByb3AgPSByY3VzdG9tUHJvcC50ZXN0KG5hbWUpLAogICAgICAgIHN0eWxlID0gZWxlbS5zdHlsZTsKCiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZS4gV2UgZG9uJ3QKICAgICAgLy8gd2FudCB0byBxdWVyeSB0aGUgdmFsdWUgaWYgaXQgaXMgYSBDU1MgY3VzdG9tIHByb3BlcnR5CiAgICAgIC8vIHNpbmNlIHRoZXkgYXJlIHVzZXItZGVmaW5lZC4KICAgICAgaWYgKCFpc0N1c3RvbVByb3ApIHsKICAgICAgICBuYW1lID0gZmluYWxQcm9wTmFtZShvcmlnTmFtZSk7CiAgICAgIH0KCiAgICAgIC8vIEdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24sIHRoZW4gdW5wcmVmaXhlZCB2ZXJzaW9uCiAgICAgIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzW25hbWVdIHx8IGpRdWVyeS5jc3NIb29rc1tvcmlnTmFtZV07CgogICAgICAvLyBDaGVjayBpZiB3ZSdyZSBzZXR0aW5nIGEgdmFsdWUKICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0eXBlID0gX3R5cGVvZih2YWx1ZSk7CgogICAgICAgIC8vIENvbnZlcnQgIis9IiBvciAiLT0iIHRvIHJlbGF0aXZlIG51bWJlcnMgKCM3MzQ1KQogICAgICAgIGlmICh0eXBlID09PSAic3RyaW5nIiAmJiAocmV0ID0gcmNzc051bS5leGVjKHZhbHVlKSkgJiYgcmV0WzFdKSB7CiAgICAgICAgICB2YWx1ZSA9IGFkanVzdENTUyhlbGVtLCBuYW1lLCByZXQpOwoKICAgICAgICAgIC8vIEZpeGVzIGJ1ZyAjOTIzNwogICAgICAgICAgdHlwZSA9ICJudW1iZXIiOwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgbnVsbCBhbmQgTmFOIHZhbHVlcyBhcmVuJ3Qgc2V0ICgjNzExNikKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSAhPT0gdmFsdWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIElmIGEgbnVtYmVyIHdhcyBwYXNzZWQgaW4sIGFkZCB0aGUgdW5pdCAoZXhjZXB0IGZvciBjZXJ0YWluIENTUyBwcm9wZXJ0aWVzKQogICAgICAgIC8vIFRoZSBpc0N1c3RvbVByb3AgY2hlY2sgY2FuIGJlIHJlbW92ZWQgaW4galF1ZXJ5IDQuMCB3aGVuIHdlIG9ubHkgYXV0by1hcHBlbmQKICAgICAgICAvLyAicHgiIHRvIGEgZmV3IGhhcmRjb2RlZCB2YWx1ZXMuCiAgICAgICAgaWYgKHR5cGUgPT09ICJudW1iZXIiICYmICFpc0N1c3RvbVByb3ApIHsKICAgICAgICAgIHZhbHVlICs9IHJldCAmJiByZXRbM10gfHwgKGpRdWVyeS5jc3NOdW1iZXJbb3JpZ05hbWVdID8gIiIgOiAicHgiKTsKICAgICAgICB9CgogICAgICAgIC8vIGJhY2tncm91bmQtKiBwcm9wcyBhZmZlY3Qgb3JpZ2luYWwgY2xvbmUncyB2YWx1ZXMKICAgICAgICBpZiAoIXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoImJhY2tncm91bmQiKSA9PT0gMCkgewogICAgICAgICAgc3R5bGVbbmFtZV0gPSAiaW5oZXJpdCI7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKICAgICAgICBpZiAoIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8ICh2YWx1ZSA9IGhvb2tzLnNldChlbGVtLCB2YWx1ZSwgZXh0cmEpKSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAoaXNDdXN0b21Qcm9wKSB7CiAgICAgICAgICAgIHN0eWxlLnNldFByb3BlcnR5KG5hbWUsIHZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0eWxlW25hbWVdID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBub24tY29tcHV0ZWQgdmFsdWUgZnJvbSB0aGVyZQogICAgICAgIGlmIChob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KGVsZW0sIGZhbHNlLCBleHRyYSkpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdAogICAgICAgIHJldHVybiBzdHlsZVtuYW1lXTsKICAgICAgfQogICAgfSwKICAgIGNzczogZnVuY3Rpb24gY3NzKGVsZW0sIG5hbWUsIGV4dHJhLCBzdHlsZXMpIHsKICAgICAgdmFyIHZhbCwKICAgICAgICBudW0sCiAgICAgICAgaG9va3MsCiAgICAgICAgb3JpZ05hbWUgPSBjYW1lbENhc2UobmFtZSksCiAgICAgICAgaXNDdXN0b21Qcm9wID0gcmN1c3RvbVByb3AudGVzdChuYW1lKTsKCiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZS4gV2UgZG9uJ3QKICAgICAgLy8gd2FudCB0byBtb2RpZnkgdGhlIHZhbHVlIGlmIGl0IGlzIGEgQ1NTIGN1c3RvbSBwcm9wZXJ0eQogICAgICAvLyBzaW5jZSB0aGV5IGFyZSB1c2VyLWRlZmluZWQuCiAgICAgIGlmICghaXNDdXN0b21Qcm9wKSB7CiAgICAgICAgbmFtZSA9IGZpbmFsUHJvcE5hbWUob3JpZ05hbWUpOwogICAgICB9CgogICAgICAvLyBUcnkgcHJlZml4ZWQgbmFtZSBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCBuYW1lCiAgICAgIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzW25hbWVdIHx8IGpRdWVyeS5jc3NIb29rc1tvcmlnTmFtZV07CgogICAgICAvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZnJvbSB0aGVyZQogICAgICBpZiAoaG9va3MgJiYgImdldCIgaW4gaG9va3MpIHsKICAgICAgICB2YWwgPSBob29rcy5nZXQoZWxlbSwgdHJ1ZSwgZXh0cmEpOwogICAgICB9CgogICAgICAvLyBPdGhlcndpc2UsIGlmIGEgd2F5IHRvIGdldCB0aGUgY29tcHV0ZWQgdmFsdWUgZXhpc3RzLCB1c2UgdGhhdAogICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICB2YWwgPSBjdXJDU1MoZWxlbSwgbmFtZSwgc3R5bGVzKTsKICAgICAgfQoKICAgICAgLy8gQ29udmVydCAibm9ybWFsIiB0byBjb21wdXRlZCB2YWx1ZQogICAgICBpZiAodmFsID09PSAibm9ybWFsIiAmJiBuYW1lIGluIGNzc05vcm1hbFRyYW5zZm9ybSkgewogICAgICAgIHZhbCA9IGNzc05vcm1hbFRyYW5zZm9ybVtuYW1lXTsKICAgICAgfQoKICAgICAgLy8gTWFrZSBudW1lcmljIGlmIGZvcmNlZCBvciBhIHF1YWxpZmllciB3YXMgcHJvdmlkZWQgYW5kIHZhbCBsb29rcyBudW1lcmljCiAgICAgIGlmIChleHRyYSA9PT0gIiIgfHwgZXh0cmEpIHsKICAgICAgICBudW0gPSBwYXJzZUZsb2F0KHZhbCk7CiAgICAgICAgcmV0dXJuIGV4dHJhID09PSB0cnVlIHx8IGlzRmluaXRlKG51bSkgPyBudW0gfHwgMCA6IHZhbDsKICAgICAgfQogICAgICByZXR1cm4gdmFsOwogICAgfQogIH0pOwogIGpRdWVyeS5lYWNoKFsiaGVpZ2h0IiwgIndpZHRoIl0sIGZ1bmN0aW9uIChfaSwgZGltZW5zaW9uKSB7CiAgICBqUXVlcnkuY3NzSG9va3NbZGltZW5zaW9uXSA9IHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSwgY29tcHV0ZWQsIGV4dHJhKSB7CiAgICAgICAgaWYgKGNvbXB1dGVkKSB7CiAgICAgICAgICAvLyBDZXJ0YWluIGVsZW1lbnRzIGNhbiBoYXZlIGRpbWVuc2lvbiBpbmZvIGlmIHdlIGludmlzaWJseSBzaG93IHRoZW0KICAgICAgICAgIC8vIGJ1dCBpdCBtdXN0IGhhdmUgYSBjdXJyZW50IGRpc3BsYXkgc3R5bGUgdGhhdCB3b3VsZCBiZW5lZml0CiAgICAgICAgICByZXR1cm4gcmRpc3BsYXlzd2FwLnRlc3QoalF1ZXJ5LmNzcyhlbGVtLCAiZGlzcGxheSIpKSAmJiAoCiAgICAgICAgICAvLyBTdXBwb3J0OiBTYWZhcmkgOCsKICAgICAgICAgIC8vIFRhYmxlIGNvbHVtbnMgaW4gU2FmYXJpIGhhdmUgbm9uLXplcm8gb2Zmc2V0V2lkdGggJiB6ZXJvCiAgICAgICAgICAvLyBnZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCB1bmxlc3MgZGlzcGxheSBpcyBjaGFuZ2VkLgogICAgICAgICAgLy8gU3VwcG9ydDogSUUgPD0xMSBvbmx5CiAgICAgICAgICAvLyBSdW5uaW5nIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlCiAgICAgICAgICAvLyBpbiBJRSB0aHJvd3MgYW4gZXJyb3IuCiAgICAgICAgICAhZWxlbS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCB8fCAhZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCkgPyBzd2FwKGVsZW0sIGNzc1Nob3csIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFdpZHRoT3JIZWlnaHQoZWxlbSwgZGltZW5zaW9uLCBleHRyYSk7CiAgICAgICAgICB9KSA6IGdldFdpZHRoT3JIZWlnaHQoZWxlbSwgZGltZW5zaW9uLCBleHRyYSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSwgZXh0cmEpIHsKICAgICAgICB2YXIgbWF0Y2hlcywKICAgICAgICAgIHN0eWxlcyA9IGdldFN0eWxlcyhlbGVtKSwKICAgICAgICAgIC8vIE9ubHkgcmVhZCBzdHlsZXMucG9zaXRpb24gaWYgdGhlIHRlc3QgaGFzIGEgY2hhbmNlIHRvIGZhaWwKICAgICAgICAgIC8vIHRvIGF2b2lkIGZvcmNpbmcgYSByZWZsb3cuCiAgICAgICAgICBzY3JvbGxib3hTaXplQnVnZ3kgPSAhc3VwcG9ydC5zY3JvbGxib3hTaXplKCkgJiYgc3R5bGVzLnBvc2l0aW9uID09PSAiYWJzb2x1dGUiLAogICAgICAgICAgLy8gVG8gYXZvaWQgZm9yY2luZyBhIHJlZmxvdywgb25seSBmZXRjaCBib3hTaXppbmcgaWYgd2UgbmVlZCBpdCAoZ2gtMzk5MSkKICAgICAgICAgIGJveFNpemluZ05lZWRlZCA9IHNjcm9sbGJveFNpemVCdWdneSB8fCBleHRyYSwKICAgICAgICAgIGlzQm9yZGVyQm94ID0gYm94U2l6aW5nTmVlZGVkICYmIGpRdWVyeS5jc3MoZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMpID09PSAiYm9yZGVyLWJveCIsCiAgICAgICAgICBzdWJ0cmFjdCA9IGV4dHJhID8gYm94TW9kZWxBZGp1c3RtZW50KGVsZW0sIGRpbWVuc2lvbiwgZXh0cmEsIGlzQm9yZGVyQm94LCBzdHlsZXMpIDogMDsKCiAgICAgICAgLy8gQWNjb3VudCBmb3IgdW5yZWxpYWJsZSBib3JkZXItYm94IGRpbWVuc2lvbnMgYnkgY29tcGFyaW5nIG9mZnNldCogdG8gY29tcHV0ZWQgYW5kCiAgICAgICAgLy8gZmFraW5nIGEgY29udGVudC1ib3ggdG8gZ2V0IGJvcmRlciBhbmQgcGFkZGluZyAoZ2gtMzY5OSkKICAgICAgICBpZiAoaXNCb3JkZXJCb3ggJiYgc2Nyb2xsYm94U2l6ZUJ1Z2d5KSB7CiAgICAgICAgICBzdWJ0cmFjdCAtPSBNYXRoLmNlaWwoZWxlbVsib2Zmc2V0IiArIGRpbWVuc2lvblswXS50b1VwcGVyQ2FzZSgpICsgZGltZW5zaW9uLnNsaWNlKDEpXSAtIHBhcnNlRmxvYXQoc3R5bGVzW2RpbWVuc2lvbl0pIC0gYm94TW9kZWxBZGp1c3RtZW50KGVsZW0sIGRpbWVuc2lvbiwgImJvcmRlciIsIGZhbHNlLCBzdHlsZXMpIC0gMC41KTsKICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnQgdG8gcGl4ZWxzIGlmIHZhbHVlIGFkanVzdG1lbnQgaXMgbmVlZGVkCiAgICAgICAgaWYgKHN1YnRyYWN0ICYmIChtYXRjaGVzID0gcmNzc051bS5leGVjKHZhbHVlKSkgJiYgKG1hdGNoZXNbM10gfHwgInB4IikgIT09ICJweCIpIHsKICAgICAgICAgIGVsZW0uc3R5bGVbZGltZW5zaW9uXSA9IHZhbHVlOwogICAgICAgICAgdmFsdWUgPSBqUXVlcnkuY3NzKGVsZW0sIGRpbWVuc2lvbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXRQb3NpdGl2ZU51bWJlcihlbGVtLCB2YWx1ZSwgc3VidHJhY3QpOwogICAgICB9CiAgICB9OwogIH0pOwogIGpRdWVyeS5jc3NIb29rcy5tYXJnaW5MZWZ0ID0gYWRkR2V0SG9va0lmKHN1cHBvcnQucmVsaWFibGVNYXJnaW5MZWZ0LCBmdW5jdGlvbiAoZWxlbSwgY29tcHV0ZWQpIHsKICAgIGlmIChjb21wdXRlZCkgewogICAgICByZXR1cm4gKHBhcnNlRmxvYXQoY3VyQ1NTKGVsZW0sICJtYXJnaW5MZWZ0IikpIHx8IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIHN3YXAoZWxlbSwgewogICAgICAgIG1hcmdpbkxlZnQ6IDAKICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7CiAgICAgIH0pKSArICJweCI7CiAgICB9CiAgfSk7CgogIC8vIFRoZXNlIGhvb2tzIGFyZSB1c2VkIGJ5IGFuaW1hdGUgdG8gZXhwYW5kIHByb3BlcnRpZXMKICBqUXVlcnkuZWFjaCh7CiAgICBtYXJnaW46ICIiLAogICAgcGFkZGluZzogIiIsCiAgICBib3JkZXI6ICJXaWR0aCIKICB9LCBmdW5jdGlvbiAocHJlZml4LCBzdWZmaXgpIHsKICAgIGpRdWVyeS5jc3NIb29rc1twcmVmaXggKyBzdWZmaXhdID0gewogICAgICBleHBhbmQ6IGZ1bmN0aW9uIGV4cGFuZCh2YWx1ZSkgewogICAgICAgIHZhciBpID0gMCwKICAgICAgICAgIGV4cGFuZGVkID0ge30sCiAgICAgICAgICAvLyBBc3N1bWVzIGEgc2luZ2xlIG51bWJlciBpZiBub3QgYSBzdHJpbmcKICAgICAgICAgIHBhcnRzID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiA/IHZhbHVlLnNwbGl0KCIgIikgOiBbdmFsdWVdOwogICAgICAgIGZvciAoOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICBleHBhbmRlZFtwcmVmaXggKyBjc3NFeHBhbmRbaV0gKyBzdWZmaXhdID0gcGFydHNbaV0gfHwgcGFydHNbaSAtIDJdIHx8IHBhcnRzWzBdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhwYW5kZWQ7CiAgICAgIH0KICAgIH07CiAgICBpZiAocHJlZml4ICE9PSAibWFyZ2luIikgewogICAgICBqUXVlcnkuY3NzSG9va3NbcHJlZml4ICsgc3VmZml4XS5zZXQgPSBzZXRQb3NpdGl2ZU51bWJlcjsKICAgIH0KICB9KTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGNzczogZnVuY3Rpb24gY3NzKG5hbWUsIHZhbHVlKSB7CiAgICAgIHJldHVybiBhY2Nlc3ModGhpcywgZnVuY3Rpb24gKGVsZW0sIG5hbWUsIHZhbHVlKSB7CiAgICAgICAgdmFyIHN0eWxlcywKICAgICAgICAgIGxlbiwKICAgICAgICAgIG1hcCA9IHt9LAogICAgICAgICAgaSA9IDA7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmFtZSkpIHsKICAgICAgICAgIHN0eWxlcyA9IGdldFN0eWxlcyhlbGVtKTsKICAgICAgICAgIGxlbiA9IG5hbWUubGVuZ3RoOwogICAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBtYXBbbmFtZVtpXV0gPSBqUXVlcnkuY3NzKGVsZW0sIG5hbWVbaV0sIGZhbHNlLCBzdHlsZXMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPyBqUXVlcnkuc3R5bGUoZWxlbSwgbmFtZSwgdmFsdWUpIDogalF1ZXJ5LmNzcyhlbGVtLCBuYW1lKTsKICAgICAgfSwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxKTsKICAgIH0KICB9KTsKICBmdW5jdGlvbiBUd2VlbihlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZykgewogICAgcmV0dXJuIG5ldyBUd2Vlbi5wcm90b3R5cGUuaW5pdChlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyk7CiAgfQogIGpRdWVyeS5Ud2VlbiA9IFR3ZWVuOwogIFR3ZWVuLnByb3RvdHlwZSA9IHsKICAgIGNvbnN0cnVjdG9yOiBUd2VlbiwKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQpIHsKICAgICAgdGhpcy5lbGVtID0gZWxlbTsKICAgICAgdGhpcy5wcm9wID0gcHJvcDsKICAgICAgdGhpcy5lYXNpbmcgPSBlYXNpbmcgfHwgalF1ZXJ5LmVhc2luZy5fZGVmYXVsdDsKICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgdGhpcy5zdGFydCA9IHRoaXMubm93ID0gdGhpcy5jdXIoKTsKICAgICAgdGhpcy5lbmQgPSBlbmQ7CiAgICAgIHRoaXMudW5pdCA9IHVuaXQgfHwgKGpRdWVyeS5jc3NOdW1iZXJbcHJvcF0gPyAiIiA6ICJweCIpOwogICAgfSwKICAgIGN1cjogZnVuY3Rpb24gY3VyKCkgewogICAgICB2YXIgaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbdGhpcy5wcm9wXTsKICAgICAgcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/IGhvb2tzLmdldCh0aGlzKSA6IFR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQodGhpcyk7CiAgICB9LAogICAgcnVuOiBmdW5jdGlvbiBydW4ocGVyY2VudCkgewogICAgICB2YXIgZWFzZWQsCiAgICAgICAgaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbdGhpcy5wcm9wXTsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5kdXJhdGlvbikgewogICAgICAgIHRoaXMucG9zID0gZWFzZWQgPSBqUXVlcnkuZWFzaW5nW3RoaXMuZWFzaW5nXShwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwogICAgICB9CiAgICAgIHRoaXMubm93ID0gKHRoaXMuZW5kIC0gdGhpcy5zdGFydCkgKiBlYXNlZCArIHRoaXMuc3RhcnQ7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RlcCkgewogICAgICAgIHRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLCB0aGlzLm5vdywgdGhpcyk7CiAgICAgIH0KICAgICAgaWYgKGhvb2tzICYmIGhvb2tzLnNldCkgewogICAgICAgIGhvb2tzLnNldCh0aGlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgVHdlZW4ucHJvdG90eXBlLmluaXQucHJvdG90eXBlID0gVHdlZW4ucHJvdG90eXBlOwogIFR3ZWVuLnByb3BIb29rcyA9IHsKICAgIF9kZWZhdWx0OiB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KHR3ZWVuKSB7CiAgICAgICAgdmFyIHJlc3VsdDsKCiAgICAgICAgLy8gVXNlIGEgcHJvcGVydHkgb24gdGhlIGVsZW1lbnQgZGlyZWN0bHkgd2hlbiBpdCBpcyBub3QgYSBET00gZWxlbWVudCwKICAgICAgICAvLyBvciB3aGVuIHRoZXJlIGlzIG5vIG1hdGNoaW5nIHN0eWxlIHByb3BlcnR5IHRoYXQgZXhpc3RzLgogICAgICAgIGlmICh0d2Vlbi5lbGVtLm5vZGVUeXBlICE9PSAxIHx8IHR3ZWVuLmVsZW1bdHdlZW4ucHJvcF0gIT0gbnVsbCAmJiB0d2Vlbi5lbGVtLnN0eWxlW3R3ZWVuLnByb3BdID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiB0d2Vlbi5lbGVtW3R3ZWVuLnByb3BdOwogICAgICAgIH0KCiAgICAgICAgLy8gUGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CiAgICAgICAgLy8gYXR0ZW1wdCBhIHBhcnNlRmxvYXQgYW5kIGZhbGxiYWNrIHRvIGEgc3RyaW5nIGlmIHRoZSBwYXJzZSBmYWlscy4KICAgICAgICAvLyBTaW1wbGUgdmFsdWVzIHN1Y2ggYXMgIjEwcHgiIGFyZSBwYXJzZWQgdG8gRmxvYXQ7CiAgICAgICAgLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMtaXMuCiAgICAgICAgcmVzdWx0ID0galF1ZXJ5LmNzcyh0d2Vlbi5lbGVtLCB0d2Vlbi5wcm9wLCAiIik7CgogICAgICAgIC8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgImF1dG8iIGFyZSBjb252ZXJ0ZWQgdG8gMC4KICAgICAgICByZXR1cm4gIXJlc3VsdCB8fCByZXN1bHQgPT09ICJhdXRvIiA/IDAgOiByZXN1bHQ7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHR3ZWVuKSB7CiAgICAgICAgLy8gVXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQuCiAgICAgICAgLy8gVXNlIGNzc0hvb2sgaWYgaXRzIHRoZXJlLgogICAgICAgIC8vIFVzZSAuc3R5bGUgaWYgYXZhaWxhYmxlIGFuZCB1c2UgcGxhaW4gcHJvcGVydGllcyB3aGVyZSBhdmFpbGFibGUuCiAgICAgICAgaWYgKGpRdWVyeS5meC5zdGVwW3R3ZWVuLnByb3BdKSB7CiAgICAgICAgICBqUXVlcnkuZnguc3RlcFt0d2Vlbi5wcm9wXSh0d2Vlbik7CiAgICAgICAgfSBlbHNlIGlmICh0d2Vlbi5lbGVtLm5vZGVUeXBlID09PSAxICYmIChqUXVlcnkuY3NzSG9va3NbdHdlZW4ucHJvcF0gfHwgdHdlZW4uZWxlbS5zdHlsZVtmaW5hbFByb3BOYW1lKHR3ZWVuLnByb3ApXSAhPSBudWxsKSkgewogICAgICAgICAgalF1ZXJ5LnN0eWxlKHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsIHR3ZWVuLm5vdyArIHR3ZWVuLnVuaXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0d2Vlbi5lbGVtW3R3ZWVuLnByb3BdID0gdHdlZW4ubm93OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vIFN1cHBvcnQ6IElFIDw9OSBvbmx5CiAgLy8gUGFuaWMgYmFzZWQgYXBwcm9hY2ggdG8gc2V0dGluZyB0aGluZ3Mgb24gZGlzY29ubmVjdGVkIG5vZGVzCiAgVHdlZW4ucHJvcEhvb2tzLnNjcm9sbFRvcCA9IFR3ZWVuLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewogICAgc2V0OiBmdW5jdGlvbiBzZXQodHdlZW4pIHsKICAgICAgaWYgKHR3ZWVuLmVsZW0ubm9kZVR5cGUgJiYgdHdlZW4uZWxlbS5wYXJlbnROb2RlKSB7CiAgICAgICAgdHdlZW4uZWxlbVt0d2Vlbi5wcm9wXSA9IHR3ZWVuLm5vdzsKICAgICAgfQogICAgfQogIH07CiAgalF1ZXJ5LmVhc2luZyA9IHsKICAgIGxpbmVhcjogZnVuY3Rpb24gbGluZWFyKHApIHsKICAgICAgcmV0dXJuIHA7CiAgICB9LAogICAgc3dpbmc6IGZ1bmN0aW9uIHN3aW5nKHApIHsKICAgICAgcmV0dXJuIDAuNSAtIE1hdGguY29zKHAgKiBNYXRoLlBJKSAvIDI7CiAgICB9LAogICAgX2RlZmF1bHQ6ICJzd2luZyIKICB9OwogIGpRdWVyeS5meCA9IFR3ZWVuLnByb3RvdHlwZS5pbml0OwoKICAvLyBCYWNrIGNvbXBhdCA8MS44IGV4dGVuc2lvbiBwb2ludAogIGpRdWVyeS5meC5zdGVwID0ge307CiAgdmFyIGZ4Tm93LAogICAgaW5Qcm9ncmVzcywKICAgIHJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAogICAgcnJ1biA9IC9xdWV1ZUhvb2tzJC87CiAgZnVuY3Rpb24gc2NoZWR1bGUoKSB7CiAgICBpZiAoaW5Qcm9ncmVzcykgewogICAgICBpZiAoZG9jdW1lbnQuaGlkZGVuID09PSBmYWxzZSAmJiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKSB7CiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShzY2hlZHVsZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoc2NoZWR1bGUsIGpRdWVyeS5meC5pbnRlcnZhbCk7CiAgICAgIH0KICAgICAgalF1ZXJ5LmZ4LnRpY2soKTsKICAgIH0KICB9CgogIC8vIEFuaW1hdGlvbnMgY3JlYXRlZCBzeW5jaHJvbm91c2x5IHdpbGwgcnVuIHN5bmNocm9ub3VzbHkKICBmdW5jdGlvbiBjcmVhdGVGeE5vdygpIHsKICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgZnhOb3cgPSB1bmRlZmluZWQ7CiAgICB9KTsKICAgIHJldHVybiBmeE5vdyA9IERhdGUubm93KCk7CiAgfQoKICAvLyBHZW5lcmF0ZSBwYXJhbWV0ZXJzIHRvIGNyZWF0ZSBhIHN0YW5kYXJkIGFuaW1hdGlvbgogIGZ1bmN0aW9uIGdlbkZ4KHR5cGUsIGluY2x1ZGVXaWR0aCkgewogICAgdmFyIHdoaWNoLAogICAgICBpID0gMCwKICAgICAgYXR0cnMgPSB7CiAgICAgICAgaGVpZ2h0OiB0eXBlCiAgICAgIH07CgogICAgLy8gSWYgd2UgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAxIHRvIGRvIGFsbCBjc3NFeHBhbmQgdmFsdWVzLAogICAgLy8gb3RoZXJ3aXNlIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKICAgIGluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aCA/IDEgOiAwOwogICAgZm9yICg7IGkgPCA0OyBpICs9IDIgLSBpbmNsdWRlV2lkdGgpIHsKICAgICAgd2hpY2ggPSBjc3NFeHBhbmRbaV07CiAgICAgIGF0dHJzWyJtYXJnaW4iICsgd2hpY2hdID0gYXR0cnNbInBhZGRpbmciICsgd2hpY2hdID0gdHlwZTsKICAgIH0KICAgIGlmIChpbmNsdWRlV2lkdGgpIHsKICAgICAgYXR0cnMub3BhY2l0eSA9IGF0dHJzLndpZHRoID0gdHlwZTsKICAgIH0KICAgIHJldHVybiBhdHRyczsKICB9CiAgZnVuY3Rpb24gY3JlYXRlVHdlZW4odmFsdWUsIHByb3AsIGFuaW1hdGlvbikgewogICAgdmFyIHR3ZWVuLAogICAgICBjb2xsZWN0aW9uID0gKEFuaW1hdGlvbi50d2VlbmVyc1twcm9wXSB8fCBbXSkuY29uY2F0KEFuaW1hdGlvbi50d2VlbmVyc1siKiJdKSwKICAgICAgaW5kZXggPSAwLAogICAgICBsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKICAgIGZvciAoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICBpZiAodHdlZW4gPSBjb2xsZWN0aW9uW2luZGV4XS5jYWxsKGFuaW1hdGlvbiwgcHJvcCwgdmFsdWUpKSB7CiAgICAgICAgLy8gV2UncmUgZG9uZSB3aXRoIHRoaXMgcHJvcGVydHkKICAgICAgICByZXR1cm4gdHdlZW47CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gZGVmYXVsdFByZWZpbHRlcihlbGVtLCBwcm9wcywgb3B0cykgewogICAgdmFyIHByb3AsCiAgICAgIHZhbHVlLAogICAgICB0b2dnbGUsCiAgICAgIGhvb2tzLAogICAgICBvbGRmaXJlLAogICAgICBwcm9wVHdlZW4sCiAgICAgIHJlc3RvcmVEaXNwbGF5LAogICAgICBkaXNwbGF5LAogICAgICBpc0JveCA9ICJ3aWR0aCIgaW4gcHJvcHMgfHwgImhlaWdodCIgaW4gcHJvcHMsCiAgICAgIGFuaW0gPSB0aGlzLAogICAgICBvcmlnID0ge30sCiAgICAgIHN0eWxlID0gZWxlbS5zdHlsZSwKICAgICAgaGlkZGVuID0gZWxlbS5ub2RlVHlwZSAmJiBpc0hpZGRlbldpdGhpblRyZWUoZWxlbSksCiAgICAgIGRhdGFTaG93ID0gZGF0YVByaXYuZ2V0KGVsZW0sICJmeHNob3ciKTsKCiAgICAvLyBRdWV1ZS1za2lwcGluZyBhbmltYXRpb25zIGhpamFjayB0aGUgZnggaG9va3MKICAgIGlmICghb3B0cy5xdWV1ZSkgewogICAgICBob29rcyA9IGpRdWVyeS5fcXVldWVIb29rcyhlbGVtLCAiZngiKTsKICAgICAgaWYgKGhvb2tzLnVucXVldWVkID09IG51bGwpIHsKICAgICAgICBob29rcy51bnF1ZXVlZCA9IDA7CiAgICAgICAgb2xkZmlyZSA9IGhvb2tzLmVtcHR5LmZpcmU7CiAgICAgICAgaG9va3MuZW1wdHkuZmlyZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghaG9va3MudW5xdWV1ZWQpIHsKICAgICAgICAgICAgb2xkZmlyZSgpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgaG9va3MudW5xdWV1ZWQrKzsKICAgICAgYW5pbS5hbHdheXMoZnVuY3Rpb24gKCkgewogICAgICAgIC8vIEVuc3VyZSB0aGUgY29tcGxldGUgaGFuZGxlciBpcyBjYWxsZWQgYmVmb3JlIHRoaXMgY29tcGxldGVzCiAgICAgICAgYW5pbS5hbHdheXMoZnVuY3Rpb24gKCkgewogICAgICAgICAgaG9va3MudW5xdWV1ZWQtLTsKICAgICAgICAgIGlmICghalF1ZXJ5LnF1ZXVlKGVsZW0sICJmeCIpLmxlbmd0aCkgewogICAgICAgICAgICBob29rcy5lbXB0eS5maXJlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIERldGVjdCBzaG93L2hpZGUgYW5pbWF0aW9ucwogICAgZm9yIChwcm9wIGluIHByb3BzKSB7CiAgICAgIHZhbHVlID0gcHJvcHNbcHJvcF07CiAgICAgIGlmIChyZnh0eXBlcy50ZXN0KHZhbHVlKSkgewogICAgICAgIGRlbGV0ZSBwcm9wc1twcm9wXTsKICAgICAgICB0b2dnbGUgPSB0b2dnbGUgfHwgdmFsdWUgPT09ICJ0b2dnbGUiOwogICAgICAgIGlmICh2YWx1ZSA9PT0gKGhpZGRlbiA/ICJoaWRlIiA6ICJzaG93IikpIHsKICAgICAgICAgIC8vIFByZXRlbmQgdG8gYmUgaGlkZGVuIGlmIHRoaXMgaXMgYSAic2hvdyIgYW5kCiAgICAgICAgICAvLyB0aGVyZSBpcyBzdGlsbCBkYXRhIGZyb20gYSBzdG9wcGVkIHNob3cvaGlkZQogICAgICAgICAgaWYgKHZhbHVlID09PSAic2hvdyIgJiYgZGF0YVNob3cgJiYgZGF0YVNob3dbcHJvcF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBoaWRkZW4gPSB0cnVlOwoKICAgICAgICAgICAgLy8gSWdub3JlIGFsbCBvdGhlciBuby1vcCBzaG93L2hpZGUgZGF0YQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG9yaWdbcHJvcF0gPSBkYXRhU2hvdyAmJiBkYXRhU2hvd1twcm9wXSB8fCBqUXVlcnkuc3R5bGUoZWxlbSwgcHJvcCk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBCYWlsIG91dCBpZiB0aGlzIGlzIGEgbm8tb3AgbGlrZSAuaGlkZSgpLmhpZGUoKQogICAgcHJvcFR3ZWVuID0gIWpRdWVyeS5pc0VtcHR5T2JqZWN0KHByb3BzKTsKICAgIGlmICghcHJvcFR3ZWVuICYmIGpRdWVyeS5pc0VtcHR5T2JqZWN0KG9yaWcpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBSZXN0cmljdCAib3ZlcmZsb3ciIGFuZCAiZGlzcGxheSIgc3R5bGVzIGR1cmluZyBib3ggYW5pbWF0aW9ucwogICAgaWYgKGlzQm94ICYmIGVsZW0ubm9kZVR5cGUgPT09IDEpIHsKICAgICAgLy8gU3VwcG9ydDogSUUgPD05IC0gMTEsIEVkZ2UgMTIgLSAxNQogICAgICAvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFIGRvZXMgbm90IGluZmVyIHRoZSBzaG9ydGhhbmQKICAgICAgLy8gZnJvbSBpZGVudGljYWxseS12YWx1ZWQgb3ZlcmZsb3dYIGFuZCBvdmVyZmxvd1kgYW5kIEVkZ2UganVzdCBtaXJyb3JzCiAgICAgIC8vIHRoZSBvdmVyZmxvd1ggdmFsdWUgdGhlcmUuCiAgICAgIG9wdHMub3ZlcmZsb3cgPSBbc3R5bGUub3ZlcmZsb3csIHN0eWxlLm92ZXJmbG93WCwgc3R5bGUub3ZlcmZsb3dZXTsKCiAgICAgIC8vIElkZW50aWZ5IGEgZGlzcGxheSB0eXBlLCBwcmVmZXJyaW5nIG9sZCBzaG93L2hpZGUgZGF0YSBvdmVyIHRoZSBDU1MgY2FzY2FkZQogICAgICByZXN0b3JlRGlzcGxheSA9IGRhdGFTaG93ICYmIGRhdGFTaG93LmRpc3BsYXk7CiAgICAgIGlmIChyZXN0b3JlRGlzcGxheSA9PSBudWxsKSB7CiAgICAgICAgcmVzdG9yZURpc3BsYXkgPSBkYXRhUHJpdi5nZXQoZWxlbSwgImRpc3BsYXkiKTsKICAgICAgfQogICAgICBkaXNwbGF5ID0galF1ZXJ5LmNzcyhlbGVtLCAiZGlzcGxheSIpOwogICAgICBpZiAoZGlzcGxheSA9PT0gIm5vbmUiKSB7CiAgICAgICAgaWYgKHJlc3RvcmVEaXNwbGF5KSB7CiAgICAgICAgICBkaXNwbGF5ID0gcmVzdG9yZURpc3BsYXk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIEdldCBub25lbXB0eSB2YWx1ZShzKSBieSB0ZW1wb3JhcmlseSBmb3JjaW5nIHZpc2liaWxpdHkKICAgICAgICAgIHNob3dIaWRlKFtlbGVtXSwgdHJ1ZSk7CiAgICAgICAgICByZXN0b3JlRGlzcGxheSA9IGVsZW0uc3R5bGUuZGlzcGxheSB8fCByZXN0b3JlRGlzcGxheTsKICAgICAgICAgIGRpc3BsYXkgPSBqUXVlcnkuY3NzKGVsZW0sICJkaXNwbGF5Iik7CiAgICAgICAgICBzaG93SGlkZShbZWxlbV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gQW5pbWF0ZSBpbmxpbmUgZWxlbWVudHMgYXMgaW5saW5lLWJsb2NrCiAgICAgIGlmIChkaXNwbGF5ID09PSAiaW5saW5lIiB8fCBkaXNwbGF5ID09PSAiaW5saW5lLWJsb2NrIiAmJiByZXN0b3JlRGlzcGxheSAhPSBudWxsKSB7CiAgICAgICAgaWYgKGpRdWVyeS5jc3MoZWxlbSwgImZsb2F0IikgPT09ICJub25lIikgewogICAgICAgICAgLy8gUmVzdG9yZSB0aGUgb3JpZ2luYWwgZGlzcGxheSB2YWx1ZSBhdCB0aGUgZW5kIG9mIHB1cmUgc2hvdy9oaWRlIGFuaW1hdGlvbnMKICAgICAgICAgIGlmICghcHJvcFR3ZWVuKSB7CiAgICAgICAgICAgIGFuaW0uZG9uZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgc3R5bGUuZGlzcGxheSA9IHJlc3RvcmVEaXNwbGF5OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKHJlc3RvcmVEaXNwbGF5ID09IG51bGwpIHsKICAgICAgICAgICAgICBkaXNwbGF5ID0gc3R5bGUuZGlzcGxheTsKICAgICAgICAgICAgICByZXN0b3JlRGlzcGxheSA9IGRpc3BsYXkgPT09ICJub25lIiA/ICIiIDogZGlzcGxheTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG9wdHMub3ZlcmZsb3cpIHsKICAgICAgc3R5bGUub3ZlcmZsb3cgPSAiaGlkZGVuIjsKICAgICAgYW5pbS5hbHdheXMoZnVuY3Rpb24gKCkgewogICAgICAgIHN0eWxlLm92ZXJmbG93ID0gb3B0cy5vdmVyZmxvd1swXTsKICAgICAgICBzdHlsZS5vdmVyZmxvd1ggPSBvcHRzLm92ZXJmbG93WzFdOwogICAgICAgIHN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbMl07CiAgICAgIH0pOwogICAgfQoKICAgIC8vIEltcGxlbWVudCBzaG93L2hpZGUgYW5pbWF0aW9ucwogICAgcHJvcFR3ZWVuID0gZmFsc2U7CiAgICBmb3IgKHByb3AgaW4gb3JpZykgewogICAgICAvLyBHZW5lcmFsIHNob3cvaGlkZSBzZXR1cCBmb3IgdGhpcyBlbGVtZW50IGFuaW1hdGlvbgogICAgICBpZiAoIXByb3BUd2VlbikgewogICAgICAgIGlmIChkYXRhU2hvdykgewogICAgICAgICAgaWYgKCJoaWRkZW4iIGluIGRhdGFTaG93KSB7CiAgICAgICAgICAgIGhpZGRlbiA9IGRhdGFTaG93LmhpZGRlbjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YVNob3cgPSBkYXRhUHJpdi5hY2Nlc3MoZWxlbSwgImZ4c2hvdyIsIHsKICAgICAgICAgICAgZGlzcGxheTogcmVzdG9yZURpc3BsYXkKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gU3RvcmUgaGlkZGVuL3Zpc2libGUgZm9yIHRvZ2dsZSBzbyBgLnN0b3AoKS50b2dnbGUoKWAgInJldmVyc2VzIgogICAgICAgIGlmICh0b2dnbGUpIHsKICAgICAgICAgIGRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAvLyBTaG93IGVsZW1lbnRzIGJlZm9yZSBhbmltYXRpbmcgdGhlbQogICAgICAgIGlmIChoaWRkZW4pIHsKICAgICAgICAgIHNob3dIaWRlKFtlbGVtXSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1sb29wLWZ1bmMgKi8KCiAgICAgICAgYW5pbS5kb25lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tbG9vcC1mdW5jICovCgogICAgICAgICAgLy8gVGhlIGZpbmFsIHN0ZXAgb2YgYSAiaGlkZSIgYW5pbWF0aW9uIGlzIGFjdHVhbGx5IGhpZGluZyB0aGUgZWxlbWVudAogICAgICAgICAgaWYgKCFoaWRkZW4pIHsKICAgICAgICAgICAgc2hvd0hpZGUoW2VsZW1dKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGFQcml2LnJlbW92ZShlbGVtLCAiZnhzaG93Iik7CiAgICAgICAgICBmb3IgKHByb3AgaW4gb3JpZykgewogICAgICAgICAgICBqUXVlcnkuc3R5bGUoZWxlbSwgcHJvcCwgb3JpZ1twcm9wXSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIC8vIFBlci1wcm9wZXJ0eSBzZXR1cAogICAgICBwcm9wVHdlZW4gPSBjcmVhdGVUd2VlbihoaWRkZW4gPyBkYXRhU2hvd1twcm9wXSA6IDAsIHByb3AsIGFuaW0pOwogICAgICBpZiAoIShwcm9wIGluIGRhdGFTaG93KSkgewogICAgICAgIGRhdGFTaG93W3Byb3BdID0gcHJvcFR3ZWVuLnN0YXJ0OwogICAgICAgIGlmIChoaWRkZW4pIHsKICAgICAgICAgIHByb3BUd2Vlbi5lbmQgPSBwcm9wVHdlZW4uc3RhcnQ7CiAgICAgICAgICBwcm9wVHdlZW4uc3RhcnQgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBwcm9wRmlsdGVyKHByb3BzLCBzcGVjaWFsRWFzaW5nKSB7CiAgICB2YXIgaW5kZXgsIG5hbWUsIGVhc2luZywgdmFsdWUsIGhvb2tzOwoKICAgIC8vIGNhbWVsQ2FzZSwgc3BlY2lhbEVhc2luZyBhbmQgZXhwYW5kIGNzc0hvb2sgcGFzcwogICAgZm9yIChpbmRleCBpbiBwcm9wcykgewogICAgICBuYW1lID0gY2FtZWxDYXNlKGluZGV4KTsKICAgICAgZWFzaW5nID0gc3BlY2lhbEVhc2luZ1tuYW1lXTsKICAgICAgdmFsdWUgPSBwcm9wc1tpbmRleF07CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgIGVhc2luZyA9IHZhbHVlWzFdOwogICAgICAgIHZhbHVlID0gcHJvcHNbaW5kZXhdID0gdmFsdWVbMF07CiAgICAgIH0KICAgICAgaWYgKGluZGV4ICE9PSBuYW1lKSB7CiAgICAgICAgcHJvcHNbbmFtZV0gPSB2YWx1ZTsKICAgICAgICBkZWxldGUgcHJvcHNbaW5kZXhdOwogICAgICB9CiAgICAgIGhvb2tzID0galF1ZXJ5LmNzc0hvb2tzW25hbWVdOwogICAgICBpZiAoaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MpIHsKICAgICAgICB2YWx1ZSA9IGhvb2tzLmV4cGFuZCh2YWx1ZSk7CiAgICAgICAgZGVsZXRlIHByb3BzW25hbWVdOwoKICAgICAgICAvLyBOb3QgcXVpdGUgJC5leHRlbmQsIHRoaXMgd29uJ3Qgb3ZlcndyaXRlIGV4aXN0aW5nIGtleXMuCiAgICAgICAgLy8gUmV1c2luZyAnaW5kZXgnIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKICAgICAgICBmb3IgKGluZGV4IGluIHZhbHVlKSB7CiAgICAgICAgICBpZiAoIShpbmRleCBpbiBwcm9wcykpIHsKICAgICAgICAgICAgcHJvcHNbaW5kZXhdID0gdmFsdWVbaW5kZXhdOwogICAgICAgICAgICBzcGVjaWFsRWFzaW5nW2luZGV4XSA9IGVhc2luZzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3BlY2lhbEVhc2luZ1tuYW1lXSA9IGVhc2luZzsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBBbmltYXRpb24oZWxlbSwgcHJvcGVydGllcywgb3B0aW9ucykgewogICAgdmFyIHJlc3VsdCwKICAgICAgc3RvcHBlZCwKICAgICAgaW5kZXggPSAwLAogICAgICBsZW5ndGggPSBBbmltYXRpb24ucHJlZmlsdGVycy5sZW5ndGgsCiAgICAgIGRlZmVycmVkID0galF1ZXJ5LkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBEb24ndCBtYXRjaCBlbGVtIGluIHRoZSA6YW5pbWF0ZWQgc2VsZWN0b3IKICAgICAgICBkZWxldGUgdGljay5lbGVtOwogICAgICB9KSwKICAgICAgdGljayA9IGZ1bmN0aW9uIHRpY2soKSB7CiAgICAgICAgaWYgKHN0b3BwZWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIGN1cnJlbnRUaW1lID0gZnhOb3cgfHwgY3JlYXRlRnhOb3coKSwKICAgICAgICAgIHJlbWFpbmluZyA9IE1hdGgubWF4KDAsIGFuaW1hdGlvbi5zdGFydFRpbWUgKyBhbmltYXRpb24uZHVyYXRpb24gLSBjdXJyZW50VGltZSksCiAgICAgICAgICAvLyBTdXBwb3J0OiBBbmRyb2lkIDIuMyBvbmx5CiAgICAgICAgICAvLyBBcmNoYWljIGNyYXNoIGJ1ZyB3b24ndCBhbGxvdyB1cyB0byB1c2UgYDEgLSAoIDAuNSB8fCAwIClgICgjMTI0OTcpCiAgICAgICAgICB0ZW1wID0gcmVtYWluaW5nIC8gYW5pbWF0aW9uLmR1cmF0aW9uIHx8IDAsCiAgICAgICAgICBwZXJjZW50ID0gMSAtIHRlbXAsCiAgICAgICAgICBpbmRleCA9IDAsCiAgICAgICAgICBsZW5ndGggPSBhbmltYXRpb24udHdlZW5zLmxlbmd0aDsKICAgICAgICBmb3IgKDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGFuaW1hdGlvbi50d2VlbnNbaW5kZXhdLnJ1bihwZXJjZW50KTsKICAgICAgICB9CiAgICAgICAgZGVmZXJyZWQubm90aWZ5V2l0aChlbGVtLCBbYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmddKTsKCiAgICAgICAgLy8gSWYgdGhlcmUncyBtb3JlIHRvIGRvLCB5aWVsZAogICAgICAgIGlmIChwZXJjZW50IDwgMSAmJiBsZW5ndGgpIHsKICAgICAgICAgIHJldHVybiByZW1haW5pbmc7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGlzIHdhcyBhbiBlbXB0eSBhbmltYXRpb24sIHN5bnRoZXNpemUgYSBmaW5hbCBwcm9ncmVzcyBub3RpZmljYXRpb24KICAgICAgICBpZiAoIWxlbmd0aCkgewogICAgICAgICAgZGVmZXJyZWQubm90aWZ5V2l0aChlbGVtLCBbYW5pbWF0aW9uLCAxLCAwXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXNvbHZlIHRoZSBhbmltYXRpb24gYW5kIHJlcG9ydCBpdHMgY29uY2x1c2lvbgogICAgICAgIGRlZmVycmVkLnJlc29sdmVXaXRoKGVsZW0sIFthbmltYXRpb25dKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIGFuaW1hdGlvbiA9IGRlZmVycmVkLnByb21pc2UoewogICAgICAgIGVsZW06IGVsZW0sCiAgICAgICAgcHJvcHM6IGpRdWVyeS5leHRlbmQoe30sIHByb3BlcnRpZXMpLAogICAgICAgIG9wdHM6IGpRdWVyeS5leHRlbmQodHJ1ZSwgewogICAgICAgICAgc3BlY2lhbEVhc2luZzoge30sCiAgICAgICAgICBlYXNpbmc6IGpRdWVyeS5lYXNpbmcuX2RlZmF1bHQKICAgICAgICB9LCBvcHRpb25zKSwKICAgICAgICBvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCiAgICAgICAgb3JpZ2luYWxPcHRpb25zOiBvcHRpb25zLAogICAgICAgIHN0YXJ0VGltZTogZnhOb3cgfHwgY3JlYXRlRnhOb3coKSwKICAgICAgICBkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKICAgICAgICB0d2VlbnM6IFtdLAogICAgICAgIGNyZWF0ZVR3ZWVuOiBmdW5jdGlvbiBjcmVhdGVUd2Vlbihwcm9wLCBlbmQpIHsKICAgICAgICAgIHZhciB0d2VlbiA9IGpRdWVyeS5Ud2VlbihlbGVtLCBhbmltYXRpb24ub3B0cywgcHJvcCwgZW5kLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nW3Byb3BdIHx8IGFuaW1hdGlvbi5vcHRzLmVhc2luZyk7CiAgICAgICAgICBhbmltYXRpb24udHdlZW5zLnB1c2godHdlZW4pOwogICAgICAgICAgcmV0dXJuIHR3ZWVuOwogICAgICAgIH0sCiAgICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcChnb3RvRW5kKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSAwLAogICAgICAgICAgICAvLyBJZiB3ZSBhcmUgZ29pbmcgdG8gdGhlIGVuZCwgd2Ugd2FudCB0byBydW4gYWxsIHRoZSB0d2VlbnMKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIHNraXAgdGhpcyBwYXJ0CiAgICAgICAgICAgIGxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CiAgICAgICAgICBpZiAoc3RvcHBlZCkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KICAgICAgICAgIHN0b3BwZWQgPSB0cnVlOwogICAgICAgICAgZm9yICg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgIGFuaW1hdGlvbi50d2VlbnNbaW5kZXhdLnJ1bigxKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBSZXNvbHZlIHdoZW4gd2UgcGxheWVkIHRoZSBsYXN0IGZyYW1lOyBvdGhlcndpc2UsIHJlamVjdAogICAgICAgICAgaWYgKGdvdG9FbmQpIHsKICAgICAgICAgICAgZGVmZXJyZWQubm90aWZ5V2l0aChlbGVtLCBbYW5pbWF0aW9uLCAxLCAwXSk7CiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmVXaXRoKGVsZW0sIFthbmltYXRpb24sIGdvdG9FbmRdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdFdpdGgoZWxlbSwgW2FuaW1hdGlvbiwgZ290b0VuZF0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9KSwKICAgICAgcHJvcHMgPSBhbmltYXRpb24ucHJvcHM7CiAgICBwcm9wRmlsdGVyKHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nKTsKICAgIGZvciAoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICByZXN1bHQgPSBBbmltYXRpb24ucHJlZmlsdGVyc1tpbmRleF0uY2FsbChhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyk7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBpZiAoaXNGdW5jdGlvbihyZXN1bHQuc3RvcCkpIHsKICAgICAgICAgIGpRdWVyeS5fcXVldWVIb29rcyhhbmltYXRpb24uZWxlbSwgYW5pbWF0aW9uLm9wdHMucXVldWUpLnN0b3AgPSByZXN1bHQuc3RvcC5iaW5kKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgIH0KICAgIGpRdWVyeS5tYXAocHJvcHMsIGNyZWF0ZVR3ZWVuLCBhbmltYXRpb24pOwogICAgaWYgKGlzRnVuY3Rpb24oYW5pbWF0aW9uLm9wdHMuc3RhcnQpKSB7CiAgICAgIGFuaW1hdGlvbi5vcHRzLnN0YXJ0LmNhbGwoZWxlbSwgYW5pbWF0aW9uKTsKICAgIH0KCiAgICAvLyBBdHRhY2ggY2FsbGJhY2tzIGZyb20gb3B0aW9ucwogICAgYW5pbWF0aW9uLnByb2dyZXNzKGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzKS5kb25lKGFuaW1hdGlvbi5vcHRzLmRvbmUsIGFuaW1hdGlvbi5vcHRzLmNvbXBsZXRlKS5mYWlsKGFuaW1hdGlvbi5vcHRzLmZhaWwpLmFsd2F5cyhhbmltYXRpb24ub3B0cy5hbHdheXMpOwogICAgalF1ZXJ5LmZ4LnRpbWVyKGpRdWVyeS5leHRlbmQodGljaywgewogICAgICBlbGVtOiBlbGVtLAogICAgICBhbmltOiBhbmltYXRpb24sCiAgICAgIHF1ZXVlOiBhbmltYXRpb24ub3B0cy5xdWV1ZQogICAgfSkpOwogICAgcmV0dXJuIGFuaW1hdGlvbjsKICB9CiAgalF1ZXJ5LkFuaW1hdGlvbiA9IGpRdWVyeS5leHRlbmQoQW5pbWF0aW9uLCB7CiAgICB0d2VlbmVyczogewogICAgICAiKiI6IFtmdW5jdGlvbiAocHJvcCwgdmFsdWUpIHsKICAgICAgICB2YXIgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKHByb3AsIHZhbHVlKTsKICAgICAgICBhZGp1c3RDU1ModHdlZW4uZWxlbSwgcHJvcCwgcmNzc051bS5leGVjKHZhbHVlKSwgdHdlZW4pOwogICAgICAgIHJldHVybiB0d2VlbjsKICAgICAgfV0KICAgIH0sCiAgICB0d2VlbmVyOiBmdW5jdGlvbiB0d2VlbmVyKHByb3BzLCBjYWxsYmFjaykgewogICAgICBpZiAoaXNGdW5jdGlvbihwcm9wcykpIHsKICAgICAgICBjYWxsYmFjayA9IHByb3BzOwogICAgICAgIHByb3BzID0gWyIqIl07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvcHMgPSBwcm9wcy5tYXRjaChybm90aHRtbHdoaXRlKTsKICAgICAgfQogICAgICB2YXIgcHJvcCwKICAgICAgICBpbmRleCA9IDAsCiAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwogICAgICBmb3IgKDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHsKICAgICAgICBwcm9wID0gcHJvcHNbaW5kZXhdOwogICAgICAgIEFuaW1hdGlvbi50d2VlbmVyc1twcm9wXSA9IEFuaW1hdGlvbi50d2VlbmVyc1twcm9wXSB8fCBbXTsKICAgICAgICBBbmltYXRpb24udHdlZW5lcnNbcHJvcF0udW5zaGlmdChjYWxsYmFjayk7CiAgICAgIH0KICAgIH0sCiAgICBwcmVmaWx0ZXJzOiBbZGVmYXVsdFByZWZpbHRlcl0sCiAgICBwcmVmaWx0ZXI6IGZ1bmN0aW9uIHByZWZpbHRlcihjYWxsYmFjaywgcHJlcGVuZCkgewogICAgICBpZiAocHJlcGVuZCkgewogICAgICAgIEFuaW1hdGlvbi5wcmVmaWx0ZXJzLnVuc2hpZnQoY2FsbGJhY2spOwogICAgICB9IGVsc2UgewogICAgICAgIEFuaW1hdGlvbi5wcmVmaWx0ZXJzLnB1c2goY2FsbGJhY2spOwogICAgICB9CiAgICB9CiAgfSk7CiAgalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24gKHNwZWVkLCBlYXNpbmcsIGZuKSB7CiAgICB2YXIgb3B0ID0gc3BlZWQgJiYgX3R5cGVvZihzcGVlZCkgPT09ICJvYmplY3QiID8galF1ZXJ5LmV4dGVuZCh7fSwgc3BlZWQpIDogewogICAgICBjb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fCBpc0Z1bmN0aW9uKHNwZWVkKSAmJiBzcGVlZCwKICAgICAgZHVyYXRpb246IHNwZWVkLAogICAgICBlYXNpbmc6IGZuICYmIGVhc2luZyB8fCBlYXNpbmcgJiYgIWlzRnVuY3Rpb24oZWFzaW5nKSAmJiBlYXNpbmcKICAgIH07CgogICAgLy8gR28gdG8gdGhlIGVuZCBzdGF0ZSBpZiBmeCBhcmUgb2ZmCiAgICBpZiAoalF1ZXJ5LmZ4Lm9mZikgewogICAgICBvcHQuZHVyYXRpb24gPSAwOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHR5cGVvZiBvcHQuZHVyYXRpb24gIT09ICJudW1iZXIiKSB7CiAgICAgICAgaWYgKG9wdC5kdXJhdGlvbiBpbiBqUXVlcnkuZnguc3BlZWRzKSB7CiAgICAgICAgICBvcHQuZHVyYXRpb24gPSBqUXVlcnkuZnguc3BlZWRzW29wdC5kdXJhdGlvbl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5zcGVlZHMuX2RlZmF1bHQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gTm9ybWFsaXplIG9wdC5xdWV1ZSAtIHRydWUvdW5kZWZpbmVkL251bGwgLT4gImZ4IgogICAgaWYgKG9wdC5xdWV1ZSA9PSBudWxsIHx8IG9wdC5xdWV1ZSA9PT0gdHJ1ZSkgewogICAgICBvcHQucXVldWUgPSAiZngiOwogICAgfQoKICAgIC8vIFF1ZXVlaW5nCiAgICBvcHQub2xkID0gb3B0LmNvbXBsZXRlOwogICAgb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoaXNGdW5jdGlvbihvcHQub2xkKSkgewogICAgICAgIG9wdC5vbGQuY2FsbCh0aGlzKTsKICAgICAgfQogICAgICBpZiAob3B0LnF1ZXVlKSB7CiAgICAgICAgalF1ZXJ5LmRlcXVldWUodGhpcywgb3B0LnF1ZXVlKTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiBvcHQ7CiAgfTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGZhZGVUbzogZnVuY3Rpb24gZmFkZVRvKHNwZWVkLCB0bywgZWFzaW5nLCBjYWxsYmFjaykgewogICAgICAvLyBTaG93IGFueSBoaWRkZW4gZWxlbWVudHMgYWZ0ZXIgc2V0dGluZyBvcGFjaXR5IHRvIDAKICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyKGlzSGlkZGVuV2l0aGluVHJlZSkuY3NzKCJvcGFjaXR5IiwgMCkuc2hvdygpCgogICAgICAvLyBBbmltYXRlIHRvIHRoZSB2YWx1ZSBzcGVjaWZpZWQKICAgICAgLmVuZCgpLmFuaW1hdGUoewogICAgICAgIG9wYWNpdHk6IHRvCiAgICAgIH0sIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrKTsKICAgIH0sCiAgICBhbmltYXRlOiBmdW5jdGlvbiBhbmltYXRlKHByb3AsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBlbXB0eSA9IGpRdWVyeS5pc0VtcHR5T2JqZWN0KHByb3ApLAogICAgICAgIG9wdGFsbCA9IGpRdWVyeS5zcGVlZChzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayksCiAgICAgICAgZG9BbmltYXRpb24gPSBmdW5jdGlvbiBkb0FuaW1hdGlvbigpIHsKICAgICAgICAgIC8vIE9wZXJhdGUgb24gYSBjb3B5IG9mIHByb3Agc28gcGVyLXByb3BlcnR5IGVhc2luZyB3b24ndCBiZSBsb3N0CiAgICAgICAgICB2YXIgYW5pbSA9IEFuaW1hdGlvbih0aGlzLCBqUXVlcnkuZXh0ZW5kKHt9LCBwcm9wKSwgb3B0YWxsKTsKCiAgICAgICAgICAvLyBFbXB0eSBhbmltYXRpb25zLCBvciBmaW5pc2hpbmcgcmVzb2x2ZXMgaW1tZWRpYXRlbHkKICAgICAgICAgIGlmIChlbXB0eSB8fCBkYXRhUHJpdi5nZXQodGhpcywgImZpbmlzaCIpKSB7CiAgICAgICAgICAgIGFuaW0uc3RvcCh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICBkb0FuaW1hdGlvbi5maW5pc2ggPSBkb0FuaW1hdGlvbjsKICAgICAgcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPyB0aGlzLmVhY2goZG9BbmltYXRpb24pIDogdGhpcy5xdWV1ZShvcHRhbGwucXVldWUsIGRvQW5pbWF0aW9uKTsKICAgIH0sCiAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQpIHsKICAgICAgdmFyIHN0b3BRdWV1ZSA9IGZ1bmN0aW9uIHN0b3BRdWV1ZShob29rcykgewogICAgICAgIHZhciBzdG9wID0gaG9va3Muc3RvcDsKICAgICAgICBkZWxldGUgaG9va3Muc3RvcDsKICAgICAgICBzdG9wKGdvdG9FbmQpOwogICAgICB9OwogICAgICBpZiAodHlwZW9mIHR5cGUgIT09ICJzdHJpbmciKSB7CiAgICAgICAgZ290b0VuZCA9IGNsZWFyUXVldWU7CiAgICAgICAgY2xlYXJRdWV1ZSA9IHR5cGU7CiAgICAgICAgdHlwZSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBpZiAoY2xlYXJRdWV1ZSkgewogICAgICAgIHRoaXMucXVldWUodHlwZSB8fCAiZngiLCBbXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRlcXVldWUgPSB0cnVlLAogICAgICAgICAgaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwKICAgICAgICAgIHRpbWVycyA9IGpRdWVyeS50aW1lcnMsCiAgICAgICAgICBkYXRhID0gZGF0YVByaXYuZ2V0KHRoaXMpOwogICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgaWYgKGRhdGFbaW5kZXhdICYmIGRhdGFbaW5kZXhdLnN0b3ApIHsKICAgICAgICAgICAgc3RvcFF1ZXVlKGRhdGFbaW5kZXhdKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChpbmRleCBpbiBkYXRhKSB7CiAgICAgICAgICAgIGlmIChkYXRhW2luZGV4XSAmJiBkYXRhW2luZGV4XS5zdG9wICYmIHJydW4udGVzdChpbmRleCkpIHsKICAgICAgICAgICAgICBzdG9wUXVldWUoZGF0YVtpbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOykgewogICAgICAgICAgaWYgKHRpbWVyc1tpbmRleF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1tpbmRleF0ucXVldWUgPT09IHR5cGUpKSB7CiAgICAgICAgICAgIHRpbWVyc1tpbmRleF0uYW5pbS5zdG9wKGdvdG9FbmQpOwogICAgICAgICAgICBkZXF1ZXVlID0gZmFsc2U7CiAgICAgICAgICAgIHRpbWVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gU3RhcnQgdGhlIG5leHQgaW4gdGhlIHF1ZXVlIGlmIHRoZSBsYXN0IHN0ZXAgd2Fzbid0IGZvcmNlZC4KICAgICAgICAvLyBUaW1lcnMgY3VycmVudGx5IHdpbGwgY2FsbCB0aGVpciBjb21wbGV0ZSBjYWxsYmFja3MsIHdoaWNoCiAgICAgICAgLy8gd2lsbCBkZXF1ZXVlIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kLgogICAgICAgIGlmIChkZXF1ZXVlIHx8ICFnb3RvRW5kKSB7CiAgICAgICAgICBqUXVlcnkuZGVxdWV1ZSh0aGlzLCB0eXBlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHR5cGUpIHsKICAgICAgaWYgKHR5cGUgIT09IGZhbHNlKSB7CiAgICAgICAgdHlwZSA9IHR5cGUgfHwgImZ4IjsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaW5kZXgsCiAgICAgICAgICBkYXRhID0gZGF0YVByaXYuZ2V0KHRoaXMpLAogICAgICAgICAgcXVldWUgPSBkYXRhW3R5cGUgKyAicXVldWUiXSwKICAgICAgICAgIGhvb2tzID0gZGF0YVt0eXBlICsgInF1ZXVlSG9va3MiXSwKICAgICAgICAgIHRpbWVycyA9IGpRdWVyeS50aW1lcnMsCiAgICAgICAgICBsZW5ndGggPSBxdWV1ZSA/IHF1ZXVlLmxlbmd0aCA6IDA7CgogICAgICAgIC8vIEVuYWJsZSBmaW5pc2hpbmcgZmxhZyBvbiBwcml2YXRlIGRhdGEKICAgICAgICBkYXRhLmZpbmlzaCA9IHRydWU7CgogICAgICAgIC8vIEVtcHR5IHRoZSBxdWV1ZSBmaXJzdAogICAgICAgIGpRdWVyeS5xdWV1ZSh0aGlzLCB0eXBlLCBbXSk7CiAgICAgICAgaWYgKGhvb2tzICYmIGhvb2tzLnN0b3ApIHsKICAgICAgICAgIGhvb2tzLnN0b3AuY2FsbCh0aGlzLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIC8vIExvb2sgZm9yIGFueSBhY3RpdmUgYW5pbWF0aW9ucywgYW5kIGZpbmlzaCB0aGVtCiAgICAgICAgZm9yIChpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07KSB7CiAgICAgICAgICBpZiAodGltZXJzW2luZGV4XS5lbGVtID09PSB0aGlzICYmIHRpbWVyc1tpbmRleF0ucXVldWUgPT09IHR5cGUpIHsKICAgICAgICAgICAgdGltZXJzW2luZGV4XS5hbmltLnN0b3AodHJ1ZSk7CiAgICAgICAgICAgIHRpbWVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gTG9vayBmb3IgYW55IGFuaW1hdGlvbnMgaW4gdGhlIG9sZCBxdWV1ZSBhbmQgZmluaXNoIHRoZW0KICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGlmIChxdWV1ZVtpbmRleF0gJiYgcXVldWVbaW5kZXhdLmZpbmlzaCkgewogICAgICAgICAgICBxdWV1ZVtpbmRleF0uZmluaXNoLmNhbGwodGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBUdXJuIG9mZiBmaW5pc2hpbmcgZmxhZwogICAgICAgIGRlbGV0ZSBkYXRhLmZpbmlzaDsKICAgICAgfSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmVhY2goWyJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIl0sIGZ1bmN0aW9uIChfaSwgbmFtZSkgewogICAgdmFyIGNzc0ZuID0galF1ZXJ5LmZuW25hbWVdOwogICAgalF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24gKHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiBzcGVlZCA9PSBudWxsIHx8IHR5cGVvZiBzcGVlZCA9PT0gImJvb2xlYW4iID8gY3NzRm4uYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IHRoaXMuYW5pbWF0ZShnZW5GeChuYW1lLCB0cnVlKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2spOwogICAgfTsKICB9KTsKCiAgLy8gR2VuZXJhdGUgc2hvcnRjdXRzIGZvciBjdXN0b20gYW5pbWF0aW9ucwogIGpRdWVyeS5lYWNoKHsKICAgIHNsaWRlRG93bjogZ2VuRngoInNob3ciKSwKICAgIHNsaWRlVXA6IGdlbkZ4KCJoaWRlIiksCiAgICBzbGlkZVRvZ2dsZTogZ2VuRngoInRvZ2dsZSIpLAogICAgZmFkZUluOiB7CiAgICAgIG9wYWNpdHk6ICJzaG93IgogICAgfSwKICAgIGZhZGVPdXQ6IHsKICAgICAgb3BhY2l0eTogImhpZGUiCiAgICB9LAogICAgZmFkZVRvZ2dsZTogewogICAgICBvcGFjaXR5OiAidG9nZ2xlIgogICAgfQogIH0sIGZ1bmN0aW9uIChuYW1lLCBwcm9wcykgewogICAgalF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24gKHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiB0aGlzLmFuaW1hdGUocHJvcHMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrKTsKICAgIH07CiAgfSk7CiAgalF1ZXJ5LnRpbWVycyA9IFtdOwogIGpRdWVyeS5meC50aWNrID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHRpbWVyLAogICAgICBpID0gMCwKICAgICAgdGltZXJzID0galF1ZXJ5LnRpbWVyczsKICAgIGZ4Tm93ID0gRGF0ZS5ub3coKTsKICAgIGZvciAoOyBpIDwgdGltZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHRpbWVyID0gdGltZXJzW2ldOwoKICAgICAgLy8gUnVuIHRoZSB0aW1lciBhbmQgc2FmZWx5IHJlbW92ZSBpdCB3aGVuIGRvbmUgKGFsbG93aW5nIGZvciBleHRlcm5hbCByZW1vdmFsKQogICAgICBpZiAoIXRpbWVyKCkgJiYgdGltZXJzW2ldID09PSB0aW1lcikgewogICAgICAgIHRpbWVycy5zcGxpY2UoaS0tLCAxKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aW1lcnMubGVuZ3RoKSB7CiAgICAgIGpRdWVyeS5meC5zdG9wKCk7CiAgICB9CiAgICBmeE5vdyA9IHVuZGVmaW5lZDsKICB9OwogIGpRdWVyeS5meC50aW1lciA9IGZ1bmN0aW9uICh0aW1lcikgewogICAgalF1ZXJ5LnRpbWVycy5wdXNoKHRpbWVyKTsKICAgIGpRdWVyeS5meC5zdGFydCgpOwogIH07CiAgalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CiAgalF1ZXJ5LmZ4LnN0YXJ0ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKGluUHJvZ3Jlc3MpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaW5Qcm9ncmVzcyA9IHRydWU7CiAgICBzY2hlZHVsZSgpOwogIH07CiAgalF1ZXJ5LmZ4LnN0b3AgPSBmdW5jdGlvbiAoKSB7CiAgICBpblByb2dyZXNzID0gbnVsbDsKICB9OwogIGpRdWVyeS5meC5zcGVlZHMgPSB7CiAgICBzbG93OiA2MDAsCiAgICBmYXN0OiAyMDAsCiAgICAvLyBEZWZhdWx0IHNwZWVkCiAgICBfZGVmYXVsdDogNDAwCiAgfTsKCiAgLy8gQmFzZWQgb2ZmIG9mIHRoZSBwbHVnaW4gYnkgQ2xpbnQgSGVsZmVycywgd2l0aCBwZXJtaXNzaW9uLgogIC8vIGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDEwMDMyNDAxNDc0Ny9odHRwOi8vYmxpbmRzaWduYWxzLmNvbS9pbmRleC5waHAvMjAwOS8wNy9qcXVlcnktZGVsYXkvCiAgalF1ZXJ5LmZuLmRlbGF5ID0gZnVuY3Rpb24gKHRpbWUsIHR5cGUpIHsKICAgIHRpbWUgPSBqUXVlcnkuZnggPyBqUXVlcnkuZnguc3BlZWRzW3RpbWVdIHx8IHRpbWUgOiB0aW1lOwogICAgdHlwZSA9IHR5cGUgfHwgImZ4IjsKICAgIHJldHVybiB0aGlzLnF1ZXVlKHR5cGUsIGZ1bmN0aW9uIChuZXh0LCBob29rcykgewogICAgICB2YXIgdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KG5leHQsIHRpbWUpOwogICAgICBob29rcy5zdG9wID0gZnVuY3Rpb24gKCkgewogICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgIH07CiAgICB9KTsKICB9OwogIChmdW5jdGlvbiAoKSB7CiAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLAogICAgICBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSwKICAgICAgb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKTsKICAgIGlucHV0LnR5cGUgPSAiY2hlY2tib3giOwoKICAgIC8vIFN1cHBvcnQ6IEFuZHJvaWQgPD00LjMgb25seQogICAgLy8gRGVmYXVsdCB2YWx1ZSBmb3IgYSBjaGVja2JveCBzaG91bGQgYmUgIm9uIgogICAgc3VwcG9ydC5jaGVja09uID0gaW5wdXQudmFsdWUgIT09ICIiOwoKICAgIC8vIFN1cHBvcnQ6IElFIDw9MTEgb25seQogICAgLy8gTXVzdCBhY2Nlc3Mgc2VsZWN0ZWRJbmRleCB0byBtYWtlIGRlZmF1bHQgb3B0aW9ucyBzZWxlY3QKICAgIHN1cHBvcnQub3B0U2VsZWN0ZWQgPSBvcHQuc2VsZWN0ZWQ7CgogICAgLy8gU3VwcG9ydDogSUUgPD0xMSBvbmx5CiAgICAvLyBBbiBpbnB1dCBsb3NlcyBpdHMgdmFsdWUgYWZ0ZXIgYmVjb21pbmcgYSByYWRpbwogICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgaW5wdXQudmFsdWUgPSAidCI7CiAgICBpbnB1dC50eXBlID0gInJhZGlvIjsKICAgIHN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7CiAgfSkoKTsKICB2YXIgYm9vbEhvb2ssCiAgICBhdHRySGFuZGxlID0galF1ZXJ5LmV4cHIuYXR0ckhhbmRsZTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGF0dHI6IGZ1bmN0aW9uIGF0dHIobmFtZSwgdmFsdWUpIHsKICAgICAgcmV0dXJuIGFjY2Vzcyh0aGlzLCBqUXVlcnkuYXR0ciwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxKTsKICAgIH0sCiAgICByZW1vdmVBdHRyOiBmdW5jdGlvbiByZW1vdmVBdHRyKG5hbWUpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgalF1ZXJ5LnJlbW92ZUF0dHIodGhpcywgbmFtZSk7CiAgICAgIH0pOwogICAgfQogIH0pOwogIGpRdWVyeS5leHRlbmQoewogICAgYXR0cjogZnVuY3Rpb24gYXR0cihlbGVtLCBuYW1lLCB2YWx1ZSkgewogICAgICB2YXIgcmV0LAogICAgICAgIGhvb2tzLAogICAgICAgIG5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCiAgICAgIC8vIERvbid0IGdldC9zZXQgYXR0cmlidXRlcyBvbiB0ZXh0LCBjb21tZW50IGFuZCBhdHRyaWJ1dGUgbm9kZXMKICAgICAgaWYgKG5UeXBlID09PSAzIHx8IG5UeXBlID09PSA4IHx8IG5UeXBlID09PSAyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBGYWxsYmFjayB0byBwcm9wIHdoZW4gYXR0cmlidXRlcyBhcmUgbm90IHN1cHBvcnRlZAogICAgICBpZiAodHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlID09PSAidW5kZWZpbmVkIikgewogICAgICAgIHJldHVybiBqUXVlcnkucHJvcChlbGVtLCBuYW1lLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIC8vIEF0dHJpYnV0ZSBob29rcyBhcmUgZGV0ZXJtaW5lZCBieSB0aGUgbG93ZXJjYXNlIHZlcnNpb24KICAgICAgLy8gR3JhYiBuZWNlc3NhcnkgaG9vayBpZiBvbmUgaXMgZGVmaW5lZAogICAgICBpZiAoblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyhlbGVtKSkgewogICAgICAgIGhvb2tzID0galF1ZXJ5LmF0dHJIb29rc1tuYW1lLnRvTG93ZXJDYXNlKCldIHx8IChqUXVlcnkuZXhwci5tYXRjaC5ib29sLnRlc3QobmFtZSkgPyBib29sSG9vayA6IHVuZGVmaW5lZCk7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgIGpRdWVyeS5yZW1vdmVBdHRyKGVsZW0sIG5hbWUpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldChlbGVtLCB2YWx1ZSwgbmFtZSkpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQogICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlICsgIiIpOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICBpZiAoaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldChlbGVtLCBuYW1lKSkgIT09IG51bGwpIHsKICAgICAgICByZXR1cm4gcmV0OwogICAgICB9CiAgICAgIHJldCA9IGpRdWVyeS5maW5kLmF0dHIoZWxlbSwgbmFtZSk7CgogICAgICAvLyBOb24tZXhpc3RlbnQgYXR0cmlidXRlcyByZXR1cm4gbnVsbCwgd2Ugbm9ybWFsaXplIHRvIHVuZGVmaW5lZAogICAgICByZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CiAgICB9LAogICAgYXR0ckhvb2tzOiB7CiAgICAgIHR5cGU6IHsKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSkgewogICAgICAgICAgaWYgKCFzdXBwb3J0LnJhZGlvVmFsdWUgJiYgdmFsdWUgPT09ICJyYWRpbyIgJiYgbm9kZU5hbWUoZWxlbSwgImlucHV0IikpIHsKICAgICAgICAgICAgdmFyIHZhbCA9IGVsZW0udmFsdWU7CiAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCJ0eXBlIiwgdmFsdWUpOwogICAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgICAgZWxlbS52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcmVtb3ZlQXR0cjogZnVuY3Rpb24gcmVtb3ZlQXR0cihlbGVtLCB2YWx1ZSkgewogICAgICB2YXIgbmFtZSwKICAgICAgICBpID0gMCwKICAgICAgICAvLyBBdHRyaWJ1dGUgbmFtZXMgY2FuIGNvbnRhaW4gbm9uLUhUTUwgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzCiAgICAgICAgLy8gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uvc3ludGF4Lmh0bWwjYXR0cmlidXRlcy0yCiAgICAgICAgYXR0ck5hbWVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2gocm5vdGh0bWx3aGl0ZSk7CiAgICAgIGlmIChhdHRyTmFtZXMgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSkgewogICAgICAgIHdoaWxlIChuYW1lID0gYXR0ck5hbWVzW2krK10pIHsKICAgICAgICAgIGVsZW0ucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwoKICAvLyBIb29rcyBmb3IgYm9vbGVhbiBhdHRyaWJ1dGVzCiAgYm9vbEhvb2sgPSB7CiAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSwgbmFtZSkgewogICAgICBpZiAodmFsdWUgPT09IGZhbHNlKSB7CiAgICAgICAgLy8gUmVtb3ZlIGJvb2xlYW4gYXR0cmlidXRlcyB3aGVuIHNldCB0byBmYWxzZQogICAgICAgIGpRdWVyeS5yZW1vdmVBdHRyKGVsZW0sIG5hbWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKG5hbWUsIG5hbWUpOwogICAgICB9CiAgICAgIHJldHVybiBuYW1lOwogICAgfQogIH07CiAgalF1ZXJ5LmVhY2goalF1ZXJ5LmV4cHIubWF0Y2guYm9vbC5zb3VyY2UubWF0Y2goL1x3Ky9nKSwgZnVuY3Rpb24gKF9pLCBuYW1lKSB7CiAgICB2YXIgZ2V0dGVyID0gYXR0ckhhbmRsZVtuYW1lXSB8fCBqUXVlcnkuZmluZC5hdHRyOwogICAgYXR0ckhhbmRsZVtuYW1lXSA9IGZ1bmN0aW9uIChlbGVtLCBuYW1lLCBpc1hNTCkgewogICAgICB2YXIgcmV0LAogICAgICAgIGhhbmRsZSwKICAgICAgICBsb3dlcmNhc2VOYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICBpZiAoIWlzWE1MKSB7CiAgICAgICAgLy8gQXZvaWQgYW4gaW5maW5pdGUgbG9vcCBieSB0ZW1wb3JhcmlseSByZW1vdmluZyB0aGlzIGZ1bmN0aW9uIGZyb20gdGhlIGdldHRlcgogICAgICAgIGhhbmRsZSA9IGF0dHJIYW5kbGVbbG93ZXJjYXNlTmFtZV07CiAgICAgICAgYXR0ckhhbmRsZVtsb3dlcmNhc2VOYW1lXSA9IHJldDsKICAgICAgICByZXQgPSBnZXR0ZXIoZWxlbSwgbmFtZSwgaXNYTUwpICE9IG51bGwgPyBsb3dlcmNhc2VOYW1lIDogbnVsbDsKICAgICAgICBhdHRySGFuZGxlW2xvd2VyY2FzZU5hbWVdID0gaGFuZGxlOwogICAgICB9CiAgICAgIHJldHVybiByZXQ7CiAgICB9OwogIH0pOwogIHZhciByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwKICAgIHJjbGlja2FibGUgPSAvXig/OmF8YXJlYSkkL2k7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBwcm9wOiBmdW5jdGlvbiBwcm9wKG5hbWUsIHZhbHVlKSB7CiAgICAgIHJldHVybiBhY2Nlc3ModGhpcywgalF1ZXJ5LnByb3AsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSk7CiAgICB9LAogICAgcmVtb3ZlUHJvcDogZnVuY3Rpb24gcmVtb3ZlUHJvcChuYW1lKSB7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGRlbGV0ZSB0aGlzW2pRdWVyeS5wcm9wRml4W25hbWVdIHx8IG5hbWVdOwogICAgICB9KTsKICAgIH0KICB9KTsKICBqUXVlcnkuZXh0ZW5kKHsKICAgIHByb3A6IGZ1bmN0aW9uIHByb3AoZWxlbSwgbmFtZSwgdmFsdWUpIHsKICAgICAgdmFyIHJldCwKICAgICAgICBob29rcywKICAgICAgICBuVHlwZSA9IGVsZW0ubm9kZVR5cGU7CgogICAgICAvLyBEb24ndCBnZXQvc2V0IHByb3BlcnRpZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCiAgICAgIGlmIChuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyhlbGVtKSkgewogICAgICAgIC8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKICAgICAgICBuYW1lID0galF1ZXJ5LnByb3BGaXhbbmFtZV0gfHwgbmFtZTsKICAgICAgICBob29rcyA9IGpRdWVyeS5wcm9wSG9va3NbbmFtZV07CiAgICAgIH0KICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldChlbGVtLCB2YWx1ZSwgbmFtZSkpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlbGVtW25hbWVdID0gdmFsdWU7CiAgICAgIH0KICAgICAgaWYgKGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoZWxlbSwgbmFtZSkpICE9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfQogICAgICByZXR1cm4gZWxlbVtuYW1lXTsKICAgIH0sCiAgICBwcm9wSG9va3M6IHsKICAgICAgdGFiSW5kZXg6IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PTkgLSAxMSBvbmx5CiAgICAgICAgICAvLyBlbGVtLnRhYkluZGV4IGRvZXNuJ3QgYWx3YXlzIHJldHVybiB0aGUKICAgICAgICAgIC8vIGNvcnJlY3QgdmFsdWUgd2hlbiBpdCBoYXNuJ3QgYmVlbiBleHBsaWNpdGx5IHNldAogICAgICAgICAgLy8gaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTQxMTE2MjMzMzQ3L2h0dHA6Ly9mbHVpZHByb2plY3Qub3JnL2Jsb2cvMjAwOC8wMS8wOS9nZXR0aW5nLXNldHRpbmctYW5kLXJlbW92aW5nLXRhYmluZGV4LXZhbHVlcy13aXRoLWphdmFzY3JpcHQvCiAgICAgICAgICAvLyBVc2UgcHJvcGVyIGF0dHJpYnV0ZSByZXRyaWV2YWwoIzEyMDcyKQogICAgICAgICAgdmFyIHRhYmluZGV4ID0galF1ZXJ5LmZpbmQuYXR0cihlbGVtLCAidGFiaW5kZXgiKTsKICAgICAgICAgIGlmICh0YWJpbmRleCkgewogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGFiaW5kZXgsIDEwKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChyZm9jdXNhYmxlLnRlc3QoZWxlbS5ub2RlTmFtZSkgfHwgcmNsaWNrYWJsZS50ZXN0KGVsZW0ubm9kZU5hbWUpICYmIGVsZW0uaHJlZikgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBwcm9wRml4OiB7CiAgICAgICJmb3IiOiAiaHRtbEZvciIsCiAgICAgICJjbGFzcyI6ICJjbGFzc05hbWUiCiAgICB9CiAgfSk7CgogIC8vIFN1cHBvcnQ6IElFIDw9MTEgb25seQogIC8vIEFjY2Vzc2luZyB0aGUgc2VsZWN0ZWRJbmRleCBwcm9wZXJ0eQogIC8vIGZvcmNlcyB0aGUgYnJvd3NlciB0byByZXNwZWN0IHNldHRpbmcgc2VsZWN0ZWQKICAvLyBvbiB0aGUgb3B0aW9uCiAgLy8gVGhlIGdldHRlciBlbnN1cmVzIGEgZGVmYXVsdCBvcHRpb24gaXMgc2VsZWN0ZWQKICAvLyB3aGVuIGluIGFuIG9wdGdyb3VwCiAgLy8gZXNsaW50IHJ1bGUgIm5vLXVudXNlZC1leHByZXNzaW9ucyIgaXMgZGlzYWJsZWQgZm9yIHRoaXMgY29kZQogIC8vIHNpbmNlIGl0IGNvbnNpZGVycyBzdWNoIGFjY2Vzc2lvbnMgbm9vcAogIGlmICghc3VwcG9ydC5vcHRTZWxlY3RlZCkgewogICAgalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSkgewogICAgICAgIC8qIGVzbGludCBuby11bnVzZWQtZXhwcmVzc2lvbnM6ICJvZmYiICovCgogICAgICAgIHZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CiAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQucGFyZW50Tm9kZSkgewogICAgICAgICAgcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KGVsZW0pIHsKICAgICAgICAvKiBlc2xpbnQgbm8tdW51c2VkLWV4cHJlc3Npb25zOiAib2ZmIiAqLwoKICAgICAgICB2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwogICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgIHBhcmVudC5zZWxlY3RlZEluZGV4OwogICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIHBhcmVudC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0KICBqUXVlcnkuZWFjaChbInRhYkluZGV4IiwgInJlYWRPbmx5IiwgIm1heExlbmd0aCIsICJjZWxsU3BhY2luZyIsICJjZWxsUGFkZGluZyIsICJyb3dTcGFuIiwgImNvbFNwYW4iLCAidXNlTWFwIiwgImZyYW1lQm9yZGVyIiwgImNvbnRlbnRFZGl0YWJsZSJdLCBmdW5jdGlvbiAoKSB7CiAgICBqUXVlcnkucHJvcEZpeFt0aGlzLnRvTG93ZXJDYXNlKCldID0gdGhpczsKICB9KTsKCiAgLy8gU3RyaXAgYW5kIGNvbGxhcHNlIHdoaXRlc3BhY2UgYWNjb3JkaW5nIHRvIEhUTUwgc3BlYwogIC8vIGh0dHBzOi8vaW5mcmEuc3BlYy53aGF0d2cub3JnLyNzdHJpcC1hbmQtY29sbGFwc2UtYXNjaWktd2hpdGVzcGFjZQogIGZ1bmN0aW9uIHN0cmlwQW5kQ29sbGFwc2UodmFsdWUpIHsKICAgIHZhciB0b2tlbnMgPSB2YWx1ZS5tYXRjaChybm90aHRtbHdoaXRlKSB8fCBbXTsKICAgIHJldHVybiB0b2tlbnMuam9pbigiICIpOwogIH0KICBmdW5jdGlvbiBnZXRDbGFzcyhlbGVtKSB7CiAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiI7CiAgfQogIGZ1bmN0aW9uIGNsYXNzZXNUb0FycmF5KHZhbHVlKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIHZhbHVlLm1hdGNoKHJub3RodG1sd2hpdGUpIHx8IFtdOwogICAgfQogICAgcmV0dXJuIFtdOwogIH0KICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIGFkZENsYXNzOiBmdW5jdGlvbiBhZGRDbGFzcyh2YWx1ZSkgewogICAgICB2YXIgY2xhc3NlcywKICAgICAgICBlbGVtLAogICAgICAgIGN1ciwKICAgICAgICBjdXJWYWx1ZSwKICAgICAgICBjbGF6eiwKICAgICAgICBqLAogICAgICAgIGZpbmFsVmFsdWUsCiAgICAgICAgaSA9IDA7CiAgICAgIGlmIChpc0Z1bmN0aW9uKHZhbHVlKSkgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGopIHsKICAgICAgICAgIGpRdWVyeSh0aGlzKS5hZGRDbGFzcyh2YWx1ZS5jYWxsKHRoaXMsIGosIGdldENsYXNzKHRoaXMpKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgY2xhc3NlcyA9IGNsYXNzZXNUb0FycmF5KHZhbHVlKTsKICAgICAgaWYgKGNsYXNzZXMubGVuZ3RoKSB7CiAgICAgICAgd2hpbGUgKGVsZW0gPSB0aGlzW2krK10pIHsKICAgICAgICAgIGN1clZhbHVlID0gZ2V0Q2xhc3MoZWxlbSk7CiAgICAgICAgICBjdXIgPSBlbGVtLm5vZGVUeXBlID09PSAxICYmICIgIiArIHN0cmlwQW5kQ29sbGFwc2UoY3VyVmFsdWUpICsgIiAiOwogICAgICAgICAgaWYgKGN1cikgewogICAgICAgICAgICBqID0gMDsKICAgICAgICAgICAgd2hpbGUgKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSB7CiAgICAgICAgICAgICAgaWYgKGN1ci5pbmRleE9mKCIgIiArIGNsYXp6ICsgIiAiKSA8IDApIHsKICAgICAgICAgICAgICAgIGN1ciArPSBjbGF6eiArICIgIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCiAgICAgICAgICAgIGZpbmFsVmFsdWUgPSBzdHJpcEFuZENvbGxhcHNlKGN1cik7CiAgICAgICAgICAgIGlmIChjdXJWYWx1ZSAhPT0gZmluYWxWYWx1ZSkgewogICAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCJjbGFzcyIsIGZpbmFsVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbiByZW1vdmVDbGFzcyh2YWx1ZSkgewogICAgICB2YXIgY2xhc3NlcywKICAgICAgICBlbGVtLAogICAgICAgIGN1ciwKICAgICAgICBjdXJWYWx1ZSwKICAgICAgICBjbGF6eiwKICAgICAgICBqLAogICAgICAgIGZpbmFsVmFsdWUsCiAgICAgICAgaSA9IDA7CiAgICAgIGlmIChpc0Z1bmN0aW9uKHZhbHVlKSkgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGopIHsKICAgICAgICAgIGpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcyh2YWx1ZS5jYWxsKHRoaXMsIGosIGdldENsYXNzKHRoaXMpKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYXR0cigiY2xhc3MiLCAiIik7CiAgICAgIH0KICAgICAgY2xhc3NlcyA9IGNsYXNzZXNUb0FycmF5KHZhbHVlKTsKICAgICAgaWYgKGNsYXNzZXMubGVuZ3RoKSB7CiAgICAgICAgd2hpbGUgKGVsZW0gPSB0aGlzW2krK10pIHsKICAgICAgICAgIGN1clZhbHVlID0gZ2V0Q2xhc3MoZWxlbSk7CgogICAgICAgICAgLy8gVGhpcyBleHByZXNzaW9uIGlzIGhlcmUgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSBhZGRDbGFzcykKICAgICAgICAgIGN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgIiAiICsgc3RyaXBBbmRDb2xsYXBzZShjdXJWYWx1ZSkgKyAiICI7CiAgICAgICAgICBpZiAoY3VyKSB7CiAgICAgICAgICAgIGogPSAwOwogICAgICAgICAgICB3aGlsZSAoY2xhenogPSBjbGFzc2VzW2orK10pIHsKICAgICAgICAgICAgICAvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCiAgICAgICAgICAgICAgd2hpbGUgKGN1ci5pbmRleE9mKCIgIiArIGNsYXp6ICsgIiAiKSA+IC0xKSB7CiAgICAgICAgICAgICAgICBjdXIgPSBjdXIucmVwbGFjZSgiICIgKyBjbGF6eiArICIgIiwgIiAiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCiAgICAgICAgICAgIGZpbmFsVmFsdWUgPSBzdHJpcEFuZENvbGxhcHNlKGN1cik7CiAgICAgICAgICAgIGlmIChjdXJWYWx1ZSAhPT0gZmluYWxWYWx1ZSkgewogICAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCJjbGFzcyIsIGZpbmFsVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHRvZ2dsZUNsYXNzOiBmdW5jdGlvbiB0b2dnbGVDbGFzcyh2YWx1ZSwgc3RhdGVWYWwpIHsKICAgICAgdmFyIHR5cGUgPSBfdHlwZW9mKHZhbHVlKSwKICAgICAgICBpc1ZhbGlkVmFsdWUgPSB0eXBlID09PSAic3RyaW5nIiB8fCBBcnJheS5pc0FycmF5KHZhbHVlKTsKICAgICAgaWYgKHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iICYmIGlzVmFsaWRWYWx1ZSkgewogICAgICAgIHJldHVybiBzdGF0ZVZhbCA/IHRoaXMuYWRkQ2xhc3ModmFsdWUpIDogdGhpcy5yZW1vdmVDbGFzcyh2YWx1ZSk7CiAgICAgIH0KICAgICAgaWYgKGlzRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLnRvZ2dsZUNsYXNzKHZhbHVlLmNhbGwodGhpcywgaSwgZ2V0Q2xhc3ModGhpcyksIHN0YXRlVmFsKSwgc3RhdGVWYWwpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjbGFzc05hbWUsIGksIHNlbGYsIGNsYXNzTmFtZXM7CiAgICAgICAgaWYgKGlzVmFsaWRWYWx1ZSkgewogICAgICAgICAgLy8gVG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXMKICAgICAgICAgIGkgPSAwOwogICAgICAgICAgc2VsZiA9IGpRdWVyeSh0aGlzKTsKICAgICAgICAgIGNsYXNzTmFtZXMgPSBjbGFzc2VzVG9BcnJheSh2YWx1ZSk7CiAgICAgICAgICB3aGlsZSAoY2xhc3NOYW1lID0gY2xhc3NOYW1lc1tpKytdKSB7CiAgICAgICAgICAgIC8vIENoZWNrIGVhY2ggY2xhc3NOYW1lIGdpdmVuLCBzcGFjZSBzZXBhcmF0ZWQgbGlzdAogICAgICAgICAgICBpZiAoc2VsZi5oYXNDbGFzcyhjbGFzc05hbWUpKSB7CiAgICAgICAgICAgICAgc2VsZi5yZW1vdmVDbGFzcyhjbGFzc05hbWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNlbGYuYWRkQ2xhc3MoY2xhc3NOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIFRvZ2dsZSB3aG9sZSBjbGFzcyBuYW1lCiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHR5cGUgPT09ICJib29sZWFuIikgewogICAgICAgICAgY2xhc3NOYW1lID0gZ2V0Q2xhc3ModGhpcyk7CiAgICAgICAgICBpZiAoY2xhc3NOYW1lKSB7CiAgICAgICAgICAgIC8vIFN0b3JlIGNsYXNzTmFtZSBpZiBzZXQKICAgICAgICAgICAgZGF0YVByaXYuc2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgY2xhc3NOYW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCBgZmFsc2VgLAogICAgICAgICAgLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KICAgICAgICAgIC8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCiAgICAgICAgICAvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCiAgICAgICAgICBpZiAodGhpcy5zZXRBdHRyaWJ1dGUpIHsKICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogZGF0YVByaXYuZ2V0KHRoaXMsICJfX2NsYXNzTmFtZV9fIikgfHwgIiIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaGFzQ2xhc3M6IGZ1bmN0aW9uIGhhc0NsYXNzKHNlbGVjdG9yKSB7CiAgICAgIHZhciBjbGFzc05hbWUsCiAgICAgICAgZWxlbSwKICAgICAgICBpID0gMDsKICAgICAgY2xhc3NOYW1lID0gIiAiICsgc2VsZWN0b3IgKyAiICI7CiAgICAgIHdoaWxlIChlbGVtID0gdGhpc1tpKytdKSB7CiAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKCIgIiArIHN0cmlwQW5kQ29sbGFwc2UoZ2V0Q2xhc3MoZWxlbSkpICsgIiAiKS5pbmRleE9mKGNsYXNzTmFtZSkgPiAtMSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9KTsKICB2YXIgcnJldHVybiA9IC9cci9nOwogIGpRdWVyeS5mbi5leHRlbmQoewogICAgdmFsOiBmdW5jdGlvbiB2YWwodmFsdWUpIHsKICAgICAgdmFyIGhvb2tzLAogICAgICAgIHJldCwKICAgICAgICB2YWx1ZUlzRnVuY3Rpb24sCiAgICAgICAgZWxlbSA9IHRoaXNbMF07CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgIGlmIChlbGVtKSB7CiAgICAgICAgICBob29rcyA9IGpRdWVyeS52YWxIb29rc1tlbGVtLnR5cGVdIHx8IGpRdWVyeS52YWxIb29rc1tlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldOwogICAgICAgICAgaWYgKGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoZWxlbSwgInZhbHVlIikpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICAgIH0KICAgICAgICAgIHJldCA9IGVsZW0udmFsdWU7CgogICAgICAgICAgLy8gSGFuZGxlIG1vc3QgY29tbW9uIHN0cmluZyBjYXNlcwogICAgICAgICAgaWYgKHR5cGVvZiByZXQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHJldHVybiByZXQucmVwbGFjZShycmV0dXJuLCAiIik7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gSGFuZGxlIGNhc2VzIHdoZXJlIHZhbHVlIGlzIG51bGwvdW5kZWYgb3IgbnVtYmVyCiAgICAgICAgICByZXR1cm4gcmV0ID09IG51bGwgPyAiIiA6IHJldDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhbHVlSXNGdW5jdGlvbiA9IGlzRnVuY3Rpb24odmFsdWUpOwogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgdmFyIHZhbDsKICAgICAgICBpZiAodGhpcy5ub2RlVHlwZSAhPT0gMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWVJc0Z1bmN0aW9uKSB7CiAgICAgICAgICB2YWwgPSB2YWx1ZS5jYWxsKHRoaXMsIGksIGpRdWVyeSh0aGlzKS52YWwoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IHZhbHVlOwogICAgICAgIH0KCiAgICAgICAgLy8gVHJlYXQgbnVsbC91bmRlZmluZWQgYXMgIiI7IGNvbnZlcnQgbnVtYmVycyB0byBzdHJpbmcKICAgICAgICBpZiAodmFsID09IG51bGwpIHsKICAgICAgICAgIHZhbCA9ICIiOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgIHZhbCArPSAiIjsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkgewogICAgICAgICAgdmFsID0galF1ZXJ5Lm1hcCh2YWwsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKyAiIjsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBob29rcyA9IGpRdWVyeS52YWxIb29rc1t0aGlzLnR5cGVdIHx8IGpRdWVyeS52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldOwoKICAgICAgICAvLyBJZiBzZXQgcmV0dXJucyB1bmRlZmluZWQsIGZhbGwgYmFjayB0byBub3JtYWwgc2V0dGluZwogICAgICAgIGlmICghaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgaG9va3Muc2V0KHRoaXMsIHZhbCwgInZhbHVlIikgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0pOwogIGpRdWVyeS5leHRlbmQoewogICAgdmFsSG9va3M6IHsKICAgICAgb3B0aW9uOiB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoZWxlbSkgewogICAgICAgICAgdmFyIHZhbCA9IGpRdWVyeS5maW5kLmF0dHIoZWxlbSwgInZhbHVlIik7CiAgICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyB2YWwgOgogICAgICAgICAgLy8gU3VwcG9ydDogSUUgPD0xMCAtIDExIG9ubHkKICAgICAgICAgIC8vIG9wdGlvbi50ZXh0IHRocm93cyBleGNlcHRpb25zICgjMTQ2ODYsICMxNDg1OCkKICAgICAgICAgIC8vIFN0cmlwIGFuZCBjb2xsYXBzZSB3aGl0ZXNwYWNlCiAgICAgICAgICAvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnLyNzdHJpcC1hbmQtY29sbGFwc2Utd2hpdGVzcGFjZQogICAgICAgICAgc3RyaXBBbmRDb2xsYXBzZShqUXVlcnkudGV4dChlbGVtKSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZWxlY3Q6IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldChlbGVtKSB7CiAgICAgICAgICB2YXIgdmFsdWUsCiAgICAgICAgICAgIG9wdGlvbiwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgb3B0aW9ucyA9IGVsZW0ub3B0aW9ucywKICAgICAgICAgICAgaW5kZXggPSBlbGVtLnNlbGVjdGVkSW5kZXgsCiAgICAgICAgICAgIG9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiLAogICAgICAgICAgICB2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCiAgICAgICAgICAgIG1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoOwogICAgICAgICAgaWYgKGluZGV4IDwgMCkgewogICAgICAgICAgICBpID0gbWF4OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaSA9IG9uZSA/IGluZGV4IDogMDsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCiAgICAgICAgICBmb3IgKDsgaSA8IG1heDsgaSsrKSB7CiAgICAgICAgICAgIG9wdGlvbiA9IG9wdGlvbnNbaV07CgogICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PTkgb25seQogICAgICAgICAgICAvLyBJRTgtOSBkb2Vzbid0IHVwZGF0ZSBzZWxlY3RlZCBhZnRlciBmb3JtIHJlc2V0ICgjMjU1MSkKICAgICAgICAgICAgaWYgKChvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXgpICYmCiAgICAgICAgICAgIC8vIERvbid0IHJldHVybiBvcHRpb25zIHRoYXQgYXJlIGRpc2FibGVkIG9yIGluIGEgZGlzYWJsZWQgb3B0Z3JvdXAKICAgICAgICAgICAgIW9wdGlvbi5kaXNhYmxlZCAmJiAoIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFub2RlTmFtZShvcHRpb24ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIikpKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHRoZSBzcGVjaWZpYyB2YWx1ZSBmb3IgdGhlIG9wdGlvbgogICAgICAgICAgICAgIHZhbHVlID0galF1ZXJ5KG9wdGlvbikudmFsKCk7CgogICAgICAgICAgICAgIC8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzCiAgICAgICAgICAgICAgaWYgKG9uZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gTXVsdGktU2VsZWN0cyByZXR1cm4gYW4gYXJyYXkKICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB2YWx1ZXM7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbGVtLCB2YWx1ZSkgewogICAgICAgICAgdmFyIG9wdGlvblNldCwKICAgICAgICAgICAgb3B0aW9uLAogICAgICAgICAgICBvcHRpb25zID0gZWxlbS5vcHRpb25zLAogICAgICAgICAgICB2YWx1ZXMgPSBqUXVlcnkubWFrZUFycmF5KHZhbHVlKSwKICAgICAgICAgICAgaSA9IG9wdGlvbnMubGVuZ3RoOwogICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICBvcHRpb24gPSBvcHRpb25zW2ldOwoKICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uZC1hc3NpZ24gKi8KCiAgICAgICAgICAgIGlmIChvcHRpb24uc2VsZWN0ZWQgPSBqUXVlcnkuaW5BcnJheShqUXVlcnkudmFsSG9va3Mub3B0aW9uLmdldChvcHRpb24pLCB2YWx1ZXMpID4gLTEpIHsKICAgICAgICAgICAgICBvcHRpb25TZXQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbmQtYXNzaWduICovCiAgICAgICAgICB9CgogICAgICAgICAgLy8gRm9yY2UgYnJvd3NlcnMgdG8gYmVoYXZlIGNvbnNpc3RlbnRseSB3aGVuIG5vbi1tYXRjaGluZyB2YWx1ZSBpcyBzZXQKICAgICAgICAgIGlmICghb3B0aW9uU2V0KSB7CiAgICAgICAgICAgIGVsZW0uc2VsZWN0ZWRJbmRleCA9IC0xOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHZhbHVlczsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKICBqUXVlcnkuZWFjaChbInJhZGlvIiwgImNoZWNrYm94Il0sIGZ1bmN0aW9uICgpIHsKICAgIGpRdWVyeS52YWxIb29rc1t0aGlzXSA9IHsKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZWxlbSwgdmFsdWUpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybiBlbGVtLmNoZWNrZWQgPSBqUXVlcnkuaW5BcnJheShqUXVlcnkoZWxlbSkudmFsKCksIHZhbHVlKSA+IC0xOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGlmICghc3VwcG9ydC5jaGVja09uKSB7CiAgICAgIGpRdWVyeS52YWxIb29rc1t0aGlzXS5nZXQgPSBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgIHJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidmFsdWUiKSA9PT0gbnVsbCA/ICJvbiIgOiBlbGVtLnZhbHVlOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBSZXR1cm4galF1ZXJ5IGZvciBhdHRyaWJ1dGVzLW9ubHkgaW5jbHVzaW9uCgogIHN1cHBvcnQuZm9jdXNpbiA9ICJvbmZvY3VzaW4iIGluIHdpbmRvdzsKICB2YXIgcmZvY3VzTW9ycGggPSAvXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sCiAgICBzdG9wUHJvcGFnYXRpb25DYWxsYmFjayA9IGZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbkNhbGxiYWNrKGUpIHsKICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH07CiAgalF1ZXJ5LmV4dGVuZChqUXVlcnkuZXZlbnQsIHsKICAgIHRyaWdnZXI6IGZ1bmN0aW9uIHRyaWdnZXIoZXZlbnQsIGRhdGEsIGVsZW0sIG9ubHlIYW5kbGVycykgewogICAgICB2YXIgaSwKICAgICAgICBjdXIsCiAgICAgICAgdG1wLAogICAgICAgIGJ1YmJsZVR5cGUsCiAgICAgICAgb250eXBlLAogICAgICAgIGhhbmRsZSwKICAgICAgICBzcGVjaWFsLAogICAgICAgIGxhc3RFbGVtZW50LAogICAgICAgIGV2ZW50UGF0aCA9IFtlbGVtIHx8IGRvY3VtZW50XSwKICAgICAgICB0eXBlID0gaGFzT3duLmNhbGwoZXZlbnQsICJ0eXBlIikgPyBldmVudC50eXBlIDogZXZlbnQsCiAgICAgICAgbmFtZXNwYWNlcyA9IGhhc093bi5jYWxsKGV2ZW50LCAibmFtZXNwYWNlIikgPyBldmVudC5uYW1lc3BhY2Uuc3BsaXQoIi4iKSA6IFtdOwogICAgICBjdXIgPSBsYXN0RWxlbWVudCA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKICAgICAgLy8gRG9uJ3QgZG8gZXZlbnRzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gZm9jdXMvYmx1ciBtb3JwaHMgdG8gZm9jdXNpbi9vdXQ7IGVuc3VyZSB3ZSdyZSBub3QgZmlyaW5nIHRoZW0gcmlnaHQgbm93CiAgICAgIGlmIChyZm9jdXNNb3JwaC50ZXN0KHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodHlwZS5pbmRleE9mKCIuIikgPiAtMSkgewogICAgICAgIC8vIE5hbWVzcGFjZWQgdHJpZ2dlcjsgY3JlYXRlIGEgcmVnZXhwIHRvIG1hdGNoIGV2ZW50IHR5cGUgaW4gaGFuZGxlKCkKICAgICAgICBuYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwogICAgICAgIHR5cGUgPSBuYW1lc3BhY2VzLnNoaWZ0KCk7CiAgICAgICAgbmFtZXNwYWNlcy5zb3J0KCk7CiAgICAgIH0KICAgICAgb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKICAgICAgLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGEgalF1ZXJ5LkV2ZW50IG9iamVjdCwgT2JqZWN0LCBvciBqdXN0IGFuIGV2ZW50IHR5cGUgc3RyaW5nCiAgICAgIGV2ZW50ID0gZXZlbnRbalF1ZXJ5LmV4cGFuZG9dID8gZXZlbnQgOiBuZXcgalF1ZXJ5LkV2ZW50KHR5cGUsIF90eXBlb2YoZXZlbnQpID09PSAib2JqZWN0IiAmJiBldmVudCk7CgogICAgICAvLyBUcmlnZ2VyIGJpdG1hc2s6ICYgMSBmb3IgbmF0aXZlIGhhbmRsZXJzOyAmIDIgZm9yIGpRdWVyeSAoYWx3YXlzIHRydWUpCiAgICAgIGV2ZW50LmlzVHJpZ2dlciA9IG9ubHlIYW5kbGVycyA/IDIgOiAzOwogICAgICBldmVudC5uYW1lc3BhY2UgPSBuYW1lc3BhY2VzLmpvaW4oIi4iKTsKICAgICAgZXZlbnQucm5hbWVzcGFjZSA9IGV2ZW50Lm5hbWVzcGFjZSA/IG5ldyBSZWdFeHAoIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIpIDogbnVsbDsKCiAgICAgIC8vIENsZWFuIHVwIHRoZSBldmVudCBpbiBjYXNlIGl0IGlzIGJlaW5nIHJldXNlZAogICAgICBldmVudC5yZXN1bHQgPSB1bmRlZmluZWQ7CiAgICAgIGlmICghZXZlbnQudGFyZ2V0KSB7CiAgICAgICAgZXZlbnQudGFyZ2V0ID0gZWxlbTsKICAgICAgfQoKICAgICAgLy8gQ2xvbmUgYW55IGluY29taW5nIGRhdGEgYW5kIHByZXBlbmQgdGhlIGV2ZW50LCBjcmVhdGluZyB0aGUgaGFuZGxlciBhcmcgbGlzdAogICAgICBkYXRhID0gZGF0YSA9PSBudWxsID8gW2V2ZW50XSA6IGpRdWVyeS5tYWtlQXJyYXkoZGF0YSwgW2V2ZW50XSk7CgogICAgICAvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCiAgICAgIHNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFt0eXBlXSB8fCB7fTsKICAgICAgaWYgKCFvbmx5SGFuZGxlcnMgJiYgc3BlY2lhbC50cmlnZ2VyICYmIHNwZWNpYWwudHJpZ2dlci5hcHBseShlbGVtLCBkYXRhKSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIERldGVybWluZSBldmVudCBwcm9wYWdhdGlvbiBwYXRoIGluIGFkdmFuY2UsIHBlciBXM0MgZXZlbnRzIHNwZWMgKCM5OTUxKQogICAgICAvLyBCdWJibGUgdXAgdG8gZG9jdW1lbnQsIHRoZW4gdG8gd2luZG93OyB3YXRjaCBmb3IgYSBnbG9iYWwgb3duZXJEb2N1bWVudCB2YXIgKCM5NzI0KQogICAgICBpZiAoIW9ubHlIYW5kbGVycyAmJiAhc3BlY2lhbC5ub0J1YmJsZSAmJiAhaXNXaW5kb3coZWxlbSkpIHsKICAgICAgICBidWJibGVUeXBlID0gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgfHwgdHlwZTsKICAgICAgICBpZiAoIXJmb2N1c01vcnBoLnRlc3QoYnViYmxlVHlwZSArIHR5cGUpKSB7CiAgICAgICAgICBjdXIgPSBjdXIucGFyZW50Tm9kZTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUpIHsKICAgICAgICAgIGV2ZW50UGF0aC5wdXNoKGN1cik7CiAgICAgICAgICB0bXAgPSBjdXI7CiAgICAgICAgfQoKICAgICAgICAvLyBPbmx5IGFkZCB3aW5kb3cgaWYgd2UgZ290IHRvIGRvY3VtZW50IChlLmcuLCBub3QgcGxhaW4gb2JqIG9yIGRldGFjaGVkIERPTSkKICAgICAgICBpZiAodG1wID09PSAoZWxlbS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50KSkgewogICAgICAgICAgZXZlbnRQYXRoLnB1c2godG1wLmRlZmF1bHRWaWV3IHx8IHRtcC5wYXJlbnRXaW5kb3cgfHwgd2luZG93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIEZpcmUgaGFuZGxlcnMgb24gdGhlIGV2ZW50IHBhdGgKICAgICAgaSA9IDA7CiAgICAgIHdoaWxlICgoY3VyID0gZXZlbnRQYXRoW2krK10pICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSB7CiAgICAgICAgbGFzdEVsZW1lbnQgPSBjdXI7CiAgICAgICAgZXZlbnQudHlwZSA9IGkgPiAxID8gYnViYmxlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgfHwgdHlwZTsKCiAgICAgICAgLy8galF1ZXJ5IGhhbmRsZXIKICAgICAgICBoYW5kbGUgPSAoZGF0YVByaXYuZ2V0KGN1ciwgImV2ZW50cyIpIHx8IE9iamVjdC5jcmVhdGUobnVsbCkpW2V2ZW50LnR5cGVdICYmIGRhdGFQcml2LmdldChjdXIsICJoYW5kbGUiKTsKICAgICAgICBpZiAoaGFuZGxlKSB7CiAgICAgICAgICBoYW5kbGUuYXBwbHkoY3VyLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIE5hdGl2ZSBoYW5kbGVyCiAgICAgICAgaGFuZGxlID0gb250eXBlICYmIGN1cltvbnR5cGVdOwogICAgICAgIGlmIChoYW5kbGUgJiYgaGFuZGxlLmFwcGx5ICYmIGFjY2VwdERhdGEoY3VyKSkgewogICAgICAgICAgZXZlbnQucmVzdWx0ID0gaGFuZGxlLmFwcGx5KGN1ciwgZGF0YSk7CiAgICAgICAgICBpZiAoZXZlbnQucmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBldmVudC50eXBlID0gdHlwZTsKCiAgICAgIC8vIElmIG5vYm9keSBwcmV2ZW50ZWQgdGhlIGRlZmF1bHQgYWN0aW9uLCBkbyBpdCBub3cKICAgICAgaWYgKCFvbmx5SGFuZGxlcnMgJiYgIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgaWYgKCghc3BlY2lhbC5fZGVmYXVsdCB8fCBzcGVjaWFsLl9kZWZhdWx0LmFwcGx5KGV2ZW50UGF0aC5wb3AoKSwgZGF0YSkgPT09IGZhbHNlKSAmJiBhY2NlcHREYXRhKGVsZW0pKSB7CiAgICAgICAgICAvLyBDYWxsIGEgbmF0aXZlIERPTSBtZXRob2Qgb24gdGhlIHRhcmdldCB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgdGhlIGV2ZW50LgogICAgICAgICAgLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKQogICAgICAgICAgaWYgKG9udHlwZSAmJiBpc0Z1bmN0aW9uKGVsZW1bdHlwZV0pICYmICFpc1dpbmRvdyhlbGVtKSkgewogICAgICAgICAgICAvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCiAgICAgICAgICAgIHRtcCA9IGVsZW1bb250eXBlXTsKICAgICAgICAgICAgaWYgKHRtcCkgewogICAgICAgICAgICAgIGVsZW1bb250eXBlXSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByZXZlbnQgcmUtdHJpZ2dlcmluZyBvZiB0aGUgc2FtZSBldmVudCwgc2luY2Ugd2UgYWxyZWFkeSBidWJibGVkIGl0IGFib3ZlCiAgICAgICAgICAgIGpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB0eXBlOwogICAgICAgICAgICBpZiAoZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgewogICAgICAgICAgICAgIGxhc3RFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgc3RvcFByb3BhZ2F0aW9uQ2FsbGJhY2spOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsZW1bdHlwZV0oKTsKICAgICAgICAgICAgaWYgKGV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIHsKICAgICAgICAgICAgICBsYXN0RWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIHN0b3BQcm9wYWdhdGlvbkNhbGxiYWNrKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdW5kZWZpbmVkOwogICAgICAgICAgICBpZiAodG1wKSB7CiAgICAgICAgICAgICAgZWxlbVtvbnR5cGVdID0gdG1wOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBldmVudC5yZXN1bHQ7CiAgICB9LAogICAgLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lCiAgICAvLyBVc2VkIG9ubHkgZm9yIGBmb2N1cyhpbiB8IG91dClgIGV2ZW50cwogICAgc2ltdWxhdGU6IGZ1bmN0aW9uIHNpbXVsYXRlKHR5cGUsIGVsZW0sIGV2ZW50KSB7CiAgICAgIHZhciBlID0galF1ZXJ5LmV4dGVuZChuZXcgalF1ZXJ5LkV2ZW50KCksIGV2ZW50LCB7CiAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICBpc1NpbXVsYXRlZDogdHJ1ZQogICAgICB9KTsKICAgICAgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoZSwgbnVsbCwgZWxlbSk7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICB0cmlnZ2VyOiBmdW5jdGlvbiB0cmlnZ2VyKHR5cGUsIGRhdGEpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgalF1ZXJ5LmV2ZW50LnRyaWdnZXIodHlwZSwgZGF0YSwgdGhpcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHRyaWdnZXJIYW5kbGVyOiBmdW5jdGlvbiB0cmlnZ2VySGFuZGxlcih0eXBlLCBkYXRhKSB7CiAgICAgIHZhciBlbGVtID0gdGhpc1swXTsKICAgICAgaWYgKGVsZW0pIHsKICAgICAgICByZXR1cm4galF1ZXJ5LmV2ZW50LnRyaWdnZXIodHlwZSwgZGF0YSwgZWxlbSwgdHJ1ZSk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gU3VwcG9ydDogRmlyZWZveCA8PTQ0CiAgLy8gRmlyZWZveCBkb2Vzbid0IGhhdmUgZm9jdXMoaW4gfCBvdXQpIGV2ZW50cwogIC8vIFJlbGF0ZWQgdGlja2V0IC0gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9Njg3Nzg3CiAgLy8KICAvLyBTdXBwb3J0OiBDaHJvbWUgPD00OCAtIDQ5LCBTYWZhcmkgPD05LjAgLSA5LjEKICAvLyBmb2N1cyhpbiB8IG91dCkgZXZlbnRzIGZpcmUgYWZ0ZXIgZm9jdXMgJiBibHVyIGV2ZW50cywKICAvLyB3aGljaCBpcyBzcGVjIHZpb2xhdGlvbiAtIGh0dHA6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0zLUV2ZW50cy8jZXZlbnRzLWZvY3VzZXZlbnQtZXZlbnQtb3JkZXIKICAvLyBSZWxhdGVkIHRpY2tldCAtIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTQ0OTg1NwogIGlmICghc3VwcG9ydC5mb2N1c2luKSB7CiAgICBqUXVlcnkuZWFjaCh7CiAgICAgIGZvY3VzOiAiZm9jdXNpbiIsCiAgICAgIGJsdXI6ICJmb2N1c291dCIKICAgIH0sIGZ1bmN0aW9uIChvcmlnLCBmaXgpIHsKICAgICAgLy8gQXR0YWNoIGEgc2luZ2xlIGNhcHR1cmluZyBoYW5kbGVyIG9uIHRoZSBkb2N1bWVudCB3aGlsZSBzb21lb25lIHdhbnRzIGZvY3VzaW4vZm9jdXNvdXQKICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKGV2ZW50KSB7CiAgICAgICAgalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKGZpeCwgZXZlbnQudGFyZ2V0LCBqUXVlcnkuZXZlbnQuZml4KGV2ZW50KSk7CiAgICAgIH07CiAgICAgIGpRdWVyeS5ldmVudC5zcGVjaWFsW2ZpeF0gPSB7CiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uIHNldHVwKCkgewogICAgICAgICAgLy8gSGFuZGxlOiByZWd1bGFyIG5vZGVzICh2aWEgYHRoaXMub3duZXJEb2N1bWVudGApLCB3aW5kb3cKICAgICAgICAgIC8vICh2aWEgYHRoaXMuZG9jdW1lbnRgKSAmIGRvY3VtZW50ICh2aWEgYHRoaXNgKS4KICAgICAgICAgIHZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcy5kb2N1bWVudCB8fCB0aGlzLAogICAgICAgICAgICBhdHRhY2hlcyA9IGRhdGFQcml2LmFjY2Vzcyhkb2MsIGZpeCk7CiAgICAgICAgICBpZiAoIWF0dGFjaGVzKSB7CiAgICAgICAgICAgIGRvYy5hZGRFdmVudExpc3RlbmVyKG9yaWcsIGhhbmRsZXIsIHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgZGF0YVByaXYuYWNjZXNzKGRvYywgZml4LCAoYXR0YWNoZXMgfHwgMCkgKyAxKTsKICAgICAgICB9LAogICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiB0ZWFyZG93bigpIHsKICAgICAgICAgIHZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcy5kb2N1bWVudCB8fCB0aGlzLAogICAgICAgICAgICBhdHRhY2hlcyA9IGRhdGFQcml2LmFjY2Vzcyhkb2MsIGZpeCkgLSAxOwogICAgICAgICAgaWYgKCFhdHRhY2hlcykgewogICAgICAgICAgICBkb2MucmVtb3ZlRXZlbnRMaXN0ZW5lcihvcmlnLCBoYW5kbGVyLCB0cnVlKTsKICAgICAgICAgICAgZGF0YVByaXYucmVtb3ZlKGRvYywgZml4KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGFQcml2LmFjY2Vzcyhkb2MsIGZpeCwgYXR0YWNoZXMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0pOwogIH0KICB2YXIgbG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb247CiAgdmFyIG5vbmNlID0gewogICAgZ3VpZDogRGF0ZS5ub3coKQogIH07CiAgdmFyIHJxdWVyeSA9IC9cPy87CgogIC8vIENyb3NzLWJyb3dzZXIgeG1sIHBhcnNpbmcKICBqUXVlcnkucGFyc2VYTUwgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIHhtbDsKICAgIGlmICghZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8gU3VwcG9ydDogSUUgOSAtIDExIG9ubHkKICAgIC8vIElFIHRocm93cyBvbiBwYXJzZUZyb21TdHJpbmcgd2l0aCBpbnZhbGlkIGlucHV0LgogICAgdHJ5IHsKICAgICAgeG1sID0gbmV3IHdpbmRvdy5ET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZGF0YSwgInRleHQveG1sIik7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHhtbCA9IHVuZGVmaW5lZDsKICAgIH0KICAgIGlmICgheG1sIHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgicGFyc2VyZXJyb3IiKS5sZW5ndGgpIHsKICAgICAgalF1ZXJ5LmVycm9yKCJJbnZhbGlkIFhNTDogIiArIGRhdGEpOwogICAgfQogICAgcmV0dXJuIHhtbDsKICB9OwogIHZhciByYnJhY2tldCA9IC9cW1xdJC8sCiAgICByQ1JMRiA9IC9ccj9cbi9nLAogICAgcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAogICAgcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwogIGZ1bmN0aW9uIGJ1aWxkUGFyYW1zKHByZWZpeCwgb2JqLCB0cmFkaXRpb25hbCwgYWRkKSB7CiAgICB2YXIgbmFtZTsKICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgLy8gU2VyaWFsaXplIGFycmF5IGl0ZW0uCiAgICAgIGpRdWVyeS5lYWNoKG9iaiwgZnVuY3Rpb24gKGksIHYpIHsKICAgICAgICBpZiAodHJhZGl0aW9uYWwgfHwgcmJyYWNrZXQudGVzdChwcmVmaXgpKSB7CiAgICAgICAgICAvLyBUcmVhdCBlYWNoIGFycmF5IGl0ZW0gYXMgYSBzY2FsYXIuCiAgICAgICAgICBhZGQocHJlZml4LCB2KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSXRlbSBpcyBub24tc2NhbGFyIChhcnJheSBvciBvYmplY3QpLCBlbmNvZGUgaXRzIG51bWVyaWMgaW5kZXguCiAgICAgICAgICBidWlsZFBhcmFtcyhwcmVmaXggKyAiWyIgKyAoX3R5cGVvZih2KSA9PT0gIm9iamVjdCIgJiYgdiAhPSBudWxsID8gaSA6ICIiKSArICJdIiwgdiwgdHJhZGl0aW9uYWwsIGFkZCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoIXRyYWRpdGlvbmFsICYmIHRvVHlwZShvYmopID09PSAib2JqZWN0IikgewogICAgICAvLyBTZXJpYWxpemUgb2JqZWN0IGl0ZW0uCiAgICAgIGZvciAobmFtZSBpbiBvYmopIHsKICAgICAgICBidWlsZFBhcmFtcyhwcmVmaXggKyAiWyIgKyBuYW1lICsgIl0iLCBvYmpbbmFtZV0sIHRyYWRpdGlvbmFsLCBhZGQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBTZXJpYWxpemUgc2NhbGFyIGl0ZW0uCiAgICAgIGFkZChwcmVmaXgsIG9iaik7CiAgICB9CiAgfQoKICAvLyBTZXJpYWxpemUgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cyBvciBhIHNldCBvZgogIC8vIGtleS92YWx1ZXMgaW50byBhIHF1ZXJ5IHN0cmluZwogIGpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uIChhLCB0cmFkaXRpb25hbCkgewogICAgdmFyIHByZWZpeCwKICAgICAgcyA9IFtdLAogICAgICBhZGQgPSBmdW5jdGlvbiBhZGQoa2V5LCB2YWx1ZU9yRnVuY3Rpb24pIHsKICAgICAgICAvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHVzZSBpdHMgcmV0dXJuIHZhbHVlCiAgICAgICAgdmFyIHZhbHVlID0gaXNGdW5jdGlvbih2YWx1ZU9yRnVuY3Rpb24pID8gdmFsdWVPckZ1bmN0aW9uKCkgOiB2YWx1ZU9yRnVuY3Rpb247CiAgICAgICAgc1tzLmxlbmd0aF0gPSBlbmNvZGVVUklDb21wb25lbnQoa2V5KSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSk7CiAgICAgIH07CiAgICBpZiAoYSA9PSBudWxsKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KCiAgICAvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgogICAgaWYgKEFycmF5LmlzQXJyYXkoYSkgfHwgYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KGEpKSB7CiAgICAgIC8vIFNlcmlhbGl6ZSB0aGUgZm9ybSBlbGVtZW50cwogICAgICBqUXVlcnkuZWFjaChhLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgYWRkKHRoaXMubmFtZSwgdGhpcy52YWx1ZSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgLy8gSWYgdHJhZGl0aW9uYWwsIGVuY29kZSB0aGUgIm9sZCIgd2F5ICh0aGUgd2F5IDEuMy4yIG9yIG9sZGVyCiAgICAgIC8vIGRpZCBpdCksIG90aGVyd2lzZSBlbmNvZGUgcGFyYW1zIHJlY3Vyc2l2ZWx5LgogICAgICBmb3IgKHByZWZpeCBpbiBhKSB7CiAgICAgICAgYnVpbGRQYXJhbXMocHJlZml4LCBhW3ByZWZpeF0sIHRyYWRpdGlvbmFsLCBhZGQpOwogICAgICB9CiAgICB9CgogICAgLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgogICAgcmV0dXJuIHMuam9pbigiJiIpOwogIH07CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uIHNlcmlhbGl6ZSgpIHsKICAgICAgcmV0dXJuIGpRdWVyeS5wYXJhbSh0aGlzLnNlcmlhbGl6ZUFycmF5KCkpOwogICAgfSwKICAgIHNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbiBzZXJpYWxpemVBcnJheSgpIHsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBDYW4gYWRkIHByb3BIb29rIGZvciAiZWxlbWVudHMiIHRvIGZpbHRlciBvciBhZGQgZm9ybSBlbGVtZW50cwogICAgICAgIHZhciBlbGVtZW50cyA9IGpRdWVyeS5wcm9wKHRoaXMsICJlbGVtZW50cyIpOwogICAgICAgIHJldHVybiBlbGVtZW50cyA/IGpRdWVyeS5tYWtlQXJyYXkoZWxlbWVudHMpIDogdGhpczsKICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdHlwZSA9IHRoaXMudHlwZTsKCiAgICAgICAgLy8gVXNlIC5pcyggIjpkaXNhYmxlZCIgKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwogICAgICAgIHJldHVybiB0aGlzLm5hbWUgJiYgIWpRdWVyeSh0aGlzKS5pcygiOmRpc2FibGVkIikgJiYgcnN1Ym1pdHRhYmxlLnRlc3QodGhpcy5ub2RlTmFtZSkgJiYgIXJzdWJtaXR0ZXJUeXBlcy50ZXN0KHR5cGUpICYmICh0aGlzLmNoZWNrZWQgfHwgIXJjaGVja2FibGVUeXBlLnRlc3QodHlwZSkpOwogICAgICB9KS5tYXAoZnVuY3Rpb24gKF9pLCBlbGVtKSB7CiAgICAgICAgdmFyIHZhbCA9IGpRdWVyeSh0aGlzKS52YWwoKTsKICAgICAgICBpZiAodmFsID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7CiAgICAgICAgICByZXR1cm4galF1ZXJ5Lm1hcCh2YWwsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBuYW1lOiBlbGVtLm5hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IHZhbC5yZXBsYWNlKHJDUkxGLCAiXHJcbiIpCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG5hbWU6IGVsZW0ubmFtZSwKICAgICAgICAgIHZhbHVlOiB2YWwucmVwbGFjZShyQ1JMRiwgIlxyXG4iKQogICAgICAgIH07CiAgICAgIH0pLmdldCgpOwogICAgfQogIH0pOwogIHZhciByMjAgPSAvJTIwL2csCiAgICByaGFzaCA9IC8jLiokLywKICAgIHJhbnRpQ2FjaGUgPSAvKFs/Jl0pXz1bXiZdKi8sCiAgICByaGVhZGVycyA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvbWcsCiAgICAvLyAjNzY1MywgIzgxMjUsICM4MTUyOiBsb2NhbCBwcm90b2NvbCBkZXRlY3Rpb24KICAgIHJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCiAgICBybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKICAgIHJwcm90b2NvbCA9IC9eXC9cLy8sCiAgICAvKiBQcmVmaWx0ZXJzCiAgICAqIDEpIFRoZXkgYXJlIHVzZWZ1bCB0byBpbnRyb2R1Y2UgY3VzdG9tIGRhdGFUeXBlcyAoc2VlIGFqYXgvanNvbnAuanMgZm9yIGFuIGV4YW1wbGUpCiAgICAqIDIpIFRoZXNlIGFyZSBjYWxsZWQ6CiAgICAqICAgIC0gQkVGT1JFIGFza2luZyBmb3IgYSB0cmFuc3BvcnQKICAgICogICAgLSBBRlRFUiBwYXJhbSBzZXJpYWxpemF0aW9uIChzLmRhdGEgaXMgYSBzdHJpbmcgaWYgcy5wcm9jZXNzRGF0YSBpcyB0cnVlKQogICAgKiAzKSBrZXkgaXMgdGhlIGRhdGFUeXBlCiAgICAqIDQpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCiAgICAqIDUpIGV4ZWN1dGlvbiB3aWxsIHN0YXJ0IHdpdGggdHJhbnNwb3J0IGRhdGFUeXBlIGFuZCBUSEVOIGNvbnRpbnVlIGRvd24gdG8gIioiIGlmIG5lZWRlZAogICAgKi8KICAgIHByZWZpbHRlcnMgPSB7fSwKICAgIC8qIFRyYW5zcG9ydHMgYmluZGluZ3MKICAgICogMSkga2V5IGlzIHRoZSBkYXRhVHlwZQogICAgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAogICAgKiAzKSBzZWxlY3Rpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBnbyB0byAiKiIgaWYgbmVlZGVkCiAgICAqLwogICAgdHJhbnNwb3J0cyA9IHt9LAogICAgLy8gQXZvaWQgY29tbWVudC1wcm9sb2cgY2hhciBzZXF1ZW5jZSAoIzEwMDk4KTsgbXVzdCBhcHBlYXNlIGxpbnQgYW5kIGV2YWRlIGNvbXByZXNzaW9uCiAgICBhbGxUeXBlcyA9ICIqLyIuY29uY2F0KCIqIiksCiAgICAvLyBBbmNob3IgdGFnIGZvciBwYXJzaW5nIHRoZSBkb2N1bWVudCBvcmlnaW4KICAgIG9yaWdpbkFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICBvcmlnaW5BbmNob3IuaHJlZiA9IGxvY2F0aW9uLmhyZWY7CgogIC8vIEJhc2UgImNvbnN0cnVjdG9yIiBmb3IgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIgYW5kIGpRdWVyeS5hamF4VHJhbnNwb3J0CiAgZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKHN0cnVjdHVyZSkgewogICAgLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jKSB7CiAgICAgIGlmICh0eXBlb2YgZGF0YVR5cGVFeHByZXNzaW9uICE9PSAic3RyaW5nIikgewogICAgICAgIGZ1bmMgPSBkYXRhVHlwZUV4cHJlc3Npb247CiAgICAgICAgZGF0YVR5cGVFeHByZXNzaW9uID0gIioiOwogICAgICB9CiAgICAgIHZhciBkYXRhVHlwZSwKICAgICAgICBpID0gMCwKICAgICAgICBkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaChybm90aHRtbHdoaXRlKSB8fCBbXTsKICAgICAgaWYgKGlzRnVuY3Rpb24oZnVuYykpIHsKICAgICAgICAvLyBGb3IgZWFjaCBkYXRhVHlwZSBpbiB0aGUgZGF0YVR5cGVFeHByZXNzaW9uCiAgICAgICAgd2hpbGUgKGRhdGFUeXBlID0gZGF0YVR5cGVzW2krK10pIHsKICAgICAgICAgIC8vIFByZXBlbmQgaWYgcmVxdWVzdGVkCiAgICAgICAgICBpZiAoZGF0YVR5cGVbMF0gPT09ICIrIikgewogICAgICAgICAgICBkYXRhVHlwZSA9IGRhdGFUeXBlLnNsaWNlKDEpIHx8ICIqIjsKICAgICAgICAgICAgKHN0cnVjdHVyZVtkYXRhVHlwZV0gPSBzdHJ1Y3R1cmVbZGF0YVR5cGVdIHx8IFtdKS51bnNoaWZ0KGZ1bmMpOwoKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGFwcGVuZAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgKHN0cnVjdHVyZVtkYXRhVHlwZV0gPSBzdHJ1Y3R1cmVbZGF0YVR5cGVdIHx8IFtdKS5wdXNoKGZ1bmMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CgogIC8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwogIGZ1bmN0aW9uIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKHN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUikgewogICAgdmFyIGluc3BlY3RlZCA9IHt9LAogICAgICBzZWVraW5nVHJhbnNwb3J0ID0gc3RydWN0dXJlID09PSB0cmFuc3BvcnRzOwogICAgZnVuY3Rpb24gaW5zcGVjdChkYXRhVHlwZSkgewogICAgICB2YXIgc2VsZWN0ZWQ7CiAgICAgIGluc3BlY3RlZFtkYXRhVHlwZV0gPSB0cnVlOwogICAgICBqUXVlcnkuZWFjaChzdHJ1Y3R1cmVbZGF0YVR5cGVdIHx8IFtdLCBmdW5jdGlvbiAoXywgcHJlZmlsdGVyT3JGYWN0b3J5KSB7CiAgICAgICAgdmFyIGRhdGFUeXBlT3JUcmFuc3BvcnQgPSBwcmVmaWx0ZXJPckZhY3Rvcnkob3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUik7CiAgICAgICAgaWYgKHR5cGVvZiBkYXRhVHlwZU9yVHJhbnNwb3J0ID09PSAic3RyaW5nIiAmJiAhc2Vla2luZ1RyYW5zcG9ydCAmJiAhaW5zcGVjdGVkW2RhdGFUeXBlT3JUcmFuc3BvcnRdKSB7CiAgICAgICAgICBvcHRpb25zLmRhdGFUeXBlcy51bnNoaWZ0KGRhdGFUeXBlT3JUcmFuc3BvcnQpOwogICAgICAgICAgaW5zcGVjdChkYXRhVHlwZU9yVHJhbnNwb3J0KTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKHNlZWtpbmdUcmFuc3BvcnQpIHsKICAgICAgICAgIHJldHVybiAhKHNlbGVjdGVkID0gZGF0YVR5cGVPclRyYW5zcG9ydCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHNlbGVjdGVkOwogICAgfQogICAgcmV0dXJuIGluc3BlY3Qob3B0aW9ucy5kYXRhVHlwZXNbMF0pIHx8ICFpbnNwZWN0ZWRbIioiXSAmJiBpbnNwZWN0KCIqIik7CiAgfQoKICAvLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKICAvLyB0aGF0IHRha2VzICJmbGF0IiBvcHRpb25zIChub3QgdG8gYmUgZGVlcCBleHRlbmRlZCkKICAvLyBGaXhlcyAjOTg4NwogIGZ1bmN0aW9uIGFqYXhFeHRlbmQodGFyZ2V0LCBzcmMpIHsKICAgIHZhciBrZXksCiAgICAgIGRlZXAsCiAgICAgIGZsYXRPcHRpb25zID0galF1ZXJ5LmFqYXhTZXR0aW5ncy5mbGF0T3B0aW9ucyB8fCB7fTsKICAgIGZvciAoa2V5IGluIHNyYykgewogICAgICBpZiAoc3JjW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIChmbGF0T3B0aW9uc1trZXldID8gdGFyZ2V0IDogZGVlcCB8fCAoZGVlcCA9IHt9KSlba2V5XSA9IHNyY1trZXldOwogICAgICB9CiAgICB9CiAgICBpZiAoZGVlcCkgewogICAgICBqUXVlcnkuZXh0ZW5kKHRydWUsIHRhcmdldCwgZGVlcCk7CiAgICB9CiAgICByZXR1cm4gdGFyZ2V0OwogIH0KCiAgLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogICogLSBmaW5kcyB0aGUgcmlnaHQgZGF0YVR5cGUgKG1lZGlhdGVzIGJldHdlZW4gY29udGVudC10eXBlIGFuZCBleHBlY3RlZCBkYXRhVHlwZSkKICAqIC0gcmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyByZXNwb25zZQogICovCiAgZnVuY3Rpb24gYWpheEhhbmRsZVJlc3BvbnNlcyhzLCBqcVhIUiwgcmVzcG9uc2VzKSB7CiAgICB2YXIgY3QsCiAgICAgIHR5cGUsCiAgICAgIGZpbmFsRGF0YVR5cGUsCiAgICAgIGZpcnN0RGF0YVR5cGUsCiAgICAgIGNvbnRlbnRzID0gcy5jb250ZW50cywKICAgICAgZGF0YVR5cGVzID0gcy5kYXRhVHlwZXM7CgogICAgLy8gUmVtb3ZlIGF1dG8gZGF0YVR5cGUgYW5kIGdldCBjb250ZW50LXR5cGUgaW4gdGhlIHByb2Nlc3MKICAgIHdoaWxlIChkYXRhVHlwZXNbMF0gPT09ICIqIikgewogICAgICBkYXRhVHlwZXMuc2hpZnQoKTsKICAgICAgaWYgKGN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpOwogICAgICB9CiAgICB9CgogICAgLy8gQ2hlY2sgaWYgd2UncmUgZGVhbGluZyB3aXRoIGEga25vd24gY29udGVudC10eXBlCiAgICBpZiAoY3QpIHsKICAgICAgZm9yICh0eXBlIGluIGNvbnRlbnRzKSB7CiAgICAgICAgaWYgKGNvbnRlbnRzW3R5cGVdICYmIGNvbnRlbnRzW3R5cGVdLnRlc3QoY3QpKSB7CiAgICAgICAgICBkYXRhVHlwZXMudW5zaGlmdCh0eXBlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcmVzcG9uc2UgZm9yIHRoZSBleHBlY3RlZCBkYXRhVHlwZQogICAgaWYgKGRhdGFUeXBlc1swXSBpbiByZXNwb25zZXMpIHsKICAgICAgZmluYWxEYXRhVHlwZSA9IGRhdGFUeXBlc1swXTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIFRyeSBjb252ZXJ0aWJsZSBkYXRhVHlwZXMKICAgICAgZm9yICh0eXBlIGluIHJlc3BvbnNlcykgewogICAgICAgIGlmICghZGF0YVR5cGVzWzBdIHx8IHMuY29udmVydGVyc1t0eXBlICsgIiAiICsgZGF0YVR5cGVzWzBdXSkgewogICAgICAgICAgZmluYWxEYXRhVHlwZSA9IHR5cGU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKCFmaXJzdERhdGFUeXBlKSB7CiAgICAgICAgICBmaXJzdERhdGFUeXBlID0gdHlwZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZQogICAgICBmaW5hbERhdGFUeXBlID0gZmluYWxEYXRhVHlwZSB8fCBmaXJzdERhdGFUeXBlOwogICAgfQoKICAgIC8vIElmIHdlIGZvdW5kIGEgZGF0YVR5cGUKICAgIC8vIFdlIGFkZCB0aGUgZGF0YVR5cGUgdG8gdGhlIGxpc3QgaWYgbmVlZGVkCiAgICAvLyBhbmQgcmV0dXJuIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCiAgICBpZiAoZmluYWxEYXRhVHlwZSkgewogICAgICBpZiAoZmluYWxEYXRhVHlwZSAhPT0gZGF0YVR5cGVzWzBdKSB7CiAgICAgICAgZGF0YVR5cGVzLnVuc2hpZnQoZmluYWxEYXRhVHlwZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3BvbnNlc1tmaW5hbERhdGFUeXBlXTsKICAgIH0KICB9CgogIC8qIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKICAqIEFsc28gc2V0cyB0aGUgcmVzcG9uc2VYWFggZmllbGRzIG9uIHRoZSBqcVhIUiBpbnN0YW5jZQogICovCiAgZnVuY3Rpb24gYWpheENvbnZlcnQocywgcmVzcG9uc2UsIGpxWEhSLCBpc1N1Y2Nlc3MpIHsKICAgIHZhciBjb252MiwKICAgICAgY3VycmVudCwKICAgICAgY29udiwKICAgICAgdG1wLAogICAgICBwcmV2LAogICAgICBjb252ZXJ0ZXJzID0ge30sCiAgICAgIC8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KICAgICAgZGF0YVR5cGVzID0gcy5kYXRhVHlwZXMuc2xpY2UoKTsKCiAgICAvLyBDcmVhdGUgY29udmVydGVycyBtYXAgd2l0aCBsb3dlcmNhc2VkIGtleXMKICAgIGlmIChkYXRhVHlwZXNbMV0pIHsKICAgICAgZm9yIChjb252IGluIHMuY29udmVydGVycykgewogICAgICAgIGNvbnZlcnRlcnNbY29udi50b0xvd2VyQ2FzZSgpXSA9IHMuY29udmVydGVyc1tjb252XTsKICAgICAgfQogICAgfQogICAgY3VycmVudCA9IGRhdGFUeXBlcy5zaGlmdCgpOwoKICAgIC8vIENvbnZlcnQgdG8gZWFjaCBzZXF1ZW50aWFsIGRhdGFUeXBlCiAgICB3aGlsZSAoY3VycmVudCkgewogICAgICBpZiAocy5yZXNwb25zZUZpZWxkc1tjdXJyZW50XSkgewogICAgICAgIGpxWEhSW3MucmVzcG9uc2VGaWVsZHNbY3VycmVudF1dID0gcmVzcG9uc2U7CiAgICAgIH0KCiAgICAgIC8vIEFwcGx5IHRoZSBkYXRhRmlsdGVyIGlmIHByb3ZpZGVkCiAgICAgIGlmICghcHJldiAmJiBpc1N1Y2Nlc3MgJiYgcy5kYXRhRmlsdGVyKSB7CiAgICAgICAgcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIocmVzcG9uc2UsIHMuZGF0YVR5cGUpOwogICAgICB9CiAgICAgIHByZXYgPSBjdXJyZW50OwogICAgICBjdXJyZW50ID0gZGF0YVR5cGVzLnNoaWZ0KCk7CiAgICAgIGlmIChjdXJyZW50KSB7CiAgICAgICAgLy8gVGhlcmUncyBvbmx5IHdvcmsgdG8gZG8gaWYgY3VycmVudCBkYXRhVHlwZSBpcyBub24tYXV0bwogICAgICAgIGlmIChjdXJyZW50ID09PSAiKiIpIHsKICAgICAgICAgIGN1cnJlbnQgPSBwcmV2OwoKICAgICAgICAgIC8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKICAgICAgICB9IGVsc2UgaWYgKHByZXYgIT09ICIqIiAmJiBwcmV2ICE9PSBjdXJyZW50KSB7CiAgICAgICAgICAvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgogICAgICAgICAgY29udiA9IGNvbnZlcnRlcnNbcHJldiArICIgIiArIGN1cnJlbnRdIHx8IGNvbnZlcnRlcnNbIiogIiArIGN1cnJlbnRdOwoKICAgICAgICAgIC8vIElmIG5vbmUgZm91bmQsIHNlZWsgYSBwYWlyCiAgICAgICAgICBpZiAoIWNvbnYpIHsKICAgICAgICAgICAgZm9yIChjb252MiBpbiBjb252ZXJ0ZXJzKSB7CiAgICAgICAgICAgICAgLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CiAgICAgICAgICAgICAgdG1wID0gY29udjIuc3BsaXQoIiAiKTsKICAgICAgICAgICAgICBpZiAodG1wWzFdID09PSBjdXJyZW50KSB7CiAgICAgICAgICAgICAgICAvLyBJZiBwcmV2IGNhbiBiZSBjb252ZXJ0ZWQgdG8gYWNjZXB0ZWQgaW5wdXQKICAgICAgICAgICAgICAgIGNvbnYgPSBjb252ZXJ0ZXJzW3ByZXYgKyAiICIgKyB0bXBbMF1dIHx8IGNvbnZlcnRlcnNbIiogIiArIHRtcFswXV07CiAgICAgICAgICAgICAgICBpZiAoY29udikgewogICAgICAgICAgICAgICAgICAvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCiAgICAgICAgICAgICAgICAgIGlmIChjb252ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgY29udiA9IGNvbnZlcnRlcnNbY29udjJdOwoKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGluc2VydCB0aGUgaW50ZXJtZWRpYXRlIGRhdGFUeXBlCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udmVydGVyc1tjb252Ml0gIT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gdG1wWzBdOwogICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlcy51bnNoaWZ0KHRtcFsxXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQXBwbHkgY29udmVydGVyIChpZiBub3QgYW4gZXF1aXZhbGVuY2UpCiAgICAgICAgICBpZiAoY29udiAhPT0gdHJ1ZSkgewogICAgICAgICAgICAvLyBVbmxlc3MgZXJyb3JzIGFyZSBhbGxvd2VkIHRvIGJ1YmJsZSwgY2F0Y2ggYW5kIHJldHVybiB0aGVtCiAgICAgICAgICAgIGlmIChjb252ICYmIHMudGhyb3dzKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjb252KHJlc3BvbnNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjb252KHJlc3BvbnNlKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBzdGF0ZTogInBhcnNlcmVycm9yIiwKICAgICAgICAgICAgICAgICAgZXJyb3I6IGNvbnYgPyBlIDogIk5vIGNvbnZlcnNpb24gZnJvbSAiICsgcHJldiArICIgdG8gIiArIGN1cnJlbnQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBzdGF0ZTogInN1Y2Nlc3MiLAogICAgICBkYXRhOiByZXNwb25zZQogICAgfTsKICB9CiAgalF1ZXJ5LmV4dGVuZCh7CiAgICAvLyBDb3VudGVyIGZvciBob2xkaW5nIHRoZSBudW1iZXIgb2YgYWN0aXZlIHF1ZXJpZXMKICAgIGFjdGl2ZTogMCwKICAgIC8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKICAgIGxhc3RNb2RpZmllZDoge30sCiAgICBldGFnOiB7fSwKICAgIGFqYXhTZXR0aW5nczogewogICAgICB1cmw6IGxvY2F0aW9uLmhyZWYsCiAgICAgIHR5cGU6ICJHRVQiLAogICAgICBpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KGxvY2F0aW9uLnByb3RvY29sKSwKICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICBwcm9jZXNzRGF0YTogdHJ1ZSwKICAgICAgYXN5bmM6IHRydWUsCiAgICAgIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiwKICAgICAgLyoKICAgICAgdGltZW91dDogMCwKICAgICAgZGF0YTogbnVsbCwKICAgICAgZGF0YVR5cGU6IG51bGwsCiAgICAgIHVzZXJuYW1lOiBudWxsLAogICAgICBwYXNzd29yZDogbnVsbCwKICAgICAgY2FjaGU6IG51bGwsCiAgICAgIHRocm93czogZmFsc2UsCiAgICAgIHRyYWRpdGlvbmFsOiBmYWxzZSwKICAgICAgaGVhZGVyczoge30sCiAgICAgICovCgogICAgICBhY2NlcHRzOiB7CiAgICAgICAgIioiOiBhbGxUeXBlcywKICAgICAgICB0ZXh0OiAidGV4dC9wbGFpbiIsCiAgICAgICAgaHRtbDogInRleHQvaHRtbCIsCiAgICAgICAgeG1sOiAiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsCiAgICAgICAganNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKICAgICAgfSwKICAgICAgY29udGVudHM6IHsKICAgICAgICB4bWw6IC9cYnhtbFxiLywKICAgICAgICBodG1sOiAvXGJodG1sLywKICAgICAgICBqc29uOiAvXGJqc29uXGIvCiAgICAgIH0sCiAgICAgIHJlc3BvbnNlRmllbGRzOiB7CiAgICAgICAgeG1sOiAicmVzcG9uc2VYTUwiLAogICAgICAgIHRleHQ6ICJyZXNwb25zZVRleHQiLAogICAgICAgIGpzb246ICJyZXNwb25zZUpTT04iCiAgICAgIH0sCiAgICAgIC8vIERhdGEgY29udmVydGVycwogICAgICAvLyBLZXlzIHNlcGFyYXRlIHNvdXJjZSAob3IgY2F0Y2hhbGwgIioiKSBhbmQgZGVzdGluYXRpb24gdHlwZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQogICAgICBjb252ZXJ0ZXJzOiB7CiAgICAgICAgLy8gQ29udmVydCBhbnl0aGluZyB0byB0ZXh0CiAgICAgICAgIiogdGV4dCI6IFN0cmluZywKICAgICAgICAvLyBUZXh0IHRvIGh0bWwgKHRydWUgPSBubyB0cmFuc2Zvcm1hdGlvbikKICAgICAgICAidGV4dCBodG1sIjogdHJ1ZSwKICAgICAgICAvLyBFdmFsdWF0ZSB0ZXh0IGFzIGEganNvbiBleHByZXNzaW9uCiAgICAgICAgInRleHQganNvbiI6IEpTT04ucGFyc2UsCiAgICAgICAgLy8gUGFyc2UgdGV4dCBhcyB4bWwKICAgICAgICAidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKICAgICAgfSwKICAgICAgLy8gRm9yIG9wdGlvbnMgdGhhdCBzaG91bGRuJ3QgYmUgZGVlcCBleHRlbmRlZDoKICAgICAgLy8geW91IGNhbiBhZGQgeW91ciBvd24gY3VzdG9tIG9wdGlvbnMgaGVyZSBpZgogICAgICAvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQogICAgICAvLyBkZWVwIGV4dGVuZGVkIChzZWUgYWpheEV4dGVuZCkKICAgICAgZmxhdE9wdGlvbnM6IHsKICAgICAgICB1cmw6IHRydWUsCiAgICAgICAgY29udGV4dDogdHJ1ZQogICAgICB9CiAgICB9LAogICAgLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKICAgIC8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KICAgIC8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCiAgICBhamF4U2V0dXA6IGZ1bmN0aW9uIGFqYXhTZXR1cCh0YXJnZXQsIHNldHRpbmdzKSB7CiAgICAgIHJldHVybiBzZXR0aW5ncyA/CiAgICAgIC8vIEJ1aWxkaW5nIGEgc2V0dGluZ3Mgb2JqZWN0CiAgICAgIGFqYXhFeHRlbmQoYWpheEV4dGVuZCh0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MpLCBzZXR0aW5ncykgOgogICAgICAvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCiAgICAgIGFqYXhFeHRlbmQoalF1ZXJ5LmFqYXhTZXR0aW5ncywgdGFyZ2V0KTsKICAgIH0sCiAgICBhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMocHJlZmlsdGVycyksCiAgICBhamF4VHJhbnNwb3J0OiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHModHJhbnNwb3J0cyksCiAgICAvLyBNYWluIG1ldGhvZAogICAgYWpheDogZnVuY3Rpb24gYWpheCh1cmwsIG9wdGlvbnMpIHsKICAgICAgLy8gSWYgdXJsIGlzIGFuIG9iamVjdCwgc2ltdWxhdGUgcHJlLTEuNSBzaWduYXR1cmUKICAgICAgaWYgKF90eXBlb2YodXJsKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICBvcHRpb25zID0gdXJsOwogICAgICAgIHVybCA9IHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgLy8gRm9yY2Ugb3B0aW9ucyB0byBiZSBhbiBvYmplY3QKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIHZhciB0cmFuc3BvcnQsCiAgICAgICAgLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQogICAgICAgIGNhY2hlVVJMLAogICAgICAgIC8vIFJlc3BvbnNlIGhlYWRlcnMKICAgICAgICByZXNwb25zZUhlYWRlcnNTdHJpbmcsCiAgICAgICAgcmVzcG9uc2VIZWFkZXJzLAogICAgICAgIC8vIHRpbWVvdXQgaGFuZGxlCiAgICAgICAgdGltZW91dFRpbWVyLAogICAgICAgIC8vIFVybCBjbGVhbnVwIHZhcgogICAgICAgIHVybEFuY2hvciwKICAgICAgICAvLyBSZXF1ZXN0IHN0YXRlIChiZWNvbWVzIGZhbHNlIHVwb24gc2VuZCBhbmQgdHJ1ZSB1cG9uIGNvbXBsZXRpb24pCiAgICAgICAgY29tcGxldGVkLAogICAgICAgIC8vIFRvIGtub3cgaWYgZ2xvYmFsIGV2ZW50cyBhcmUgdG8gYmUgZGlzcGF0Y2hlZAogICAgICAgIGZpcmVHbG9iYWxzLAogICAgICAgIC8vIExvb3AgdmFyaWFibGUKICAgICAgICBpLAogICAgICAgIC8vIHVuY2FjaGVkIHBhcnQgb2YgdGhlIHVybAogICAgICAgIHVuY2FjaGVkLAogICAgICAgIC8vIENyZWF0ZSB0aGUgZmluYWwgb3B0aW9ucyBvYmplY3QKICAgICAgICBzID0galF1ZXJ5LmFqYXhTZXR1cCh7fSwgb3B0aW9ucyksCiAgICAgICAgLy8gQ2FsbGJhY2tzIGNvbnRleHQKICAgICAgICBjYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKICAgICAgICAvLyBDb250ZXh0IGZvciBnbG9iYWwgZXZlbnRzIGlzIGNhbGxiYWNrQ29udGV4dCBpZiBpdCBpcyBhIERPTSBub2RlIG9yIGpRdWVyeSBjb2xsZWN0aW9uCiAgICAgICAgZ2xvYmFsRXZlbnRDb250ZXh0ID0gcy5jb250ZXh0ICYmIChjYWxsYmFja0NvbnRleHQubm9kZVR5cGUgfHwgY2FsbGJhY2tDb250ZXh0LmpxdWVyeSkgPyBqUXVlcnkoY2FsbGJhY2tDb250ZXh0KSA6IGpRdWVyeS5ldmVudCwKICAgICAgICAvLyBEZWZlcnJlZHMKICAgICAgICBkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLAogICAgICAgIGNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLAogICAgICAgIC8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCiAgICAgICAgX3N0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCiAgICAgICAgLy8gSGVhZGVycyAodGhleSBhcmUgc2VudCBhbGwgYXQgb25jZSkKICAgICAgICByZXF1ZXN0SGVhZGVycyA9IHt9LAogICAgICAgIHJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKICAgICAgICAvLyBEZWZhdWx0IGFib3J0IG1lc3NhZ2UKICAgICAgICBzdHJBYm9ydCA9ICJjYW5jZWxlZCIsCiAgICAgICAgLy8gRmFrZSB4aHIKICAgICAgICBqcVhIUiA9IHsKICAgICAgICAgIHJlYWR5U3RhdGU6IDAsCiAgICAgICAgICAvLyBCdWlsZHMgaGVhZGVycyBoYXNodGFibGUgaWYgbmVlZGVkCiAgICAgICAgICBnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24gZ2V0UmVzcG9uc2VIZWFkZXIoa2V5KSB7CiAgICAgICAgICAgIHZhciBtYXRjaDsKICAgICAgICAgICAgaWYgKGNvbXBsZXRlZCkgewogICAgICAgICAgICAgIGlmICghcmVzcG9uc2VIZWFkZXJzKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZUhlYWRlcnMgPSB7fTsKICAgICAgICAgICAgICAgIHdoaWxlIChtYXRjaCA9IHJoZWFkZXJzLmV4ZWMocmVzcG9uc2VIZWFkZXJzU3RyaW5nKSkgewogICAgICAgICAgICAgICAgICByZXNwb25zZUhlYWRlcnNbbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSArICIgIl0gPSAocmVzcG9uc2VIZWFkZXJzW21hdGNoWzFdLnRvTG93ZXJDYXNlKCkgKyAiICJdIHx8IFtdKS5jb25jYXQobWF0Y2hbMl0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1trZXkudG9Mb3dlckNhc2UoKSArICIgIl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2guam9pbigiLCAiKTsKICAgICAgICAgIH0sCiAgICAgICAgICAvLyBSYXcgc3RyaW5nCiAgICAgICAgICBnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uIGdldEFsbFJlc3BvbnNlSGVhZGVycygpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbXBsZXRlZCA/IHJlc3BvbnNlSGVhZGVyc1N0cmluZyA6IG51bGw7CiAgICAgICAgICB9LAogICAgICAgICAgLy8gQ2FjaGVzIHRoZSBoZWFkZXIKICAgICAgICAgIHNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uIHNldFJlcXVlc3RIZWFkZXIobmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKGNvbXBsZXRlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgbmFtZSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbbmFtZS50b0xvd2VyQ2FzZSgpXSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbbmFtZS50b0xvd2VyQ2FzZSgpXSB8fCBuYW1lOwogICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzW25hbWVdID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9LAogICAgICAgICAgLy8gT3ZlcnJpZGVzIHJlc3BvbnNlIGNvbnRlbnQtdHlwZSBoZWFkZXIKICAgICAgICAgIG92ZXJyaWRlTWltZVR5cGU6IGZ1bmN0aW9uIG92ZXJyaWRlTWltZVR5cGUodHlwZSkgewogICAgICAgICAgICBpZiAoY29tcGxldGVkID09IG51bGwpIHsKICAgICAgICAgICAgICBzLm1pbWVUeXBlID0gdHlwZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0sCiAgICAgICAgICAvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwogICAgICAgICAgc3RhdHVzQ29kZTogZnVuY3Rpb24gc3RhdHVzQ29kZShtYXApIHsKICAgICAgICAgICAgdmFyIGNvZGU7CiAgICAgICAgICAgIGlmIChtYXApIHsKICAgICAgICAgICAgICBpZiAoY29tcGxldGVkKSB7CiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBhcHByb3ByaWF0ZSBjYWxsYmFja3MKICAgICAgICAgICAgICAgIGpxWEhSLmFsd2F5cyhtYXBbanFYSFIuc3RhdHVzXSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIExhenktYWRkIHRoZSBuZXcgY2FsbGJhY2tzIGluIGEgd2F5IHRoYXQgcHJlc2VydmVzIG9sZCBvbmVzCiAgICAgICAgICAgICAgICBmb3IgKGNvZGUgaW4gbWFwKSB7CiAgICAgICAgICAgICAgICAgIF9zdGF0dXNDb2RlW2NvZGVdID0gW19zdGF0dXNDb2RlW2NvZGVdLCBtYXBbY29kZV1dOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0sCiAgICAgICAgICAvLyBDYW5jZWwgdGhlIHJlcXVlc3QKICAgICAgICAgIGFib3J0OiBmdW5jdGlvbiBhYm9ydChzdGF0dXNUZXh0KSB7CiAgICAgICAgICAgIHZhciBmaW5hbFRleHQgPSBzdGF0dXNUZXh0IHx8IHN0ckFib3J0OwogICAgICAgICAgICBpZiAodHJhbnNwb3J0KSB7CiAgICAgICAgICAgICAgdHJhbnNwb3J0LmFib3J0KGZpbmFsVGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9uZSgwLCBmaW5hbFRleHQpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgLy8gQXR0YWNoIGRlZmVycmVkcwogICAgICBkZWZlcnJlZC5wcm9taXNlKGpxWEhSKTsKCiAgICAgIC8vIEFkZCBwcm90b2NvbCBpZiBub3QgcHJvdmlkZWQgKHByZWZpbHRlcnMgbWlnaHQgZXhwZWN0IGl0KQogICAgICAvLyBIYW5kbGUgZmFsc3kgdXJsIGluIHRoZSBzZXR0aW5ncyBvYmplY3QgKCMxMDA5MzogY29uc2lzdGVuY3kgd2l0aCBvbGQgc2lnbmF0dXJlKQogICAgICAvLyBXZSBhbHNvIHVzZSB0aGUgdXJsIHBhcmFtZXRlciBpZiBhdmFpbGFibGUKICAgICAgcy51cmwgPSAoKHVybCB8fCBzLnVybCB8fCBsb2NhdGlvbi5ocmVmKSArICIiKS5yZXBsYWNlKHJwcm90b2NvbCwgbG9jYXRpb24ucHJvdG9jb2wgKyAiLy8iKTsKCiAgICAgIC8vIEFsaWFzIG1ldGhvZCBvcHRpb24gdG8gdHlwZSBhcyBwZXIgdGlja2V0ICMxMjAwNAogICAgICBzLnR5cGUgPSBvcHRpb25zLm1ldGhvZCB8fCBvcHRpb25zLnR5cGUgfHwgcy5tZXRob2QgfHwgcy50eXBlOwoKICAgICAgLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAogICAgICBzLmRhdGFUeXBlcyA9IChzLmRhdGFUeXBlIHx8ICIqIikudG9Mb3dlckNhc2UoKS5tYXRjaChybm90aHRtbHdoaXRlKSB8fCBbIiJdOwoKICAgICAgLy8gQSBjcm9zcy1kb21haW4gcmVxdWVzdCBpcyBpbiBvcmRlciB3aGVuIHRoZSBvcmlnaW4gZG9lc24ndCBtYXRjaCB0aGUgY3VycmVudCBvcmlnaW4uCiAgICAgIGlmIChzLmNyb3NzRG9tYWluID09IG51bGwpIHsKICAgICAgICB1cmxBbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CgogICAgICAgIC8vIFN1cHBvcnQ6IElFIDw9OCAtIDExLCBFZGdlIDEyIC0gMTUKICAgICAgICAvLyBJRSB0aHJvd3MgZXhjZXB0aW9uIG9uIGFjY2Vzc2luZyB0aGUgaHJlZiBwcm9wZXJ0eSBpZiB1cmwgaXMgbWFsZm9ybWVkLAogICAgICAgIC8vIGUuZy4gaHR0cDovL2V4YW1wbGUuY29tOjgweC8KICAgICAgICB0cnkgewogICAgICAgICAgdXJsQW5jaG9yLmhyZWYgPSBzLnVybDsKCiAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PTggLSAxMSBvbmx5CiAgICAgICAgICAvLyBBbmNob3IncyBob3N0IHByb3BlcnR5IGlzbid0IGNvcnJlY3RseSBzZXQgd2hlbiBzLnVybCBpcyByZWxhdGl2ZQogICAgICAgICAgdXJsQW5jaG9yLmhyZWYgPSB1cmxBbmNob3IuaHJlZjsKICAgICAgICAgIHMuY3Jvc3NEb21haW4gPSBvcmlnaW5BbmNob3IucHJvdG9jb2wgKyAiLy8iICsgb3JpZ2luQW5jaG9yLmhvc3QgIT09IHVybEFuY2hvci5wcm90b2NvbCArICIvLyIgKyB1cmxBbmNob3IuaG9zdDsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBlcnJvciBwYXJzaW5nIHRoZSBVUkwsIGFzc3VtZSBpdCBpcyBjcm9zc0RvbWFpbiwKICAgICAgICAgIC8vIGl0IGNhbiBiZSByZWplY3RlZCBieSB0aGUgdHJhbnNwb3J0IGlmIGl0IGlzIGludmFsaWQKICAgICAgICAgIHMuY3Jvc3NEb21haW4gPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCiAgICAgIGlmIChzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIikgewogICAgICAgIHMuZGF0YSA9IGpRdWVyeS5wYXJhbShzLmRhdGEsIHMudHJhZGl0aW9uYWwpOwogICAgICB9CgogICAgICAvLyBBcHBseSBwcmVmaWx0ZXJzCiAgICAgIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKHByZWZpbHRlcnMsIHMsIG9wdGlvbnMsIGpxWEhSKTsKCiAgICAgIC8vIElmIHJlcXVlc3Qgd2FzIGFib3J0ZWQgaW5zaWRlIGEgcHJlZmlsdGVyLCBzdG9wIHRoZXJlCiAgICAgIGlmIChjb21wbGV0ZWQpIHsKICAgICAgICByZXR1cm4ganFYSFI7CiAgICAgIH0KCiAgICAgIC8vIFdlIGNhbiBmaXJlIGdsb2JhbCBldmVudHMgYXMgb2Ygbm93IGlmIGFza2VkIHRvCiAgICAgIC8vIERvbid0IGZpcmUgZXZlbnRzIGlmIGpRdWVyeS5ldmVudCBpcyB1bmRlZmluZWQgaW4gYW4gQU1ELXVzYWdlIHNjZW5hcmlvICgjMTUxMTgpCiAgICAgIGZpcmVHbG9iYWxzID0galF1ZXJ5LmV2ZW50ICYmIHMuZ2xvYmFsOwoKICAgICAgLy8gV2F0Y2ggZm9yIGEgbmV3IHNldCBvZiByZXF1ZXN0cwogICAgICBpZiAoZmlyZUdsb2JhbHMgJiYgalF1ZXJ5LmFjdGl2ZSsrID09PSAwKSB7CiAgICAgICAgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwogICAgICB9CgogICAgICAvLyBVcHBlcmNhc2UgdGhlIHR5cGUKICAgICAgcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgogICAgICAvLyBEZXRlcm1pbmUgaWYgcmVxdWVzdCBoYXMgY29udGVudAogICAgICBzLmhhc0NvbnRlbnQgPSAhcm5vQ29udGVudC50ZXN0KHMudHlwZSk7CgogICAgICAvLyBTYXZlIHRoZSBVUkwgaW4gY2FzZSB3ZSdyZSB0b3lpbmcgd2l0aCB0aGUgSWYtTW9kaWZpZWQtU2luY2UKICAgICAgLy8gYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyIGxhdGVyIG9uCiAgICAgIC8vIFJlbW92ZSBoYXNoIHRvIHNpbXBsaWZ5IHVybCBtYW5pcHVsYXRpb24KICAgICAgY2FjaGVVUkwgPSBzLnVybC5yZXBsYWNlKHJoYXNoLCAiIik7CgogICAgICAvLyBNb3JlIG9wdGlvbnMgaGFuZGxpbmcgZm9yIHJlcXVlc3RzIHdpdGggbm8gY29udGVudAogICAgICBpZiAoIXMuaGFzQ29udGVudCkgewogICAgICAgIC8vIFJlbWVtYmVyIHRoZSBoYXNoIHNvIHdlIGNhbiBwdXQgaXQgYmFjawogICAgICAgIHVuY2FjaGVkID0gcy51cmwuc2xpY2UoY2FjaGVVUkwubGVuZ3RoKTsKCiAgICAgICAgLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUgYW5kIHNob3VsZCBiZSBwcm9jZXNzZWQsIGFwcGVuZCBkYXRhIHRvIHVybAogICAgICAgIGlmIChzLmRhdGEgJiYgKHMucHJvY2Vzc0RhdGEgfHwgdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIpKSB7CiAgICAgICAgICBjYWNoZVVSTCArPSAocnF1ZXJ5LnRlc3QoY2FjaGVVUkwpID8gIiYiIDogIj8iKSArIHMuZGF0YTsKCiAgICAgICAgICAvLyAjOTY4MjogcmVtb3ZlIGRhdGEgc28gdGhhdCBpdCdzIG5vdCB1c2VkIGluIGFuIGV2ZW50dWFsIHJldHJ5CiAgICAgICAgICBkZWxldGUgcy5kYXRhOwogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIG9yIHVwZGF0ZSBhbnRpLWNhY2hlIHBhcmFtIGlmIG5lZWRlZAogICAgICAgIGlmIChzLmNhY2hlID09PSBmYWxzZSkgewogICAgICAgICAgY2FjaGVVUkwgPSBjYWNoZVVSTC5yZXBsYWNlKHJhbnRpQ2FjaGUsICIkMSIpOwogICAgICAgICAgdW5jYWNoZWQgPSAocnF1ZXJ5LnRlc3QoY2FjaGVVUkwpID8gIiYiIDogIj8iKSArICJfPSIgKyBub25jZS5ndWlkKysgKyB1bmNhY2hlZDsKICAgICAgICB9CgogICAgICAgIC8vIFB1dCBoYXNoIGFuZCBhbnRpLWNhY2hlIG9uIHRoZSBVUkwgdGhhdCB3aWxsIGJlIHJlcXVlc3RlZCAoZ2gtMTczMikKICAgICAgICBzLnVybCA9IGNhY2hlVVJMICsgdW5jYWNoZWQ7CgogICAgICAgIC8vIENoYW5nZSAnJTIwJyB0byAnKycgaWYgdGhpcyBpcyBlbmNvZGVkIGZvcm0gYm9keSBjb250ZW50IChnaC0yNjU4KQogICAgICB9IGVsc2UgaWYgKHMuZGF0YSAmJiBzLnByb2Nlc3NEYXRhICYmIChzLmNvbnRlbnRUeXBlIHx8ICIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSA9PT0gMCkgewogICAgICAgIHMuZGF0YSA9IHMuZGF0YS5yZXBsYWNlKHIyMCwgIisiKTsKICAgICAgfQoKICAgICAgLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KICAgICAgaWYgKHMuaWZNb2RpZmllZCkgewogICAgICAgIGlmIChqUXVlcnkubGFzdE1vZGlmaWVkW2NhY2hlVVJMXSkgewogICAgICAgICAganFYSFIuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLCBqUXVlcnkubGFzdE1vZGlmaWVkW2NhY2hlVVJMXSk7CiAgICAgICAgfQogICAgICAgIGlmIChqUXVlcnkuZXRhZ1tjYWNoZVVSTF0pIHsKICAgICAgICAgIGpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIklmLU5vbmUtTWF0Y2giLCBqUXVlcnkuZXRhZ1tjYWNoZVVSTF0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2V0IHRoZSBjb3JyZWN0IGhlYWRlciwgaWYgZGF0YSBpcyBiZWluZyBzZW50CiAgICAgIGlmIChzLmRhdGEgJiYgcy5oYXNDb250ZW50ICYmIHMuY29udGVudFR5cGUgIT09IGZhbHNlIHx8IG9wdGlvbnMuY29udGVudFR5cGUpIHsKICAgICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCBzLmNvbnRlbnRUeXBlKTsKICAgICAgfQoKICAgICAgLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQogICAgICBqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLCBzLmRhdGFUeXBlc1swXSAmJiBzLmFjY2VwdHNbcy5kYXRhVHlwZXNbMF1dID8gcy5hY2NlcHRzW3MuZGF0YVR5cGVzWzBdXSArIChzLmRhdGFUeXBlc1swXSAhPT0gIioiID8gIiwgIiArIGFsbFR5cGVzICsgIjsgcT0wLjAxIiA6ICIiKSA6IHMuYWNjZXB0c1siKiJdKTsKCiAgICAgIC8vIENoZWNrIGZvciBoZWFkZXJzIG9wdGlvbgogICAgICBmb3IgKGkgaW4gcy5oZWFkZXJzKSB7CiAgICAgICAganFYSFIuc2V0UmVxdWVzdEhlYWRlcihpLCBzLmhlYWRlcnNbaV0pOwogICAgICB9CgogICAgICAvLyBBbGxvdyBjdXN0b20gaGVhZGVycy9taW1ldHlwZXMgYW5kIGVhcmx5IGFib3J0CiAgICAgIGlmIChzLmJlZm9yZVNlbmQgJiYgKHMuYmVmb3JlU2VuZC5jYWxsKGNhbGxiYWNrQ29udGV4dCwganFYSFIsIHMpID09PSBmYWxzZSB8fCBjb21wbGV0ZWQpKSB7CiAgICAgICAgLy8gQWJvcnQgaWYgbm90IGRvbmUgYWxyZWFkeSBhbmQgcmV0dXJuCiAgICAgICAgcmV0dXJuIGpxWEhSLmFib3J0KCk7CiAgICAgIH0KCiAgICAgIC8vIEFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgogICAgICBzdHJBYm9ydCA9ICJhYm9ydCI7CgogICAgICAvLyBJbnN0YWxsIGNhbGxiYWNrcyBvbiBkZWZlcnJlZHMKICAgICAgY29tcGxldGVEZWZlcnJlZC5hZGQocy5jb21wbGV0ZSk7CiAgICAgIGpxWEhSLmRvbmUocy5zdWNjZXNzKTsKICAgICAganFYSFIuZmFpbChzLmVycm9yKTsKCiAgICAgIC8vIEdldCB0cmFuc3BvcnQKICAgICAgdHJhbnNwb3J0ID0gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHModHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIpOwoKICAgICAgLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CiAgICAgIGlmICghdHJhbnNwb3J0KSB7CiAgICAgICAgZG9uZSgtMSwgIk5vIFRyYW5zcG9ydCIpOwogICAgICB9IGVsc2UgewogICAgICAgIGpxWEhSLnJlYWR5U3RhdGUgPSAxOwoKICAgICAgICAvLyBTZW5kIGdsb2JhbCBldmVudAogICAgICAgIGlmIChmaXJlR2xvYmFscykgewogICAgICAgICAgZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoImFqYXhTZW5kIiwgW2pxWEhSLCBzXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiByZXF1ZXN0IHdhcyBhYm9ydGVkIGluc2lkZSBhamF4U2VuZCwgc3RvcCB0aGVyZQogICAgICAgIGlmIChjb21wbGV0ZWQpIHsKICAgICAgICAgIHJldHVybiBqcVhIUjsKICAgICAgICB9CgogICAgICAgIC8vIFRpbWVvdXQKICAgICAgICBpZiAocy5hc3luYyAmJiBzLnRpbWVvdXQgPiAwKSB7CiAgICAgICAgICB0aW1lb3V0VGltZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGpxWEhSLmFib3J0KCJ0aW1lb3V0Iik7CiAgICAgICAgICB9LCBzLnRpbWVvdXQpOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgY29tcGxldGVkID0gZmFsc2U7CiAgICAgICAgICB0cmFuc3BvcnQuc2VuZChyZXF1ZXN0SGVhZGVycywgZG9uZSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgLy8gUmV0aHJvdyBwb3N0LWNvbXBsZXRpb24gZXhjZXB0aW9ucwogICAgICAgICAgaWYgKGNvbXBsZXRlZCkgewogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFByb3BhZ2F0ZSBvdGhlcnMgYXMgcmVzdWx0cwogICAgICAgICAgZG9uZSgtMSwgZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKICAgICAgZnVuY3Rpb24gZG9uZShzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycykgewogICAgICAgIHZhciBpc1N1Y2Nlc3MsCiAgICAgICAgICBzdWNjZXNzLAogICAgICAgICAgZXJyb3IsCiAgICAgICAgICByZXNwb25zZSwKICAgICAgICAgIG1vZGlmaWVkLAogICAgICAgICAgc3RhdHVzVGV4dCA9IG5hdGl2ZVN0YXR1c1RleHQ7CgogICAgICAgIC8vIElnbm9yZSByZXBlYXQgaW52b2NhdGlvbnMKICAgICAgICBpZiAoY29tcGxldGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbXBsZXRlZCA9IHRydWU7CgogICAgICAgIC8vIENsZWFyIHRpbWVvdXQgaWYgaXQgZXhpc3RzCiAgICAgICAgaWYgKHRpbWVvdXRUaW1lcikgewogICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0VGltZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gRGVyZWZlcmVuY2UgdHJhbnNwb3J0IGZvciBlYXJseSBnYXJiYWdlIGNvbGxlY3Rpb24KICAgICAgICAvLyAobm8gbWF0dGVyIGhvdyBsb25nIHRoZSBqcVhIUiBvYmplY3Qgd2lsbCBiZSB1c2VkKQogICAgICAgIHRyYW5zcG9ydCA9IHVuZGVmaW5lZDsKCiAgICAgICAgLy8gQ2FjaGUgcmVzcG9uc2UgaGVhZGVycwogICAgICAgIHJlc3BvbnNlSGVhZGVyc1N0cmluZyA9IGhlYWRlcnMgfHwgIiI7CgogICAgICAgIC8vIFNldCByZWFkeVN0YXRlCiAgICAgICAganFYSFIucmVhZHlTdGF0ZSA9IHN0YXR1cyA+IDAgPyA0IDogMDsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHN1Y2Nlc3NmdWwKICAgICAgICBpc1N1Y2Nlc3MgPSBzdGF0dXMgPj0gMjAwICYmIHN0YXR1cyA8IDMwMCB8fCBzdGF0dXMgPT09IDMwNDsKCiAgICAgICAgLy8gR2V0IHJlc3BvbnNlIGRhdGEKICAgICAgICBpZiAocmVzcG9uc2VzKSB7CiAgICAgICAgICByZXNwb25zZSA9IGFqYXhIYW5kbGVSZXNwb25zZXMocywganFYSFIsIHJlc3BvbnNlcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBVc2UgYSBub29wIGNvbnZlcnRlciBmb3IgbWlzc2luZyBzY3JpcHQKICAgICAgICBpZiAoIWlzU3VjY2VzcyAmJiBqUXVlcnkuaW5BcnJheSgic2NyaXB0Iiwgcy5kYXRhVHlwZXMpID4gLTEpIHsKICAgICAgICAgIHMuY29udmVydGVyc1sidGV4dCBzY3JpcHQiXSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KCiAgICAgICAgLy8gQ29udmVydCBubyBtYXR0ZXIgd2hhdCAodGhhdCB3YXkgcmVzcG9uc2VYWFggZmllbGRzIGFyZSBhbHdheXMgc2V0KQogICAgICAgIHJlc3BvbnNlID0gYWpheENvbnZlcnQocywgcmVzcG9uc2UsIGpxWEhSLCBpc1N1Y2Nlc3MpOwoKICAgICAgICAvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwogICAgICAgIGlmIChpc1N1Y2Nlc3MpIHsKICAgICAgICAgIC8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCiAgICAgICAgICBpZiAocy5pZk1vZGlmaWVkKSB7CiAgICAgICAgICAgIG1vZGlmaWVkID0ganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKTsKICAgICAgICAgICAgaWYgKG1vZGlmaWVkKSB7CiAgICAgICAgICAgICAgalF1ZXJ5Lmxhc3RNb2RpZmllZFtjYWNoZVVSTF0gPSBtb2RpZmllZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBtb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CiAgICAgICAgICAgIGlmIChtb2RpZmllZCkgewogICAgICAgICAgICAgIGpRdWVyeS5ldGFnW2NhY2hlVVJMXSA9IG1vZGlmaWVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gaWYgbm8gY29udGVudAogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gMjA0IHx8IHMudHlwZSA9PT0gIkhFQUQiKSB7CiAgICAgICAgICAgIHN0YXR1c1RleHQgPSAibm9jb250ZW50IjsKCiAgICAgICAgICAgIC8vIGlmIG5vdCBtb2RpZmllZAogICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDMwNCkgewogICAgICAgICAgICBzdGF0dXNUZXh0ID0gIm5vdG1vZGlmaWVkIjsKCiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgZGF0YSwgbGV0J3MgY29udmVydCBpdAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdHVzVGV4dCA9IHJlc3BvbnNlLnN0YXRlOwogICAgICAgICAgICBzdWNjZXNzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgZXJyb3IgPSByZXNwb25zZS5lcnJvcjsKICAgICAgICAgICAgaXNTdWNjZXNzID0gIWVycm9yOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBFeHRyYWN0IGVycm9yIGZyb20gc3RhdHVzVGV4dCBhbmQgbm9ybWFsaXplIGZvciBub24tYWJvcnRzCiAgICAgICAgICBlcnJvciA9IHN0YXR1c1RleHQ7CiAgICAgICAgICBpZiAoc3RhdHVzIHx8ICFzdGF0dXNUZXh0KSB7CiAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiZXJyb3IiOwogICAgICAgICAgICBpZiAoc3RhdHVzIDwgMCkgewogICAgICAgICAgICAgIHN0YXR1cyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CiAgICAgICAganFYSFIuc3RhdHVzID0gc3RhdHVzOwogICAgICAgIGpxWEhSLnN0YXR1c1RleHQgPSAobmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0KSArICIiOwoKICAgICAgICAvLyBTdWNjZXNzL0Vycm9yCiAgICAgICAgaWYgKGlzU3VjY2VzcykgewogICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZVdpdGgoY2FsbGJhY2tDb250ZXh0LCBbc3VjY2Vzcywgc3RhdHVzVGV4dCwganFYSFJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVmZXJyZWQucmVqZWN0V2l0aChjYWxsYmFja0NvbnRleHQsIFtqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3JdKTsKICAgICAgICB9CgogICAgICAgIC8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCiAgICAgICAganFYSFIuc3RhdHVzQ29kZShfc3RhdHVzQ29kZSk7CiAgICAgICAgX3N0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgaWYgKGZpcmVHbG9iYWxzKSB7CiAgICAgICAgICBnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlcihpc1N1Y2Nlc3MgPyAiYWpheFN1Y2Nlc3MiIDogImFqYXhFcnJvciIsIFtqcVhIUiwgcywgaXNTdWNjZXNzID8gc3VjY2VzcyA6IGVycm9yXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBDb21wbGV0ZQogICAgICAgIGNvbXBsZXRlRGVmZXJyZWQuZmlyZVdpdGgoY2FsbGJhY2tDb250ZXh0LCBbanFYSFIsIHN0YXR1c1RleHRdKTsKICAgICAgICBpZiAoZmlyZUdsb2JhbHMpIHsKICAgICAgICAgIGdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCJhamF4Q29tcGxldGUiLCBbanFYSFIsIHNdKTsKCiAgICAgICAgICAvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKICAgICAgICAgIGlmICghIC0talF1ZXJ5LmFjdGl2ZSkgewogICAgICAgICAgICBqUXVlcnkuZXZlbnQudHJpZ2dlcigiYWpheFN0b3AiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGpxWEhSOwogICAgfSwKICAgIGdldEpTT046IGZ1bmN0aW9uIGdldEpTT04odXJsLCBkYXRhLCBjYWxsYmFjaykgewogICAgICByZXR1cm4galF1ZXJ5LmdldCh1cmwsIGRhdGEsIGNhbGxiYWNrLCAianNvbiIpOwogICAgfSwKICAgIGdldFNjcmlwdDogZnVuY3Rpb24gZ2V0U2NyaXB0KHVybCwgY2FsbGJhY2spIHsKICAgICAgcmV0dXJuIGpRdWVyeS5nZXQodXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0Iik7CiAgICB9CiAgfSk7CiAgalF1ZXJ5LmVhY2goWyJnZXQiLCAicG9zdCJdLCBmdW5jdGlvbiAoX2ksIG1ldGhvZCkgewogICAgalF1ZXJ5W21ldGhvZF0gPSBmdW5jdGlvbiAodXJsLCBkYXRhLCBjYWxsYmFjaywgdHlwZSkgewogICAgICAvLyBTaGlmdCBhcmd1bWVudHMgaWYgZGF0YSBhcmd1bWVudCB3YXMgb21pdHRlZAogICAgICBpZiAoaXNGdW5jdGlvbihkYXRhKSkgewogICAgICAgIHR5cGUgPSB0eXBlIHx8IGNhbGxiYWNrOwogICAgICAgIGNhbGxiYWNrID0gZGF0YTsKICAgICAgICBkYXRhID0gdW5kZWZpbmVkOwogICAgICB9CgogICAgICAvLyBUaGUgdXJsIGNhbiBiZSBhbiBvcHRpb25zIG9iamVjdCAod2hpY2ggdGhlbiBtdXN0IGhhdmUgLnVybCkKICAgICAgcmV0dXJuIGpRdWVyeS5hamF4KGpRdWVyeS5leHRlbmQoewogICAgICAgIHVybDogdXJsLAogICAgICAgIHR5cGU6IG1ldGhvZCwKICAgICAgICBkYXRhVHlwZTogdHlwZSwKICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIHN1Y2Nlc3M6IGNhbGxiYWNrCiAgICAgIH0sIGpRdWVyeS5pc1BsYWluT2JqZWN0KHVybCkgJiYgdXJsKSk7CiAgICB9OwogIH0pOwogIGpRdWVyeS5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uIChzKSB7CiAgICB2YXIgaTsKICAgIGZvciAoaSBpbiBzLmhlYWRlcnMpIHsKICAgICAgaWYgKGkudG9Mb3dlckNhc2UoKSA9PT0gImNvbnRlbnQtdHlwZSIpIHsKICAgICAgICBzLmNvbnRlbnRUeXBlID0gcy5oZWFkZXJzW2ldIHx8ICIiOwogICAgICB9CiAgICB9CiAgfSk7CiAgalF1ZXJ5Ll9ldmFsVXJsID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucywgZG9jKSB7CiAgICByZXR1cm4galF1ZXJ5LmFqYXgoewogICAgICB1cmw6IHVybCwKICAgICAgLy8gTWFrZSB0aGlzIGV4cGxpY2l0LCBzaW5jZSB1c2VyIGNhbiBvdmVycmlkZSB0aGlzIHRocm91Z2ggYWpheFNldHVwICgjMTEyNjQpCiAgICAgIHR5cGU6ICJHRVQiLAogICAgICBkYXRhVHlwZTogInNjcmlwdCIsCiAgICAgIGNhY2hlOiB0cnVlLAogICAgICBhc3luYzogZmFsc2UsCiAgICAgIGdsb2JhbDogZmFsc2UsCiAgICAgIC8vIE9ubHkgZXZhbHVhdGUgdGhlIHJlc3BvbnNlIGlmIGl0IGlzIHN1Y2Nlc3NmdWwgKGdoLTQxMjYpCiAgICAgIC8vIGRhdGFGaWx0ZXIgaXMgbm90IGludm9rZWQgZm9yIGZhaWx1cmUgcmVzcG9uc2VzLCBzbyB1c2luZyBpdCBpbnN0ZWFkCiAgICAgIC8vIG9mIHRoZSBkZWZhdWx0IGNvbnZlcnRlciBpcyBrbHVkZ3kgYnV0IGl0IHdvcmtzLgogICAgICBjb252ZXJ0ZXJzOiB7CiAgICAgICAgInRleHQgc2NyaXB0IjogZnVuY3Rpb24gdGV4dFNjcmlwdCgpIHt9CiAgICAgIH0sCiAgICAgIGRhdGFGaWx0ZXI6IGZ1bmN0aW9uIGRhdGFGaWx0ZXIocmVzcG9uc2UpIHsKICAgICAgICBqUXVlcnkuZ2xvYmFsRXZhbChyZXNwb25zZSwgb3B0aW9ucywgZG9jKTsKICAgICAgfQogICAgfSk7CiAgfTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIHdyYXBBbGw6IGZ1bmN0aW9uIHdyYXBBbGwoaHRtbCkgewogICAgICB2YXIgd3JhcDsKICAgICAgaWYgKHRoaXNbMF0pIHsKICAgICAgICBpZiAoaXNGdW5jdGlvbihodG1sKSkgewogICAgICAgICAgaHRtbCA9IGh0bWwuY2FsbCh0aGlzWzBdKTsKICAgICAgICB9CgogICAgICAgIC8vIFRoZSBlbGVtZW50cyB0byB3cmFwIHRoZSB0YXJnZXQgYXJvdW5kCiAgICAgICAgd3JhcCA9IGpRdWVyeShodG1sLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKHRydWUpOwogICAgICAgIGlmICh0aGlzWzBdLnBhcmVudE5vZGUpIHsKICAgICAgICAgIHdyYXAuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pOwogICAgICAgIH0KICAgICAgICB3cmFwLm1hcChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZWxlbSA9IHRoaXM7CiAgICAgICAgICB3aGlsZSAoZWxlbS5maXJzdEVsZW1lbnRDaGlsZCkgewogICAgICAgICAgICBlbGVtID0gZWxlbS5maXJzdEVsZW1lbnRDaGlsZDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlbGVtOwogICAgICAgIH0pLmFwcGVuZCh0aGlzKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICB3cmFwSW5uZXI6IGZ1bmN0aW9uIHdyYXBJbm5lcihodG1sKSB7CiAgICAgIGlmIChpc0Z1bmN0aW9uKGh0bWwpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgalF1ZXJ5KHRoaXMpLndyYXBJbm5lcihodG1sLmNhbGwodGhpcywgaSkpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxmID0galF1ZXJ5KHRoaXMpLAogICAgICAgICAgY29udGVudHMgPSBzZWxmLmNvbnRlbnRzKCk7CiAgICAgICAgaWYgKGNvbnRlbnRzLmxlbmd0aCkgewogICAgICAgICAgY29udGVudHMud3JhcEFsbChodG1sKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi5hcHBlbmQoaHRtbCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICB3cmFwOiBmdW5jdGlvbiB3cmFwKGh0bWwpIHsKICAgICAgdmFyIGh0bWxJc0Z1bmN0aW9uID0gaXNGdW5jdGlvbihodG1sKTsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgIGpRdWVyeSh0aGlzKS53cmFwQWxsKGh0bWxJc0Z1bmN0aW9uID8gaHRtbC5jYWxsKHRoaXMsIGkpIDogaHRtbCk7CiAgICAgIH0pOwogICAgfSwKICAgIHVud3JhcDogZnVuY3Rpb24gdW53cmFwKHNlbGVjdG9yKSB7CiAgICAgIHRoaXMucGFyZW50KHNlbGVjdG9yKS5ub3QoImJvZHkiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBqUXVlcnkodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0pOwogIGpRdWVyeS5leHByLnBzZXVkb3MuaGlkZGVuID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgIHJldHVybiAhalF1ZXJ5LmV4cHIucHNldWRvcy52aXNpYmxlKGVsZW0pOwogIH07CiAgalF1ZXJ5LmV4cHIucHNldWRvcy52aXNpYmxlID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgIHJldHVybiAhIShlbGVtLm9mZnNldFdpZHRoIHx8IGVsZW0ub2Zmc2V0SGVpZ2h0IHx8IGVsZW0uZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpOwogIH07CiAgalF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIgPSBmdW5jdGlvbiAoKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCgpOwogICAgfSBjYXRjaCAoZSkge30KICB9OwogIHZhciB4aHJTdWNjZXNzU3RhdHVzID0gewogICAgICAvLyBGaWxlIHByb3RvY29sIGFsd2F5cyB5aWVsZHMgc3RhdHVzIGNvZGUgMCwgYXNzdW1lIDIwMAogICAgICAwOiAyMDAsCiAgICAgIC8vIFN1cHBvcnQ6IElFIDw9OSBvbmx5CiAgICAgIC8vICMxNDUwOiBzb21ldGltZXMgSUUgcmV0dXJucyAxMjIzIHdoZW4gaXQgc2hvdWxkIGJlIDIwNAogICAgICAxMjIzOiAyMDQKICAgIH0sCiAgICB4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwogIHN1cHBvcnQuY29ycyA9ICEheGhyU3VwcG9ydGVkICYmICJ3aXRoQ3JlZGVudGlhbHMiIGluIHhoclN1cHBvcnRlZDsKICBzdXBwb3J0LmFqYXggPSB4aHJTdXBwb3J0ZWQgPSAhIXhoclN1cHBvcnRlZDsKICBqUXVlcnkuYWpheFRyYW5zcG9ydChmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIF9jYWxsYmFjaywgZXJyb3JDYWxsYmFjazsKCiAgICAvLyBDcm9zcyBkb21haW4gb25seSBhbGxvd2VkIGlmIHN1cHBvcnRlZCB0aHJvdWdoIFhNTEh0dHBSZXF1ZXN0CiAgICBpZiAoc3VwcG9ydC5jb3JzIHx8IHhoclN1cHBvcnRlZCAmJiAhb3B0aW9ucy5jcm9zc0RvbWFpbikgewogICAgICByZXR1cm4gewogICAgICAgIHNlbmQ6IGZ1bmN0aW9uIHNlbmQoaGVhZGVycywgY29tcGxldGUpIHsKICAgICAgICAgIHZhciBpLAogICAgICAgICAgICB4aHIgPSBvcHRpb25zLnhocigpOwogICAgICAgICAgeGhyLm9wZW4ob3B0aW9ucy50eXBlLCBvcHRpb25zLnVybCwgb3B0aW9ucy5hc3luYywgb3B0aW9ucy51c2VybmFtZSwgb3B0aW9ucy5wYXNzd29yZCk7CgogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIGZpZWxkcyBpZiBwcm92aWRlZAogICAgICAgICAgaWYgKG9wdGlvbnMueGhyRmllbGRzKSB7CiAgICAgICAgICAgIGZvciAoaSBpbiBvcHRpb25zLnhockZpZWxkcykgewogICAgICAgICAgICAgIHhocltpXSA9IG9wdGlvbnMueGhyRmllbGRzW2ldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZAogICAgICAgICAgaWYgKG9wdGlvbnMubWltZVR5cGUgJiYgeGhyLm92ZXJyaWRlTWltZVR5cGUpIHsKICAgICAgICAgICAgeGhyLm92ZXJyaWRlTWltZVR5cGUob3B0aW9ucy5taW1lVHlwZSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKICAgICAgICAgIC8vIEZvciBjcm9zcy1kb21haW4gcmVxdWVzdHMsIHNlZWluZyBhcyBjb25kaXRpb25zIGZvciBhIHByZWZsaWdodCBhcmUKICAgICAgICAgIC8vIGFraW4gdG8gYSBqaWdzYXcgcHV6emxlLCB3ZSBzaW1wbHkgbmV2ZXIgc2V0IGl0IHRvIGJlIHN1cmUuCiAgICAgICAgICAvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKICAgICAgICAgIC8vIEZvciBzYW1lLWRvbWFpbiByZXF1ZXN0cywgd29uJ3QgY2hhbmdlIGhlYWRlciBpZiBhbHJlYWR5IHByb3ZpZGVkLgogICAgICAgICAgaWYgKCFvcHRpb25zLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0pIHsKICAgICAgICAgICAgaGVhZGVyc1siWC1SZXF1ZXN0ZWQtV2l0aCJdID0gIlhNTEh0dHBSZXF1ZXN0IjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTZXQgaGVhZGVycwogICAgICAgICAgZm9yIChpIGluIGhlYWRlcnMpIHsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaSwgaGVhZGVyc1tpXSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQ2FsbGJhY2sKICAgICAgICAgIF9jYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKHR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX2NhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBfY2FsbGJhY2sgPSBlcnJvckNhbGxiYWNrID0geGhyLm9ubG9hZCA9IHhoci5vbmVycm9yID0geGhyLm9uYWJvcnQgPSB4aHIub250aW1lb3V0ID0geGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gImFib3J0IikgewogICAgICAgICAgICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImVycm9yIikgewogICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PTkgb25seQogICAgICAgICAgICAgICAgICAvLyBPbiBhIG1hbnVhbCBuYXRpdmUgYWJvcnQsIElFOSB0aHJvd3MKICAgICAgICAgICAgICAgICAgLy8gZXJyb3JzIG9uIGFueSBwcm9wZXJ0eSBhY2Nlc3MgdGhhdCBpcyBub3QgcmVhZHlTdGF0ZQogICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHhoci5zdGF0dXMgIT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgICAgY29tcGxldGUoMCwgImVycm9yIik7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29tcGxldGUoCiAgICAgICAgICAgICAgICAgICAgLy8gRmlsZTogcHJvdG9jb2wgYWx3YXlzIHlpZWxkcyBzdGF0dXMgMDsgc2VlICM4NjA1LCAjMTQyMDcKICAgICAgICAgICAgICAgICAgICB4aHIuc3RhdHVzLCB4aHIuc3RhdHVzVGV4dCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGNvbXBsZXRlKHhoclN1Y2Nlc3NTdGF0dXNbeGhyLnN0YXR1c10gfHwgeGhyLnN0YXR1cywgeGhyLnN0YXR1c1RleHQsCiAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFIDw9OSBvbmx5CiAgICAgICAgICAgICAgICAgIC8vIElFOSBoYXMgbm8gWEhSMiBidXQgdGhyb3dzIG9uIGJpbmFyeSAodHJhYy0xMTQyNikKICAgICAgICAgICAgICAgICAgLy8gRm9yIFhIUjIgbm9uLXRleHQsIGxldCB0aGUgY2FsbGVyIGhhbmRsZSBpdCAoZ2gtMjQ5OCkKICAgICAgICAgICAgICAgICAgKHhoci5yZXNwb25zZVR5cGUgfHwgInRleHQiKSAhPT0gInRleHQiIHx8IHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ICE9PSAic3RyaW5nIiA/IHsKICAgICAgICAgICAgICAgICAgICBiaW5hcnk6IHhoci5yZXNwb25zZQogICAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgIHRleHQ6IHhoci5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgfSwgeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9OwoKICAgICAgICAgIC8vIExpc3RlbiB0byBldmVudHMKICAgICAgICAgIHhoci5vbmxvYWQgPSBfY2FsbGJhY2soKTsKICAgICAgICAgIGVycm9yQ2FsbGJhY2sgPSB4aHIub25lcnJvciA9IHhoci5vbnRpbWVvdXQgPSBfY2FsbGJhY2soImVycm9yIik7CgogICAgICAgICAgLy8gU3VwcG9ydDogSUUgOSBvbmx5CiAgICAgICAgICAvLyBVc2Ugb25yZWFkeXN0YXRlY2hhbmdlIHRvIHJlcGxhY2Ugb25hYm9ydAogICAgICAgICAgLy8gdG8gaGFuZGxlIHVuY2F1Z2h0IGFib3J0cwogICAgICAgICAgaWYgKHhoci5vbmFib3J0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgeGhyLm9uYWJvcnQgPSBlcnJvckNhbGxiYWNrOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAvLyBDaGVjayByZWFkeVN0YXRlIGJlZm9yZSB0aW1lb3V0IGFzIGl0IGNoYW5nZXMKICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICAgICAgICAgIC8vIEFsbG93IG9uZXJyb3IgdG8gYmUgY2FsbGVkIGZpcnN0LAogICAgICAgICAgICAgICAgLy8gYnV0IHRoYXQgd2lsbCBub3QgaGFuZGxlIGEgbmF0aXZlIGFib3J0CiAgICAgICAgICAgICAgICAvLyBBbHNvLCBzYXZlIGVycm9yQ2FsbGJhY2sgdG8gYSB2YXJpYWJsZQogICAgICAgICAgICAgICAgLy8gYXMgeGhyLm9uZXJyb3IgY2Fubm90IGJlIGFjY2Vzc2VkCiAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChfY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBDcmVhdGUgdGhlIGFib3J0IGNhbGxiYWNrCiAgICAgICAgICBfY2FsbGJhY2sgPSBfY2FsbGJhY2soImFib3J0Iik7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBEbyBzZW5kIHRoZSByZXF1ZXN0ICh0aGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24pCiAgICAgICAgICAgIHhoci5zZW5kKG9wdGlvbnMuaGFzQ29udGVudCAmJiBvcHRpb25zLmRhdGEgfHwgbnVsbCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIC8vICMxNDY4MzogT25seSByZXRocm93IGlmIHRoaXMgaGFzbid0IGJlZW4gbm90aWZpZWQgYXMgYW4gZXJyb3IgeWV0CiAgICAgICAgICAgIGlmIChfY2FsbGJhY2spIHsKICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhYm9ydDogZnVuY3Rpb24gYWJvcnQoKSB7CiAgICAgICAgICBpZiAoX2NhbGxiYWNrKSB7CiAgICAgICAgICAgIF9jYWxsYmFjaygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gUHJldmVudCBhdXRvLWV4ZWN1dGlvbiBvZiBzY3JpcHRzIHdoZW4gbm8gZXhwbGljaXQgZGF0YVR5cGUgd2FzIHByb3ZpZGVkIChTZWUgZ2gtMjQzMikKICBqUXVlcnkuYWpheFByZWZpbHRlcihmdW5jdGlvbiAocykgewogICAgaWYgKHMuY3Jvc3NEb21haW4pIHsKICAgICAgcy5jb250ZW50cy5zY3JpcHQgPSBmYWxzZTsKICAgIH0KICB9KTsKCiAgLy8gSW5zdGFsbCBzY3JpcHQgZGF0YVR5cGUKICBqUXVlcnkuYWpheFNldHVwKHsKICAgIGFjY2VwdHM6IHsKICAgICAgc2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCAiICsgImFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKICAgIH0sCiAgICBjb250ZW50czogewogICAgICBzY3JpcHQ6IC9cYig/OmphdmF8ZWNtYSlzY3JpcHRcYi8KICAgIH0sCiAgICBjb252ZXJ0ZXJzOiB7CiAgICAgICJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uIHRleHRTY3JpcHQodGV4dCkgewogICAgICAgIGpRdWVyeS5nbG9iYWxFdmFsKHRleHQpOwogICAgICAgIHJldHVybiB0ZXh0OwogICAgICB9CiAgICB9CiAgfSk7CgogIC8vIEhhbmRsZSBjYWNoZSdzIHNwZWNpYWwgY2FzZSBhbmQgY3Jvc3NEb21haW4KICBqUXVlcnkuYWpheFByZWZpbHRlcigic2NyaXB0IiwgZnVuY3Rpb24gKHMpIHsKICAgIGlmIChzLmNhY2hlID09PSB1bmRlZmluZWQpIHsKICAgICAgcy5jYWNoZSA9IGZhbHNlOwogICAgfQogICAgaWYgKHMuY3Jvc3NEb21haW4pIHsKICAgICAgcy50eXBlID0gIkdFVCI7CiAgICB9CiAgfSk7CgogIC8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydAogIGpRdWVyeS5hamF4VHJhbnNwb3J0KCJzY3JpcHQiLCBmdW5jdGlvbiAocykgewogICAgLy8gVGhpcyB0cmFuc3BvcnQgb25seSBkZWFscyB3aXRoIGNyb3NzIGRvbWFpbiBvciBmb3JjZWQtYnktYXR0cnMgcmVxdWVzdHMKICAgIGlmIChzLmNyb3NzRG9tYWluIHx8IHMuc2NyaXB0QXR0cnMpIHsKICAgICAgdmFyIHNjcmlwdCwgX2NhbGxiYWNrMjsKICAgICAgcmV0dXJuIHsKICAgICAgICBzZW5kOiBmdW5jdGlvbiBzZW5kKF8sIGNvbXBsZXRlKSB7CiAgICAgICAgICBzY3JpcHQgPSBqUXVlcnkoIjxzY3JpcHQ+IikuYXR0cihzLnNjcmlwdEF0dHJzIHx8IHt9KS5wcm9wKHsKICAgICAgICAgICAgY2hhcnNldDogcy5zY3JpcHRDaGFyc2V0LAogICAgICAgICAgICBzcmM6IHMudXJsCiAgICAgICAgICB9KS5vbigibG9hZCBlcnJvciIsIF9jYWxsYmFjazIgPSBmdW5jdGlvbiBjYWxsYmFjayhldnQpIHsKICAgICAgICAgICAgc2NyaXB0LnJlbW92ZSgpOwogICAgICAgICAgICBfY2FsbGJhY2syID0gbnVsbDsKICAgICAgICAgICAgaWYgKGV2dCkgewogICAgICAgICAgICAgIGNvbXBsZXRlKGV2dC50eXBlID09PSAiZXJyb3IiID8gNDA0IDogMjAwLCBldnQudHlwZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQogICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHRbMF0pOwogICAgICAgIH0sCiAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgICAgaWYgKF9jYWxsYmFjazIpIHsKICAgICAgICAgICAgX2NhbGxiYWNrMigpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KTsKICB2YXIgb2xkQ2FsbGJhY2tzID0gW10sCiAgICByanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKICAvLyBEZWZhdWx0IGpzb25wIHNldHRpbmdzCiAgalF1ZXJ5LmFqYXhTZXR1cCh7CiAgICBqc29ucDogImNhbGxiYWNrIiwKICAgIGpzb25wQ2FsbGJhY2s6IGZ1bmN0aW9uIGpzb25wQ2FsbGJhY2soKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IG9sZENhbGxiYWNrcy5wb3AoKSB8fCBqUXVlcnkuZXhwYW5kbyArICJfIiArIG5vbmNlLmd1aWQrKzsKICAgICAgdGhpc1tjYWxsYmFja10gPSB0cnVlOwogICAgICByZXR1cm4gY2FsbGJhY2s7CiAgICB9CiAgfSk7CgogIC8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwogIGpRdWVyeS5hamF4UHJlZmlsdGVyKCJqc29uIGpzb25wIiwgZnVuY3Rpb24gKHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSKSB7CiAgICB2YXIgY2FsbGJhY2tOYW1lLAogICAgICBvdmVyd3JpdHRlbiwKICAgICAgcmVzcG9uc2VDb250YWluZXIsCiAgICAgIGpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKHJqc29ucC50ZXN0KHMudXJsKSA/ICJ1cmwiIDogdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgKHMuY29udGVudFR5cGUgfHwgIiIpLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpID09PSAwICYmIHJqc29ucC50ZXN0KHMuZGF0YSkgJiYgImRhdGEiKTsKCiAgICAvLyBIYW5kbGUgaWZmIHRoZSBleHBlY3RlZCBkYXRhIHR5cGUgaXMgImpzb25wIiBvciB3ZSBoYXZlIGEgcGFyYW1ldGVyIHRvIHNldAogICAgaWYgKGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWzBdID09PSAianNvbnAiKSB7CiAgICAgIC8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKICAgICAgY2FsbGJhY2tOYW1lID0gcy5qc29ucENhbGxiYWNrID0gaXNGdW5jdGlvbihzLmpzb25wQ2FsbGJhY2spID8gcy5qc29ucENhbGxiYWNrKCkgOiBzLmpzb25wQ2FsbGJhY2s7CgogICAgICAvLyBJbnNlcnQgY2FsbGJhY2sgaW50byB1cmwgb3IgZm9ybSBkYXRhCiAgICAgIGlmIChqc29uUHJvcCkgewogICAgICAgIHNbanNvblByb3BdID0gc1tqc29uUHJvcF0ucmVwbGFjZShyanNvbnAsICIkMSIgKyBjYWxsYmFja05hbWUpOwogICAgICB9IGVsc2UgaWYgKHMuanNvbnAgIT09IGZhbHNlKSB7CiAgICAgICAgcy51cmwgKz0gKHJxdWVyeS50ZXN0KHMudXJsKSA/ICImIiA6ICI/IikgKyBzLmpzb25wICsgIj0iICsgY2FsbGJhY2tOYW1lOwogICAgICB9CgogICAgICAvLyBVc2UgZGF0YSBjb252ZXJ0ZXIgdG8gcmV0cmlldmUganNvbiBhZnRlciBzY3JpcHQgZXhlY3V0aW9uCiAgICAgIHMuY29udmVydGVyc1sic2NyaXB0IGpzb24iXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXJlc3BvbnNlQ29udGFpbmVyKSB7CiAgICAgICAgICBqUXVlcnkuZXJyb3IoY2FsbGJhY2tOYW1lICsgIiB3YXMgbm90IGNhbGxlZCIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzcG9uc2VDb250YWluZXJbMF07CiAgICAgIH07CgogICAgICAvLyBGb3JjZSBqc29uIGRhdGFUeXBlCiAgICAgIHMuZGF0YVR5cGVzWzBdID0gImpzb24iOwoKICAgICAgLy8gSW5zdGFsbCBjYWxsYmFjawogICAgICBvdmVyd3JpdHRlbiA9IHdpbmRvd1tjYWxsYmFja05hbWVdOwogICAgICB3aW5kb3dbY2FsbGJhY2tOYW1lXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXNwb25zZUNvbnRhaW5lciA9IGFyZ3VtZW50czsKICAgICAgfTsKCiAgICAgIC8vIENsZWFuLXVwIGZ1bmN0aW9uIChmaXJlcyBhZnRlciBjb252ZXJ0ZXJzKQogICAgICBqcVhIUi5hbHdheXMoZnVuY3Rpb24gKCkgewogICAgICAgIC8vIElmIHByZXZpb3VzIHZhbHVlIGRpZG4ndCBleGlzdCAtIHJlbW92ZSBpdAogICAgICAgIGlmIChvdmVyd3JpdHRlbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBqUXVlcnkod2luZG93KS5yZW1vdmVQcm9wKGNhbGxiYWNrTmFtZSk7CgogICAgICAgICAgLy8gT3RoZXJ3aXNlIHJlc3RvcmUgcHJlZXhpc3RpbmcgdmFsdWUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2luZG93W2NhbGxiYWNrTmFtZV0gPSBvdmVyd3JpdHRlbjsKICAgICAgICB9CgogICAgICAgIC8vIFNhdmUgYmFjayBhcyBmcmVlCiAgICAgICAgaWYgKHNbY2FsbGJhY2tOYW1lXSkgewogICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgcmUtdXNpbmcgdGhlIG9wdGlvbnMgZG9lc24ndCBzY3JldyB0aGluZ3MgYXJvdW5kCiAgICAgICAgICBzLmpzb25wQ2FsbGJhY2sgPSBvcmlnaW5hbFNldHRpbmdzLmpzb25wQ2FsbGJhY2s7CgogICAgICAgICAgLy8gU2F2ZSB0aGUgY2FsbGJhY2sgbmFtZSBmb3IgZnV0dXJlIHVzZQogICAgICAgICAgb2xkQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2tOYW1lKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGwgaWYgaXQgd2FzIGEgZnVuY3Rpb24gYW5kIHdlIGhhdmUgYSByZXNwb25zZQogICAgICAgIGlmIChyZXNwb25zZUNvbnRhaW5lciAmJiBpc0Z1bmN0aW9uKG92ZXJ3cml0dGVuKSkgewogICAgICAgICAgb3ZlcndyaXR0ZW4ocmVzcG9uc2VDb250YWluZXJbMF0pOwogICAgICAgIH0KICAgICAgICByZXNwb25zZUNvbnRhaW5lciA9IG92ZXJ3cml0dGVuID0gdW5kZWZpbmVkOwogICAgICB9KTsKCiAgICAgIC8vIERlbGVnYXRlIHRvIHNjcmlwdAogICAgICByZXR1cm4gInNjcmlwdCI7CiAgICB9CiAgfSk7CgogIC8vIFN1cHBvcnQ6IFNhZmFyaSA4IG9ubHkKICAvLyBJbiBTYWZhcmkgOCBkb2N1bWVudHMgY3JlYXRlZCB2aWEgZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50CiAgLy8gY29sbGFwc2Ugc2libGluZyBmb3JtczogdGhlIHNlY29uZCBvbmUgYmVjb21lcyBhIGNoaWxkIG9mIHRoZSBmaXJzdCBvbmUuCiAgLy8gQmVjYXVzZSBvZiB0aGF0LCB0aGlzIHNlY3VyaXR5IG1lYXN1cmUgaGFzIHRvIGJlIGRpc2FibGVkIGluIFNhZmFyaSA4LgogIC8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0xMzczMzcKICBzdXBwb3J0LmNyZWF0ZUhUTUxEb2N1bWVudCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBib2R5ID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5OwogICAgYm9keS5pbm5lckhUTUwgPSAiPGZvcm0+PC9mb3JtPjxmb3JtPjwvZm9ybT4iOwogICAgcmV0dXJuIGJvZHkuY2hpbGROb2Rlcy5sZW5ndGggPT09IDI7CiAgfSgpOwoKICAvLyBBcmd1bWVudCAiZGF0YSIgc2hvdWxkIGJlIHN0cmluZyBvZiBodG1sCiAgLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LAogIC8vIGRlZmF1bHRzIHRvIGRvY3VtZW50CiAgLy8ga2VlcFNjcmlwdHMgKG9wdGlvbmFsKTogSWYgdHJ1ZSwgd2lsbCBpbmNsdWRlIHNjcmlwdHMgcGFzc2VkIGluIHRoZSBodG1sIHN0cmluZwogIGpRdWVyeS5wYXJzZUhUTUwgPSBmdW5jdGlvbiAoZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMpIHsKICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgaWYgKHR5cGVvZiBjb250ZXh0ID09PSAiYm9vbGVhbiIpIHsKICAgICAga2VlcFNjcmlwdHMgPSBjb250ZXh0OwogICAgICBjb250ZXh0ID0gZmFsc2U7CiAgICB9CiAgICB2YXIgYmFzZSwgcGFyc2VkLCBzY3JpcHRzOwogICAgaWYgKCFjb250ZXh0KSB7CiAgICAgIC8vIFN0b3Agc2NyaXB0cyBvciBpbmxpbmUgZXZlbnQgaGFuZGxlcnMgZnJvbSBiZWluZyBleGVjdXRlZCBpbW1lZGlhdGVseQogICAgICAvLyBieSB1c2luZyBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbgogICAgICBpZiAoc3VwcG9ydC5jcmVhdGVIVE1MRG9jdW1lbnQpIHsKICAgICAgICBjb250ZXh0ID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKTsKCiAgICAgICAgLy8gU2V0IHRoZSBiYXNlIGhyZWYgZm9yIHRoZSBjcmVhdGVkIGRvY3VtZW50CiAgICAgICAgLy8gc28gYW55IHBhcnNlZCBlbGVtZW50cyB3aXRoIFVSTHMKICAgICAgICAvLyBhcmUgYmFzZWQgb24gdGhlIGRvY3VtZW50J3MgVVJMIChnaC0yOTY1KQogICAgICAgIGJhc2UgPSBjb250ZXh0LmNyZWF0ZUVsZW1lbnQoImJhc2UiKTsKICAgICAgICBiYXNlLmhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwogICAgICAgIGNvbnRleHQuaGVhZC5hcHBlbmRDaGlsZChiYXNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb250ZXh0ID0gZG9jdW1lbnQ7CiAgICAgIH0KICAgIH0KICAgIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyhkYXRhKTsKICAgIHNjcmlwdHMgPSAha2VlcFNjcmlwdHMgJiYgW107CgogICAgLy8gU2luZ2xlIHRhZwogICAgaWYgKHBhcnNlZCkgewogICAgICByZXR1cm4gW2NvbnRleHQuY3JlYXRlRWxlbWVudChwYXJzZWRbMV0pXTsKICAgIH0KICAgIHBhcnNlZCA9IGJ1aWxkRnJhZ21lbnQoW2RhdGFdLCBjb250ZXh0LCBzY3JpcHRzKTsKICAgIGlmIChzY3JpcHRzICYmIHNjcmlwdHMubGVuZ3RoKSB7CiAgICAgIGpRdWVyeShzY3JpcHRzKS5yZW1vdmUoKTsKICAgIH0KICAgIHJldHVybiBqUXVlcnkubWVyZ2UoW10sIHBhcnNlZC5jaGlsZE5vZGVzKTsKICB9OwoKICAvKioKICAgKiBMb2FkIGEgdXJsIGludG8gYSBwYWdlCiAgICovCiAgalF1ZXJ5LmZuLmxvYWQgPSBmdW5jdGlvbiAodXJsLCBwYXJhbXMsIGNhbGxiYWNrKSB7CiAgICB2YXIgc2VsZWN0b3IsCiAgICAgIHR5cGUsCiAgICAgIHJlc3BvbnNlLAogICAgICBzZWxmID0gdGhpcywKICAgICAgb2ZmID0gdXJsLmluZGV4T2YoIiAiKTsKICAgIGlmIChvZmYgPiAtMSkgewogICAgICBzZWxlY3RvciA9IHN0cmlwQW5kQ29sbGFwc2UodXJsLnNsaWNlKG9mZikpOwogICAgICB1cmwgPSB1cmwuc2xpY2UoMCwgb2ZmKTsKICAgIH0KCiAgICAvLyBJZiBpdCdzIGEgZnVuY3Rpb24KICAgIGlmIChpc0Z1bmN0aW9uKHBhcmFtcykpIHsKICAgICAgLy8gV2UgYXNzdW1lIHRoYXQgaXQncyB0aGUgY2FsbGJhY2sKICAgICAgY2FsbGJhY2sgPSBwYXJhbXM7CiAgICAgIHBhcmFtcyA9IHVuZGVmaW5lZDsKCiAgICAgIC8vIE90aGVyd2lzZSwgYnVpbGQgYSBwYXJhbSBzdHJpbmcKICAgIH0gZWxzZSBpZiAocGFyYW1zICYmIF90eXBlb2YocGFyYW1zKSA9PT0gIm9iamVjdCIpIHsKICAgICAgdHlwZSA9ICJQT1NUIjsKICAgIH0KCiAgICAvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAogICAgaWYgKHNlbGYubGVuZ3RoID4gMCkgewogICAgICBqUXVlcnkuYWpheCh7CiAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgLy8gSWYgInR5cGUiIHZhcmlhYmxlIGlzIHVuZGVmaW5lZCwgdGhlbiAiR0VUIiBtZXRob2Qgd2lsbCBiZSB1c2VkLgogICAgICAgIC8vIE1ha2UgdmFsdWUgb2YgdGhpcyBmaWVsZCBleHBsaWNpdCBzaW5jZQogICAgICAgIC8vIHVzZXIgY2FuIG92ZXJyaWRlIGl0IHRocm91Z2ggYWpheFNldHVwIG1ldGhvZAogICAgICAgIHR5cGU6IHR5cGUgfHwgIkdFVCIsCiAgICAgICAgZGF0YVR5cGU6ICJodG1sIiwKICAgICAgICBkYXRhOiBwYXJhbXMKICAgICAgfSkuZG9uZShmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7CiAgICAgICAgLy8gU2F2ZSByZXNwb25zZSBmb3IgdXNlIGluIGNvbXBsZXRlIGNhbGxiYWNrCiAgICAgICAgcmVzcG9uc2UgPSBhcmd1bWVudHM7CiAgICAgICAgc2VsZi5odG1sKHNlbGVjdG9yID8KICAgICAgICAvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKICAgICAgICAvLyBFeGNsdWRlIHNjcmlwdHMgdG8gYXZvaWQgSUUgJ1Blcm1pc3Npb24gRGVuaWVkJyBlcnJvcnMKICAgICAgICBqUXVlcnkoIjxkaXY+IikuYXBwZW5kKGpRdWVyeS5wYXJzZUhUTUwocmVzcG9uc2VUZXh0KSkuZmluZChzZWxlY3RvcikgOgogICAgICAgIC8vIE90aGVyd2lzZSB1c2UgdGhlIGZ1bGwgcmVzdWx0CiAgICAgICAgcmVzcG9uc2VUZXh0KTsKCiAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3Qgc3VjY2VlZHMsIHRoaXMgZnVuY3Rpb24gZ2V0cyAiZGF0YSIsICJzdGF0dXMiLCAianFYSFIiCiAgICAgICAgLy8gYnV0IHRoZXkgYXJlIGlnbm9yZWQgYmVjYXVzZSByZXNwb25zZSB3YXMgc2V0IGFib3ZlLgogICAgICAgIC8vIElmIGl0IGZhaWxzLCB0aGlzIGZ1bmN0aW9uIGdldHMgImpxWEhSIiwgInN0YXR1cyIsICJlcnJvciIKICAgICAgfSkuYWx3YXlzKGNhbGxiYWNrICYmIGZ1bmN0aW9uIChqcVhIUiwgc3RhdHVzKSB7CiAgICAgICAgc2VsZi5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHRoaXMsIHJlc3BvbnNlIHx8IFtqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFJdKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwogIGpRdWVyeS5leHByLnBzZXVkb3MuYW5pbWF0ZWQgPSBmdW5jdGlvbiAoZWxlbSkgewogICAgcmV0dXJuIGpRdWVyeS5ncmVwKGpRdWVyeS50aW1lcnMsIGZ1bmN0aW9uIChmbikgewogICAgICByZXR1cm4gZWxlbSA9PT0gZm4uZWxlbTsKICAgIH0pLmxlbmd0aDsKICB9OwogIGpRdWVyeS5vZmZzZXQgPSB7CiAgICBzZXRPZmZzZXQ6IGZ1bmN0aW9uIHNldE9mZnNldChlbGVtLCBvcHRpb25zLCBpKSB7CiAgICAgIHZhciBjdXJQb3NpdGlvbiwKICAgICAgICBjdXJMZWZ0LAogICAgICAgIGN1ckNTU1RvcCwKICAgICAgICBjdXJUb3AsCiAgICAgICAgY3VyT2Zmc2V0LAogICAgICAgIGN1ckNTU0xlZnQsCiAgICAgICAgY2FsY3VsYXRlUG9zaXRpb24sCiAgICAgICAgcG9zaXRpb24gPSBqUXVlcnkuY3NzKGVsZW0sICJwb3NpdGlvbiIpLAogICAgICAgIGN1ckVsZW0gPSBqUXVlcnkoZWxlbSksCiAgICAgICAgcHJvcHMgPSB7fTsKCiAgICAgIC8vIFNldCBwb3NpdGlvbiBmaXJzdCwgaW4tY2FzZSB0b3AvbGVmdCBhcmUgc2V0IGV2ZW4gb24gc3RhdGljIGVsZW0KICAgICAgaWYgKHBvc2l0aW9uID09PSAic3RhdGljIikgewogICAgICAgIGVsZW0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwogICAgICB9CiAgICAgIGN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCk7CiAgICAgIGN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoZWxlbSwgInRvcCIpOwogICAgICBjdXJDU1NMZWZ0ID0galF1ZXJ5LmNzcyhlbGVtLCAibGVmdCIpOwogICAgICBjYWxjdWxhdGVQb3NpdGlvbiA9IChwb3NpdGlvbiA9PT0gImFic29sdXRlIiB8fCBwb3NpdGlvbiA9PT0gImZpeGVkIikgJiYgKGN1ckNTU1RvcCArIGN1ckNTU0xlZnQpLmluZGV4T2YoImF1dG8iKSA+IC0xOwoKICAgICAgLy8gTmVlZCB0byBiZSBhYmxlIHRvIGNhbGN1bGF0ZSBwb3NpdGlvbiBpZiBlaXRoZXIKICAgICAgLy8gdG9wIG9yIGxlZnQgaXMgYXV0byBhbmQgcG9zaXRpb24gaXMgZWl0aGVyIGFic29sdXRlIG9yIGZpeGVkCiAgICAgIGlmIChjYWxjdWxhdGVQb3NpdGlvbikgewogICAgICAgIGN1clBvc2l0aW9uID0gY3VyRWxlbS5wb3NpdGlvbigpOwogICAgICAgIGN1clRvcCA9IGN1clBvc2l0aW9uLnRvcDsKICAgICAgICBjdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJUb3AgPSBwYXJzZUZsb2F0KGN1ckNTU1RvcCkgfHwgMDsKICAgICAgICBjdXJMZWZ0ID0gcGFyc2VGbG9hdChjdXJDU1NMZWZ0KSB8fCAwOwogICAgICB9CiAgICAgIGlmIChpc0Z1bmN0aW9uKG9wdGlvbnMpKSB7CiAgICAgICAgLy8gVXNlIGpRdWVyeS5leHRlbmQgaGVyZSB0byBhbGxvdyBtb2RpZmljYXRpb24gb2YgY29vcmRpbmF0ZXMgYXJndW1lbnQgKGdoLTE4NDgpCiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMuY2FsbChlbGVtLCBpLCBqUXVlcnkuZXh0ZW5kKHt9LCBjdXJPZmZzZXQpKTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy50b3AgIT0gbnVsbCkgewogICAgICAgIHByb3BzLnRvcCA9IG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCArIGN1clRvcDsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy5sZWZ0ICE9IG51bGwpIHsKICAgICAgICBwcm9wcy5sZWZ0ID0gb3B0aW9ucy5sZWZ0IC0gY3VyT2Zmc2V0LmxlZnQgKyBjdXJMZWZ0OwogICAgICB9CiAgICAgIGlmICgidXNpbmciIGluIG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zLnVzaW5nLmNhbGwoZWxlbSwgcHJvcHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0eXBlb2YgcHJvcHMudG9wID09PSAibnVtYmVyIikgewogICAgICAgICAgcHJvcHMudG9wICs9ICJweCI7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgcHJvcHMubGVmdCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgIHByb3BzLmxlZnQgKz0gInB4IjsKICAgICAgICB9CiAgICAgICAgY3VyRWxlbS5jc3MocHJvcHMpOwogICAgICB9CiAgICB9CiAgfTsKICBqUXVlcnkuZm4uZXh0ZW5kKHsKICAgIC8vIG9mZnNldCgpIHJlbGF0ZXMgYW4gZWxlbWVudCdzIGJvcmRlciBib3ggdG8gdGhlIGRvY3VtZW50IG9yaWdpbgogICAgb2Zmc2V0OiBmdW5jdGlvbiBvZmZzZXQob3B0aW9ucykgewogICAgICAvLyBQcmVzZXJ2ZSBjaGFpbmluZyBmb3Igc2V0dGVyCiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMgPT09IHVuZGVmaW5lZCA/IHRoaXMgOiB0aGlzLmVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIGpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsIG9wdGlvbnMsIGkpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHZhciByZWN0LAogICAgICAgIHdpbiwKICAgICAgICBlbGVtID0gdGhpc1swXTsKICAgICAgaWYgKCFlbGVtKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBSZXR1cm4gemVyb3MgZm9yIGRpc2Nvbm5lY3RlZCBhbmQgaGlkZGVuIChkaXNwbGF5OiBub25lKSBlbGVtZW50cyAoZ2gtMjMxMCkKICAgICAgLy8gU3VwcG9ydDogSUUgPD0xMSBvbmx5CiAgICAgIC8vIFJ1bm5pbmcgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IG9uIGEKICAgICAgLy8gZGlzY29ubmVjdGVkIG5vZGUgaW4gSUUgdGhyb3dzIGFuIGVycm9yCiAgICAgIGlmICghZWxlbS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgLy8gR2V0IGRvY3VtZW50LXJlbGF0aXZlIHBvc2l0aW9uIGJ5IGFkZGluZyB2aWV3cG9ydCBzY3JvbGwgdG8gdmlld3BvcnQtcmVsYXRpdmUgZ0JDUgogICAgICByZWN0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgd2luID0gZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3OwogICAgICByZXR1cm4gewogICAgICAgIHRvcDogcmVjdC50b3AgKyB3aW4ucGFnZVlPZmZzZXQsCiAgICAgICAgbGVmdDogcmVjdC5sZWZ0ICsgd2luLnBhZ2VYT2Zmc2V0CiAgICAgIH07CiAgICB9LAogICAgLy8gcG9zaXRpb24oKSByZWxhdGVzIGFuIGVsZW1lbnQncyBtYXJnaW4gYm94IHRvIGl0cyBvZmZzZXQgcGFyZW50J3MgcGFkZGluZyBib3gKICAgIC8vIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIGJlaGF2aW9yIG9mIENTUyBhYnNvbHV0ZSBwb3NpdGlvbmluZwogICAgcG9zaXRpb246IGZ1bmN0aW9uIHBvc2l0aW9uKCkgewogICAgICBpZiAoIXRoaXNbMF0pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIG9mZnNldFBhcmVudCwKICAgICAgICBvZmZzZXQsCiAgICAgICAgZG9jLAogICAgICAgIGVsZW0gPSB0aGlzWzBdLAogICAgICAgIHBhcmVudE9mZnNldCA9IHsKICAgICAgICAgIHRvcDogMCwKICAgICAgICAgIGxlZnQ6IDAKICAgICAgICB9OwoKICAgICAgLy8gcG9zaXRpb246Zml4ZWQgZWxlbWVudHMgYXJlIG9mZnNldCBmcm9tIHRoZSB2aWV3cG9ydCwgd2hpY2ggaXRzZWxmIGFsd2F5cyBoYXMgemVybyBvZmZzZXQKICAgICAgaWYgKGpRdWVyeS5jc3MoZWxlbSwgInBvc2l0aW9uIikgPT09ICJmaXhlZCIpIHsKICAgICAgICAvLyBBc3N1bWUgcG9zaXRpb246Zml4ZWQgaW1wbGllcyBhdmFpbGFiaWxpdHkgb2YgZ2V0Qm91bmRpbmdDbGllbnRSZWN0CiAgICAgICAgb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvZmZzZXQgPSB0aGlzLm9mZnNldCgpOwoKICAgICAgICAvLyBBY2NvdW50IGZvciB0aGUgKnJlYWwqIG9mZnNldCBwYXJlbnQsIHdoaWNoIGNhbiBiZSB0aGUgZG9jdW1lbnQgb3IgaXRzIHJvb3QgZWxlbWVudAogICAgICAgIC8vIHdoZW4gYSBzdGF0aWNhbGx5IHBvc2l0aW9uZWQgZWxlbWVudCBpcyBpZGVudGlmaWVkCiAgICAgICAgZG9jID0gZWxlbS5vd25lckRvY3VtZW50OwogICAgICAgIG9mZnNldFBhcmVudCA9IGVsZW0ub2Zmc2V0UGFyZW50IHx8IGRvYy5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgd2hpbGUgKG9mZnNldFBhcmVudCAmJiAob2Zmc2V0UGFyZW50ID09PSBkb2MuYm9keSB8fCBvZmZzZXRQYXJlbnQgPT09IGRvYy5kb2N1bWVudEVsZW1lbnQpICYmIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIpIHsKICAgICAgICAgIG9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5wYXJlbnROb2RlOwogICAgICAgIH0KICAgICAgICBpZiAob2Zmc2V0UGFyZW50ICYmIG9mZnNldFBhcmVudCAhPT0gZWxlbSAmJiBvZmZzZXRQYXJlbnQubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICAgIC8vIEluY29ycG9yYXRlIGJvcmRlcnMgaW50byBpdHMgb2Zmc2V0LCBzaW5jZSB0aGV5IGFyZSBvdXRzaWRlIGl0cyBjb250ZW50IG9yaWdpbgogICAgICAgICAgcGFyZW50T2Zmc2V0ID0galF1ZXJ5KG9mZnNldFBhcmVudCkub2Zmc2V0KCk7CiAgICAgICAgICBwYXJlbnRPZmZzZXQudG9wICs9IGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlKTsKICAgICAgICAgIHBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBTdWJ0cmFjdCBwYXJlbnQgb2Zmc2V0cyBhbmQgZWxlbWVudCBtYXJnaW5zCiAgICAgIHJldHVybiB7CiAgICAgICAgdG9wOiBvZmZzZXQudG9wIC0gcGFyZW50T2Zmc2V0LnRvcCAtIGpRdWVyeS5jc3MoZWxlbSwgIm1hcmdpblRvcCIsIHRydWUpLAogICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0IC0gcGFyZW50T2Zmc2V0LmxlZnQgLSBqUXVlcnkuY3NzKGVsZW0sICJtYXJnaW5MZWZ0IiwgdHJ1ZSkKICAgICAgfTsKICAgIH0sCiAgICAvLyBUaGlzIG1ldGhvZCB3aWxsIHJldHVybiBkb2N1bWVudEVsZW1lbnQgaW4gdGhlIGZvbGxvd2luZyBjYXNlczoKICAgIC8vIDEpIEZvciB0aGUgZWxlbWVudCBpbnNpZGUgdGhlIGlmcmFtZSB3aXRob3V0IG9mZnNldFBhcmVudCwgdGhpcyBtZXRob2Qgd2lsbCByZXR1cm4KICAgIC8vICAgIGRvY3VtZW50RWxlbWVudCBvZiB0aGUgcGFyZW50IHdpbmRvdwogICAgLy8gMikgRm9yIHRoZSBoaWRkZW4gb3IgZGV0YWNoZWQgZWxlbWVudAogICAgLy8gMykgRm9yIGJvZHkgb3IgaHRtbCBlbGVtZW50LCBpLmUuIGluIGNhc2Ugb2YgdGhlIGh0bWwgbm9kZSAtIGl0IHdpbGwgcmV0dXJuIGl0c2VsZgogICAgLy8KICAgIC8vIGJ1dCB0aG9zZSBleGNlcHRpb25zIHdlcmUgbmV2ZXIgcHJlc2VudGVkIGFzIGEgcmVhbCBsaWZlIHVzZS1jYXNlcwogICAgLy8gYW5kIG1pZ2h0IGJlIGNvbnNpZGVyZWQgYXMgbW9yZSBwcmVmZXJhYmxlIHJlc3VsdHMuCiAgICAvLwogICAgLy8gVGhpcyBsb2dpYywgaG93ZXZlciwgaXMgbm90IGd1YXJhbnRlZWQgYW5kIGNhbiBjaGFuZ2UgYXQgYW55IHBvaW50IGluIHRoZSBmdXR1cmUKICAgIG9mZnNldFBhcmVudDogZnVuY3Rpb24gb2Zmc2V0UGFyZW50KCkgewogICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudDsKICAgICAgICB3aGlsZSAob2Zmc2V0UGFyZW50ICYmIGpRdWVyeS5jc3Mob2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIpIHsKICAgICAgICAgIG9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnRFbGVtZW50OwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gQ3JlYXRlIHNjcm9sbExlZnQgYW5kIHNjcm9sbFRvcCBtZXRob2RzCiAgalF1ZXJ5LmVhY2goewogICAgc2Nyb2xsTGVmdDogInBhZ2VYT2Zmc2V0IiwKICAgIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0IgogIH0sIGZ1bmN0aW9uIChtZXRob2QsIHByb3ApIHsKICAgIHZhciB0b3AgPSAicGFnZVlPZmZzZXQiID09PSBwcm9wOwogICAgalF1ZXJ5LmZuW21ldGhvZF0gPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgIHJldHVybiBhY2Nlc3ModGhpcywgZnVuY3Rpb24gKGVsZW0sIG1ldGhvZCwgdmFsKSB7CiAgICAgICAgLy8gQ29hbGVzY2UgZG9jdW1lbnRzIGFuZCB3aW5kb3dzCiAgICAgICAgdmFyIHdpbjsKICAgICAgICBpZiAoaXNXaW5kb3coZWxlbSkpIHsKICAgICAgICAgIHdpbiA9IGVsZW07CiAgICAgICAgfSBlbHNlIGlmIChlbGVtLm5vZGVUeXBlID09PSA5KSB7CiAgICAgICAgICB3aW4gPSBlbGVtLmRlZmF1bHRWaWV3OwogICAgICAgIH0KICAgICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiB3aW4gPyB3aW5bcHJvcF0gOiBlbGVtW21ldGhvZF07CiAgICAgICAgfQogICAgICAgIGlmICh3aW4pIHsKICAgICAgICAgIHdpbi5zY3JvbGxUbyghdG9wID8gdmFsIDogd2luLnBhZ2VYT2Zmc2V0LCB0b3AgPyB2YWwgOiB3aW4ucGFnZVlPZmZzZXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbGVtW21ldGhvZF0gPSB2YWw7CiAgICAgICAgfQogICAgICB9LCBtZXRob2QsIHZhbCwgYXJndW1lbnRzLmxlbmd0aCk7CiAgICB9OwogIH0pOwoKICAvLyBTdXBwb3J0OiBTYWZhcmkgPD03IC0gOS4xLCBDaHJvbWUgPD0zNyAtIDQ5CiAgLy8gQWRkIHRoZSB0b3AvbGVmdCBjc3NIb29rcyB1c2luZyBqUXVlcnkuZm4ucG9zaXRpb24KICAvLyBXZWJraXQgYnVnOiBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MjkwODQKICAvLyBCbGluayBidWc6IGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTU4OTM0NwogIC8vIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyBwZXJjZW50IHdoZW4gc3BlY2lmaWVkIGZvciB0b3AvbGVmdC9ib3R0b20vcmlnaHQ7CiAgLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKICBqUXVlcnkuZWFjaChbInRvcCIsICJsZWZ0Il0sIGZ1bmN0aW9uIChfaSwgcHJvcCkgewogICAgalF1ZXJ5LmNzc0hvb2tzW3Byb3BdID0gYWRkR2V0SG9va0lmKHN1cHBvcnQucGl4ZWxQb3NpdGlvbiwgZnVuY3Rpb24gKGVsZW0sIGNvbXB1dGVkKSB7CiAgICAgIGlmIChjb21wdXRlZCkgewogICAgICAgIGNvbXB1dGVkID0gY3VyQ1NTKGVsZW0sIHByb3ApOwoKICAgICAgICAvLyBJZiBjdXJDU1MgcmV0dXJucyBwZXJjZW50YWdlLCBmYWxsYmFjayB0byBvZmZzZXQKICAgICAgICByZXR1cm4gcm51bW5vbnB4LnRlc3QoY29tcHV0ZWQpID8galF1ZXJ5KGVsZW0pLnBvc2l0aW9uKClbcHJvcF0gKyAicHgiIDogY29tcHV0ZWQ7CiAgICAgIH0KICAgIH0pOwogIH0pOwoKICAvLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKICBqUXVlcnkuZWFjaCh7CiAgICBIZWlnaHQ6ICJoZWlnaHQiLAogICAgV2lkdGg6ICJ3aWR0aCIKICB9LCBmdW5jdGlvbiAobmFtZSwgdHlwZSkgewogICAgalF1ZXJ5LmVhY2goewogICAgICBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwKICAgICAgY29udGVudDogdHlwZSwKICAgICAgIiI6ICJvdXRlciIgKyBuYW1lCiAgICB9LCBmdW5jdGlvbiAoZGVmYXVsdEV4dHJhLCBmdW5jTmFtZSkgewogICAgICAvLyBNYXJnaW4gaXMgb25seSBmb3Igb3V0ZXJIZWlnaHQsIG91dGVyV2lkdGgKICAgICAgalF1ZXJ5LmZuW2Z1bmNOYW1lXSA9IGZ1bmN0aW9uIChtYXJnaW4sIHZhbHVlKSB7CiAgICAgICAgdmFyIGNoYWluYWJsZSA9IGFyZ3VtZW50cy5sZW5ndGggJiYgKGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIpLAogICAgICAgICAgZXh0cmEgPSBkZWZhdWx0RXh0cmEgfHwgKG1hcmdpbiA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gdHJ1ZSA/ICJtYXJnaW4iIDogImJvcmRlciIpOwogICAgICAgIHJldHVybiBhY2Nlc3ModGhpcywgZnVuY3Rpb24gKGVsZW0sIHR5cGUsIHZhbHVlKSB7CiAgICAgICAgICB2YXIgZG9jOwogICAgICAgICAgaWYgKGlzV2luZG93KGVsZW0pKSB7CiAgICAgICAgICAgIC8vICQoIHdpbmRvdyApLm91dGVyV2lkdGgvSGVpZ2h0IHJldHVybiB3L2ggaW5jbHVkaW5nIHNjcm9sbGJhcnMgKGdoLTE3MjkpCiAgICAgICAgICAgIHJldHVybiBmdW5jTmFtZS5pbmRleE9mKCJvdXRlciIpID09PSAwID8gZWxlbVsiaW5uZXIiICsgbmFtZV0gOiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IiArIG5hbWVdOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIEdldCBkb2N1bWVudCB3aWR0aCBvciBoZWlnaHQKICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSA5KSB7CiAgICAgICAgICAgIGRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OwoKICAgICAgICAgICAgLy8gRWl0aGVyIHNjcm9sbFtXaWR0aC9IZWlnaHRdIG9yIG9mZnNldFtXaWR0aC9IZWlnaHRdIG9yIGNsaWVudFtXaWR0aC9IZWlnaHRdLAogICAgICAgICAgICAvLyB3aGljaGV2ZXIgaXMgZ3JlYXRlc3QKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KGVsZW0uYm9keVsic2Nyb2xsIiArIG5hbWVdLCBkb2NbInNjcm9sbCIgKyBuYW1lXSwgZWxlbS5ib2R5WyJvZmZzZXQiICsgbmFtZV0sIGRvY1sib2Zmc2V0IiArIG5hbWVdLCBkb2NbImNsaWVudCIgKyBuYW1lXSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/CiAgICAgICAgICAvLyBHZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50LCByZXF1ZXN0aW5nIGJ1dCBub3QgZm9yY2luZyBwYXJzZUZsb2F0CiAgICAgICAgICBqUXVlcnkuY3NzKGVsZW0sIHR5cGUsIGV4dHJhKSA6CiAgICAgICAgICAvLyBTZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50CiAgICAgICAgICBqUXVlcnkuc3R5bGUoZWxlbSwgdHlwZSwgdmFsdWUsIGV4dHJhKTsKICAgICAgICB9LCB0eXBlLCBjaGFpbmFibGUgPyBtYXJnaW4gOiB1bmRlZmluZWQsIGNoYWluYWJsZSk7CiAgICAgIH07CiAgICB9KTsKICB9KTsKICBqUXVlcnkuZWFjaChbImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIl0sIGZ1bmN0aW9uIChfaSwgdHlwZSkgewogICAgalF1ZXJ5LmZuW3R5cGVdID0gZnVuY3Rpb24gKGZuKSB7CiAgICAgIHJldHVybiB0aGlzLm9uKHR5cGUsIGZuKTsKICAgIH07CiAgfSk7CiAgalF1ZXJ5LmZuLmV4dGVuZCh7CiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kKHR5cGVzLCBkYXRhLCBmbikgewogICAgICByZXR1cm4gdGhpcy5vbih0eXBlcywgbnVsbCwgZGF0YSwgZm4pOwogICAgfSwKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kKHR5cGVzLCBmbikgewogICAgICByZXR1cm4gdGhpcy5vZmYodHlwZXMsIG51bGwsIGZuKTsKICAgIH0sCiAgICBkZWxlZ2F0ZTogZnVuY3Rpb24gZGVsZWdhdGUoc2VsZWN0b3IsIHR5cGVzLCBkYXRhLCBmbikgewogICAgICByZXR1cm4gdGhpcy5vbih0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuKTsKICAgIH0sCiAgICB1bmRlbGVnYXRlOiBmdW5jdGlvbiB1bmRlbGVnYXRlKHNlbGVjdG9yLCB0eXBlcywgZm4pIHsKICAgICAgLy8gKCBuYW1lc3BhY2UgKSBvciAoIHNlbGVjdG9yLCB0eXBlcyBbLCBmbl0gKQogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA/IHRoaXMub2ZmKHNlbGVjdG9yLCAiKioiKSA6IHRoaXMub2ZmKHR5cGVzLCBzZWxlY3RvciB8fCAiKioiLCBmbik7CiAgICB9LAogICAgaG92ZXI6IGZ1bmN0aW9uIGhvdmVyKGZuT3ZlciwgZm5PdXQpIHsKICAgICAgcmV0dXJuIHRoaXMubW91c2VlbnRlcihmbk92ZXIpLm1vdXNlbGVhdmUoZm5PdXQgfHwgZm5PdmVyKTsKICAgIH0KICB9KTsKICBqUXVlcnkuZWFjaCgoImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCByZXNpemUgc2Nyb2xsIGNsaWNrIGRibGNsaWNrICIgKyAibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArICJjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGNvbnRleHRtZW51Iikuc3BsaXQoIiAiKSwgZnVuY3Rpb24gKF9pLCBuYW1lKSB7CiAgICAvLyBIYW5kbGUgZXZlbnQgYmluZGluZwogICAgalF1ZXJ5LmZuW25hbWVdID0gZnVuY3Rpb24gKGRhdGEsIGZuKSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMCA/IHRoaXMub24obmFtZSwgbnVsbCwgZGF0YSwgZm4pIDogdGhpcy50cmlnZ2VyKG5hbWUpOwogICAgfTsKICB9KTsKCiAgLy8gU3VwcG9ydDogQW5kcm9pZCA8PTQuMCBvbmx5CiAgLy8gTWFrZSBzdXJlIHdlIHRyaW0gQk9NIGFuZCBOQlNQCiAgdmFyIHJ0cmltID0gL15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nOwoKICAvLyBCaW5kIGEgZnVuY3Rpb24gdG8gYSBjb250ZXh0LCBvcHRpb25hbGx5IHBhcnRpYWxseSBhcHBseWluZyBhbnkKICAvLyBhcmd1bWVudHMuCiAgLy8galF1ZXJ5LnByb3h5IGlzIGRlcHJlY2F0ZWQgdG8gcHJvbW90ZSBzdGFuZGFyZHMgKHNwZWNpZmljYWxseSBGdW5jdGlvbiNiaW5kKQogIC8vIEhvd2V2ZXIsIGl0IGlzIG5vdCBzbGF0ZWQgZm9yIHJlbW92YWwgYW55IHRpbWUgc29vbgogIGpRdWVyeS5wcm94eSA9IGZ1bmN0aW9uIChmbiwgY29udGV4dCkgewogICAgdmFyIHRtcCwgYXJncywgcHJveHk7CiAgICBpZiAodHlwZW9mIGNvbnRleHQgPT09ICJzdHJpbmciKSB7CiAgICAgIHRtcCA9IGZuW2NvbnRleHRdOwogICAgICBjb250ZXh0ID0gZm47CiAgICAgIGZuID0gdG1wOwogICAgfQoKICAgIC8vIFF1aWNrIGNoZWNrIHRvIGRldGVybWluZSBpZiB0YXJnZXQgaXMgY2FsbGFibGUsIGluIHRoZSBzcGVjCiAgICAvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgogICAgaWYgKCFpc0Z1bmN0aW9uKGZuKSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfQoKICAgIC8vIFNpbXVsYXRlZCBiaW5kCiAgICBhcmdzID0gX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHByb3h5ID0gZnVuY3Rpb24gcHJveHkoKSB7CiAgICAgIHJldHVybiBmbi5hcHBseShjb250ZXh0IHx8IHRoaXMsIGFyZ3MuY29uY2F0KF9zbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CgogICAgLy8gU2V0IHRoZSBndWlkIG9mIHVuaXF1ZSBoYW5kbGVyIHRvIHRoZSBzYW1lIG9mIG9yaWdpbmFsIGhhbmRsZXIsIHNvIGl0IGNhbiBiZSByZW1vdmVkCiAgICBwcm94eS5ndWlkID0gZm4uZ3VpZCA9IGZuLmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKzsKICAgIHJldHVybiBwcm94eTsKICB9OwogIGpRdWVyeS5ob2xkUmVhZHkgPSBmdW5jdGlvbiAoaG9sZCkgewogICAgaWYgKGhvbGQpIHsKICAgICAgalF1ZXJ5LnJlYWR5V2FpdCsrOwogICAgfSBlbHNlIHsKICAgICAgalF1ZXJ5LnJlYWR5KHRydWUpOwogICAgfQogIH07CiAgalF1ZXJ5LmlzQXJyYXkgPSBBcnJheS5pc0FycmF5OwogIGpRdWVyeS5wYXJzZUpTT04gPSBKU09OLnBhcnNlOwogIGpRdWVyeS5ub2RlTmFtZSA9IG5vZGVOYW1lOwogIGpRdWVyeS5pc0Z1bmN0aW9uID0gaXNGdW5jdGlvbjsKICBqUXVlcnkuaXNXaW5kb3cgPSBpc1dpbmRvdzsKICBqUXVlcnkuY2FtZWxDYXNlID0gY2FtZWxDYXNlOwogIGpRdWVyeS50eXBlID0gdG9UeXBlOwogIGpRdWVyeS5ub3cgPSBEYXRlLm5vdzsKICBqUXVlcnkuaXNOdW1lcmljID0gZnVuY3Rpb24gKG9iaikgewogICAgLy8gQXMgb2YgalF1ZXJ5IDMuMCwgaXNOdW1lcmljIGlzIGxpbWl0ZWQgdG8KICAgIC8vIHN0cmluZ3MgYW5kIG51bWJlcnMgKHByaW1pdGl2ZXMgb3Igb2JqZWN0cykKICAgIC8vIHRoYXQgY2FuIGJlIGNvZXJjZWQgdG8gZmluaXRlIG51bWJlcnMgKGdoLTI2NjIpCiAgICB2YXIgdHlwZSA9IGpRdWVyeS50eXBlKG9iaik7CiAgICByZXR1cm4gKHR5cGUgPT09ICJudW1iZXIiIHx8IHR5cGUgPT09ICJzdHJpbmciKSAmJgogICAgLy8gcGFyc2VGbG9hdCBOYU5zIG51bWVyaWMtY2FzdCBmYWxzZSBwb3NpdGl2ZXMgKCIiKQogICAgLy8gLi4uYnV0IG1pc2ludGVycHJldHMgbGVhZGluZy1udW1iZXIgc3RyaW5ncywgcGFydGljdWxhcmx5IGhleCBsaXRlcmFscyAoIjB4Li4uIikKICAgIC8vIHN1YnRyYWN0aW9uIGZvcmNlcyBpbmZpbml0aWVzIHRvIE5hTgogICAgIWlzTmFOKG9iaiAtIHBhcnNlRmxvYXQob2JqKSk7CiAgfTsKICBqUXVlcnkudHJpbSA9IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICByZXR1cm4gdGV4dCA9PSBudWxsID8gIiIgOiAodGV4dCArICIiKS5yZXBsYWNlKHJ0cmltLCAiIik7CiAgfTsKCiAgLy8gUmVnaXN0ZXIgYXMgYSBuYW1lZCBBTUQgbW9kdWxlLCBzaW5jZSBqUXVlcnkgY2FuIGJlIGNvbmNhdGVuYXRlZCB3aXRoIG90aGVyCiAgLy8gZmlsZXMgdGhhdCBtYXkgdXNlIGRlZmluZSwgYnV0IG5vdCB2aWEgYSBwcm9wZXIgY29uY2F0ZW5hdGlvbiBzY3JpcHQgdGhhdAogIC8vIHVuZGVyc3RhbmRzIGFub255bW91cyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdAogIC8vIHdheSB0byByZWdpc3Rlci4gTG93ZXJjYXNlIGpxdWVyeSBpcyB1c2VkIGJlY2F1c2UgQU1EIG1vZHVsZSBuYW1lcyBhcmUKICAvLyBkZXJpdmVkIGZyb20gZmlsZSBuYW1lcywgYW5kIGpRdWVyeSBpcyBub3JtYWxseSBkZWxpdmVyZWQgaW4gYSBsb3dlcmNhc2UKICAvLyBmaWxlIG5hbWUuIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMKICAvLyB0byBjYWxsIG5vQ29uZmxpY3QgdG8gaGlkZSB0aGlzIHZlcnNpb24gb2YgalF1ZXJ5LCBpdCB3aWxsIHdvcmsuCgogIC8vIE5vdGUgdGhhdCBmb3IgbWF4aW11bSBwb3J0YWJpbGl0eSwgbGlicmFyaWVzIHRoYXQgYXJlIG5vdCBqUXVlcnkgc2hvdWxkCiAgLy8gZGVjbGFyZSB0aGVtc2VsdmVzIGFzIGFub255bW91cyBtb2R1bGVzLCBhbmQgYXZvaWQgc2V0dGluZyBhIGdsb2JhbCBpZiBhbgogIC8vIEFNRCBsb2FkZXIgaXMgcHJlc2VudC4galF1ZXJ5IGlzIGEgc3BlY2lhbCBjYXNlLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlCiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzL3dpa2kvVXBkYXRpbmctZXhpc3RpbmctbGlicmFyaWVzI3dpa2ktYW5vbgoKICBpZiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoImpxdWVyeSIsIFtdLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBqUXVlcnk7CiAgICB9KTsKICB9CiAgdmFyCiAgICAvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKICAgIF9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5LAogICAgLy8gTWFwIG92ZXIgdGhlICQgaW4gY2FzZSBvZiBvdmVyd3JpdGUKICAgIF8kID0gd2luZG93LiQ7CiAgalF1ZXJ5Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoZGVlcCkgewogICAgaWYgKHdpbmRvdy4kID09PSBqUXVlcnkpIHsKICAgICAgd2luZG93LiQgPSBfJDsKICAgIH0KICAgIGlmIChkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSkgewogICAgICB3aW5kb3cualF1ZXJ5ID0gX2pRdWVyeTsKICAgIH0KICAgIHJldHVybiBqUXVlcnk7CiAgfTsKCiAgLy8gRXhwb3NlIGpRdWVyeSBhbmQgJCBpZGVudGlmaWVycywgZXZlbiBpbiBBTUQKICAvLyAoIzcxMDIjY29tbWVudDoxMCwgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkvcHVsbC81NTcpCiAgLy8gYW5kIENvbW1vbkpTIGZvciBicm93c2VyIGVtdWxhdG9ycyAoIzEzNTY2KQogIGlmICh0eXBlb2Ygbm9HbG9iYWwgPT09ICJ1bmRlZmluZWQiKSB7CiAgICB3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7CiAgfQogIHJldHVybiBqUXVlcnk7Cn0pOw=="},{"version":3,"names":["global","factory","module","_typeof","exports","document","w","Error","window","noGlobal","arr","getProto","Object","getPrototypeOf","slice","flat","array","call","concat","apply","push","indexOf","class2type","toString","hasOwn","hasOwnProperty","fnToString","ObjectFunctionString","support","isFunction","obj","nodeType","isWindow","preservedScriptAttributes","type","src","nonce","noModule","DOMEval","code","node","doc","i","val","script","createElement","text","getAttribute","setAttribute","head","appendChild","parentNode","removeChild","toType","version","jQuery","selector","context","fn","init","prototype","jquery","constructor","length","toArray","get","num","pushStack","elems","ret","merge","prevObject","each","callback","map","elem","arguments","first","eq","last","even","grep","_elem","odd","len","j","end","sort","splice","extend","options","name","copy","copyIsArray","clone","target","deep","isPlainObject","Array","isArray","undefined","expando","Math","random","replace","isReady","error","msg","noop","proto","Ctor","isEmptyObject","globalEval","isArrayLike","makeArray","results","inArray","second","invert","callbackInverse","matches","callbackExpect","arg","value","guid","Symbol","iterator","split","_i","toLowerCase","Sizzle","Expr","getText","isXML","tokenize","compile","select","outermostContext","sortInput","hasDuplicate","setDocument","docElem","documentIsHTML","rbuggyQSA","rbuggyMatches","contains","Date","preferredDoc","dirruns","done","classCache","createCache","tokenCache","compilerCache","nonnativeSelectorCache","sortOrder","a","b","pop","pushNative","list","booleans","whitespace","identifier","attributes","pseudos","rwhitespace","RegExp","rtrim","rcomma","rcombinators","rdescend","rpseudo","ridentifier","matchExpr","rhtml","rinputs","rheader","rnative","rquickExpr","rsibling","runescape","funescape","escape","nonHex","high","String","fromCharCode","rcssescape","fcssescape","ch","asCodePoint","charCodeAt","unloadHandler","inDisabledFieldset","addCombinator","disabled","nodeName","dir","next","childNodes","e","els","seed","m","nid","match","groups","newSelector","newContext","ownerDocument","exec","getElementById","id","getElementsByTagName","getElementsByClassName","qsa","test","testContext","scope","toSelector","join","querySelectorAll","qsaError","removeAttribute","keys","cache","key","cacheLength","shift","markFunction","assert","el","addHandle","attrs","handler","attrHandle","siblingCheck","cur","diff","sourceIndex","nextSibling","createInputPseudo","createButtonPseudo","createDisabledPseudo","isDisabled","createPositionalPseudo","argument","matchIndexes","namespace","namespaceURI","documentElement","hasCompare","subWindow","defaultView","top","addEventListener","attachEvent","className","createComment","getById","getElementsByName","filter","attrId","find","getAttributeNode","tag","tmp","input","innerHTML","matchesSelector","webkitMatchesSelector","mozMatchesSelector","oMatchesSelector","msMatchesSelector","disconnectedMatch","compareDocumentPosition","adown","bup","compare","sortDetached","aup","ap","bp","unshift","expr","elements","attr","specified","sel","uniqueSort","duplicates","detectDuplicates","sortStable","textContent","firstChild","nodeValue","selectors","createPseudo","relative","preFilter","ATTR","CHILD","PSEUDO","excess","unquoted","TAG","nodeNameSelector","CLASS","pattern","operator","check","result","what","_argument","simple","forward","ofType","_context","xml","uniqueCache","outerCache","nodeIndex","start","parent","useCache","lastChild","uniqueID","pseudo","args","setFilters","idx","matched","matcher","unmatched","lang","elemLang","hash","location","root","focus","activeElement","hasFocus","href","tabIndex","checked","selected","selectedIndex","empty","header","button","_matchIndexes","radio","checkbox","file","password","image","submit","reset","filters","parseOnly","tokens","soFar","preFilters","cached","combinator","base","skip","checkNonElements","doneName","oldCache","newCache","elementMatcher","matchers","multipleContexts","contexts","condense","newUnmatched","mapped","setMatcher","postFilter","postFinder","postSelector","temp","preMap","postMap","preexisting","matcherIn","matcherOut","matcherFromTokens","checkContext","leadingRelative","implicitRelative","matchContext","matchAnyContext","matcherFromGroupMatchers","elementMatchers","setMatchers","bySet","byElement","superMatcher","outermost","matchedCount","setMatched","contextBackup","dirrunsUnique","token","compiled","_name","defaultValue","unique","isXMLDoc","escapeSelector","until","truncate","is","siblings","n","rneedsContext","needsContext","rsingleTag","winnow","qualifier","not","self","rootjQuery","parseHTML","ready","rparentsprev","guaranteedUnique","children","contents","prev","has","targets","l","closest","index","prevAll","add","addBack","sibling","parents","parentsUntil","nextAll","nextUntil","prevUntil","contentDocument","content","reverse","rnothtmlwhite","createOptions","object","_","flag","Callbacks","firing","memory","fired","locked","queue","firingIndex","fire","once","stopOnFalse","remove","disable","lock","fireWith","Identity","v","Thrower","ex","adoptValue","resolve","reject","noValue","method","promise","fail","then","Deferred","func","tuples","state","always","deferred","_catch","pipe","fns","newDefer","tuple","returned","progress","notify","onFulfilled","onRejected","onProgress","maxDepth","depth","special","that","mightThrow","TypeError","notifyWith","resolveWith","process","exceptionHook","stackTrace","rejectWith","getStackHook","setTimeout","stateString","when","singleValue","remaining","resolveContexts","resolveValues","master","updateFunc","rerrorNames","stack","console","warn","message","readyException","readyList","catch","readyWait","wait","completed","removeEventListener","readyState","doScroll","access","chainable","emptyGet","raw","bulk","_key","rmsPrefix","rdashAlpha","fcamelCase","_all","letter","toUpperCase","camelCase","string","acceptData","owner","Data","uid","defineProperty","configurable","set","data","prop","hasData","dataPriv","dataUser","rbrace","rmultiDash","getData","JSON","parse","dataAttr","removeData","_data","_removeData","dequeue","startLength","hooks","_queueHooks","stop","setter","clearQueue","count","defer","pnum","source","rcssNum","cssExpand","isAttached","composed","getRootNode","isHiddenWithinTree","style","display","css","adjustCSS","valueParts","tween","adjusted","scale","maxIterations","currentValue","initial","unit","cssNumber","initialInUnit","defaultDisplayMap","getDefaultDisplay","body","showHide","show","values","hide","toggle","rcheckableType","rtagName","rscriptType","fragment","createDocumentFragment","div","checkClone","cloneNode","noCloneChecked","option","wrapMap","thead","col","tr","td","_default","tbody","tfoot","colgroup","caption","th","optgroup","getAll","setGlobalEval","refElements","buildFragment","scripts","selection","ignored","wrap","attached","nodes","createTextNode","htmlPrefilter","rkeyEvent","rmouseEvent","rtypenamespace","returnTrue","returnFalse","expectSync","safeActiveElement","err","on","types","one","origFn","event","off","handleObjIn","eventHandle","events","t","handleObj","handlers","namespaces","origType","elemData","create","handle","triggered","dispatch","delegateType","bindType","delegateCount","setup","mappedTypes","origCount","teardown","removeEvent","nativeEvent","handlerQueue","fix","delegateTarget","preDispatch","isPropagationStopped","currentTarget","isImmediatePropagationStopped","rnamespace","preventDefault","stopPropagation","postDispatch","matchedHandlers","matchedSelectors","addProp","hook","Event","enumerable","originalEvent","writable","load","noBubble","click","leverageNative","trigger","beforeunload","returnValue","notAsync","saved","isTrigger","stopImmediatePropagation","props","isDefaultPrevented","defaultPrevented","relatedTarget","timeStamp","now","isSimulated","altKey","bubbles","cancelable","changedTouches","ctrlKey","detail","eventPhase","metaKey","pageX","pageY","shiftKey","view","charCode","keyCode","buttons","clientX","clientY","offsetX","offsetY","pointerId","pointerType","screenX","screenY","targetTouches","toElement","touches","which","blur","mouseenter","mouseleave","pointerenter","pointerleave","orig","related","rnoInnerhtml","rchecked","rcleanScript","manipulationTarget","disableScript","restoreScript","cloneCopyEvent","dest","pdataOld","udataOld","udataCur","fixInput","domManip","collection","hasScripts","iNoClone","valueIsFunction","html","_evalUrl","keepData","cleanData","dataAndEvents","deepDataAndEvents","srcElements","destElements","inPage","detach","append","prepend","insertBefore","before","after","replaceWith","replaceChild","appendTo","prependTo","insertAfter","replaceAll","original","insert","rnumnonpx","getStyles","opener","getComputedStyle","swap","old","rboxStyle","computeStyleTests","container","cssText","divStyle","pixelPositionVal","reliableMarginLeftVal","roundPixelMeasures","marginLeft","right","pixelBoxStylesVal","boxSizingReliableVal","width","position","scrollboxSizeVal","offsetWidth","measure","round","parseFloat","reliableTrDimensionsVal","backgroundClip","clearCloneStyle","boxSizingReliable","pixelBoxStyles","pixelPosition","reliableMarginLeft","scrollboxSize","reliableTrDimensions","table","trChild","trStyle","height","parseInt","curCSS","computed","minWidth","maxWidth","getPropertyValue","addGetHookIf","conditionFn","hookFn","cssPrefixes","emptyStyle","vendorProps","vendorPropName","capName","finalPropName","final","cssProps","rdisplayswap","rcustomProp","cssShow","visibility","cssNormalTransform","letterSpacing","fontWeight","setPositiveNumber","subtract","max","boxModelAdjustment","dimension","box","isBorderBox","styles","computedVal","extra","delta","ceil","getWidthOrHeight","boxSizingNeeded","valueIsBorderBox","offsetProp","getClientRects","cssHooks","opacity","origName","isCustomProp","setProperty","isFinite","getBoundingClientRect","scrollboxSizeBuggy","left","margin","padding","border","prefix","suffix","expand","expanded","parts","Tween","easing","propHooks","run","percent","eased","duration","pos","step","fx","scrollTop","scrollLeft","linear","p","swing","cos","PI","fxNow","inProgress","rfxtypes","rrun","schedule","hidden","requestAnimationFrame","interval","tick","createFxNow","genFx","includeWidth","createTween","animation","Animation","tweeners","defaultPrefilter","opts","oldfire","propTween","restoreDisplay","isBox","anim","dataShow","unqueued","overflow","overflowX","overflowY","propFilter","specialEasing","properties","stopped","prefilters","currentTime","startTime","tweens","originalProperties","originalOptions","gotoEnd","bind","complete","timer","tweener","prefilter","speed","opt","speeds","fadeTo","to","animate","optall","doAnimation","finish","stopQueue","timers","cssFn","slideDown","slideUp","slideToggle","fadeIn","fadeOut","fadeToggle","slow","fast","delay","time","timeout","clearTimeout","checkOn","optSelected","radioValue","boolHook","removeAttr","nType","attrHooks","bool","attrNames","getter","lowercaseName","rfocusable","rclickable","removeProp","propFix","tabindex","stripAndCollapse","getClass","classesToArray","addClass","classes","curValue","clazz","finalValue","removeClass","toggleClass","stateVal","isValidValue","classNames","hasClass","rreturn","valHooks","optionSet","focusin","rfocusMorph","stopPropagationCallback","onlyHandlers","bubbleType","ontype","lastElement","eventPath","parentWindow","simulate","triggerHandler","attaches","rquery","parseXML","DOMParser","parseFromString","rbracket","rCRLF","rsubmitterTypes","rsubmittable","buildParams","traditional","param","s","valueOrFunction","encodeURIComponent","serialize","serializeArray","r20","rhash","rantiCache","rheaders","rlocalProtocol","rnoContent","rprotocol","transports","allTypes","originAnchor","addToPrefiltersOrTransports","structure","dataTypeExpression","dataType","dataTypes","inspectPrefiltersOrTransports","jqXHR","inspected","seekingTransport","inspect","prefilterOrFactory","dataTypeOrTransport","ajaxExtend","flatOptions","ajaxSettings","ajaxHandleResponses","responses","ct","finalDataType","firstDataType","mimeType","getResponseHeader","converters","ajaxConvert","response","isSuccess","conv2","current","conv","responseFields","dataFilter","throws","active","lastModified","etag","url","isLocal","protocol","processData","async","contentType","accepts","json","ajaxSetup","settings","ajaxPrefilter","ajaxTransport","ajax","transport","cacheURL","responseHeadersString","responseHeaders","timeoutTimer","urlAnchor","fireGlobals","uncached","callbackContext","globalEventContext","completeDeferred","statusCode","requestHeaders","requestHeadersNames","strAbort","getAllResponseHeaders","setRequestHeader","overrideMimeType","status","abort","statusText","finalText","crossDomain","host","hasContent","ifModified","headers","beforeSend","success","send","nativeStatusText","modified","getJSON","getScript","textScript","wrapAll","firstElementChild","wrapInner","htmlIsFunction","unwrap","visible","offsetHeight","xhr","XMLHttpRequest","xhrSuccessStatus","xhrSupported","cors","errorCallback","open","username","xhrFields","onload","onerror","onabort","ontimeout","onreadystatechange","responseType","responseText","binary","scriptAttrs","charset","scriptCharset","evt","oldCallbacks","rjsonp","jsonp","jsonpCallback","originalSettings","callbackName","overwritten","responseContainer","jsonProp","createHTMLDocument","implementation","keepScripts","parsed","params","animated","offset","setOffset","curPosition","curLeft","curCSSTop","curTop","curOffset","curCSSLeft","calculatePosition","curElem","using","rect","win","pageYOffset","pageXOffset","offsetParent","parentOffset","scrollTo","Height","Width","defaultExtra","funcName","unbind","delegate","undelegate","hover","fnOver","fnOut","proxy","holdReady","hold","parseJSON","isNumeric","isNaN","trim","define","amd","_jQuery","_$","$","noConflict"],"sources":["/Users/a1/Desktop/code/golang/src/vue-element-admin/src/utils/jquery.js"],"sourcesContent":["/*!\n * jQuery JavaScript Library v3.5.1\n * https://jquery.com/\n *\n * Includes Sizzle.js\n * https://sizzlejs.com/\n *\n * Copyright JS Foundation and other contributors\n * Released under the MIT license\n * https://jquery.org/license\n *\n * Date: 2020-05-04T22:49Z\n */\n( function( global, factory ) {\n\n  \"use strict\";\n\n  if ( typeof module === \"object\" && typeof module.exports === \"object\" ) {\n\n    // For CommonJS and CommonJS-like environments where a proper `window`\n    // is present, execute the factory and get jQuery.\n    // For environments that do not have a `window` with a `document`\n    // (such as Node.js), expose a factory as module.exports.\n    // This accentuates the need for the creation of a real `window`.\n    // e.g. var jQuery = require(\"jquery\")(window);\n    // See ticket #14549 for more info.\n    module.exports = global.document ?\n      factory( global, true ) :\n      function( w ) {\n        if ( !w.document ) {\n          throw new Error( \"jQuery requires a window with a document\" );\n        }\n        return factory( w );\n      };\n  } else {\n    factory( global );\n  }\n\n// Pass this if window is not defined yet\n} )( typeof window !== \"undefined\" ? window : this, function( window, noGlobal ) {\n\n// Edge <= 12 - 13+, Firefox <=18 - 45+, IE 10 - 11, Safari 5.1 - 9+, iOS 6 - 9.1\n// throw exceptions when non-strict code (e.g., ASP.NET 4.5) accesses strict mode\n// arguments.callee.caller (trac-13335). But as of jQuery 3.0 (2016), strict mode should be common\n// enough that all such attempts are guarded in a try block.\n  \"use strict\";\n\n  var arr = [];\n\n  var getProto = Object.getPrototypeOf;\n\n  var slice = arr.slice;\n\n  var flat = arr.flat ? function( array ) {\n    return arr.flat.call( array );\n  } : function( array ) {\n    return arr.concat.apply( [], array );\n  };\n\n\n  var push = arr.push;\n\n  var indexOf = arr.indexOf;\n\n  var class2type = {};\n\n  var toString = class2type.toString;\n\n  var hasOwn = class2type.hasOwnProperty;\n\n  var fnToString = hasOwn.toString;\n\n  var ObjectFunctionString = fnToString.call( Object );\n\n  var support = {};\n\n  var isFunction = function isFunction( obj ) {\n\n    // Support: Chrome <=57, Firefox <=52\n    // In some browsers, typeof returns \"function\" for HTML <object> elements\n    // (i.e., `typeof document.createElement( \"object\" ) === \"function\"`).\n    // We don't want to classify *any* DOM node as a function.\n    return typeof obj === \"function\" && typeof obj.nodeType !== \"number\";\n  };\n\n\n  var isWindow = function isWindow( obj ) {\n    return obj != null && obj === obj.window;\n  };\n\n\n  var document = window.document;\n\n\n\n  var preservedScriptAttributes = {\n    type: true,\n    src: true,\n    nonce: true,\n    noModule: true\n  };\n\n  function DOMEval( code, node, doc ) {\n    doc = doc || document;\n\n    var i, val,\n      script = doc.createElement( \"script\" );\n\n    script.text = code;\n    if ( node ) {\n      for ( i in preservedScriptAttributes ) {\n\n        // Support: Firefox 64+, Edge 18+\n        // Some browsers don't support the \"nonce\" property on scripts.\n        // On the other hand, just using `getAttribute` is not enough as\n        // the `nonce` attribute is reset to an empty string whenever it\n        // becomes browsing-context connected.\n        // See https://github.com/whatwg/html/issues/2369\n        // See https://html.spec.whatwg.org/#nonce-attributes\n        // The `node.getAttribute` check was added for the sake of\n        // `jQuery.globalEval` so that it can fake a nonce-containing node\n        // via an object.\n        val = node[ i ] || node.getAttribute && node.getAttribute( i );\n        if ( val ) {\n          script.setAttribute( i, val );\n        }\n      }\n    }\n    doc.head.appendChild( script ).parentNode.removeChild( script );\n  }\n\n\n  function toType( obj ) {\n    if ( obj == null ) {\n      return obj + \"\";\n    }\n\n    // Support: Android <=2.3 only (functionish RegExp)\n    return typeof obj === \"object\" || typeof obj === \"function\" ?\n      class2type[ toString.call( obj ) ] || \"object\" :\n      typeof obj;\n  }\n  /* global Symbol */\n// Defining this global in .eslintrc.json would create a danger of using the global\n// unguarded in another place, it seems safer to define global only for this module\n\n\n\n  var\n    version = \"3.5.1\",\n\n    // Define a local copy of jQuery\n    jQuery = function( selector, context ) {\n\n      // The jQuery object is actually just the init constructor 'enhanced'\n      // Need init if jQuery is called (just allow error to be thrown if not included)\n      return new jQuery.fn.init( selector, context );\n    };\n\n  jQuery.fn = jQuery.prototype = {\n\n    // The current version of jQuery being used\n    jquery: version,\n\n    constructor: jQuery,\n\n    // The default length of a jQuery object is 0\n    length: 0,\n\n    toArray: function() {\n      return slice.call( this );\n    },\n\n    // Get the Nth element in the matched element set OR\n    // Get the whole matched element set as a clean array\n    get: function( num ) {\n\n      // Return all the elements in a clean array\n      if ( num == null ) {\n        return slice.call( this );\n      }\n\n      // Return just the one element from the set\n      return num < 0 ? this[ num + this.length ] : this[ num ];\n    },\n\n    // Take an array of elements and push it onto the stack\n    // (returning the new matched element set)\n    pushStack: function( elems ) {\n\n      // Build a new jQuery matched element set\n      var ret = jQuery.merge( this.constructor(), elems );\n\n      // Add the old object onto the stack (as a reference)\n      ret.prevObject = this;\n\n      // Return the newly-formed element set\n      return ret;\n    },\n\n    // Execute a callback for every element in the matched set.\n    each: function( callback ) {\n      return jQuery.each( this, callback );\n    },\n\n    map: function( callback ) {\n      return this.pushStack( jQuery.map( this, function( elem, i ) {\n        return callback.call( elem, i, elem );\n      } ) );\n    },\n\n    slice: function() {\n      return this.pushStack( slice.apply( this, arguments ) );\n    },\n\n    first: function() {\n      return this.eq( 0 );\n    },\n\n    last: function() {\n      return this.eq( -1 );\n    },\n\n    even: function() {\n      return this.pushStack( jQuery.grep( this, function( _elem, i ) {\n        return ( i + 1 ) % 2;\n      } ) );\n    },\n\n    odd: function() {\n      return this.pushStack( jQuery.grep( this, function( _elem, i ) {\n        return i % 2;\n      } ) );\n    },\n\n    eq: function( i ) {\n      var len = this.length,\n        j = +i + ( i < 0 ? len : 0 );\n      return this.pushStack( j >= 0 && j < len ? [ this[ j ] ] : [] );\n    },\n\n    end: function() {\n      return this.prevObject || this.constructor();\n    },\n\n    // For internal use only.\n    // Behaves like an Array's method, not like a jQuery method.\n    push: push,\n    sort: arr.sort,\n    splice: arr.splice\n  };\n\n  jQuery.extend = jQuery.fn.extend = function() {\n    var options, name, src, copy, copyIsArray, clone,\n      target = arguments[ 0 ] || {},\n      i = 1,\n      length = arguments.length,\n      deep = false;\n\n    // Handle a deep copy situation\n    if ( typeof target === \"boolean\" ) {\n      deep = target;\n\n      // Skip the boolean and the target\n      target = arguments[ i ] || {};\n      i++;\n    }\n\n    // Handle case when target is a string or something (possible in deep copy)\n    if ( typeof target !== \"object\" && !isFunction( target ) ) {\n      target = {};\n    }\n\n    // Extend jQuery itself if only one argument is passed\n    if ( i === length ) {\n      target = this;\n      i--;\n    }\n\n    for ( ; i < length; i++ ) {\n\n      // Only deal with non-null/undefined values\n      if ( ( options = arguments[ i ] ) != null ) {\n\n        // Extend the base object\n        for ( name in options ) {\n          copy = options[ name ];\n\n          // Prevent Object.prototype pollution\n          // Prevent never-ending loop\n          if ( name === \"__proto__\" || target === copy ) {\n            continue;\n          }\n\n          // Recurse if we're merging plain objects or arrays\n          if ( deep && copy && ( jQuery.isPlainObject( copy ) ||\n            ( copyIsArray = Array.isArray( copy ) ) ) ) {\n            src = target[ name ];\n\n            // Ensure proper type for the source value\n            if ( copyIsArray && !Array.isArray( src ) ) {\n              clone = [];\n            } else if ( !copyIsArray && !jQuery.isPlainObject( src ) ) {\n              clone = {};\n            } else {\n              clone = src;\n            }\n            copyIsArray = false;\n\n            // Never move original objects, clone them\n            target[ name ] = jQuery.extend( deep, clone, copy );\n\n            // Don't bring in undefined values\n          } else if ( copy !== undefined ) {\n            target[ name ] = copy;\n          }\n        }\n      }\n    }\n\n    // Return the modified object\n    return target;\n  };\n\n  jQuery.extend( {\n\n    // Unique for each copy of jQuery on the page\n    expando: \"jQuery\" + ( version + Math.random() ).replace( /\\D/g, \"\" ),\n\n    // Assume jQuery is ready without the ready module\n    isReady: true,\n\n    error: function( msg ) {\n      throw new Error( msg );\n    },\n\n    noop: function() {},\n\n    isPlainObject: function( obj ) {\n      var proto, Ctor;\n\n      // Detect obvious negatives\n      // Use toString instead of jQuery.type to catch host objects\n      if ( !obj || toString.call( obj ) !== \"[object Object]\" ) {\n        return false;\n      }\n\n      proto = getProto( obj );\n\n      // Objects with no prototype (e.g., `Object.create( null )`) are plain\n      if ( !proto ) {\n        return true;\n      }\n\n      // Objects with prototype are plain iff they were constructed by a global Object function\n      Ctor = hasOwn.call( proto, \"constructor\" ) && proto.constructor;\n      return typeof Ctor === \"function\" && fnToString.call( Ctor ) === ObjectFunctionString;\n    },\n\n    isEmptyObject: function( obj ) {\n      var name;\n\n      for ( name in obj ) {\n        return false;\n      }\n      return true;\n    },\n\n    // Evaluates a script in a provided context; falls back to the global one\n    // if not specified.\n    globalEval: function( code, options, doc ) {\n      DOMEval( code, { nonce: options && options.nonce }, doc );\n    },\n\n    each: function( obj, callback ) {\n      var length, i = 0;\n\n      if ( isArrayLike( obj ) ) {\n        length = obj.length;\n        for ( ; i < length; i++ ) {\n          if ( callback.call( obj[ i ], i, obj[ i ] ) === false ) {\n            break;\n          }\n        }\n      } else {\n        for ( i in obj ) {\n          if ( callback.call( obj[ i ], i, obj[ i ] ) === false ) {\n            break;\n          }\n        }\n      }\n\n      return obj;\n    },\n\n    // results is for internal usage only\n    makeArray: function( arr, results ) {\n      var ret = results || [];\n\n      if ( arr != null ) {\n        if ( isArrayLike( Object( arr ) ) ) {\n          jQuery.merge( ret,\n            typeof arr === \"string\" ?\n              [ arr ] : arr\n          );\n        } else {\n          push.call( ret, arr );\n        }\n      }\n\n      return ret;\n    },\n\n    inArray: function( elem, arr, i ) {\n      return arr == null ? -1 : indexOf.call( arr, elem, i );\n    },\n\n    // Support: Android <=4.0 only, PhantomJS 1 only\n    // push.apply(_, arraylike) throws on ancient WebKit\n    merge: function( first, second ) {\n      var len = +second.length,\n        j = 0,\n        i = first.length;\n\n      for ( ; j < len; j++ ) {\n        first[ i++ ] = second[ j ];\n      }\n\n      first.length = i;\n\n      return first;\n    },\n\n    grep: function( elems, callback, invert ) {\n      var callbackInverse,\n        matches = [],\n        i = 0,\n        length = elems.length,\n        callbackExpect = !invert;\n\n      // Go through the array, only saving the items\n      // that pass the validator function\n      for ( ; i < length; i++ ) {\n        callbackInverse = !callback( elems[ i ], i );\n        if ( callbackInverse !== callbackExpect ) {\n          matches.push( elems[ i ] );\n        }\n      }\n\n      return matches;\n    },\n\n    // arg is for internal usage only\n    map: function( elems, callback, arg ) {\n      var length, value,\n        i = 0,\n        ret = [];\n\n      // Go through the array, translating each of the items to their new values\n      if ( isArrayLike( elems ) ) {\n        length = elems.length;\n        for ( ; i < length; i++ ) {\n          value = callback( elems[ i ], i, arg );\n\n          if ( value != null ) {\n            ret.push( value );\n          }\n        }\n\n        // Go through every key on the object,\n      } else {\n        for ( i in elems ) {\n          value = callback( elems[ i ], i, arg );\n\n          if ( value != null ) {\n            ret.push( value );\n          }\n        }\n      }\n\n      // Flatten any nested arrays\n      return flat( ret );\n    },\n\n    // A global GUID counter for objects\n    guid: 1,\n\n    // jQuery.support is not used in Core but other projects attach their\n    // properties to it so it needs to exist.\n    support: support\n  } );\n\n  if ( typeof Symbol === \"function\" ) {\n    jQuery.fn[ Symbol.iterator ] = arr[ Symbol.iterator ];\n  }\n\n// Populate the class2type map\n  jQuery.each( \"Boolean Number String Function Array Date RegExp Object Error Symbol\".split( \" \" ),\n    function( _i, name ) {\n      class2type[ \"[object \" + name + \"]\" ] = name.toLowerCase();\n    } );\n\n  function isArrayLike( obj ) {\n\n    // Support: real iOS 8.2 only (not reproducible in simulator)\n    // `in` check used to prevent JIT error (gh-2145)\n    // hasOwn isn't used here due to false negatives\n    // regarding Nodelist length in IE\n    var length = !!obj && \"length\" in obj && obj.length,\n      type = toType( obj );\n\n    if ( isFunction( obj ) || isWindow( obj ) ) {\n      return false;\n    }\n\n    return type === \"array\" || length === 0 ||\n      typeof length === \"number\" && length > 0 && ( length - 1 ) in obj;\n  }\n  var Sizzle =\n    /*!\n * Sizzle CSS Selector Engine v2.3.5\n * https://sizzlejs.com/\n *\n * Copyright JS Foundation and other contributors\n * Released under the MIT license\n * https://js.foundation/\n *\n * Date: 2020-03-14\n */\n    ( function( window ) {\n      var i,\n        support,\n        Expr,\n        getText,\n        isXML,\n        tokenize,\n        compile,\n        select,\n        outermostContext,\n        sortInput,\n        hasDuplicate,\n\n        // Local document vars\n        setDocument,\n        document,\n        docElem,\n        documentIsHTML,\n        rbuggyQSA,\n        rbuggyMatches,\n        matches,\n        contains,\n\n        // Instance-specific data\n        expando = \"sizzle\" + 1 * new Date(),\n        preferredDoc = window.document,\n        dirruns = 0,\n        done = 0,\n        classCache = createCache(),\n        tokenCache = createCache(),\n        compilerCache = createCache(),\n        nonnativeSelectorCache = createCache(),\n        sortOrder = function( a, b ) {\n          if ( a === b ) {\n            hasDuplicate = true;\n          }\n          return 0;\n        },\n\n        // Instance methods\n        hasOwn = ( {} ).hasOwnProperty,\n        arr = [],\n        pop = arr.pop,\n        pushNative = arr.push,\n        push = arr.push,\n        slice = arr.slice,\n\n        // Use a stripped-down indexOf as it's faster than native\n        // https://jsperf.com/thor-indexof-vs-for/5\n        indexOf = function( list, elem ) {\n          var i = 0,\n            len = list.length;\n          for ( ; i < len; i++ ) {\n            if ( list[ i ] === elem ) {\n              return i;\n            }\n          }\n          return -1;\n        },\n\n        booleans = \"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|\" +\n          \"ismap|loop|multiple|open|readonly|required|scoped\",\n\n        // Regular expressions\n\n        // http://www.w3.org/TR/css3-selectors/#whitespace\n        whitespace = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\n\n        // https://www.w3.org/TR/css-syntax-3/#ident-token-diagram\n        identifier = \"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\" + whitespace +\n          \"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",\n\n        // Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors\n        attributes = \"\\\\[\" + whitespace + \"*(\" + identifier + \")(?:\" + whitespace +\n\n          // Operator (capture 2)\n          \"*([*^$|!~]?=)\" + whitespace +\n\n          // \"Attribute values must be CSS identifiers [capture 5]\n          // or strings [capture 3 or capture 4]\"\n          \"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\" + identifier + \"))|)\" +\n          whitespace + \"*\\\\]\",\n\n        pseudos = \":(\" + identifier + \")(?:\\\\((\" +\n\n          // To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:\n          // 1. quoted (capture 3; capture 4 or capture 5)\n          \"('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|\" +\n\n          // 2. simple (capture 6)\n          \"((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\" + attributes + \")*)|\" +\n\n          // 3. anything else (capture 2)\n          \".*\" +\n          \")\\\\)|)\",\n\n        // Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter\n        rwhitespace = new RegExp( whitespace + \"+\", \"g\" ),\n        rtrim = new RegExp( \"^\" + whitespace + \"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\" +\n          whitespace + \"+$\", \"g\" ),\n\n        rcomma = new RegExp( \"^\" + whitespace + \"*,\" + whitespace + \"*\" ),\n        rcombinators = new RegExp( \"^\" + whitespace + \"*([>+~]|\" + whitespace + \")\" + whitespace +\n          \"*\" ),\n        rdescend = new RegExp( whitespace + \"|>\" ),\n\n        rpseudo = new RegExp( pseudos ),\n        ridentifier = new RegExp( \"^\" + identifier + \"$\" ),\n\n        matchExpr = {\n          \"ID\": new RegExp( \"^#(\" + identifier + \")\" ),\n          \"CLASS\": new RegExp( \"^\\\\.(\" + identifier + \")\" ),\n          \"TAG\": new RegExp( \"^(\" + identifier + \"|[*])\" ),\n          \"ATTR\": new RegExp( \"^\" + attributes ),\n          \"PSEUDO\": new RegExp( \"^\" + pseudos ),\n          \"CHILD\": new RegExp( \"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\" +\n            whitespace + \"*(even|odd|(([+-]|)(\\\\d*)n|)\" + whitespace + \"*(?:([+-]|)\" +\n            whitespace + \"*(\\\\d+)|))\" + whitespace + \"*\\\\)|)\", \"i\" ),\n          \"bool\": new RegExp( \"^(?:\" + booleans + \")$\", \"i\" ),\n\n          // For use in libraries implementing .is()\n          // We use this for POS matching in `select`\n          \"needsContext\": new RegExp( \"^\" + whitespace +\n            \"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\" + whitespace +\n            \"*((?:-\\\\d)?\\\\d*)\" + whitespace + \"*\\\\)|)(?=[^-]|$)\", \"i\" )\n        },\n\n        rhtml = /HTML$/i,\n        rinputs = /^(?:input|select|textarea|button)$/i,\n        rheader = /^h\\d$/i,\n\n        rnative = /^[^{]+\\{\\s*\\[native \\w/,\n\n        // Easily-parseable/retrievable ID or TAG or CLASS selectors\n        rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,\n\n        rsibling = /[+~]/,\n\n        // CSS escapes\n        // http://www.w3.org/TR/CSS21/syndata.html#escaped-characters\n        runescape = new RegExp( \"\\\\\\\\[\\\\da-fA-F]{1,6}\" + whitespace + \"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\", \"g\" ),\n        funescape = function( escape, nonHex ) {\n          var high = \"0x\" + escape.slice( 1 ) - 0x10000;\n\n          return nonHex ?\n\n            // Strip the backslash prefix from a non-hex escape sequence\n            nonHex :\n\n            // Replace a hexadecimal escape sequence with the encoded Unicode code point\n            // Support: IE <=11+\n            // For values outside the Basic Multilingual Plane (BMP), manually construct a\n            // surrogate pair\n            high < 0 ?\n              String.fromCharCode( high + 0x10000 ) :\n              String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );\n        },\n\n        // CSS string/identifier serialization\n        // https://drafts.csswg.org/cssom/#common-serializing-idioms\n        rcssescape = /([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g,\n        fcssescape = function( ch, asCodePoint ) {\n          if ( asCodePoint ) {\n\n            // U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER\n            if ( ch === \"\\0\" ) {\n              return \"\\uFFFD\";\n            }\n\n            // Control characters and (dependent upon position) numbers get escaped as code points\n            return ch.slice( 0, -1 ) + \"\\\\\" +\n              ch.charCodeAt( ch.length - 1 ).toString( 16 ) + \" \";\n          }\n\n          // Other potentially-special ASCII characters get backslash-escaped\n          return \"\\\\\" + ch;\n        },\n\n        // Used for iframes\n        // See setDocument()\n        // Removing the function wrapper causes a \"Permission Denied\"\n        // error in IE\n        unloadHandler = function() {\n          setDocument();\n        },\n\n        inDisabledFieldset = addCombinator(\n          function( elem ) {\n            return elem.disabled === true && elem.nodeName.toLowerCase() === \"fieldset\";\n          },\n          { dir: \"parentNode\", next: \"legend\" }\n        );\n\n// Optimize for push.apply( _, NodeList )\n      try {\n        push.apply(\n          ( arr = slice.call( preferredDoc.childNodes ) ),\n          preferredDoc.childNodes\n        );\n\n        // Support: Android<4.0\n        // Detect silently failing push.apply\n        // eslint-disable-next-line no-unused-expressions\n        arr[ preferredDoc.childNodes.length ].nodeType;\n      } catch ( e ) {\n        push = { apply: arr.length ?\n\n            // Leverage slice if possible\n            function( target, els ) {\n              pushNative.apply( target, slice.call( els ) );\n            } :\n\n            // Support: IE<9\n            // Otherwise append directly\n            function( target, els ) {\n              var j = target.length,\n                i = 0;\n\n              // Can't trust NodeList.length\n              while ( ( target[ j++ ] = els[ i++ ] ) ) {}\n              target.length = j - 1;\n            }\n        };\n      }\n\n      function Sizzle( selector, context, results, seed ) {\n        var m, i, elem, nid, match, groups, newSelector,\n          newContext = context && context.ownerDocument,\n\n          // nodeType defaults to 9, since context defaults to document\n          nodeType = context ? context.nodeType : 9;\n\n        results = results || [];\n\n        // Return early from calls with invalid selector or context\n        if ( typeof selector !== \"string\" || !selector ||\n          nodeType !== 1 && nodeType !== 9 && nodeType !== 11 ) {\n\n          return results;\n        }\n\n        // Try to shortcut find operations (as opposed to filters) in HTML documents\n        if ( !seed ) {\n          setDocument( context );\n          context = context || document;\n\n          if ( documentIsHTML ) {\n\n            // If the selector is sufficiently simple, try using a \"get*By*\" DOM method\n            // (excepting DocumentFragment context, where the methods don't exist)\n            if ( nodeType !== 11 && ( match = rquickExpr.exec( selector ) ) ) {\n\n              // ID selector\n              if ( ( m = match[ 1 ] ) ) {\n\n                // Document context\n                if ( nodeType === 9 ) {\n                  if ( ( elem = context.getElementById( m ) ) ) {\n\n                    // Support: IE, Opera, Webkit\n                    // TODO: identify versions\n                    // getElementById can match elements by name instead of ID\n                    if ( elem.id === m ) {\n                      results.push( elem );\n                      return results;\n                    }\n                  } else {\n                    return results;\n                  }\n\n                  // Element context\n                } else {\n\n                  // Support: IE, Opera, Webkit\n                  // TODO: identify versions\n                  // getElementById can match elements by name instead of ID\n                  if ( newContext && ( elem = newContext.getElementById( m ) ) &&\n                    contains( context, elem ) &&\n                    elem.id === m ) {\n\n                    results.push( elem );\n                    return results;\n                  }\n                }\n\n                // Type selector\n              } else if ( match[ 2 ] ) {\n                push.apply( results, context.getElementsByTagName( selector ) );\n                return results;\n\n                // Class selector\n              } else if ( ( m = match[ 3 ] ) && support.getElementsByClassName &&\n                context.getElementsByClassName ) {\n\n                push.apply( results, context.getElementsByClassName( m ) );\n                return results;\n              }\n            }\n\n            // Take advantage of querySelectorAll\n            if ( support.qsa &&\n              !nonnativeSelectorCache[ selector + \" \" ] &&\n              ( !rbuggyQSA || !rbuggyQSA.test( selector ) ) &&\n\n              // Support: IE 8 only\n              // Exclude object elements\n              ( nodeType !== 1 || context.nodeName.toLowerCase() !== \"object\" ) ) {\n\n              newSelector = selector;\n              newContext = context;\n\n              // qSA considers elements outside a scoping root when evaluating child or\n              // descendant combinators, which is not what we want.\n              // In such cases, we work around the behavior by prefixing every selector in the\n              // list with an ID selector referencing the scope context.\n              // The technique has to be used as well when a leading combinator is used\n              // as such selectors are not recognized by querySelectorAll.\n              // Thanks to Andrew Dupont for this technique.\n              if ( nodeType === 1 &&\n                ( rdescend.test( selector ) || rcombinators.test( selector ) ) ) {\n\n                // Expand context for sibling selectors\n                newContext = rsibling.test( selector ) && testContext( context.parentNode ) ||\n                  context;\n\n                // We can use :scope instead of the ID hack if the browser\n                // supports it & if we're not changing the context.\n                if ( newContext !== context || !support.scope ) {\n\n                  // Capture the context ID, setting it first if necessary\n                  if ( ( nid = context.getAttribute( \"id\" ) ) ) {\n                    nid = nid.replace( rcssescape, fcssescape );\n                  } else {\n                    context.setAttribute( \"id\", ( nid = expando ) );\n                  }\n                }\n\n                // Prefix every selector in the list\n                groups = tokenize( selector );\n                i = groups.length;\n                while ( i-- ) {\n                  groups[ i ] = ( nid ? \"#\" + nid : \":scope\" ) + \" \" +\n                    toSelector( groups[ i ] );\n                }\n                newSelector = groups.join( \",\" );\n              }\n\n              try {\n                push.apply( results,\n                  newContext.querySelectorAll( newSelector )\n                );\n                return results;\n              } catch ( qsaError ) {\n                nonnativeSelectorCache( selector, true );\n              } finally {\n                if ( nid === expando ) {\n                  context.removeAttribute( \"id\" );\n                }\n              }\n            }\n          }\n        }\n\n        // All others\n        return select( selector.replace( rtrim, \"$1\" ), context, results, seed );\n      }\n\n      /**\n       * Create key-value caches of limited size\n       * @returns {function(string, object)} Returns the Object data after storing it on itself with\n       *\tproperty name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)\n       *\tdeleting the oldest entry\n       */\n      function createCache() {\n        var keys = [];\n\n        function cache( key, value ) {\n\n          // Use (key + \" \") to avoid collision with native prototype properties (see Issue #157)\n          if ( keys.push( key + \" \" ) > Expr.cacheLength ) {\n\n            // Only keep the most recent entries\n            delete cache[ keys.shift() ];\n          }\n          return ( cache[ key + \" \" ] = value );\n        }\n        return cache;\n      }\n\n      /**\n       * Mark a function for special use by Sizzle\n       * @param {Function} fn The function to mark\n       */\n      function markFunction( fn ) {\n        fn[ expando ] = true;\n        return fn;\n      }\n\n      /**\n       * Support testing using an element\n       * @param {Function} fn Passed the created element and returns a boolean result\n       */\n      function assert( fn ) {\n        var el = document.createElement( \"fieldset\" );\n\n        try {\n          return !!fn( el );\n        } catch ( e ) {\n          return false;\n        } finally {\n\n          // Remove from its parent by default\n          if ( el.parentNode ) {\n            el.parentNode.removeChild( el );\n          }\n\n          // release memory in IE\n          el = null;\n        }\n      }\n\n      /**\n       * Adds the same handler for all of the specified attrs\n       * @param {String} attrs Pipe-separated list of attributes\n       * @param {Function} handler The method that will be applied\n       */\n      function addHandle( attrs, handler ) {\n        var arr = attrs.split( \"|\" ),\n          i = arr.length;\n\n        while ( i-- ) {\n          Expr.attrHandle[ arr[ i ] ] = handler;\n        }\n      }\n\n      /**\n       * Checks document order of two siblings\n       * @param {Element} a\n       * @param {Element} b\n       * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b\n       */\n      function siblingCheck( a, b ) {\n        var cur = b && a,\n          diff = cur && a.nodeType === 1 && b.nodeType === 1 &&\n            a.sourceIndex - b.sourceIndex;\n\n        // Use IE sourceIndex if available on both nodes\n        if ( diff ) {\n          return diff;\n        }\n\n        // Check if b follows a\n        if ( cur ) {\n          while ( ( cur = cur.nextSibling ) ) {\n            if ( cur === b ) {\n              return -1;\n            }\n          }\n        }\n\n        return a ? 1 : -1;\n      }\n\n      /**\n       * Returns a function to use in pseudos for input types\n       * @param {String} type\n       */\n      function createInputPseudo( type ) {\n        return function( elem ) {\n          var name = elem.nodeName.toLowerCase();\n          return name === \"input\" && elem.type === type;\n        };\n      }\n\n      /**\n       * Returns a function to use in pseudos for buttons\n       * @param {String} type\n       */\n      function createButtonPseudo( type ) {\n        return function( elem ) {\n          var name = elem.nodeName.toLowerCase();\n          return ( name === \"input\" || name === \"button\" ) && elem.type === type;\n        };\n      }\n\n      /**\n       * Returns a function to use in pseudos for :enabled/:disabled\n       * @param {Boolean} disabled true for :disabled; false for :enabled\n       */\n      function createDisabledPseudo( disabled ) {\n\n        // Known :disabled false positives: fieldset[disabled] > legend:nth-of-type(n+2) :can-disable\n        return function( elem ) {\n\n          // Only certain elements can match :enabled or :disabled\n          // https://html.spec.whatwg.org/multipage/scripting.html#selector-enabled\n          // https://html.spec.whatwg.org/multipage/scripting.html#selector-disabled\n          if ( \"form\" in elem ) {\n\n            // Check for inherited disabledness on relevant non-disabled elements:\n            // * listed form-associated elements in a disabled fieldset\n            //   https://html.spec.whatwg.org/multipage/forms.html#category-listed\n            //   https://html.spec.whatwg.org/multipage/forms.html#concept-fe-disabled\n            // * option elements in a disabled optgroup\n            //   https://html.spec.whatwg.org/multipage/forms.html#concept-option-disabled\n            // All such elements have a \"form\" property.\n            if ( elem.parentNode && elem.disabled === false ) {\n\n              // Option elements defer to a parent optgroup if present\n              if ( \"label\" in elem ) {\n                if ( \"label\" in elem.parentNode ) {\n                  return elem.parentNode.disabled === disabled;\n                } else {\n                  return elem.disabled === disabled;\n                }\n              }\n\n              // Support: IE 6 - 11\n              // Use the isDisabled shortcut property to check for disabled fieldset ancestors\n              return elem.isDisabled === disabled ||\n\n                // Where there is no isDisabled, check manually\n                /* jshint -W018 */\n                elem.isDisabled !== !disabled &&\n                inDisabledFieldset( elem ) === disabled;\n            }\n\n            return elem.disabled === disabled;\n\n            // Try to winnow out elements that can't be disabled before trusting the disabled property.\n            // Some victims get caught in our net (label, legend, menu, track), but it shouldn't\n            // even exist on them, let alone have a boolean value.\n          } else if ( \"label\" in elem ) {\n            return elem.disabled === disabled;\n          }\n\n          // Remaining elements are neither :enabled nor :disabled\n          return false;\n        };\n      }\n\n      /**\n       * Returns a function to use in pseudos for positionals\n       * @param {Function} fn\n       */\n      function createPositionalPseudo( fn ) {\n        return markFunction( function( argument ) {\n          argument = +argument;\n          return markFunction( function( seed, matches ) {\n            var j,\n              matchIndexes = fn( [], seed.length, argument ),\n              i = matchIndexes.length;\n\n            // Match elements found at the specified indexes\n            while ( i-- ) {\n              if ( seed[ ( j = matchIndexes[ i ] ) ] ) {\n                seed[ j ] = !( matches[ j ] = seed[ j ] );\n              }\n            }\n          } );\n        } );\n      }\n\n      /**\n       * Checks a node for validity as a Sizzle context\n       * @param {Element|Object=} context\n       * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value\n       */\n      function testContext( context ) {\n        return context && typeof context.getElementsByTagName !== \"undefined\" && context;\n      }\n\n// Expose support vars for convenience\n      support = Sizzle.support = {};\n\n      /**\n       * Detects XML nodes\n       * @param {Element|Object} elem An element or a document\n       * @returns {Boolean} True iff elem is a non-HTML XML node\n       */\n      isXML = Sizzle.isXML = function( elem ) {\n        var namespace = elem.namespaceURI,\n          docElem = ( elem.ownerDocument || elem ).documentElement;\n\n        // Support: IE <=8\n        // Assume HTML when documentElement doesn't yet exist, such as inside loading iframes\n        // https://bugs.jquery.com/ticket/4833\n        return !rhtml.test( namespace || docElem && docElem.nodeName || \"HTML\" );\n      };\n\n      /**\n       * Sets document-related variables once based on the current document\n       * @param {Element|Object} [doc] An element or document object to use to set the document\n       * @returns {Object} Returns the current document\n       */\n      setDocument = Sizzle.setDocument = function( node ) {\n        var hasCompare, subWindow,\n          doc = node ? node.ownerDocument || node : preferredDoc;\n\n        // Return early if doc is invalid or already selected\n        // Support: IE 11+, Edge 17 - 18+\n        // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n        // two documents; shallow comparisons work.\n        // eslint-disable-next-line eqeqeq\n        if ( doc == document || doc.nodeType !== 9 || !doc.documentElement ) {\n          return document;\n        }\n\n        // Update global variables\n        document = doc;\n        docElem = document.documentElement;\n        documentIsHTML = !isXML( document );\n\n        // Support: IE 9 - 11+, Edge 12 - 18+\n        // Accessing iframe documents after unload throws \"permission denied\" errors (jQuery #13936)\n        // Support: IE 11+, Edge 17 - 18+\n        // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n        // two documents; shallow comparisons work.\n        // eslint-disable-next-line eqeqeq\n        if ( preferredDoc != document &&\n          ( subWindow = document.defaultView ) && subWindow.top !== subWindow ) {\n\n          // Support: IE 11, Edge\n          if ( subWindow.addEventListener ) {\n            subWindow.addEventListener( \"unload\", unloadHandler, false );\n\n            // Support: IE 9 - 10 only\n          } else if ( subWindow.attachEvent ) {\n            subWindow.attachEvent( \"onunload\", unloadHandler );\n          }\n        }\n\n        // Support: IE 8 - 11+, Edge 12 - 18+, Chrome <=16 - 25 only, Firefox <=3.6 - 31 only,\n        // Safari 4 - 5 only, Opera <=11.6 - 12.x only\n        // IE/Edge & older browsers don't support the :scope pseudo-class.\n        // Support: Safari 6.0 only\n        // Safari 6.0 supports :scope but it's an alias of :root there.\n        support.scope = assert( function( el ) {\n          docElem.appendChild( el ).appendChild( document.createElement( \"div\" ) );\n          return typeof el.querySelectorAll !== \"undefined\" &&\n            !el.querySelectorAll( \":scope fieldset div\" ).length;\n        } );\n\n        /* Attributes\n\t---------------------------------------------------------------------- */\n\n        // Support: IE<8\n        // Verify that getAttribute really returns attributes and not properties\n        // (excepting IE8 booleans)\n        support.attributes = assert( function( el ) {\n          el.className = \"i\";\n          return !el.getAttribute( \"className\" );\n        } );\n\n        /* getElement(s)By*\n\t---------------------------------------------------------------------- */\n\n        // Check if getElementsByTagName(\"*\") returns only elements\n        support.getElementsByTagName = assert( function( el ) {\n          el.appendChild( document.createComment( \"\" ) );\n          return !el.getElementsByTagName( \"*\" ).length;\n        } );\n\n        // Support: IE<9\n        support.getElementsByClassName = rnative.test( document.getElementsByClassName );\n\n        // Support: IE<10\n        // Check if getElementById returns elements by name\n        // The broken getElementById methods don't pick up programmatically-set names,\n        // so use a roundabout getElementsByName test\n        support.getById = assert( function( el ) {\n          docElem.appendChild( el ).id = expando;\n          return !document.getElementsByName || !document.getElementsByName( expando ).length;\n        } );\n\n        // ID filter and find\n        if ( support.getById ) {\n          Expr.filter[ \"ID\" ] = function( id ) {\n            var attrId = id.replace( runescape, funescape );\n            return function( elem ) {\n              return elem.getAttribute( \"id\" ) === attrId;\n            };\n          };\n          Expr.find[ \"ID\" ] = function( id, context ) {\n            if ( typeof context.getElementById !== \"undefined\" && documentIsHTML ) {\n              var elem = context.getElementById( id );\n              return elem ? [ elem ] : [];\n            }\n          };\n        } else {\n          Expr.filter[ \"ID\" ] =  function( id ) {\n            var attrId = id.replace( runescape, funescape );\n            return function( elem ) {\n              var node = typeof elem.getAttributeNode !== \"undefined\" &&\n                elem.getAttributeNode( \"id\" );\n              return node && node.value === attrId;\n            };\n          };\n\n          // Support: IE 6 - 7 only\n          // getElementById is not reliable as a find shortcut\n          Expr.find[ \"ID\" ] = function( id, context ) {\n            if ( typeof context.getElementById !== \"undefined\" && documentIsHTML ) {\n              var node, i, elems,\n                elem = context.getElementById( id );\n\n              if ( elem ) {\n\n                // Verify the id attribute\n                node = elem.getAttributeNode( \"id\" );\n                if ( node && node.value === id ) {\n                  return [ elem ];\n                }\n\n                // Fall back on getElementsByName\n                elems = context.getElementsByName( id );\n                i = 0;\n                while ( ( elem = elems[ i++ ] ) ) {\n                  node = elem.getAttributeNode( \"id\" );\n                  if ( node && node.value === id ) {\n                    return [ elem ];\n                  }\n                }\n              }\n\n              return [];\n            }\n          };\n        }\n\n        // Tag\n        Expr.find[ \"TAG\" ] = support.getElementsByTagName ?\n          function( tag, context ) {\n            if ( typeof context.getElementsByTagName !== \"undefined\" ) {\n              return context.getElementsByTagName( tag );\n\n              // DocumentFragment nodes don't have gEBTN\n            } else if ( support.qsa ) {\n              return context.querySelectorAll( tag );\n            }\n          } :\n\n          function( tag, context ) {\n            var elem,\n              tmp = [],\n              i = 0,\n\n              // By happy coincidence, a (broken) gEBTN appears on DocumentFragment nodes too\n              results = context.getElementsByTagName( tag );\n\n            // Filter out possible comments\n            if ( tag === \"*\" ) {\n              while ( ( elem = results[ i++ ] ) ) {\n                if ( elem.nodeType === 1 ) {\n                  tmp.push( elem );\n                }\n              }\n\n              return tmp;\n            }\n            return results;\n          };\n\n        // Class\n        Expr.find[ \"CLASS\" ] = support.getElementsByClassName && function( className, context ) {\n          if ( typeof context.getElementsByClassName !== \"undefined\" && documentIsHTML ) {\n            return context.getElementsByClassName( className );\n          }\n        };\n\n        /* QSA/matchesSelector\n\t---------------------------------------------------------------------- */\n\n        // QSA and matchesSelector support\n\n        // matchesSelector(:active) reports false when true (IE9/Opera 11.5)\n        rbuggyMatches = [];\n\n        // qSa(:focus) reports false when true (Chrome 21)\n        // We allow this because of a bug in IE8/9 that throws an error\n        // whenever `document.activeElement` is accessed on an iframe\n        // So, we allow :focus to pass through QSA all the time to avoid the IE error\n        // See https://bugs.jquery.com/ticket/13378\n        rbuggyQSA = [];\n\n        if ( ( support.qsa = rnative.test( document.querySelectorAll ) ) ) {\n\n          // Build QSA regex\n          // Regex strategy adopted from Diego Perini\n          assert( function( el ) {\n\n            var input;\n\n            // Select is set to empty string on purpose\n            // This is to test IE's treatment of not explicitly\n            // setting a boolean content attribute,\n            // since its presence should be enough\n            // https://bugs.jquery.com/ticket/12359\n            docElem.appendChild( el ).innerHTML = \"<a id='\" + expando + \"'></a>\" +\n              \"<select id='\" + expando + \"-\\r\\\\' msallowcapture=''>\" +\n              \"<option selected=''></option></select>\";\n\n            // Support: IE8, Opera 11-12.16\n            // Nothing should be selected when empty strings follow ^= or $= or *=\n            // The test attribute must be unknown in Opera but \"safe\" for WinRT\n            // https://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section\n            if ( el.querySelectorAll( \"[msallowcapture^='']\" ).length ) {\n              rbuggyQSA.push( \"[*^$]=\" + whitespace + \"*(?:''|\\\"\\\")\" );\n            }\n\n            // Support: IE8\n            // Boolean attributes and \"value\" are not treated correctly\n            if ( !el.querySelectorAll( \"[selected]\" ).length ) {\n              rbuggyQSA.push( \"\\\\[\" + whitespace + \"*(?:value|\" + booleans + \")\" );\n            }\n\n            // Support: Chrome<29, Android<4.4, Safari<7.0+, iOS<7.0+, PhantomJS<1.9.8+\n            if ( !el.querySelectorAll( \"[id~=\" + expando + \"-]\" ).length ) {\n              rbuggyQSA.push( \"~=\" );\n            }\n\n            // Support: IE 11+, Edge 15 - 18+\n            // IE 11/Edge don't find elements on a `[name='']` query in some cases.\n            // Adding a temporary attribute to the document before the selection works\n            // around the issue.\n            // Interestingly, IE 10 & older don't seem to have the issue.\n            input = document.createElement( \"input\" );\n            input.setAttribute( \"name\", \"\" );\n            el.appendChild( input );\n            if ( !el.querySelectorAll( \"[name='']\" ).length ) {\n              rbuggyQSA.push( \"\\\\[\" + whitespace + \"*name\" + whitespace + \"*=\" +\n                whitespace + \"*(?:''|\\\"\\\")\" );\n            }\n\n            // Webkit/Opera - :checked should return selected option elements\n            // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n            // IE8 throws error here and will not see later tests\n            if ( !el.querySelectorAll( \":checked\" ).length ) {\n              rbuggyQSA.push( \":checked\" );\n            }\n\n            // Support: Safari 8+, iOS 8+\n            // https://bugs.webkit.org/show_bug.cgi?id=136851\n            // In-page `selector#id sibling-combinator selector` fails\n            if ( !el.querySelectorAll( \"a#\" + expando + \"+*\" ).length ) {\n              rbuggyQSA.push( \".#.+[+~]\" );\n            }\n\n            // Support: Firefox <=3.6 - 5 only\n            // Old Firefox doesn't throw on a badly-escaped identifier.\n            el.querySelectorAll( \"\\\\\\f\" );\n            rbuggyQSA.push( \"[\\\\r\\\\n\\\\f]\" );\n          } );\n\n          assert( function( el ) {\n            el.innerHTML = \"<a href='' disabled='disabled'></a>\" +\n              \"<select disabled='disabled'><option/></select>\";\n\n            // Support: Windows 8 Native Apps\n            // The type and name attributes are restricted during .innerHTML assignment\n            var input = document.createElement( \"input\" );\n            input.setAttribute( \"type\", \"hidden\" );\n            el.appendChild( input ).setAttribute( \"name\", \"D\" );\n\n            // Support: IE8\n            // Enforce case-sensitivity of name attribute\n            if ( el.querySelectorAll( \"[name=d]\" ).length ) {\n              rbuggyQSA.push( \"name\" + whitespace + \"*[*^$|!~]?=\" );\n            }\n\n            // FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)\n            // IE8 throws error here and will not see later tests\n            if ( el.querySelectorAll( \":enabled\" ).length !== 2 ) {\n              rbuggyQSA.push( \":enabled\", \":disabled\" );\n            }\n\n            // Support: IE9-11+\n            // IE's :disabled selector does not pick up the children of disabled fieldsets\n            docElem.appendChild( el ).disabled = true;\n            if ( el.querySelectorAll( \":disabled\" ).length !== 2 ) {\n              rbuggyQSA.push( \":enabled\", \":disabled\" );\n            }\n\n            // Support: Opera 10 - 11 only\n            // Opera 10-11 does not throw on post-comma invalid pseudos\n            el.querySelectorAll( \"*,:x\" );\n            rbuggyQSA.push( \",.*:\" );\n          } );\n        }\n\n        if ( ( support.matchesSelector = rnative.test( ( matches = docElem.matches ||\n          docElem.webkitMatchesSelector ||\n          docElem.mozMatchesSelector ||\n          docElem.oMatchesSelector ||\n          docElem.msMatchesSelector ) ) ) ) {\n\n          assert( function( el ) {\n\n            // Check to see if it's possible to do matchesSelector\n            // on a disconnected node (IE 9)\n            support.disconnectedMatch = matches.call( el, \"*\" );\n\n            // This should fail with an exception\n            // Gecko does not error, returns false instead\n            matches.call( el, \"[s!='']:x\" );\n            rbuggyMatches.push( \"!=\", pseudos );\n          } );\n        }\n\n        rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join( \"|\" ) );\n        rbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join( \"|\" ) );\n\n        /* Contains\n\t---------------------------------------------------------------------- */\n        hasCompare = rnative.test( docElem.compareDocumentPosition );\n\n        // Element contains another\n        // Purposefully self-exclusive\n        // As in, an element does not contain itself\n        contains = hasCompare || rnative.test( docElem.contains ) ?\n          function( a, b ) {\n            var adown = a.nodeType === 9 ? a.documentElement : a,\n              bup = b && b.parentNode;\n            return a === bup || !!( bup && bup.nodeType === 1 && (\n              adown.contains ?\n                adown.contains( bup ) :\n                a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16\n            ) );\n          } :\n          function( a, b ) {\n            if ( b ) {\n              while ( ( b = b.parentNode ) ) {\n                if ( b === a ) {\n                  return true;\n                }\n              }\n            }\n            return false;\n          };\n\n        /* Sorting\n\t---------------------------------------------------------------------- */\n\n        // Document order sorting\n        sortOrder = hasCompare ?\n          function( a, b ) {\n\n            // Flag for duplicate removal\n            if ( a === b ) {\n              hasDuplicate = true;\n              return 0;\n            }\n\n            // Sort on method existence if only one input has compareDocumentPosition\n            var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\n            if ( compare ) {\n              return compare;\n            }\n\n            // Calculate position if both inputs belong to the same document\n            // Support: IE 11+, Edge 17 - 18+\n            // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n            // two documents; shallow comparisons work.\n            // eslint-disable-next-line eqeqeq\n            compare = ( a.ownerDocument || a ) == ( b.ownerDocument || b ) ?\n              a.compareDocumentPosition( b ) :\n\n              // Otherwise we know they are disconnected\n              1;\n\n            // Disconnected nodes\n            if ( compare & 1 ||\n              ( !support.sortDetached && b.compareDocumentPosition( a ) === compare ) ) {\n\n              // Choose the first element that is related to our preferred document\n              // Support: IE 11+, Edge 17 - 18+\n              // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n              // two documents; shallow comparisons work.\n              // eslint-disable-next-line eqeqeq\n              if ( a == document || a.ownerDocument == preferredDoc &&\n                contains( preferredDoc, a ) ) {\n                return -1;\n              }\n\n              // Support: IE 11+, Edge 17 - 18+\n              // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n              // two documents; shallow comparisons work.\n              // eslint-disable-next-line eqeqeq\n              if ( b == document || b.ownerDocument == preferredDoc &&\n                contains( preferredDoc, b ) ) {\n                return 1;\n              }\n\n              // Maintain original order\n              return sortInput ?\n                ( indexOf( sortInput, a ) - indexOf( sortInput, b ) ) :\n                0;\n            }\n\n            return compare & 4 ? -1 : 1;\n          } :\n          function( a, b ) {\n\n            // Exit early if the nodes are identical\n            if ( a === b ) {\n              hasDuplicate = true;\n              return 0;\n            }\n\n            var cur,\n              i = 0,\n              aup = a.parentNode,\n              bup = b.parentNode,\n              ap = [ a ],\n              bp = [ b ];\n\n            // Parentless nodes are either documents or disconnected\n            if ( !aup || !bup ) {\n\n              // Support: IE 11+, Edge 17 - 18+\n              // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n              // two documents; shallow comparisons work.\n              /* eslint-disable eqeqeq */\n              return a == document ? -1 :\n                b == document ? 1 :\n                  /* eslint-enable eqeqeq */\n                  aup ? -1 :\n                    bup ? 1 :\n                      sortInput ?\n                        ( indexOf( sortInput, a ) - indexOf( sortInput, b ) ) :\n                        0;\n\n              // If the nodes are siblings, we can do a quick check\n            } else if ( aup === bup ) {\n              return siblingCheck( a, b );\n            }\n\n            // Otherwise we need full lists of their ancestors for comparison\n            cur = a;\n            while ( ( cur = cur.parentNode ) ) {\n              ap.unshift( cur );\n            }\n            cur = b;\n            while ( ( cur = cur.parentNode ) ) {\n              bp.unshift( cur );\n            }\n\n            // Walk down the tree looking for a discrepancy\n            while ( ap[ i ] === bp[ i ] ) {\n              i++;\n            }\n\n            return i ?\n\n              // Do a sibling check if the nodes have a common ancestor\n              siblingCheck( ap[ i ], bp[ i ] ) :\n\n              // Otherwise nodes in our document sort first\n              // Support: IE 11+, Edge 17 - 18+\n              // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n              // two documents; shallow comparisons work.\n              /* eslint-disable eqeqeq */\n              ap[ i ] == preferredDoc ? -1 :\n                bp[ i ] == preferredDoc ? 1 :\n                  /* eslint-enable eqeqeq */\n                  0;\n          };\n\n        return document;\n      };\n\n      Sizzle.matches = function( expr, elements ) {\n        return Sizzle( expr, null, null, elements );\n      };\n\n      Sizzle.matchesSelector = function( elem, expr ) {\n        setDocument( elem );\n\n        if ( support.matchesSelector && documentIsHTML &&\n          !nonnativeSelectorCache[ expr + \" \" ] &&\n          ( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&\n          ( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {\n\n          try {\n            var ret = matches.call( elem, expr );\n\n            // IE 9's matchesSelector returns false on disconnected nodes\n            if ( ret || support.disconnectedMatch ||\n\n              // As well, disconnected nodes are said to be in a document\n              // fragment in IE 9\n              elem.document && elem.document.nodeType !== 11 ) {\n              return ret;\n            }\n          } catch ( e ) {\n            nonnativeSelectorCache( expr, true );\n          }\n        }\n\n        return Sizzle( expr, document, null, [ elem ] ).length > 0;\n      };\n\n      Sizzle.contains = function( context, elem ) {\n\n        // Set document vars if needed\n        // Support: IE 11+, Edge 17 - 18+\n        // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n        // two documents; shallow comparisons work.\n        // eslint-disable-next-line eqeqeq\n        if ( ( context.ownerDocument || context ) != document ) {\n          setDocument( context );\n        }\n        return contains( context, elem );\n      };\n\n      Sizzle.attr = function( elem, name ) {\n\n        // Set document vars if needed\n        // Support: IE 11+, Edge 17 - 18+\n        // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n        // two documents; shallow comparisons work.\n        // eslint-disable-next-line eqeqeq\n        if ( ( elem.ownerDocument || elem ) != document ) {\n          setDocument( elem );\n        }\n\n        var fn = Expr.attrHandle[ name.toLowerCase() ],\n\n          // Don't get fooled by Object.prototype properties (jQuery #13807)\n          val = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?\n            fn( elem, name, !documentIsHTML ) :\n            undefined;\n\n        return val !== undefined ?\n          val :\n          support.attributes || !documentIsHTML ?\n            elem.getAttribute( name ) :\n            ( val = elem.getAttributeNode( name ) ) && val.specified ?\n              val.value :\n              null;\n      };\n\n      Sizzle.escape = function( sel ) {\n        return ( sel + \"\" ).replace( rcssescape, fcssescape );\n      };\n\n      Sizzle.error = function( msg ) {\n        throw new Error( \"Syntax error, unrecognized expression: \" + msg );\n      };\n\n      /**\n       * Document sorting and removing duplicates\n       * @param {ArrayLike} results\n       */\n      Sizzle.uniqueSort = function( results ) {\n        var elem,\n          duplicates = [],\n          j = 0,\n          i = 0;\n\n        // Unless we *know* we can detect duplicates, assume their presence\n        hasDuplicate = !support.detectDuplicates;\n        sortInput = !support.sortStable && results.slice( 0 );\n        results.sort( sortOrder );\n\n        if ( hasDuplicate ) {\n          while ( ( elem = results[ i++ ] ) ) {\n            if ( elem === results[ i ] ) {\n              j = duplicates.push( i );\n            }\n          }\n          while ( j-- ) {\n            results.splice( duplicates[ j ], 1 );\n          }\n        }\n\n        // Clear input after sorting to release objects\n        // See https://github.com/jquery/sizzle/pull/225\n        sortInput = null;\n\n        return results;\n      };\n\n      /**\n       * Utility function for retrieving the text value of an array of DOM nodes\n       * @param {Array|Element} elem\n       */\n      getText = Sizzle.getText = function( elem ) {\n        var node,\n          ret = \"\",\n          i = 0,\n          nodeType = elem.nodeType;\n\n        if ( !nodeType ) {\n\n          // If no nodeType, this is expected to be an array\n          while ( ( node = elem[ i++ ] ) ) {\n\n            // Do not traverse comment nodes\n            ret += getText( node );\n          }\n        } else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\n\n          // Use textContent for elements\n          // innerText usage removed for consistency of new lines (jQuery #11153)\n          if ( typeof elem.textContent === \"string\" ) {\n            return elem.textContent;\n          } else {\n\n            // Traverse its children\n            for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n              ret += getText( elem );\n            }\n          }\n        } else if ( nodeType === 3 || nodeType === 4 ) {\n          return elem.nodeValue;\n        }\n\n        // Do not include comment or processing instruction nodes\n\n        return ret;\n      };\n\n      Expr = Sizzle.selectors = {\n\n        // Can be adjusted by the user\n        cacheLength: 50,\n\n        createPseudo: markFunction,\n\n        match: matchExpr,\n\n        attrHandle: {},\n\n        find: {},\n\n        relative: {\n          \">\": { dir: \"parentNode\", first: true },\n          \" \": { dir: \"parentNode\" },\n          \"+\": { dir: \"previousSibling\", first: true },\n          \"~\": { dir: \"previousSibling\" }\n        },\n\n        preFilter: {\n          \"ATTR\": function( match ) {\n            match[ 1 ] = match[ 1 ].replace( runescape, funescape );\n\n            // Move the given value to match[3] whether quoted or unquoted\n            match[ 3 ] = ( match[ 3 ] || match[ 4 ] ||\n              match[ 5 ] || \"\" ).replace( runescape, funescape );\n\n            if ( match[ 2 ] === \"~=\" ) {\n              match[ 3 ] = \" \" + match[ 3 ] + \" \";\n            }\n\n            return match.slice( 0, 4 );\n          },\n\n          \"CHILD\": function( match ) {\n\n            /* matches from matchExpr[\"CHILD\"]\n\t\t\t\t1 type (only|nth|...)\n\t\t\t\t2 what (child|of-type)\n\t\t\t\t3 argument (even|odd|\\d*|\\d*n([+-]\\d+)?|...)\n\t\t\t\t4 xn-component of xn+y argument ([+-]?\\d*n|)\n\t\t\t\t5 sign of xn-component\n\t\t\t\t6 x of xn-component\n\t\t\t\t7 sign of y-component\n\t\t\t\t8 y of y-component\n\t\t\t*/\n            match[ 1 ] = match[ 1 ].toLowerCase();\n\n            if ( match[ 1 ].slice( 0, 3 ) === \"nth\" ) {\n\n              // nth-* requires argument\n              if ( !match[ 3 ] ) {\n                Sizzle.error( match[ 0 ] );\n              }\n\n              // numeric x and y parameters for Expr.filter.CHILD\n              // remember that false/true cast respectively to 0/1\n              match[ 4 ] = +( match[ 4 ] ?\n                match[ 5 ] + ( match[ 6 ] || 1 ) :\n                2 * ( match[ 3 ] === \"even\" || match[ 3 ] === \"odd\" ) );\n              match[ 5 ] = +( ( match[ 7 ] + match[ 8 ] ) || match[ 3 ] === \"odd\" );\n\n              // other types prohibit arguments\n            } else if ( match[ 3 ] ) {\n              Sizzle.error( match[ 0 ] );\n            }\n\n            return match;\n          },\n\n          \"PSEUDO\": function( match ) {\n            var excess,\n              unquoted = !match[ 6 ] && match[ 2 ];\n\n            if ( matchExpr[ \"CHILD\" ].test( match[ 0 ] ) ) {\n              return null;\n            }\n\n            // Accept quoted arguments as-is\n            if ( match[ 3 ] ) {\n              match[ 2 ] = match[ 4 ] || match[ 5 ] || \"\";\n\n              // Strip excess characters from unquoted arguments\n            } else if ( unquoted && rpseudo.test( unquoted ) &&\n\n              // Get excess from tokenize (recursively)\n              ( excess = tokenize( unquoted, true ) ) &&\n\n              // advance to the next closing parenthesis\n              ( excess = unquoted.indexOf( \")\", unquoted.length - excess ) - unquoted.length ) ) {\n\n              // excess is a negative index\n              match[ 0 ] = match[ 0 ].slice( 0, excess );\n              match[ 2 ] = unquoted.slice( 0, excess );\n            }\n\n            // Return only captures needed by the pseudo filter method (type and argument)\n            return match.slice( 0, 3 );\n          }\n        },\n\n        filter: {\n\n          \"TAG\": function( nodeNameSelector ) {\n            var nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();\n            return nodeNameSelector === \"*\" ?\n              function() {\n                return true;\n              } :\n              function( elem ) {\n                return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\n              };\n          },\n\n          \"CLASS\": function( className ) {\n            var pattern = classCache[ className + \" \" ];\n\n            return pattern ||\n              ( pattern = new RegExp( \"(^|\" + whitespace +\n                \")\" + className + \"(\" + whitespace + \"|$)\" ) ) && classCache(\n                className, function( elem ) {\n                  return pattern.test(\n                    typeof elem.className === \"string\" && elem.className ||\n                    typeof elem.getAttribute !== \"undefined\" &&\n                    elem.getAttribute( \"class\" ) ||\n                    \"\"\n                  );\n                } );\n          },\n\n          \"ATTR\": function( name, operator, check ) {\n            return function( elem ) {\n              var result = Sizzle.attr( elem, name );\n\n              if ( result == null ) {\n                return operator === \"!=\";\n              }\n              if ( !operator ) {\n                return true;\n              }\n\n              result += \"\";\n\n              /* eslint-disable max-len */\n\n              return operator === \"=\" ? result === check :\n                operator === \"!=\" ? result !== check :\n                  operator === \"^=\" ? check && result.indexOf( check ) === 0 :\n                    operator === \"*=\" ? check && result.indexOf( check ) > -1 :\n                      operator === \"$=\" ? check && result.slice( -check.length ) === check :\n                        operator === \"~=\" ? ( \" \" + result.replace( rwhitespace, \" \" ) + \" \" ).indexOf( check ) > -1 :\n                          operator === \"|=\" ? result === check || result.slice( 0, check.length + 1 ) === check + \"-\" :\n                            false;\n              /* eslint-enable max-len */\n\n            };\n          },\n\n          \"CHILD\": function( type, what, _argument, first, last ) {\n            var simple = type.slice( 0, 3 ) !== \"nth\",\n              forward = type.slice( -4 ) !== \"last\",\n              ofType = what === \"of-type\";\n\n            return first === 1 && last === 0 ?\n\n              // Shortcut for :nth-*(n)\n              function( elem ) {\n                return !!elem.parentNode;\n              } :\n\n              function( elem, _context, xml ) {\n                var cache, uniqueCache, outerCache, node, nodeIndex, start,\n                  dir = simple !== forward ? \"nextSibling\" : \"previousSibling\",\n                  parent = elem.parentNode,\n                  name = ofType && elem.nodeName.toLowerCase(),\n                  useCache = !xml && !ofType,\n                  diff = false;\n\n                if ( parent ) {\n\n                  // :(first|last|only)-(child|of-type)\n                  if ( simple ) {\n                    while ( dir ) {\n                      node = elem;\n                      while ( ( node = node[ dir ] ) ) {\n                        if ( ofType ?\n                          node.nodeName.toLowerCase() === name :\n                          node.nodeType === 1 ) {\n\n                          return false;\n                        }\n                      }\n\n                      // Reverse direction for :only-* (if we haven't yet done so)\n                      start = dir = type === \"only\" && !start && \"nextSibling\";\n                    }\n                    return true;\n                  }\n\n                  start = [ forward ? parent.firstChild : parent.lastChild ];\n\n                  // non-xml :nth-child(...) stores cache data on `parent`\n                  if ( forward && useCache ) {\n\n                    // Seek `elem` from a previously-cached index\n\n                    // ...in a gzip-friendly way\n                    node = parent;\n                    outerCache = node[ expando ] || ( node[ expando ] = {} );\n\n                    // Support: IE <9 only\n                    // Defend against cloned attroperties (jQuery gh-1709)\n                    uniqueCache = outerCache[ node.uniqueID ] ||\n                      ( outerCache[ node.uniqueID ] = {} );\n\n                    cache = uniqueCache[ type ] || [];\n                    nodeIndex = cache[ 0 ] === dirruns && cache[ 1 ];\n                    diff = nodeIndex && cache[ 2 ];\n                    node = nodeIndex && parent.childNodes[ nodeIndex ];\n\n                    while ( ( node = ++nodeIndex && node && node[ dir ] ||\n\n                      // Fallback to seeking `elem` from the start\n                      ( diff = nodeIndex = 0 ) || start.pop() ) ) {\n\n                      // When found, cache indexes on `parent` and break\n                      if ( node.nodeType === 1 && ++diff && node === elem ) {\n                        uniqueCache[ type ] = [ dirruns, nodeIndex, diff ];\n                        break;\n                      }\n                    }\n\n                  } else {\n\n                    // Use previously-cached element index if available\n                    if ( useCache ) {\n\n                      // ...in a gzip-friendly way\n                      node = elem;\n                      outerCache = node[ expando ] || ( node[ expando ] = {} );\n\n                      // Support: IE <9 only\n                      // Defend against cloned attroperties (jQuery gh-1709)\n                      uniqueCache = outerCache[ node.uniqueID ] ||\n                        ( outerCache[ node.uniqueID ] = {} );\n\n                      cache = uniqueCache[ type ] || [];\n                      nodeIndex = cache[ 0 ] === dirruns && cache[ 1 ];\n                      diff = nodeIndex;\n                    }\n\n                    // xml :nth-child(...)\n                    // or :nth-last-child(...) or :nth(-last)?-of-type(...)\n                    if ( diff === false ) {\n\n                      // Use the same loop as above to seek `elem` from the start\n                      while ( ( node = ++nodeIndex && node && node[ dir ] ||\n                        ( diff = nodeIndex = 0 ) || start.pop() ) ) {\n\n                        if ( ( ofType ?\n                            node.nodeName.toLowerCase() === name :\n                            node.nodeType === 1 ) &&\n                          ++diff ) {\n\n                          // Cache the index of each encountered element\n                          if ( useCache ) {\n                            outerCache = node[ expando ] ||\n                              ( node[ expando ] = {} );\n\n                            // Support: IE <9 only\n                            // Defend against cloned attroperties (jQuery gh-1709)\n                            uniqueCache = outerCache[ node.uniqueID ] ||\n                              ( outerCache[ node.uniqueID ] = {} );\n\n                            uniqueCache[ type ] = [ dirruns, diff ];\n                          }\n\n                          if ( node === elem ) {\n                            break;\n                          }\n                        }\n                      }\n                    }\n                  }\n\n                  // Incorporate the offset, then check against cycle size\n                  diff -= last;\n                  return diff === first || ( diff % first === 0 && diff / first >= 0 );\n                }\n              };\n          },\n\n          \"PSEUDO\": function( pseudo, argument ) {\n\n            // pseudo-class names are case-insensitive\n            // http://www.w3.org/TR/selectors/#pseudo-classes\n            // Prioritize by case sensitivity in case custom pseudos are added with uppercase letters\n            // Remember that setFilters inherits from pseudos\n            var args,\n              fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||\n                Sizzle.error( \"unsupported pseudo: \" + pseudo );\n\n            // The user may use createPseudo to indicate that\n            // arguments are needed to create the filter function\n            // just as Sizzle does\n            if ( fn[ expando ] ) {\n              return fn( argument );\n            }\n\n            // But maintain support for old signatures\n            if ( fn.length > 1 ) {\n              args = [ pseudo, pseudo, \"\", argument ];\n              return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?\n                markFunction( function( seed, matches ) {\n                  var idx,\n                    matched = fn( seed, argument ),\n                    i = matched.length;\n                  while ( i-- ) {\n                    idx = indexOf( seed, matched[ i ] );\n                    seed[ idx ] = !( matches[ idx ] = matched[ i ] );\n                  }\n                } ) :\n                function( elem ) {\n                  return fn( elem, 0, args );\n                };\n            }\n\n            return fn;\n          }\n        },\n\n        pseudos: {\n\n          // Potentially complex pseudos\n          \"not\": markFunction( function( selector ) {\n\n            // Trim the selector passed to compile\n            // to avoid treating leading and trailing\n            // spaces as combinators\n            var input = [],\n              results = [],\n              matcher = compile( selector.replace( rtrim, \"$1\" ) );\n\n            return matcher[ expando ] ?\n              markFunction( function( seed, matches, _context, xml ) {\n                var elem,\n                  unmatched = matcher( seed, null, xml, [] ),\n                  i = seed.length;\n\n                // Match elements unmatched by `matcher`\n                while ( i-- ) {\n                  if ( ( elem = unmatched[ i ] ) ) {\n                    seed[ i ] = !( matches[ i ] = elem );\n                  }\n                }\n              } ) :\n              function( elem, _context, xml ) {\n                input[ 0 ] = elem;\n                matcher( input, null, xml, results );\n\n                // Don't keep the element (issue #299)\n                input[ 0 ] = null;\n                return !results.pop();\n              };\n          } ),\n\n          \"has\": markFunction( function( selector ) {\n            return function( elem ) {\n              return Sizzle( selector, elem ).length > 0;\n            };\n          } ),\n\n          \"contains\": markFunction( function( text ) {\n            text = text.replace( runescape, funescape );\n            return function( elem ) {\n              return ( elem.textContent || getText( elem ) ).indexOf( text ) > -1;\n            };\n          } ),\n\n          // \"Whether an element is represented by a :lang() selector\n          // is based solely on the element's language value\n          // being equal to the identifier C,\n          // or beginning with the identifier C immediately followed by \"-\".\n          // The matching of C against the element's language value is performed case-insensitively.\n          // The identifier C does not have to be a valid language name.\"\n          // http://www.w3.org/TR/selectors/#lang-pseudo\n          \"lang\": markFunction( function( lang ) {\n\n            // lang value must be a valid identifier\n            if ( !ridentifier.test( lang || \"\" ) ) {\n              Sizzle.error( \"unsupported lang: \" + lang );\n            }\n            lang = lang.replace( runescape, funescape ).toLowerCase();\n            return function( elem ) {\n              var elemLang;\n              do {\n                if ( ( elemLang = documentIsHTML ?\n                  elem.lang :\n                  elem.getAttribute( \"xml:lang\" ) || elem.getAttribute( \"lang\" ) ) ) {\n\n                  elemLang = elemLang.toLowerCase();\n                  return elemLang === lang || elemLang.indexOf( lang + \"-\" ) === 0;\n                }\n              } while ( ( elem = elem.parentNode ) && elem.nodeType === 1 );\n              return false;\n            };\n          } ),\n\n          // Miscellaneous\n          \"target\": function( elem ) {\n            var hash = window.location && window.location.hash;\n            return hash && hash.slice( 1 ) === elem.id;\n          },\n\n          \"root\": function( elem ) {\n            return elem === docElem;\n          },\n\n          \"focus\": function( elem ) {\n            return elem === document.activeElement &&\n              ( !document.hasFocus || document.hasFocus() ) &&\n              !!( elem.type || elem.href || ~elem.tabIndex );\n          },\n\n          // Boolean properties\n          \"enabled\": createDisabledPseudo( false ),\n          \"disabled\": createDisabledPseudo( true ),\n\n          \"checked\": function( elem ) {\n\n            // In CSS3, :checked should return both checked and selected elements\n            // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked\n            var nodeName = elem.nodeName.toLowerCase();\n            return ( nodeName === \"input\" && !!elem.checked ) ||\n              ( nodeName === \"option\" && !!elem.selected );\n          },\n\n          \"selected\": function( elem ) {\n\n            // Accessing this property makes selected-by-default\n            // options in Safari work properly\n            if ( elem.parentNode ) {\n              // eslint-disable-next-line no-unused-expressions\n              elem.parentNode.selectedIndex;\n            }\n\n            return elem.selected === true;\n          },\n\n          // Contents\n          \"empty\": function( elem ) {\n\n            // http://www.w3.org/TR/selectors/#empty-pseudo\n            // :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),\n            //   but not by others (comment: 8; processing instruction: 7; etc.)\n            // nodeType < 6 works because attributes (2) do not appear as children\n            for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {\n              if ( elem.nodeType < 6 ) {\n                return false;\n              }\n            }\n            return true;\n          },\n\n          \"parent\": function( elem ) {\n            return !Expr.pseudos[ \"empty\" ]( elem );\n          },\n\n          // Element/input types\n          \"header\": function( elem ) {\n            return rheader.test( elem.nodeName );\n          },\n\n          \"input\": function( elem ) {\n            return rinputs.test( elem.nodeName );\n          },\n\n          \"button\": function( elem ) {\n            var name = elem.nodeName.toLowerCase();\n            return name === \"input\" && elem.type === \"button\" || name === \"button\";\n          },\n\n          \"text\": function( elem ) {\n            var attr;\n            return elem.nodeName.toLowerCase() === \"input\" &&\n              elem.type === \"text\" &&\n\n              // Support: IE<8\n              // New HTML5 attribute values (e.g., \"search\") appear with elem.type === \"text\"\n              ( ( attr = elem.getAttribute( \"type\" ) ) == null ||\n                attr.toLowerCase() === \"text\" );\n          },\n\n          // Position-in-collection\n          \"first\": createPositionalPseudo( function() {\n            return [ 0 ];\n          } ),\n\n          \"last\": createPositionalPseudo( function( _matchIndexes, length ) {\n            return [ length - 1 ];\n          } ),\n\n          \"eq\": createPositionalPseudo( function( _matchIndexes, length, argument ) {\n            return [ argument < 0 ? argument + length : argument ];\n          } ),\n\n          \"even\": createPositionalPseudo( function( matchIndexes, length ) {\n            var i = 0;\n            for ( ; i < length; i += 2 ) {\n              matchIndexes.push( i );\n            }\n            return matchIndexes;\n          } ),\n\n          \"odd\": createPositionalPseudo( function( matchIndexes, length ) {\n            var i = 1;\n            for ( ; i < length; i += 2 ) {\n              matchIndexes.push( i );\n            }\n            return matchIndexes;\n          } ),\n\n          \"lt\": createPositionalPseudo( function( matchIndexes, length, argument ) {\n            var i = argument < 0 ?\n              argument + length :\n              argument > length ?\n                length :\n                argument;\n            for ( ; --i >= 0; ) {\n              matchIndexes.push( i );\n            }\n            return matchIndexes;\n          } ),\n\n          \"gt\": createPositionalPseudo( function( matchIndexes, length, argument ) {\n            var i = argument < 0 ? argument + length : argument;\n            for ( ; ++i < length; ) {\n              matchIndexes.push( i );\n            }\n            return matchIndexes;\n          } )\n        }\n      };\n\n      Expr.pseudos[ \"nth\" ] = Expr.pseudos[ \"eq\" ];\n\n// Add button/input type pseudos\n      for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {\n        Expr.pseudos[ i ] = createInputPseudo( i );\n      }\n      for ( i in { submit: true, reset: true } ) {\n        Expr.pseudos[ i ] = createButtonPseudo( i );\n      }\n\n// Easy API for creating new setFilters\n      function setFilters() {}\n      setFilters.prototype = Expr.filters = Expr.pseudos;\n      Expr.setFilters = new setFilters();\n\n      tokenize = Sizzle.tokenize = function( selector, parseOnly ) {\n        var matched, match, tokens, type,\n          soFar, groups, preFilters,\n          cached = tokenCache[ selector + \" \" ];\n\n        if ( cached ) {\n          return parseOnly ? 0 : cached.slice( 0 );\n        }\n\n        soFar = selector;\n        groups = [];\n        preFilters = Expr.preFilter;\n\n        while ( soFar ) {\n\n          // Comma and first run\n          if ( !matched || ( match = rcomma.exec( soFar ) ) ) {\n            if ( match ) {\n\n              // Don't consume trailing commas as valid\n              soFar = soFar.slice( match[ 0 ].length ) || soFar;\n            }\n            groups.push( ( tokens = [] ) );\n          }\n\n          matched = false;\n\n          // Combinators\n          if ( ( match = rcombinators.exec( soFar ) ) ) {\n            matched = match.shift();\n            tokens.push( {\n              value: matched,\n\n              // Cast descendant combinators to space\n              type: match[ 0 ].replace( rtrim, \" \" )\n            } );\n            soFar = soFar.slice( matched.length );\n          }\n\n          // Filters\n          for ( type in Expr.filter ) {\n            if ( ( match = matchExpr[ type ].exec( soFar ) ) && ( !preFilters[ type ] ||\n              ( match = preFilters[ type ]( match ) ) ) ) {\n              matched = match.shift();\n              tokens.push( {\n                value: matched,\n                type: type,\n                matches: match\n              } );\n              soFar = soFar.slice( matched.length );\n            }\n          }\n\n          if ( !matched ) {\n            break;\n          }\n        }\n\n        // Return the length of the invalid excess\n        // if we're just parsing\n        // Otherwise, throw an error or return tokens\n        return parseOnly ?\n          soFar.length :\n          soFar ?\n            Sizzle.error( selector ) :\n\n            // Cache the tokens\n            tokenCache( selector, groups ).slice( 0 );\n      };\n\n      function toSelector( tokens ) {\n        var i = 0,\n          len = tokens.length,\n          selector = \"\";\n        for ( ; i < len; i++ ) {\n          selector += tokens[ i ].value;\n        }\n        return selector;\n      }\n\n      function addCombinator( matcher, combinator, base ) {\n        var dir = combinator.dir,\n          skip = combinator.next,\n          key = skip || dir,\n          checkNonElements = base && key === \"parentNode\",\n          doneName = done++;\n\n        return combinator.first ?\n\n          // Check against closest ancestor/preceding element\n          function( elem, context, xml ) {\n            while ( ( elem = elem[ dir ] ) ) {\n              if ( elem.nodeType === 1 || checkNonElements ) {\n                return matcher( elem, context, xml );\n              }\n            }\n            return false;\n          } :\n\n          // Check against all ancestor/preceding elements\n          function( elem, context, xml ) {\n            var oldCache, uniqueCache, outerCache,\n              newCache = [ dirruns, doneName ];\n\n            // We can't set arbitrary data on XML nodes, so they don't benefit from combinator caching\n            if ( xml ) {\n              while ( ( elem = elem[ dir ] ) ) {\n                if ( elem.nodeType === 1 || checkNonElements ) {\n                  if ( matcher( elem, context, xml ) ) {\n                    return true;\n                  }\n                }\n              }\n            } else {\n              while ( ( elem = elem[ dir ] ) ) {\n                if ( elem.nodeType === 1 || checkNonElements ) {\n                  outerCache = elem[ expando ] || ( elem[ expando ] = {} );\n\n                  // Support: IE <9 only\n                  // Defend against cloned attroperties (jQuery gh-1709)\n                  uniqueCache = outerCache[ elem.uniqueID ] ||\n                    ( outerCache[ elem.uniqueID ] = {} );\n\n                  if ( skip && skip === elem.nodeName.toLowerCase() ) {\n                    elem = elem[ dir ] || elem;\n                  } else if ( ( oldCache = uniqueCache[ key ] ) &&\n                    oldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {\n\n                    // Assign to newCache so results back-propagate to previous elements\n                    return ( newCache[ 2 ] = oldCache[ 2 ] );\n                  } else {\n\n                    // Reuse newcache so results back-propagate to previous elements\n                    uniqueCache[ key ] = newCache;\n\n                    // A match means we're done; a fail means we have to keep checking\n                    if ( ( newCache[ 2 ] = matcher( elem, context, xml ) ) ) {\n                      return true;\n                    }\n                  }\n                }\n              }\n            }\n            return false;\n          };\n      }\n\n      function elementMatcher( matchers ) {\n        return matchers.length > 1 ?\n          function( elem, context, xml ) {\n            var i = matchers.length;\n            while ( i-- ) {\n              if ( !matchers[ i ]( elem, context, xml ) ) {\n                return false;\n              }\n            }\n            return true;\n          } :\n          matchers[ 0 ];\n      }\n\n      function multipleContexts( selector, contexts, results ) {\n        var i = 0,\n          len = contexts.length;\n        for ( ; i < len; i++ ) {\n          Sizzle( selector, contexts[ i ], results );\n        }\n        return results;\n      }\n\n      function condense( unmatched, map, filter, context, xml ) {\n        var elem,\n          newUnmatched = [],\n          i = 0,\n          len = unmatched.length,\n          mapped = map != null;\n\n        for ( ; i < len; i++ ) {\n          if ( ( elem = unmatched[ i ] ) ) {\n            if ( !filter || filter( elem, context, xml ) ) {\n              newUnmatched.push( elem );\n              if ( mapped ) {\n                map.push( i );\n              }\n            }\n          }\n        }\n\n        return newUnmatched;\n      }\n\n      function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {\n        if ( postFilter && !postFilter[ expando ] ) {\n          postFilter = setMatcher( postFilter );\n        }\n        if ( postFinder && !postFinder[ expando ] ) {\n          postFinder = setMatcher( postFinder, postSelector );\n        }\n        return markFunction( function( seed, results, context, xml ) {\n          var temp, i, elem,\n            preMap = [],\n            postMap = [],\n            preexisting = results.length,\n\n            // Get initial elements from seed or context\n            elems = seed || multipleContexts(\n              selector || \"*\",\n              context.nodeType ? [ context ] : context,\n              []\n            ),\n\n            // Prefilter to get matcher input, preserving a map for seed-results synchronization\n            matcherIn = preFilter && ( seed || !selector ) ?\n              condense( elems, preMap, preFilter, context, xml ) :\n              elems,\n\n            matcherOut = matcher ?\n\n              // If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,\n              postFinder || ( seed ? preFilter : preexisting || postFilter ) ?\n\n                // ...intermediate processing is necessary\n                [] :\n\n                // ...otherwise use results directly\n                results :\n              matcherIn;\n\n          // Find primary matches\n          if ( matcher ) {\n            matcher( matcherIn, matcherOut, context, xml );\n          }\n\n          // Apply postFilter\n          if ( postFilter ) {\n            temp = condense( matcherOut, postMap );\n            postFilter( temp, [], context, xml );\n\n            // Un-match failing elements by moving them back to matcherIn\n            i = temp.length;\n            while ( i-- ) {\n              if ( ( elem = temp[ i ] ) ) {\n                matcherOut[ postMap[ i ] ] = !( matcherIn[ postMap[ i ] ] = elem );\n              }\n            }\n          }\n\n          if ( seed ) {\n            if ( postFinder || preFilter ) {\n              if ( postFinder ) {\n\n                // Get the final matcherOut by condensing this intermediate into postFinder contexts\n                temp = [];\n                i = matcherOut.length;\n                while ( i-- ) {\n                  if ( ( elem = matcherOut[ i ] ) ) {\n\n                    // Restore matcherIn since elem is not yet a final match\n                    temp.push( ( matcherIn[ i ] = elem ) );\n                  }\n                }\n                postFinder( null, ( matcherOut = [] ), temp, xml );\n              }\n\n              // Move matched elements from seed to results to keep them synchronized\n              i = matcherOut.length;\n              while ( i-- ) {\n                if ( ( elem = matcherOut[ i ] ) &&\n                  ( temp = postFinder ? indexOf( seed, elem ) : preMap[ i ] ) > -1 ) {\n\n                  seed[ temp ] = !( results[ temp ] = elem );\n                }\n              }\n            }\n\n            // Add elements to results, through postFinder if defined\n          } else {\n            matcherOut = condense(\n              matcherOut === results ?\n                matcherOut.splice( preexisting, matcherOut.length ) :\n                matcherOut\n            );\n            if ( postFinder ) {\n              postFinder( null, results, matcherOut, xml );\n            } else {\n              push.apply( results, matcherOut );\n            }\n          }\n        } );\n      }\n\n      function matcherFromTokens( tokens ) {\n        var checkContext, matcher, j,\n          len = tokens.length,\n          leadingRelative = Expr.relative[ tokens[ 0 ].type ],\n          implicitRelative = leadingRelative || Expr.relative[ \" \" ],\n          i = leadingRelative ? 1 : 0,\n\n          // The foundational matcher ensures that elements are reachable from top-level context(s)\n          matchContext = addCombinator( function( elem ) {\n            return elem === checkContext;\n          }, implicitRelative, true ),\n          matchAnyContext = addCombinator( function( elem ) {\n            return indexOf( checkContext, elem ) > -1;\n          }, implicitRelative, true ),\n          matchers = [ function( elem, context, xml ) {\n            var ret = ( !leadingRelative && ( xml || context !== outermostContext ) ) || (\n              ( checkContext = context ).nodeType ?\n                matchContext( elem, context, xml ) :\n                matchAnyContext( elem, context, xml ) );\n\n            // Avoid hanging onto element (issue #299)\n            checkContext = null;\n            return ret;\n          } ];\n\n        for ( ; i < len; i++ ) {\n          if ( ( matcher = Expr.relative[ tokens[ i ].type ] ) ) {\n            matchers = [ addCombinator( elementMatcher( matchers ), matcher ) ];\n          } else {\n            matcher = Expr.filter[ tokens[ i ].type ].apply( null, tokens[ i ].matches );\n\n            // Return special upon seeing a positional matcher\n            if ( matcher[ expando ] ) {\n\n              // Find the next relative operator (if any) for proper handling\n              j = ++i;\n              for ( ; j < len; j++ ) {\n                if ( Expr.relative[ tokens[ j ].type ] ) {\n                  break;\n                }\n              }\n              return setMatcher(\n                i > 1 && elementMatcher( matchers ),\n                i > 1 && toSelector(\n\n                  // If the preceding token was a descendant combinator, insert an implicit any-element `*`\n                  tokens\n                    .slice( 0, i - 1 )\n                    .concat( { value: tokens[ i - 2 ].type === \" \" ? \"*\" : \"\" } )\n                ).replace( rtrim, \"$1\" ),\n                matcher,\n                i < j && matcherFromTokens( tokens.slice( i, j ) ),\n                j < len && matcherFromTokens( ( tokens = tokens.slice( j ) ) ),\n                j < len && toSelector( tokens )\n              );\n            }\n            matchers.push( matcher );\n          }\n        }\n\n        return elementMatcher( matchers );\n      }\n\n      function matcherFromGroupMatchers( elementMatchers, setMatchers ) {\n        var bySet = setMatchers.length > 0,\n          byElement = elementMatchers.length > 0,\n          superMatcher = function( seed, context, xml, results, outermost ) {\n            var elem, j, matcher,\n              matchedCount = 0,\n              i = \"0\",\n              unmatched = seed && [],\n              setMatched = [],\n              contextBackup = outermostContext,\n\n              // We must always have either seed elements or outermost context\n              elems = seed || byElement && Expr.find[ \"TAG\" ]( \"*\", outermost ),\n\n              // Use integer dirruns iff this is the outermost matcher\n              dirrunsUnique = ( dirruns += contextBackup == null ? 1 : Math.random() || 0.1 ),\n              len = elems.length;\n\n            if ( outermost ) {\n\n              // Support: IE 11+, Edge 17 - 18+\n              // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n              // two documents; shallow comparisons work.\n              // eslint-disable-next-line eqeqeq\n              outermostContext = context == document || context || outermost;\n            }\n\n            // Add elements passing elementMatchers directly to results\n            // Support: IE<9, Safari\n            // Tolerate NodeList properties (IE: \"length\"; Safari: <number>) matching elements by id\n            for ( ; i !== len && ( elem = elems[ i ] ) != null; i++ ) {\n              if ( byElement && elem ) {\n                j = 0;\n\n                // Support: IE 11+, Edge 17 - 18+\n                // IE/Edge sometimes throw a \"Permission denied\" error when strict-comparing\n                // two documents; shallow comparisons work.\n                // eslint-disable-next-line eqeqeq\n                if ( !context && elem.ownerDocument != document ) {\n                  setDocument( elem );\n                  xml = !documentIsHTML;\n                }\n                while ( ( matcher = elementMatchers[ j++ ] ) ) {\n                  if ( matcher( elem, context || document, xml ) ) {\n                    results.push( elem );\n                    break;\n                  }\n                }\n                if ( outermost ) {\n                  dirruns = dirrunsUnique;\n                }\n              }\n\n              // Track unmatched elements for set filters\n              if ( bySet ) {\n\n                // They will have gone through all possible matchers\n                if ( ( elem = !matcher && elem ) ) {\n                  matchedCount--;\n                }\n\n                // Lengthen the array for every element, matched or not\n                if ( seed ) {\n                  unmatched.push( elem );\n                }\n              }\n            }\n\n            // `i` is now the count of elements visited above, and adding it to `matchedCount`\n            // makes the latter nonnegative.\n            matchedCount += i;\n\n            // Apply set filters to unmatched elements\n            // NOTE: This can be skipped if there are no unmatched elements (i.e., `matchedCount`\n            // equals `i`), unless we didn't visit _any_ elements in the above loop because we have\n            // no element matchers and no seed.\n            // Incrementing an initially-string \"0\" `i` allows `i` to remain a string only in that\n            // case, which will result in a \"00\" `matchedCount` that differs from `i` but is also\n            // numerically zero.\n            if ( bySet && i !== matchedCount ) {\n              j = 0;\n              while ( ( matcher = setMatchers[ j++ ] ) ) {\n                matcher( unmatched, setMatched, context, xml );\n              }\n\n              if ( seed ) {\n\n                // Reintegrate element matches to eliminate the need for sorting\n                if ( matchedCount > 0 ) {\n                  while ( i-- ) {\n                    if ( !( unmatched[ i ] || setMatched[ i ] ) ) {\n                      setMatched[ i ] = pop.call( results );\n                    }\n                  }\n                }\n\n                // Discard index placeholder values to get only actual matches\n                setMatched = condense( setMatched );\n              }\n\n              // Add matches to results\n              push.apply( results, setMatched );\n\n              // Seedless set matches succeeding multiple successful matchers stipulate sorting\n              if ( outermost && !seed && setMatched.length > 0 &&\n                ( matchedCount + setMatchers.length ) > 1 ) {\n\n                Sizzle.uniqueSort( results );\n              }\n            }\n\n            // Override manipulation of globals by nested matchers\n            if ( outermost ) {\n              dirruns = dirrunsUnique;\n              outermostContext = contextBackup;\n            }\n\n            return unmatched;\n          };\n\n        return bySet ?\n          markFunction( superMatcher ) :\n          superMatcher;\n      }\n\n      compile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {\n        var i,\n          setMatchers = [],\n          elementMatchers = [],\n          cached = compilerCache[ selector + \" \" ];\n\n        if ( !cached ) {\n\n          // Generate a function of recursive functions that can be used to check each element\n          if ( !match ) {\n            match = tokenize( selector );\n          }\n          i = match.length;\n          while ( i-- ) {\n            cached = matcherFromTokens( match[ i ] );\n            if ( cached[ expando ] ) {\n              setMatchers.push( cached );\n            } else {\n              elementMatchers.push( cached );\n            }\n          }\n\n          // Cache the compiled function\n          cached = compilerCache(\n            selector,\n            matcherFromGroupMatchers( elementMatchers, setMatchers )\n          );\n\n          // Save selector and tokenization\n          cached.selector = selector;\n        }\n        return cached;\n      };\n\n      /**\n       * A low-level selection function that works with Sizzle's compiled\n       *  selector functions\n       * @param {String|Function} selector A selector or a pre-compiled\n       *  selector function built with Sizzle.compile\n       * @param {Element} context\n       * @param {Array} [results]\n       * @param {Array} [seed] A set of elements to match against\n       */\n      select = Sizzle.select = function( selector, context, results, seed ) {\n        var i, tokens, token, type, find,\n          compiled = typeof selector === \"function\" && selector,\n          match = !seed && tokenize( ( selector = compiled.selector || selector ) );\n\n        results = results || [];\n\n        // Try to minimize operations if there is only one selector in the list and no seed\n        // (the latter of which guarantees us context)\n        if ( match.length === 1 ) {\n\n          // Reduce context if the leading compound selector is an ID\n          tokens = match[ 0 ] = match[ 0 ].slice( 0 );\n          if ( tokens.length > 2 && ( token = tokens[ 0 ] ).type === \"ID\" &&\n            context.nodeType === 9 && documentIsHTML && Expr.relative[ tokens[ 1 ].type ] ) {\n\n            context = ( Expr.find[ \"ID\" ]( token.matches[ 0 ]\n              .replace( runescape, funescape ), context ) || [] )[ 0 ];\n            if ( !context ) {\n              return results;\n\n              // Precompiled matchers will still verify ancestry, so step up a level\n            } else if ( compiled ) {\n              context = context.parentNode;\n            }\n\n            selector = selector.slice( tokens.shift().value.length );\n          }\n\n          // Fetch a seed set for right-to-left matching\n          i = matchExpr[ \"needsContext\" ].test( selector ) ? 0 : tokens.length;\n          while ( i-- ) {\n            token = tokens[ i ];\n\n            // Abort if we hit a combinator\n            if ( Expr.relative[ ( type = token.type ) ] ) {\n              break;\n            }\n            if ( ( find = Expr.find[ type ] ) ) {\n\n              // Search, expanding context for leading sibling combinators\n              if ( ( seed = find(\n                token.matches[ 0 ].replace( runescape, funescape ),\n                rsibling.test( tokens[ 0 ].type ) && testContext( context.parentNode ) ||\n                context\n              ) ) ) {\n\n                // If seed is empty or no tokens remain, we can return early\n                tokens.splice( i, 1 );\n                selector = seed.length && toSelector( tokens );\n                if ( !selector ) {\n                  push.apply( results, seed );\n                  return results;\n                }\n\n                break;\n              }\n            }\n          }\n        }\n\n        // Compile and execute a filtering function if one is not provided\n        // Provide `match` to avoid retokenization if we modified the selector above\n        ( compiled || compile( selector, match ) )(\n          seed,\n          context,\n          !documentIsHTML,\n          results,\n          !context || rsibling.test( selector ) && testContext( context.parentNode ) || context\n        );\n        return results;\n      };\n\n// One-time assignments\n\n// Sort stability\n      support.sortStable = expando.split( \"\" ).sort( sortOrder ).join( \"\" ) === expando;\n\n// Support: Chrome 14-35+\n// Always assume duplicates if they aren't passed to the comparison function\n      support.detectDuplicates = !!hasDuplicate;\n\n// Initialize against the default document\n      setDocument();\n\n// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)\n// Detached nodes confoundingly follow *each other*\n      support.sortDetached = assert( function( el ) {\n\n        // Should return 1, but returns 4 (following)\n        return el.compareDocumentPosition( document.createElement( \"fieldset\" ) ) & 1;\n      } );\n\n// Support: IE<8\n// Prevent attribute/property \"interpolation\"\n// https://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx\n      if ( !assert( function( el ) {\n        el.innerHTML = \"<a href='#'></a>\";\n        return el.firstChild.getAttribute( \"href\" ) === \"#\";\n      } ) ) {\n        addHandle( \"type|href|height|width\", function( elem, name, isXML ) {\n          if ( !isXML ) {\n            return elem.getAttribute( name, name.toLowerCase() === \"type\" ? 1 : 2 );\n          }\n        } );\n      }\n\n// Support: IE<9\n// Use defaultValue in place of getAttribute(\"value\")\n      if ( !support.attributes || !assert( function( el ) {\n        el.innerHTML = \"<input/>\";\n        el.firstChild.setAttribute( \"value\", \"\" );\n        return el.firstChild.getAttribute( \"value\" ) === \"\";\n      } ) ) {\n        addHandle( \"value\", function( elem, _name, isXML ) {\n          if ( !isXML && elem.nodeName.toLowerCase() === \"input\" ) {\n            return elem.defaultValue;\n          }\n        } );\n      }\n\n// Support: IE<9\n// Use getAttributeNode to fetch booleans when getAttribute lies\n      if ( !assert( function( el ) {\n        return el.getAttribute( \"disabled\" ) == null;\n      } ) ) {\n        addHandle( booleans, function( elem, name, isXML ) {\n          var val;\n          if ( !isXML ) {\n            return elem[ name ] === true ? name.toLowerCase() :\n              ( val = elem.getAttributeNode( name ) ) && val.specified ?\n                val.value :\n                null;\n          }\n        } );\n      }\n\n      return Sizzle;\n\n    } )( window );\n\n\n\n  jQuery.find = Sizzle;\n  jQuery.expr = Sizzle.selectors;\n\n// Deprecated\n  jQuery.expr[ \":\" ] = jQuery.expr.pseudos;\n  jQuery.uniqueSort = jQuery.unique = Sizzle.uniqueSort;\n  jQuery.text = Sizzle.getText;\n  jQuery.isXMLDoc = Sizzle.isXML;\n  jQuery.contains = Sizzle.contains;\n  jQuery.escapeSelector = Sizzle.escape;\n\n\n\n\n  var dir = function( elem, dir, until ) {\n    var matched = [],\n      truncate = until !== undefined;\n\n    while ( ( elem = elem[ dir ] ) && elem.nodeType !== 9 ) {\n      if ( elem.nodeType === 1 ) {\n        if ( truncate && jQuery( elem ).is( until ) ) {\n          break;\n        }\n        matched.push( elem );\n      }\n    }\n    return matched;\n  };\n\n\n  var siblings = function( n, elem ) {\n    var matched = [];\n\n    for ( ; n; n = n.nextSibling ) {\n      if ( n.nodeType === 1 && n !== elem ) {\n        matched.push( n );\n      }\n    }\n\n    return matched;\n  };\n\n\n  var rneedsContext = jQuery.expr.match.needsContext;\n\n\n\n  function nodeName( elem, name ) {\n\n    return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();\n\n  };\n  var rsingleTag = ( /^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i );\n\n\n\n// Implement the identical functionality for filter and not\n  function winnow( elements, qualifier, not ) {\n    if ( isFunction( qualifier ) ) {\n      return jQuery.grep( elements, function( elem, i ) {\n        return !!qualifier.call( elem, i, elem ) !== not;\n      } );\n    }\n\n    // Single element\n    if ( qualifier.nodeType ) {\n      return jQuery.grep( elements, function( elem ) {\n        return ( elem === qualifier ) !== not;\n      } );\n    }\n\n    // Arraylike of elements (jQuery, arguments, Array)\n    if ( typeof qualifier !== \"string\" ) {\n      return jQuery.grep( elements, function( elem ) {\n        return ( indexOf.call( qualifier, elem ) > -1 ) !== not;\n      } );\n    }\n\n    // Filtered directly for both simple and complex selectors\n    return jQuery.filter( qualifier, elements, not );\n  }\n\n  jQuery.filter = function( expr, elems, not ) {\n    var elem = elems[ 0 ];\n\n    if ( not ) {\n      expr = \":not(\" + expr + \")\";\n    }\n\n    if ( elems.length === 1 && elem.nodeType === 1 ) {\n      return jQuery.find.matchesSelector( elem, expr ) ? [ elem ] : [];\n    }\n\n    return jQuery.find.matches( expr, jQuery.grep( elems, function( elem ) {\n      return elem.nodeType === 1;\n    } ) );\n  };\n\n  jQuery.fn.extend( {\n    find: function( selector ) {\n      var i, ret,\n        len = this.length,\n        self = this;\n\n      if ( typeof selector !== \"string\" ) {\n        return this.pushStack( jQuery( selector ).filter( function() {\n          for ( i = 0; i < len; i++ ) {\n            if ( jQuery.contains( self[ i ], this ) ) {\n              return true;\n            }\n          }\n        } ) );\n      }\n\n      ret = this.pushStack( [] );\n\n      for ( i = 0; i < len; i++ ) {\n        jQuery.find( selector, self[ i ], ret );\n      }\n\n      return len > 1 ? jQuery.uniqueSort( ret ) : ret;\n    },\n    filter: function( selector ) {\n      return this.pushStack( winnow( this, selector || [], false ) );\n    },\n    not: function( selector ) {\n      return this.pushStack( winnow( this, selector || [], true ) );\n    },\n    is: function( selector ) {\n      return !!winnow(\n        this,\n\n        // If this is a positional/relative selector, check membership in the returned set\n        // so $(\"p:first\").is(\"p:last\") won't return true for a doc with two \"p\".\n        typeof selector === \"string\" && rneedsContext.test( selector ) ?\n          jQuery( selector ) :\n          selector || [],\n        false\n      ).length;\n    }\n  } );\n\n\n// Initialize a jQuery object\n\n\n// A central reference to the root jQuery(document)\n  var rootjQuery,\n\n    // A simple way to check for HTML strings\n    // Prioritize #id over <tag> to avoid XSS via location.hash (#9521)\n    // Strict HTML recognition (#11290: must start with <)\n    // Shortcut simple #id case for speed\n    rquickExpr = /^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/,\n\n    init = jQuery.fn.init = function( selector, context, root ) {\n      var match, elem;\n\n      // HANDLE: $(\"\"), $(null), $(undefined), $(false)\n      if ( !selector ) {\n        return this;\n      }\n\n      // Method init() accepts an alternate rootjQuery\n      // so migrate can support jQuery.sub (gh-2101)\n      root = root || rootjQuery;\n\n      // Handle HTML strings\n      if ( typeof selector === \"string\" ) {\n        if ( selector[ 0 ] === \"<\" &&\n          selector[ selector.length - 1 ] === \">\" &&\n          selector.length >= 3 ) {\n\n          // Assume that strings that start and end with <> are HTML and skip the regex check\n          match = [ null, selector, null ];\n\n        } else {\n          match = rquickExpr.exec( selector );\n        }\n\n        // Match html or make sure no context is specified for #id\n        if ( match && ( match[ 1 ] || !context ) ) {\n\n          // HANDLE: $(html) -> $(array)\n          if ( match[ 1 ] ) {\n            context = context instanceof jQuery ? context[ 0 ] : context;\n\n            // Option to run scripts is true for back-compat\n            // Intentionally let the error be thrown if parseHTML is not present\n            jQuery.merge( this, jQuery.parseHTML(\n              match[ 1 ],\n              context && context.nodeType ? context.ownerDocument || context : document,\n              true\n            ) );\n\n            // HANDLE: $(html, props)\n            if ( rsingleTag.test( match[ 1 ] ) && jQuery.isPlainObject( context ) ) {\n              for ( match in context ) {\n\n                // Properties of context are called as methods if possible\n                if ( isFunction( this[ match ] ) ) {\n                  this[ match ]( context[ match ] );\n\n                  // ...and otherwise set as attributes\n                } else {\n                  this.attr( match, context[ match ] );\n                }\n              }\n            }\n\n            return this;\n\n            // HANDLE: $(#id)\n          } else {\n            elem = document.getElementById( match[ 2 ] );\n\n            if ( elem ) {\n\n              // Inject the element directly into the jQuery object\n              this[ 0 ] = elem;\n              this.length = 1;\n            }\n            return this;\n          }\n\n          // HANDLE: $(expr, $(...))\n        } else if ( !context || context.jquery ) {\n          return ( context || root ).find( selector );\n\n          // HANDLE: $(expr, context)\n          // (which is just equivalent to: $(context).find(expr)\n        } else {\n          return this.constructor( context ).find( selector );\n        }\n\n        // HANDLE: $(DOMElement)\n      } else if ( selector.nodeType ) {\n        this[ 0 ] = selector;\n        this.length = 1;\n        return this;\n\n        // HANDLE: $(function)\n        // Shortcut for document ready\n      } else if ( isFunction( selector ) ) {\n        return root.ready !== undefined ?\n          root.ready( selector ) :\n\n          // Execute immediately if ready is not present\n          selector( jQuery );\n      }\n\n      return jQuery.makeArray( selector, this );\n    };\n\n// Give the init function the jQuery prototype for later instantiation\n  init.prototype = jQuery.fn;\n\n// Initialize central reference\n  rootjQuery = jQuery( document );\n\n\n  var rparentsprev = /^(?:parents|prev(?:Until|All))/,\n\n    // Methods guaranteed to produce a unique set when starting from a unique set\n    guaranteedUnique = {\n      children: true,\n      contents: true,\n      next: true,\n      prev: true\n    };\n\n  jQuery.fn.extend( {\n    has: function( target ) {\n      var targets = jQuery( target, this ),\n        l = targets.length;\n\n      return this.filter( function() {\n        var i = 0;\n        for ( ; i < l; i++ ) {\n          if ( jQuery.contains( this, targets[ i ] ) ) {\n            return true;\n          }\n        }\n      } );\n    },\n\n    closest: function( selectors, context ) {\n      var cur,\n        i = 0,\n        l = this.length,\n        matched = [],\n        targets = typeof selectors !== \"string\" && jQuery( selectors );\n\n      // Positional selectors never match, since there's no _selection_ context\n      if ( !rneedsContext.test( selectors ) ) {\n        for ( ; i < l; i++ ) {\n          for ( cur = this[ i ]; cur && cur !== context; cur = cur.parentNode ) {\n\n            // Always skip document fragments\n            if ( cur.nodeType < 11 && ( targets ?\n              targets.index( cur ) > -1 :\n\n              // Don't pass non-elements to Sizzle\n              cur.nodeType === 1 &&\n              jQuery.find.matchesSelector( cur, selectors ) ) ) {\n\n              matched.push( cur );\n              break;\n            }\n          }\n        }\n      }\n\n      return this.pushStack( matched.length > 1 ? jQuery.uniqueSort( matched ) : matched );\n    },\n\n    // Determine the position of an element within the set\n    index: function( elem ) {\n\n      // No argument, return index in parent\n      if ( !elem ) {\n        return ( this[ 0 ] && this[ 0 ].parentNode ) ? this.first().prevAll().length : -1;\n      }\n\n      // Index in selector\n      if ( typeof elem === \"string\" ) {\n        return indexOf.call( jQuery( elem ), this[ 0 ] );\n      }\n\n      // Locate the position of the desired element\n      return indexOf.call( this,\n\n        // If it receives a jQuery object, the first element is used\n        elem.jquery ? elem[ 0 ] : elem\n      );\n    },\n\n    add: function( selector, context ) {\n      return this.pushStack(\n        jQuery.uniqueSort(\n          jQuery.merge( this.get(), jQuery( selector, context ) )\n        )\n      );\n    },\n\n    addBack: function( selector ) {\n      return this.add( selector == null ?\n        this.prevObject : this.prevObject.filter( selector )\n      );\n    }\n  } );\n\n  function sibling( cur, dir ) {\n    while ( ( cur = cur[ dir ] ) && cur.nodeType !== 1 ) {}\n    return cur;\n  }\n\n  jQuery.each( {\n    parent: function( elem ) {\n      var parent = elem.parentNode;\n      return parent && parent.nodeType !== 11 ? parent : null;\n    },\n    parents: function( elem ) {\n      return dir( elem, \"parentNode\" );\n    },\n    parentsUntil: function( elem, _i, until ) {\n      return dir( elem, \"parentNode\", until );\n    },\n    next: function( elem ) {\n      return sibling( elem, \"nextSibling\" );\n    },\n    prev: function( elem ) {\n      return sibling( elem, \"previousSibling\" );\n    },\n    nextAll: function( elem ) {\n      return dir( elem, \"nextSibling\" );\n    },\n    prevAll: function( elem ) {\n      return dir( elem, \"previousSibling\" );\n    },\n    nextUntil: function( elem, _i, until ) {\n      return dir( elem, \"nextSibling\", until );\n    },\n    prevUntil: function( elem, _i, until ) {\n      return dir( elem, \"previousSibling\", until );\n    },\n    siblings: function( elem ) {\n      return siblings( ( elem.parentNode || {} ).firstChild, elem );\n    },\n    children: function( elem ) {\n      return siblings( elem.firstChild );\n    },\n    contents: function( elem ) {\n      if ( elem.contentDocument != null &&\n\n        // Support: IE 11+\n        // <object> elements with no `data` attribute has an object\n        // `contentDocument` with a `null` prototype.\n        getProto( elem.contentDocument ) ) {\n\n        return elem.contentDocument;\n      }\n\n      // Support: IE 9 - 11 only, iOS 7 only, Android Browser <=4.3 only\n      // Treat the template element as a regular one in browsers that\n      // don't support it.\n      if ( nodeName( elem, \"template\" ) ) {\n        elem = elem.content || elem;\n      }\n\n      return jQuery.merge( [], elem.childNodes );\n    }\n  }, function( name, fn ) {\n    jQuery.fn[ name ] = function( until, selector ) {\n      var matched = jQuery.map( this, fn, until );\n\n      if ( name.slice( -5 ) !== \"Until\" ) {\n        selector = until;\n      }\n\n      if ( selector && typeof selector === \"string\" ) {\n        matched = jQuery.filter( selector, matched );\n      }\n\n      if ( this.length > 1 ) {\n\n        // Remove duplicates\n        if ( !guaranteedUnique[ name ] ) {\n          jQuery.uniqueSort( matched );\n        }\n\n        // Reverse order for parents* and prev-derivatives\n        if ( rparentsprev.test( name ) ) {\n          matched.reverse();\n        }\n      }\n\n      return this.pushStack( matched );\n    };\n  } );\n  var rnothtmlwhite = ( /[^\\x20\\t\\r\\n\\f]+/g );\n\n\n\n// Convert String-formatted options into Object-formatted ones\n  function createOptions( options ) {\n    var object = {};\n    jQuery.each( options.match( rnothtmlwhite ) || [], function( _, flag ) {\n      object[ flag ] = true;\n    } );\n    return object;\n  }\n\n  /*\n * Create a callback list using the following parameters:\n *\n *\toptions: an optional list of space-separated options that will change how\n *\t\t\tthe callback list behaves or a more traditional option object\n *\n * By default a callback list will act like an event callback list and can be\n * \"fired\" multiple times.\n *\n * Possible options:\n *\n *\tonce:\t\t\twill ensure the callback list can only be fired once (like a Deferred)\n *\n *\tmemory:\t\t\twill keep track of previous values and will call any callback added\n *\t\t\t\t\tafter the list has been fired right away with the latest \"memorized\"\n *\t\t\t\t\tvalues (like a Deferred)\n *\n *\tunique:\t\t\twill ensure a callback can only be added once (no duplicate in the list)\n *\n *\tstopOnFalse:\tinterrupt callings when a callback returns false\n *\n */\n  jQuery.Callbacks = function( options ) {\n\n    // Convert options from String-formatted to Object-formatted if needed\n    // (we check in cache first)\n    options = typeof options === \"string\" ?\n      createOptions( options ) :\n      jQuery.extend( {}, options );\n\n    var // Flag to know if list is currently firing\n      firing,\n\n      // Last fire value for non-forgettable lists\n      memory,\n\n      // Flag to know if list was already fired\n      fired,\n\n      // Flag to prevent firing\n      locked,\n\n      // Actual callback list\n      list = [],\n\n      // Queue of execution data for repeatable lists\n      queue = [],\n\n      // Index of currently firing callback (modified by add/remove as needed)\n      firingIndex = -1,\n\n      // Fire callbacks\n      fire = function() {\n\n        // Enforce single-firing\n        locked = locked || options.once;\n\n        // Execute callbacks for all pending executions,\n        // respecting firingIndex overrides and runtime changes\n        fired = firing = true;\n        for ( ; queue.length; firingIndex = -1 ) {\n          memory = queue.shift();\n          while ( ++firingIndex < list.length ) {\n\n            // Run callback and check for early termination\n            if ( list[ firingIndex ].apply( memory[ 0 ], memory[ 1 ] ) === false &&\n              options.stopOnFalse ) {\n\n              // Jump to end and forget the data so .add doesn't re-fire\n              firingIndex = list.length;\n              memory = false;\n            }\n          }\n        }\n\n        // Forget the data if we're done with it\n        if ( !options.memory ) {\n          memory = false;\n        }\n\n        firing = false;\n\n        // Clean up if we're done firing for good\n        if ( locked ) {\n\n          // Keep an empty list if we have data for future add calls\n          if ( memory ) {\n            list = [];\n\n            // Otherwise, this object is spent\n          } else {\n            list = \"\";\n          }\n        }\n      },\n\n      // Actual Callbacks object\n      self = {\n\n        // Add a callback or a collection of callbacks to the list\n        add: function() {\n          if ( list ) {\n\n            // If we have memory from a past run, we should fire after adding\n            if ( memory && !firing ) {\n              firingIndex = list.length - 1;\n              queue.push( memory );\n            }\n\n            ( function add( args ) {\n              jQuery.each( args, function( _, arg ) {\n                if ( isFunction( arg ) ) {\n                  if ( !options.unique || !self.has( arg ) ) {\n                    list.push( arg );\n                  }\n                } else if ( arg && arg.length && toType( arg ) !== \"string\" ) {\n\n                  // Inspect recursively\n                  add( arg );\n                }\n              } );\n            } )( arguments );\n\n            if ( memory && !firing ) {\n              fire();\n            }\n          }\n          return this;\n        },\n\n        // Remove a callback from the list\n        remove: function() {\n          jQuery.each( arguments, function( _, arg ) {\n            var index;\n            while ( ( index = jQuery.inArray( arg, list, index ) ) > -1 ) {\n              list.splice( index, 1 );\n\n              // Handle firing indexes\n              if ( index <= firingIndex ) {\n                firingIndex--;\n              }\n            }\n          } );\n          return this;\n        },\n\n        // Check if a given callback is in the list.\n        // If no argument is given, return whether or not list has callbacks attached.\n        has: function( fn ) {\n          return fn ?\n            jQuery.inArray( fn, list ) > -1 :\n            list.length > 0;\n        },\n\n        // Remove all callbacks from the list\n        empty: function() {\n          if ( list ) {\n            list = [];\n          }\n          return this;\n        },\n\n        // Disable .fire and .add\n        // Abort any current/pending executions\n        // Clear all callbacks and values\n        disable: function() {\n          locked = queue = [];\n          list = memory = \"\";\n          return this;\n        },\n        disabled: function() {\n          return !list;\n        },\n\n        // Disable .fire\n        // Also disable .add unless we have memory (since it would have no effect)\n        // Abort any pending executions\n        lock: function() {\n          locked = queue = [];\n          if ( !memory && !firing ) {\n            list = memory = \"\";\n          }\n          return this;\n        },\n        locked: function() {\n          return !!locked;\n        },\n\n        // Call all callbacks with the given context and arguments\n        fireWith: function( context, args ) {\n          if ( !locked ) {\n            args = args || [];\n            args = [ context, args.slice ? args.slice() : args ];\n            queue.push( args );\n            if ( !firing ) {\n              fire();\n            }\n          }\n          return this;\n        },\n\n        // Call all the callbacks with the given arguments\n        fire: function() {\n          self.fireWith( this, arguments );\n          return this;\n        },\n\n        // To know if the callbacks have already been called at least once\n        fired: function() {\n          return !!fired;\n        }\n      };\n\n    return self;\n  };\n\n\n  function Identity( v ) {\n    return v;\n  }\n  function Thrower( ex ) {\n    throw ex;\n  }\n\n  function adoptValue( value, resolve, reject, noValue ) {\n    var method;\n\n    try {\n\n      // Check for promise aspect first to privilege synchronous behavior\n      if ( value && isFunction( ( method = value.promise ) ) ) {\n        method.call( value ).done( resolve ).fail( reject );\n\n        // Other thenables\n      } else if ( value && isFunction( ( method = value.then ) ) ) {\n        method.call( value, resolve, reject );\n\n        // Other non-thenables\n      } else {\n\n        // Control `resolve` arguments by letting Array#slice cast boolean `noValue` to integer:\n        // * false: [ value ].slice( 0 ) => resolve( value )\n        // * true: [ value ].slice( 1 ) => resolve()\n        resolve.apply( undefined, [ value ].slice( noValue ) );\n      }\n\n      // For Promises/A+, convert exceptions into rejections\n      // Since jQuery.when doesn't unwrap thenables, we can skip the extra checks appearing in\n      // Deferred#then to conditionally suppress rejection.\n    } catch ( value ) {\n\n      // Support: Android 4.0 only\n      // Strict mode functions invoked without .call/.apply get global-object context\n      reject.apply( undefined, [ value ] );\n    }\n  }\n\n  jQuery.extend( {\n\n    Deferred: function( func ) {\n      var tuples = [\n\n          // action, add listener, callbacks,\n          // ... .then handlers, argument index, [final state]\n          [ \"notify\", \"progress\", jQuery.Callbacks( \"memory\" ),\n            jQuery.Callbacks( \"memory\" ), 2 ],\n          [ \"resolve\", \"done\", jQuery.Callbacks( \"once memory\" ),\n            jQuery.Callbacks( \"once memory\" ), 0, \"resolved\" ],\n          [ \"reject\", \"fail\", jQuery.Callbacks( \"once memory\" ),\n            jQuery.Callbacks( \"once memory\" ), 1, \"rejected\" ]\n        ],\n        state = \"pending\",\n        promise = {\n          state: function() {\n            return state;\n          },\n          always: function() {\n            deferred.done( arguments ).fail( arguments );\n            return this;\n          },\n          \"catch\": function( fn ) {\n            return promise.then( null, fn );\n          },\n\n          // Keep pipe for back-compat\n          pipe: function( /* fnDone, fnFail, fnProgress */ ) {\n            var fns = arguments;\n\n            return jQuery.Deferred( function( newDefer ) {\n              jQuery.each( tuples, function( _i, tuple ) {\n\n                // Map tuples (progress, done, fail) to arguments (done, fail, progress)\n                var fn = isFunction( fns[ tuple[ 4 ] ] ) && fns[ tuple[ 4 ] ];\n\n                // deferred.progress(function() { bind to newDefer or newDefer.notify })\n                // deferred.done(function() { bind to newDefer or newDefer.resolve })\n                // deferred.fail(function() { bind to newDefer or newDefer.reject })\n                deferred[ tuple[ 1 ] ]( function() {\n                  var returned = fn && fn.apply( this, arguments );\n                  if ( returned && isFunction( returned.promise ) ) {\n                    returned.promise()\n                      .progress( newDefer.notify )\n                      .done( newDefer.resolve )\n                      .fail( newDefer.reject );\n                  } else {\n                    newDefer[ tuple[ 0 ] + \"With\" ](\n                      this,\n                      fn ? [ returned ] : arguments\n                    );\n                  }\n                } );\n              } );\n              fns = null;\n            } ).promise();\n          },\n          then: function( onFulfilled, onRejected, onProgress ) {\n            var maxDepth = 0;\n            function resolve( depth, deferred, handler, special ) {\n              return function() {\n                var that = this,\n                  args = arguments,\n                  mightThrow = function() {\n                    var returned, then;\n\n                    // Support: Promises/A+ section 2.3.3.3.3\n                    // https://promisesaplus.com/#point-59\n                    // Ignore double-resolution attempts\n                    if ( depth < maxDepth ) {\n                      return;\n                    }\n\n                    returned = handler.apply( that, args );\n\n                    // Support: Promises/A+ section 2.3.1\n                    // https://promisesaplus.com/#point-48\n                    if ( returned === deferred.promise() ) {\n                      throw new TypeError( \"Thenable self-resolution\" );\n                    }\n\n                    // Support: Promises/A+ sections 2.3.3.1, 3.5\n                    // https://promisesaplus.com/#point-54\n                    // https://promisesaplus.com/#point-75\n                    // Retrieve `then` only once\n                    then = returned &&\n\n                      // Support: Promises/A+ section 2.3.4\n                      // https://promisesaplus.com/#point-64\n                      // Only check objects and functions for thenability\n                      ( typeof returned === \"object\" ||\n                        typeof returned === \"function\" ) &&\n                      returned.then;\n\n                    // Handle a returned thenable\n                    if ( isFunction( then ) ) {\n\n                      // Special processors (notify) just wait for resolution\n                      if ( special ) {\n                        then.call(\n                          returned,\n                          resolve( maxDepth, deferred, Identity, special ),\n                          resolve( maxDepth, deferred, Thrower, special )\n                        );\n\n                        // Normal processors (resolve) also hook into progress\n                      } else {\n\n                        // ...and disregard older resolution values\n                        maxDepth++;\n\n                        then.call(\n                          returned,\n                          resolve( maxDepth, deferred, Identity, special ),\n                          resolve( maxDepth, deferred, Thrower, special ),\n                          resolve( maxDepth, deferred, Identity,\n                            deferred.notifyWith )\n                        );\n                      }\n\n                      // Handle all other returned values\n                    } else {\n\n                      // Only substitute handlers pass on context\n                      // and multiple values (non-spec behavior)\n                      if ( handler !== Identity ) {\n                        that = undefined;\n                        args = [ returned ];\n                      }\n\n                      // Process the value(s)\n                      // Default process is resolve\n                      ( special || deferred.resolveWith )( that, args );\n                    }\n                  },\n\n                  // Only normal processors (resolve) catch and reject exceptions\n                  process = special ?\n                    mightThrow :\n                    function() {\n                      try {\n                        mightThrow();\n                      } catch ( e ) {\n\n                        if ( jQuery.Deferred.exceptionHook ) {\n                          jQuery.Deferred.exceptionHook( e,\n                            process.stackTrace );\n                        }\n\n                        // Support: Promises/A+ section 2.3.3.3.4.1\n                        // https://promisesaplus.com/#point-61\n                        // Ignore post-resolution exceptions\n                        if ( depth + 1 >= maxDepth ) {\n\n                          // Only substitute handlers pass on context\n                          // and multiple values (non-spec behavior)\n                          if ( handler !== Thrower ) {\n                            that = undefined;\n                            args = [ e ];\n                          }\n\n                          deferred.rejectWith( that, args );\n                        }\n                      }\n                    };\n\n                // Support: Promises/A+ section 2.3.3.3.1\n                // https://promisesaplus.com/#point-57\n                // Re-resolve promises immediately to dodge false rejection from\n                // subsequent errors\n                if ( depth ) {\n                  process();\n                } else {\n\n                  // Call an optional hook to record the stack, in case of exception\n                  // since it's otherwise lost when execution goes async\n                  if ( jQuery.Deferred.getStackHook ) {\n                    process.stackTrace = jQuery.Deferred.getStackHook();\n                  }\n                  window.setTimeout( process );\n                }\n              };\n            }\n\n            return jQuery.Deferred( function( newDefer ) {\n\n              // progress_handlers.add( ... )\n              tuples[ 0 ][ 3 ].add(\n                resolve(\n                  0,\n                  newDefer,\n                  isFunction( onProgress ) ?\n                    onProgress :\n                    Identity,\n                  newDefer.notifyWith\n                )\n              );\n\n              // fulfilled_handlers.add( ... )\n              tuples[ 1 ][ 3 ].add(\n                resolve(\n                  0,\n                  newDefer,\n                  isFunction( onFulfilled ) ?\n                    onFulfilled :\n                    Identity\n                )\n              );\n\n              // rejected_handlers.add( ... )\n              tuples[ 2 ][ 3 ].add(\n                resolve(\n                  0,\n                  newDefer,\n                  isFunction( onRejected ) ?\n                    onRejected :\n                    Thrower\n                )\n              );\n            } ).promise();\n          },\n\n          // Get a promise for this deferred\n          // If obj is provided, the promise aspect is added to the object\n          promise: function( obj ) {\n            return obj != null ? jQuery.extend( obj, promise ) : promise;\n          }\n        },\n        deferred = {};\n\n      // Add list-specific methods\n      jQuery.each( tuples, function( i, tuple ) {\n        var list = tuple[ 2 ],\n          stateString = tuple[ 5 ];\n\n        // promise.progress = list.add\n        // promise.done = list.add\n        // promise.fail = list.add\n        promise[ tuple[ 1 ] ] = list.add;\n\n        // Handle state\n        if ( stateString ) {\n          list.add(\n            function() {\n\n              // state = \"resolved\" (i.e., fulfilled)\n              // state = \"rejected\"\n              state = stateString;\n            },\n\n            // rejected_callbacks.disable\n            // fulfilled_callbacks.disable\n            tuples[ 3 - i ][ 2 ].disable,\n\n            // rejected_handlers.disable\n            // fulfilled_handlers.disable\n            tuples[ 3 - i ][ 3 ].disable,\n\n            // progress_callbacks.lock\n            tuples[ 0 ][ 2 ].lock,\n\n            // progress_handlers.lock\n            tuples[ 0 ][ 3 ].lock\n          );\n        }\n\n        // progress_handlers.fire\n        // fulfilled_handlers.fire\n        // rejected_handlers.fire\n        list.add( tuple[ 3 ].fire );\n\n        // deferred.notify = function() { deferred.notifyWith(...) }\n        // deferred.resolve = function() { deferred.resolveWith(...) }\n        // deferred.reject = function() { deferred.rejectWith(...) }\n        deferred[ tuple[ 0 ] ] = function() {\n          deferred[ tuple[ 0 ] + \"With\" ]( this === deferred ? undefined : this, arguments );\n          return this;\n        };\n\n        // deferred.notifyWith = list.fireWith\n        // deferred.resolveWith = list.fireWith\n        // deferred.rejectWith = list.fireWith\n        deferred[ tuple[ 0 ] + \"With\" ] = list.fireWith;\n      } );\n\n      // Make the deferred a promise\n      promise.promise( deferred );\n\n      // Call given func if any\n      if ( func ) {\n        func.call( deferred, deferred );\n      }\n\n      // All done!\n      return deferred;\n    },\n\n    // Deferred helper\n    when: function( singleValue ) {\n      var\n\n        // count of uncompleted subordinates\n        remaining = arguments.length,\n\n        // count of unprocessed arguments\n        i = remaining,\n\n        // subordinate fulfillment data\n        resolveContexts = Array( i ),\n        resolveValues = slice.call( arguments ),\n\n        // the master Deferred\n        master = jQuery.Deferred(),\n\n        // subordinate callback factory\n        updateFunc = function( i ) {\n          return function( value ) {\n            resolveContexts[ i ] = this;\n            resolveValues[ i ] = arguments.length > 1 ? slice.call( arguments ) : value;\n            if ( !( --remaining ) ) {\n              master.resolveWith( resolveContexts, resolveValues );\n            }\n          };\n        };\n\n      // Single- and empty arguments are adopted like Promise.resolve\n      if ( remaining <= 1 ) {\n        adoptValue( singleValue, master.done( updateFunc( i ) ).resolve, master.reject,\n          !remaining );\n\n        // Use .then() to unwrap secondary thenables (cf. gh-3000)\n        if ( master.state() === \"pending\" ||\n          isFunction( resolveValues[ i ] && resolveValues[ i ].then ) ) {\n\n          return master.then();\n        }\n      }\n\n      // Multiple arguments are aggregated like Promise.all array elements\n      while ( i-- ) {\n        adoptValue( resolveValues[ i ], updateFunc( i ), master.reject );\n      }\n\n      return master.promise();\n    }\n  } );\n\n\n// These usually indicate a programmer mistake during development,\n// warn about them ASAP rather than swallowing them by default.\n  var rerrorNames = /^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;\n\n  jQuery.Deferred.exceptionHook = function( error, stack ) {\n\n    // Support: IE 8 - 9 only\n    // Console exists when dev tools are open, which can happen at any time\n    if ( window.console && window.console.warn && error && rerrorNames.test( error.name ) ) {\n      window.console.warn( \"jQuery.Deferred exception: \" + error.message, error.stack, stack );\n    }\n  };\n\n\n\n\n  jQuery.readyException = function( error ) {\n    window.setTimeout( function() {\n      throw error;\n    } );\n  };\n\n\n\n\n// The deferred used on DOM ready\n  var readyList = jQuery.Deferred();\n\n  jQuery.fn.ready = function( fn ) {\n\n    readyList\n      .then( fn )\n\n      // Wrap jQuery.readyException in a function so that the lookup\n      // happens at the time of error handling instead of callback\n      // registration.\n      .catch( function( error ) {\n        jQuery.readyException( error );\n      } );\n\n    return this;\n  };\n\n  jQuery.extend( {\n\n    // Is the DOM ready to be used? Set to true once it occurs.\n    isReady: false,\n\n    // A counter to track how many items to wait for before\n    // the ready event fires. See #6781\n    readyWait: 1,\n\n    // Handle when the DOM is ready\n    ready: function( wait ) {\n\n      // Abort if there are pending holds or we're already ready\n      if ( wait === true ? --jQuery.readyWait : jQuery.isReady ) {\n        return;\n      }\n\n      // Remember that the DOM is ready\n      jQuery.isReady = true;\n\n      // If a normal DOM Ready event fired, decrement, and wait if need be\n      if ( wait !== true && --jQuery.readyWait > 0 ) {\n        return;\n      }\n\n      // If there are functions bound, to execute\n      readyList.resolveWith( document, [ jQuery ] );\n    }\n  } );\n\n  jQuery.ready.then = readyList.then;\n\n// The ready event handler and self cleanup method\n  function completed() {\n    document.removeEventListener( \"DOMContentLoaded\", completed );\n    window.removeEventListener( \"load\", completed );\n    jQuery.ready();\n  }\n\n// Catch cases where $(document).ready() is called\n// after the browser event has already occurred.\n// Support: IE <=9 - 10 only\n// Older IE sometimes signals \"interactive\" too soon\n  if ( document.readyState === \"complete\" ||\n    ( document.readyState !== \"loading\" && !document.documentElement.doScroll ) ) {\n\n    // Handle it asynchronously to allow scripts the opportunity to delay ready\n    window.setTimeout( jQuery.ready );\n\n  } else {\n\n    // Use the handy event callback\n    document.addEventListener( \"DOMContentLoaded\", completed );\n\n    // A fallback to window.onload, that will always work\n    window.addEventListener( \"load\", completed );\n  }\n\n\n\n\n// Multifunctional method to get and set values of a collection\n// The value/s can optionally be executed if it's a function\n  var access = function( elems, fn, key, value, chainable, emptyGet, raw ) {\n    var i = 0,\n      len = elems.length,\n      bulk = key == null;\n\n    // Sets many values\n    if ( toType( key ) === \"object\" ) {\n      chainable = true;\n      for ( i in key ) {\n        access( elems, fn, i, key[ i ], true, emptyGet, raw );\n      }\n\n      // Sets one value\n    } else if ( value !== undefined ) {\n      chainable = true;\n\n      if ( !isFunction( value ) ) {\n        raw = true;\n      }\n\n      if ( bulk ) {\n\n        // Bulk operations run against the entire set\n        if ( raw ) {\n          fn.call( elems, value );\n          fn = null;\n\n          // ...except when executing function values\n        } else {\n          bulk = fn;\n          fn = function( elem, _key, value ) {\n            return bulk.call( jQuery( elem ), value );\n          };\n        }\n      }\n\n      if ( fn ) {\n        for ( ; i < len; i++ ) {\n          fn(\n            elems[ i ], key, raw ?\n              value :\n              value.call( elems[ i ], i, fn( elems[ i ], key ) )\n          );\n        }\n      }\n    }\n\n    if ( chainable ) {\n      return elems;\n    }\n\n    // Gets\n    if ( bulk ) {\n      return fn.call( elems );\n    }\n\n    return len ? fn( elems[ 0 ], key ) : emptyGet;\n  };\n\n\n// Matches dashed string for camelizing\n  var rmsPrefix = /^-ms-/,\n    rdashAlpha = /-([a-z])/g;\n\n// Used by camelCase as callback to replace()\n  function fcamelCase( _all, letter ) {\n    return letter.toUpperCase();\n  }\n\n// Convert dashed to camelCase; used by the css and data modules\n// Support: IE <=9 - 11, Edge 12 - 15\n// Microsoft forgot to hump their vendor prefix (#9572)\n  function camelCase( string ) {\n    return string.replace( rmsPrefix, \"ms-\" ).replace( rdashAlpha, fcamelCase );\n  }\n  var acceptData = function( owner ) {\n\n    // Accepts only:\n    //  - Node\n    //    - Node.ELEMENT_NODE\n    //    - Node.DOCUMENT_NODE\n    //  - Object\n    //    - Any\n    return owner.nodeType === 1 || owner.nodeType === 9 || !( +owner.nodeType );\n  };\n\n\n\n\n  function Data() {\n    this.expando = jQuery.expando + Data.uid++;\n  }\n\n  Data.uid = 1;\n\n  Data.prototype = {\n\n    cache: function( owner ) {\n\n      // Check if the owner object already has a cache\n      var value = owner[ this.expando ];\n\n      // If not, create one\n      if ( !value ) {\n        value = {};\n\n        // We can accept data for non-element nodes in modern browsers,\n        // but we should not, see #8335.\n        // Always return an empty object.\n        if ( acceptData( owner ) ) {\n\n          // If it is a node unlikely to be stringify-ed or looped over\n          // use plain assignment\n          if ( owner.nodeType ) {\n            owner[ this.expando ] = value;\n\n            // Otherwise secure it in a non-enumerable property\n            // configurable must be true to allow the property to be\n            // deleted when data is removed\n          } else {\n            Object.defineProperty( owner, this.expando, {\n              value: value,\n              configurable: true\n            } );\n          }\n        }\n      }\n\n      return value;\n    },\n    set: function( owner, data, value ) {\n      var prop,\n        cache = this.cache( owner );\n\n      // Handle: [ owner, key, value ] args\n      // Always use camelCase key (gh-2257)\n      if ( typeof data === \"string\" ) {\n        cache[ camelCase( data ) ] = value;\n\n        // Handle: [ owner, { properties } ] args\n      } else {\n\n        // Copy the properties one-by-one to the cache object\n        for ( prop in data ) {\n          cache[ camelCase( prop ) ] = data[ prop ];\n        }\n      }\n      return cache;\n    },\n    get: function( owner, key ) {\n      return key === undefined ?\n        this.cache( owner ) :\n\n        // Always use camelCase key (gh-2257)\n        owner[ this.expando ] && owner[ this.expando ][ camelCase( key ) ];\n    },\n    access: function( owner, key, value ) {\n\n      // In cases where either:\n      //\n      //   1. No key was specified\n      //   2. A string key was specified, but no value provided\n      //\n      // Take the \"read\" path and allow the get method to determine\n      // which value to return, respectively either:\n      //\n      //   1. The entire cache object\n      //   2. The data stored at the key\n      //\n      if ( key === undefined ||\n        ( ( key && typeof key === \"string\" ) && value === undefined ) ) {\n\n        return this.get( owner, key );\n      }\n\n      // When the key is not a string, or both a key and value\n      // are specified, set or extend (existing objects) with either:\n      //\n      //   1. An object of properties\n      //   2. A key and value\n      //\n      this.set( owner, key, value );\n\n      // Since the \"set\" path can have two possible entry points\n      // return the expected data based on which path was taken[*]\n      return value !== undefined ? value : key;\n    },\n    remove: function( owner, key ) {\n      var i,\n        cache = owner[ this.expando ];\n\n      if ( cache === undefined ) {\n        return;\n      }\n\n      if ( key !== undefined ) {\n\n        // Support array or space separated string of keys\n        if ( Array.isArray( key ) ) {\n\n          // If key is an array of keys...\n          // We always set camelCase keys, so remove that.\n          key = key.map( camelCase );\n        } else {\n          key = camelCase( key );\n\n          // If a key with the spaces exists, use it.\n          // Otherwise, create an array by matching non-whitespace\n          key = key in cache ?\n            [ key ] :\n            ( key.match( rnothtmlwhite ) || [] );\n        }\n\n        i = key.length;\n\n        while ( i-- ) {\n          delete cache[ key[ i ] ];\n        }\n      }\n\n      // Remove the expando if there's no more data\n      if ( key === undefined || jQuery.isEmptyObject( cache ) ) {\n\n        // Support: Chrome <=35 - 45\n        // Webkit & Blink performance suffers when deleting properties\n        // from DOM nodes, so set to undefined instead\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=378607 (bug restricted)\n        if ( owner.nodeType ) {\n          owner[ this.expando ] = undefined;\n        } else {\n          delete owner[ this.expando ];\n        }\n      }\n    },\n    hasData: function( owner ) {\n      var cache = owner[ this.expando ];\n      return cache !== undefined && !jQuery.isEmptyObject( cache );\n    }\n  };\n  var dataPriv = new Data();\n\n  var dataUser = new Data();\n\n\n\n//\tImplementation Summary\n//\n//\t1. Enforce API surface and semantic compatibility with 1.9.x branch\n//\t2. Improve the module's maintainability by reducing the storage\n//\t\tpaths to a single mechanism.\n//\t3. Use the same single mechanism to support \"private\" and \"user\" data.\n//\t4. _Never_ expose \"private\" data to user code (TODO: Drop _data, _removeData)\n//\t5. Avoid exposing implementation details on user objects (eg. expando properties)\n//\t6. Provide a clear path for implementation upgrade to WeakMap in 2014\n\n  var rbrace = /^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,\n    rmultiDash = /[A-Z]/g;\n\n  function getData( data ) {\n    if ( data === \"true\" ) {\n      return true;\n    }\n\n    if ( data === \"false\" ) {\n      return false;\n    }\n\n    if ( data === \"null\" ) {\n      return null;\n    }\n\n    // Only convert to a number if it doesn't change the string\n    if ( data === +data + \"\" ) {\n      return +data;\n    }\n\n    if ( rbrace.test( data ) ) {\n      return JSON.parse( data );\n    }\n\n    return data;\n  }\n\n  function dataAttr( elem, key, data ) {\n    var name;\n\n    // If nothing was found internally, try to fetch any\n    // data from the HTML5 data-* attribute\n    if ( data === undefined && elem.nodeType === 1 ) {\n      name = \"data-\" + key.replace( rmultiDash, \"-$&\" ).toLowerCase();\n      data = elem.getAttribute( name );\n\n      if ( typeof data === \"string\" ) {\n        try {\n          data = getData( data );\n        } catch ( e ) {}\n\n        // Make sure we set the data so it isn't changed later\n        dataUser.set( elem, key, data );\n      } else {\n        data = undefined;\n      }\n    }\n    return data;\n  }\n\n  jQuery.extend( {\n    hasData: function( elem ) {\n      return dataUser.hasData( elem ) || dataPriv.hasData( elem );\n    },\n\n    data: function( elem, name, data ) {\n      return dataUser.access( elem, name, data );\n    },\n\n    removeData: function( elem, name ) {\n      dataUser.remove( elem, name );\n    },\n\n    // TODO: Now that all calls to _data and _removeData have been replaced\n    // with direct calls to dataPriv methods, these can be deprecated.\n    _data: function( elem, name, data ) {\n      return dataPriv.access( elem, name, data );\n    },\n\n    _removeData: function( elem, name ) {\n      dataPriv.remove( elem, name );\n    }\n  } );\n\n  jQuery.fn.extend( {\n    data: function( key, value ) {\n      var i, name, data,\n        elem = this[ 0 ],\n        attrs = elem && elem.attributes;\n\n      // Gets all values\n      if ( key === undefined ) {\n        if ( this.length ) {\n          data = dataUser.get( elem );\n\n          if ( elem.nodeType === 1 && !dataPriv.get( elem, \"hasDataAttrs\" ) ) {\n            i = attrs.length;\n            while ( i-- ) {\n\n              // Support: IE 11 only\n              // The attrs elements can be null (#14894)\n              if ( attrs[ i ] ) {\n                name = attrs[ i ].name;\n                if ( name.indexOf( \"data-\" ) === 0 ) {\n                  name = camelCase( name.slice( 5 ) );\n                  dataAttr( elem, name, data[ name ] );\n                }\n              }\n            }\n            dataPriv.set( elem, \"hasDataAttrs\", true );\n          }\n        }\n\n        return data;\n      }\n\n      // Sets multiple values\n      if ( typeof key === \"object\" ) {\n        return this.each( function() {\n          dataUser.set( this, key );\n        } );\n      }\n\n      return access( this, function( value ) {\n        var data;\n\n        // The calling jQuery object (element matches) is not empty\n        // (and therefore has an element appears at this[ 0 ]) and the\n        // `value` parameter was not undefined. An empty jQuery object\n        // will result in `undefined` for elem = this[ 0 ] which will\n        // throw an exception if an attempt to read a data cache is made.\n        if ( elem && value === undefined ) {\n\n          // Attempt to get data from the cache\n          // The key will always be camelCased in Data\n          data = dataUser.get( elem, key );\n          if ( data !== undefined ) {\n            return data;\n          }\n\n          // Attempt to \"discover\" the data in\n          // HTML5 custom data-* attrs\n          data = dataAttr( elem, key );\n          if ( data !== undefined ) {\n            return data;\n          }\n\n          // We tried really hard, but the data doesn't exist.\n          return;\n        }\n\n        // Set the data...\n        this.each( function() {\n\n          // We always store the camelCased key\n          dataUser.set( this, key, value );\n        } );\n      }, null, value, arguments.length > 1, null, true );\n    },\n\n    removeData: function( key ) {\n      return this.each( function() {\n        dataUser.remove( this, key );\n      } );\n    }\n  } );\n\n\n  jQuery.extend( {\n    queue: function( elem, type, data ) {\n      var queue;\n\n      if ( elem ) {\n        type = ( type || \"fx\" ) + \"queue\";\n        queue = dataPriv.get( elem, type );\n\n        // Speed up dequeue by getting out quickly if this is just a lookup\n        if ( data ) {\n          if ( !queue || Array.isArray( data ) ) {\n            queue = dataPriv.access( elem, type, jQuery.makeArray( data ) );\n          } else {\n            queue.push( data );\n          }\n        }\n        return queue || [];\n      }\n    },\n\n    dequeue: function( elem, type ) {\n      type = type || \"fx\";\n\n      var queue = jQuery.queue( elem, type ),\n        startLength = queue.length,\n        fn = queue.shift(),\n        hooks = jQuery._queueHooks( elem, type ),\n        next = function() {\n          jQuery.dequeue( elem, type );\n        };\n\n      // If the fx queue is dequeued, always remove the progress sentinel\n      if ( fn === \"inprogress\" ) {\n        fn = queue.shift();\n        startLength--;\n      }\n\n      if ( fn ) {\n\n        // Add a progress sentinel to prevent the fx queue from being\n        // automatically dequeued\n        if ( type === \"fx\" ) {\n          queue.unshift( \"inprogress\" );\n        }\n\n        // Clear up the last queue stop function\n        delete hooks.stop;\n        fn.call( elem, next, hooks );\n      }\n\n      if ( !startLength && hooks ) {\n        hooks.empty.fire();\n      }\n    },\n\n    // Not public - generate a queueHooks object, or return the current one\n    _queueHooks: function( elem, type ) {\n      var key = type + \"queueHooks\";\n      return dataPriv.get( elem, key ) || dataPriv.access( elem, key, {\n        empty: jQuery.Callbacks( \"once memory\" ).add( function() {\n          dataPriv.remove( elem, [ type + \"queue\", key ] );\n        } )\n      } );\n    }\n  } );\n\n  jQuery.fn.extend( {\n    queue: function( type, data ) {\n      var setter = 2;\n\n      if ( typeof type !== \"string\" ) {\n        data = type;\n        type = \"fx\";\n        setter--;\n      }\n\n      if ( arguments.length < setter ) {\n        return jQuery.queue( this[ 0 ], type );\n      }\n\n      return data === undefined ?\n        this :\n        this.each( function() {\n          var queue = jQuery.queue( this, type, data );\n\n          // Ensure a hooks for this queue\n          jQuery._queueHooks( this, type );\n\n          if ( type === \"fx\" && queue[ 0 ] !== \"inprogress\" ) {\n            jQuery.dequeue( this, type );\n          }\n        } );\n    },\n    dequeue: function( type ) {\n      return this.each( function() {\n        jQuery.dequeue( this, type );\n      } );\n    },\n    clearQueue: function( type ) {\n      return this.queue( type || \"fx\", [] );\n    },\n\n    // Get a promise resolved when queues of a certain type\n    // are emptied (fx is the type by default)\n    promise: function( type, obj ) {\n      var tmp,\n        count = 1,\n        defer = jQuery.Deferred(),\n        elements = this,\n        i = this.length,\n        resolve = function() {\n          if ( !( --count ) ) {\n            defer.resolveWith( elements, [ elements ] );\n          }\n        };\n\n      if ( typeof type !== \"string\" ) {\n        obj = type;\n        type = undefined;\n      }\n      type = type || \"fx\";\n\n      while ( i-- ) {\n        tmp = dataPriv.get( elements[ i ], type + \"queueHooks\" );\n        if ( tmp && tmp.empty ) {\n          count++;\n          tmp.empty.add( resolve );\n        }\n      }\n      resolve();\n      return defer.promise( obj );\n    }\n  } );\n  var pnum = ( /[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/ ).source;\n\n  var rcssNum = new RegExp( \"^(?:([+-])=|)(\" + pnum + \")([a-z%]*)$\", \"i\" );\n\n\n  var cssExpand = [ \"Top\", \"Right\", \"Bottom\", \"Left\" ];\n\n  var documentElement = document.documentElement;\n\n\n\n  var isAttached = function( elem ) {\n      return jQuery.contains( elem.ownerDocument, elem );\n    },\n    composed = { composed: true };\n\n  // Support: IE 9 - 11+, Edge 12 - 18+, iOS 10.0 - 10.2 only\n  // Check attachment across shadow DOM boundaries when possible (gh-3504)\n  // Support: iOS 10.0-10.2 only\n  // Early iOS 10 versions support `attachShadow` but not `getRootNode`,\n  // leading to errors. We need to check for `getRootNode`.\n  if ( documentElement.getRootNode ) {\n    isAttached = function( elem ) {\n      return jQuery.contains( elem.ownerDocument, elem ) ||\n        elem.getRootNode( composed ) === elem.ownerDocument;\n    };\n  }\n  var isHiddenWithinTree = function( elem, el ) {\n\n    // isHiddenWithinTree might be called from jQuery#filter function;\n    // in that case, element will be second argument\n    elem = el || elem;\n\n    // Inline style trumps all\n    return elem.style.display === \"none\" ||\n      elem.style.display === \"\" &&\n\n      // Otherwise, check computed style\n      // Support: Firefox <=43 - 45\n      // Disconnected elements can have computed display: none, so first confirm that elem is\n      // in the document.\n      isAttached( elem ) &&\n\n      jQuery.css( elem, \"display\" ) === \"none\";\n  };\n\n\n\n  function adjustCSS( elem, prop, valueParts, tween ) {\n    var adjusted, scale,\n      maxIterations = 20,\n      currentValue = tween ?\n        function() {\n          return tween.cur();\n        } :\n        function() {\n          return jQuery.css( elem, prop, \"\" );\n        },\n      initial = currentValue(),\n      unit = valueParts && valueParts[ 3 ] || ( jQuery.cssNumber[ prop ] ? \"\" : \"px\" ),\n\n      // Starting value computation is required for potential unit mismatches\n      initialInUnit = elem.nodeType &&\n        ( jQuery.cssNumber[ prop ] || unit !== \"px\" && +initial ) &&\n        rcssNum.exec( jQuery.css( elem, prop ) );\n\n    if ( initialInUnit && initialInUnit[ 3 ] !== unit ) {\n\n      // Support: Firefox <=54\n      // Halve the iteration target value to prevent interference from CSS upper bounds (gh-2144)\n      initial = initial / 2;\n\n      // Trust units reported by jQuery.css\n      unit = unit || initialInUnit[ 3 ];\n\n      // Iteratively approximate from a nonzero starting point\n      initialInUnit = +initial || 1;\n\n      while ( maxIterations-- ) {\n\n        // Evaluate and update our best guess (doubling guesses that zero out).\n        // Finish if the scale equals or crosses 1 (making the old*new product non-positive).\n        jQuery.style( elem, prop, initialInUnit + unit );\n        if ( ( 1 - scale ) * ( 1 - ( scale = currentValue() / initial || 0.5 ) ) <= 0 ) {\n          maxIterations = 0;\n        }\n        initialInUnit = initialInUnit / scale;\n\n      }\n\n      initialInUnit = initialInUnit * 2;\n      jQuery.style( elem, prop, initialInUnit + unit );\n\n      // Make sure we update the tween properties later on\n      valueParts = valueParts || [];\n    }\n\n    if ( valueParts ) {\n      initialInUnit = +initialInUnit || +initial || 0;\n\n      // Apply relative offset (+=/-=) if specified\n      adjusted = valueParts[ 1 ] ?\n        initialInUnit + ( valueParts[ 1 ] + 1 ) * valueParts[ 2 ] :\n        +valueParts[ 2 ];\n      if ( tween ) {\n        tween.unit = unit;\n        tween.start = initialInUnit;\n        tween.end = adjusted;\n      }\n    }\n    return adjusted;\n  }\n\n\n  var defaultDisplayMap = {};\n\n  function getDefaultDisplay( elem ) {\n    var temp,\n      doc = elem.ownerDocument,\n      nodeName = elem.nodeName,\n      display = defaultDisplayMap[ nodeName ];\n\n    if ( display ) {\n      return display;\n    }\n\n    temp = doc.body.appendChild( doc.createElement( nodeName ) );\n    display = jQuery.css( temp, \"display\" );\n\n    temp.parentNode.removeChild( temp );\n\n    if ( display === \"none\" ) {\n      display = \"block\";\n    }\n    defaultDisplayMap[ nodeName ] = display;\n\n    return display;\n  }\n\n  function showHide( elements, show ) {\n    var display, elem,\n      values = [],\n      index = 0,\n      length = elements.length;\n\n    // Determine new display value for elements that need to change\n    for ( ; index < length; index++ ) {\n      elem = elements[ index ];\n      if ( !elem.style ) {\n        continue;\n      }\n\n      display = elem.style.display;\n      if ( show ) {\n\n        // Since we force visibility upon cascade-hidden elements, an immediate (and slow)\n        // check is required in this first loop unless we have a nonempty display value (either\n        // inline or about-to-be-restored)\n        if ( display === \"none\" ) {\n          values[ index ] = dataPriv.get( elem, \"display\" ) || null;\n          if ( !values[ index ] ) {\n            elem.style.display = \"\";\n          }\n        }\n        if ( elem.style.display === \"\" && isHiddenWithinTree( elem ) ) {\n          values[ index ] = getDefaultDisplay( elem );\n        }\n      } else {\n        if ( display !== \"none\" ) {\n          values[ index ] = \"none\";\n\n          // Remember what we're overwriting\n          dataPriv.set( elem, \"display\", display );\n        }\n      }\n    }\n\n    // Set the display of the elements in a second loop to avoid constant reflow\n    for ( index = 0; index < length; index++ ) {\n      if ( values[ index ] != null ) {\n        elements[ index ].style.display = values[ index ];\n      }\n    }\n\n    return elements;\n  }\n\n  jQuery.fn.extend( {\n    show: function() {\n      return showHide( this, true );\n    },\n    hide: function() {\n      return showHide( this );\n    },\n    toggle: function( state ) {\n      if ( typeof state === \"boolean\" ) {\n        return state ? this.show() : this.hide();\n      }\n\n      return this.each( function() {\n        if ( isHiddenWithinTree( this ) ) {\n          jQuery( this ).show();\n        } else {\n          jQuery( this ).hide();\n        }\n      } );\n    }\n  } );\n  var rcheckableType = ( /^(?:checkbox|radio)$/i );\n\n  var rtagName = ( /<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i );\n\n  var rscriptType = ( /^$|^module$|\\/(?:java|ecma)script/i );\n\n\n\n  ( function() {\n    var fragment = document.createDocumentFragment(),\n      div = fragment.appendChild( document.createElement( \"div\" ) ),\n      input = document.createElement( \"input\" );\n\n    // Support: Android 4.0 - 4.3 only\n    // Check state lost if the name is set (#11217)\n    // Support: Windows Web Apps (WWA)\n    // `name` and `type` must use .setAttribute for WWA (#14901)\n    input.setAttribute( \"type\", \"radio\" );\n    input.setAttribute( \"checked\", \"checked\" );\n    input.setAttribute( \"name\", \"t\" );\n\n    div.appendChild( input );\n\n    // Support: Android <=4.1 only\n    // Older WebKit doesn't clone checked state correctly in fragments\n    support.checkClone = div.cloneNode( true ).cloneNode( true ).lastChild.checked;\n\n    // Support: IE <=11 only\n    // Make sure textarea (and checkbox) defaultValue is properly cloned\n    div.innerHTML = \"<textarea>x</textarea>\";\n    support.noCloneChecked = !!div.cloneNode( true ).lastChild.defaultValue;\n\n    // Support: IE <=9 only\n    // IE <=9 replaces <option> tags with their contents when inserted outside of\n    // the select element.\n    div.innerHTML = \"<option></option>\";\n    support.option = !!div.lastChild;\n  } )();\n\n\n// We have to close these tags to support XHTML (#13200)\n  var wrapMap = {\n\n    // XHTML parsers do not magically insert elements in the\n    // same way that tag soup parsers do. So we cannot shorten\n    // this by omitting <tbody> or other required elements.\n    thead: [ 1, \"<table>\", \"</table>\" ],\n    col: [ 2, \"<table><colgroup>\", \"</colgroup></table>\" ],\n    tr: [ 2, \"<table><tbody>\", \"</tbody></table>\" ],\n    td: [ 3, \"<table><tbody><tr>\", \"</tr></tbody></table>\" ],\n\n    _default: [ 0, \"\", \"\" ]\n  };\n\n  wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;\n  wrapMap.th = wrapMap.td;\n\n// Support: IE <=9 only\n  if ( !support.option ) {\n    wrapMap.optgroup = wrapMap.option = [ 1, \"<select multiple='multiple'>\", \"</select>\" ];\n  }\n\n\n  function getAll( context, tag ) {\n\n    // Support: IE <=9 - 11 only\n    // Use typeof to avoid zero-argument method invocation on host objects (#15151)\n    var ret;\n\n    if ( typeof context.getElementsByTagName !== \"undefined\" ) {\n      ret = context.getElementsByTagName( tag || \"*\" );\n\n    } else if ( typeof context.querySelectorAll !== \"undefined\" ) {\n      ret = context.querySelectorAll( tag || \"*\" );\n\n    } else {\n      ret = [];\n    }\n\n    if ( tag === undefined || tag && nodeName( context, tag ) ) {\n      return jQuery.merge( [ context ], ret );\n    }\n\n    return ret;\n  }\n\n\n// Mark scripts as having already been evaluated\n  function setGlobalEval( elems, refElements ) {\n    var i = 0,\n      l = elems.length;\n\n    for ( ; i < l; i++ ) {\n      dataPriv.set(\n        elems[ i ],\n        \"globalEval\",\n        !refElements || dataPriv.get( refElements[ i ], \"globalEval\" )\n      );\n    }\n  }\n\n\n  var rhtml = /<|&#?\\w+;/;\n\n  function buildFragment( elems, context, scripts, selection, ignored ) {\n    var elem, tmp, tag, wrap, attached, j,\n      fragment = context.createDocumentFragment(),\n      nodes = [],\n      i = 0,\n      l = elems.length;\n\n    for ( ; i < l; i++ ) {\n      elem = elems[ i ];\n\n      if ( elem || elem === 0 ) {\n\n        // Add nodes directly\n        if ( toType( elem ) === \"object\" ) {\n\n          // Support: Android <=4.0 only, PhantomJS 1 only\n          // push.apply(_, arraylike) throws on ancient WebKit\n          jQuery.merge( nodes, elem.nodeType ? [ elem ] : elem );\n\n          // Convert non-html into a text node\n        } else if ( !rhtml.test( elem ) ) {\n          nodes.push( context.createTextNode( elem ) );\n\n          // Convert html into DOM nodes\n        } else {\n          tmp = tmp || fragment.appendChild( context.createElement( \"div\" ) );\n\n          // Deserialize a standard representation\n          tag = ( rtagName.exec( elem ) || [ \"\", \"\" ] )[ 1 ].toLowerCase();\n          wrap = wrapMap[ tag ] || wrapMap._default;\n          tmp.innerHTML = wrap[ 1 ] + jQuery.htmlPrefilter( elem ) + wrap[ 2 ];\n\n          // Descend through wrappers to the right content\n          j = wrap[ 0 ];\n          while ( j-- ) {\n            tmp = tmp.lastChild;\n          }\n\n          // Support: Android <=4.0 only, PhantomJS 1 only\n          // push.apply(_, arraylike) throws on ancient WebKit\n          jQuery.merge( nodes, tmp.childNodes );\n\n          // Remember the top-level container\n          tmp = fragment.firstChild;\n\n          // Ensure the created nodes are orphaned (#12392)\n          tmp.textContent = \"\";\n        }\n      }\n    }\n\n    // Remove wrapper from fragment\n    fragment.textContent = \"\";\n\n    i = 0;\n    while ( ( elem = nodes[ i++ ] ) ) {\n\n      // Skip elements already in the context collection (trac-4087)\n      if ( selection && jQuery.inArray( elem, selection ) > -1 ) {\n        if ( ignored ) {\n          ignored.push( elem );\n        }\n        continue;\n      }\n\n      attached = isAttached( elem );\n\n      // Append to fragment\n      tmp = getAll( fragment.appendChild( elem ), \"script\" );\n\n      // Preserve script evaluation history\n      if ( attached ) {\n        setGlobalEval( tmp );\n      }\n\n      // Capture executables\n      if ( scripts ) {\n        j = 0;\n        while ( ( elem = tmp[ j++ ] ) ) {\n          if ( rscriptType.test( elem.type || \"\" ) ) {\n            scripts.push( elem );\n          }\n        }\n      }\n    }\n\n    return fragment;\n  }\n\n\n  var\n    rkeyEvent = /^key/,\n    rmouseEvent = /^(?:mouse|pointer|contextmenu|drag|drop)|click/,\n    rtypenamespace = /^([^.]*)(?:\\.(.+)|)/;\n\n  function returnTrue() {\n    return true;\n  }\n\n  function returnFalse() {\n    return false;\n  }\n\n// Support: IE <=9 - 11+\n// focus() and blur() are asynchronous, except when they are no-op.\n// So expect focus to be synchronous when the element is already active,\n// and blur to be synchronous when the element is not already active.\n// (focus and blur are always synchronous in other supported browsers,\n// this just defines when we can count on it).\n  function expectSync( elem, type ) {\n    return ( elem === safeActiveElement() ) === ( type === \"focus\" );\n  }\n\n// Support: IE <=9 only\n// Accessing document.activeElement can throw unexpectedly\n// https://bugs.jquery.com/ticket/13393\n  function safeActiveElement() {\n    try {\n      return document.activeElement;\n    } catch ( err ) { }\n  }\n\n  function on( elem, types, selector, data, fn, one ) {\n    var origFn, type;\n\n    // Types can be a map of types/handlers\n    if ( typeof types === \"object\" ) {\n\n      // ( types-Object, selector, data )\n      if ( typeof selector !== \"string\" ) {\n\n        // ( types-Object, data )\n        data = data || selector;\n        selector = undefined;\n      }\n      for ( type in types ) {\n        on( elem, type, selector, data, types[ type ], one );\n      }\n      return elem;\n    }\n\n    if ( data == null && fn == null ) {\n\n      // ( types, fn )\n      fn = selector;\n      data = selector = undefined;\n    } else if ( fn == null ) {\n      if ( typeof selector === \"string\" ) {\n\n        // ( types, selector, fn )\n        fn = data;\n        data = undefined;\n      } else {\n\n        // ( types, data, fn )\n        fn = data;\n        data = selector;\n        selector = undefined;\n      }\n    }\n    if ( fn === false ) {\n      fn = returnFalse;\n    } else if ( !fn ) {\n      return elem;\n    }\n\n    if ( one === 1 ) {\n      origFn = fn;\n      fn = function( event ) {\n\n        // Can use an empty set, since event contains the info\n        jQuery().off( event );\n        return origFn.apply( this, arguments );\n      };\n\n      // Use same guid so caller can remove using origFn\n      fn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );\n    }\n    return elem.each( function() {\n      jQuery.event.add( this, types, fn, data, selector );\n    } );\n  }\n\n  /*\n * Helper functions for managing events -- not part of the public interface.\n * Props to Dean Edwards' addEvent library for many of the ideas.\n */\n  jQuery.event = {\n\n    global: {},\n\n    add: function( elem, types, handler, data, selector ) {\n\n      var handleObjIn, eventHandle, tmp,\n        events, t, handleObj,\n        special, handlers, type, namespaces, origType,\n        elemData = dataPriv.get( elem );\n\n      // Only attach events to objects that accept data\n      if ( !acceptData( elem ) ) {\n        return;\n      }\n\n      // Caller can pass in an object of custom data in lieu of the handler\n      if ( handler.handler ) {\n        handleObjIn = handler;\n        handler = handleObjIn.handler;\n        selector = handleObjIn.selector;\n      }\n\n      // Ensure that invalid selectors throw exceptions at attach time\n      // Evaluate against documentElement in case elem is a non-element node (e.g., document)\n      if ( selector ) {\n        jQuery.find.matchesSelector( documentElement, selector );\n      }\n\n      // Make sure that the handler has a unique ID, used to find/remove it later\n      if ( !handler.guid ) {\n        handler.guid = jQuery.guid++;\n      }\n\n      // Init the element's event structure and main handler, if this is the first\n      if ( !( events = elemData.events ) ) {\n        events = elemData.events = Object.create( null );\n      }\n      if ( !( eventHandle = elemData.handle ) ) {\n        eventHandle = elemData.handle = function( e ) {\n\n          // Discard the second event of a jQuery.event.trigger() and\n          // when an event is called after a page has unloaded\n          return typeof jQuery !== \"undefined\" && jQuery.event.triggered !== e.type ?\n            jQuery.event.dispatch.apply( elem, arguments ) : undefined;\n        };\n      }\n\n      // Handle multiple events separated by a space\n      types = ( types || \"\" ).match( rnothtmlwhite ) || [ \"\" ];\n      t = types.length;\n      while ( t-- ) {\n        tmp = rtypenamespace.exec( types[ t ] ) || [];\n        type = origType = tmp[ 1 ];\n        namespaces = ( tmp[ 2 ] || \"\" ).split( \".\" ).sort();\n\n        // There *must* be a type, no attaching namespace-only handlers\n        if ( !type ) {\n          continue;\n        }\n\n        // If event changes its type, use the special event handlers for the changed type\n        special = jQuery.event.special[ type ] || {};\n\n        // If selector defined, determine special event api type, otherwise given type\n        type = ( selector ? special.delegateType : special.bindType ) || type;\n\n        // Update special based on newly reset type\n        special = jQuery.event.special[ type ] || {};\n\n        // handleObj is passed to all event handlers\n        handleObj = jQuery.extend( {\n          type: type,\n          origType: origType,\n          data: data,\n          handler: handler,\n          guid: handler.guid,\n          selector: selector,\n          needsContext: selector && jQuery.expr.match.needsContext.test( selector ),\n          namespace: namespaces.join( \".\" )\n        }, handleObjIn );\n\n        // Init the event handler queue if we're the first\n        if ( !( handlers = events[ type ] ) ) {\n          handlers = events[ type ] = [];\n          handlers.delegateCount = 0;\n\n          // Only use addEventListener if the special events handler returns false\n          if ( !special.setup ||\n            special.setup.call( elem, data, namespaces, eventHandle ) === false ) {\n\n            if ( elem.addEventListener ) {\n              elem.addEventListener( type, eventHandle );\n            }\n          }\n        }\n\n        if ( special.add ) {\n          special.add.call( elem, handleObj );\n\n          if ( !handleObj.handler.guid ) {\n            handleObj.handler.guid = handler.guid;\n          }\n        }\n\n        // Add to the element's handler list, delegates in front\n        if ( selector ) {\n          handlers.splice( handlers.delegateCount++, 0, handleObj );\n        } else {\n          handlers.push( handleObj );\n        }\n\n        // Keep track of which events have ever been used, for event optimization\n        jQuery.event.global[ type ] = true;\n      }\n\n    },\n\n    // Detach an event or set of events from an element\n    remove: function( elem, types, handler, selector, mappedTypes ) {\n\n      var j, origCount, tmp,\n        events, t, handleObj,\n        special, handlers, type, namespaces, origType,\n        elemData = dataPriv.hasData( elem ) && dataPriv.get( elem );\n\n      if ( !elemData || !( events = elemData.events ) ) {\n        return;\n      }\n\n      // Once for each type.namespace in types; type may be omitted\n      types = ( types || \"\" ).match( rnothtmlwhite ) || [ \"\" ];\n      t = types.length;\n      while ( t-- ) {\n        tmp = rtypenamespace.exec( types[ t ] ) || [];\n        type = origType = tmp[ 1 ];\n        namespaces = ( tmp[ 2 ] || \"\" ).split( \".\" ).sort();\n\n        // Unbind all events (on this namespace, if provided) for the element\n        if ( !type ) {\n          for ( type in events ) {\n            jQuery.event.remove( elem, type + types[ t ], handler, selector, true );\n          }\n          continue;\n        }\n\n        special = jQuery.event.special[ type ] || {};\n        type = ( selector ? special.delegateType : special.bindType ) || type;\n        handlers = events[ type ] || [];\n        tmp = tmp[ 2 ] &&\n          new RegExp( \"(^|\\\\.)\" + namespaces.join( \"\\\\.(?:.*\\\\.|)\" ) + \"(\\\\.|$)\" );\n\n        // Remove matching events\n        origCount = j = handlers.length;\n        while ( j-- ) {\n          handleObj = handlers[ j ];\n\n          if ( ( mappedTypes || origType === handleObj.origType ) &&\n            ( !handler || handler.guid === handleObj.guid ) &&\n            ( !tmp || tmp.test( handleObj.namespace ) ) &&\n            ( !selector || selector === handleObj.selector ||\n              selector === \"**\" && handleObj.selector ) ) {\n            handlers.splice( j, 1 );\n\n            if ( handleObj.selector ) {\n              handlers.delegateCount--;\n            }\n            if ( special.remove ) {\n              special.remove.call( elem, handleObj );\n            }\n          }\n        }\n\n        // Remove generic event handler if we removed something and no more handlers exist\n        // (avoids potential for endless recursion during removal of special event handlers)\n        if ( origCount && !handlers.length ) {\n          if ( !special.teardown ||\n            special.teardown.call( elem, namespaces, elemData.handle ) === false ) {\n\n            jQuery.removeEvent( elem, type, elemData.handle );\n          }\n\n          delete events[ type ];\n        }\n      }\n\n      // Remove data and the expando if it's no longer used\n      if ( jQuery.isEmptyObject( events ) ) {\n        dataPriv.remove( elem, \"handle events\" );\n      }\n    },\n\n    dispatch: function( nativeEvent ) {\n\n      var i, j, ret, matched, handleObj, handlerQueue,\n        args = new Array( arguments.length ),\n\n        // Make a writable jQuery.Event from the native event object\n        event = jQuery.event.fix( nativeEvent ),\n\n        handlers = (\n          dataPriv.get( this, \"events\" ) || Object.create( null )\n        )[ event.type ] || [],\n        special = jQuery.event.special[ event.type ] || {};\n\n      // Use the fix-ed jQuery.Event rather than the (read-only) native event\n      args[ 0 ] = event;\n\n      for ( i = 1; i < arguments.length; i++ ) {\n        args[ i ] = arguments[ i ];\n      }\n\n      event.delegateTarget = this;\n\n      // Call the preDispatch hook for the mapped type, and let it bail if desired\n      if ( special.preDispatch && special.preDispatch.call( this, event ) === false ) {\n        return;\n      }\n\n      // Determine handlers\n      handlerQueue = jQuery.event.handlers.call( this, event, handlers );\n\n      // Run delegates first; they may want to stop propagation beneath us\n      i = 0;\n      while ( ( matched = handlerQueue[ i++ ] ) && !event.isPropagationStopped() ) {\n        event.currentTarget = matched.elem;\n\n        j = 0;\n        while ( ( handleObj = matched.handlers[ j++ ] ) &&\n        !event.isImmediatePropagationStopped() ) {\n\n          // If the event is namespaced, then each handler is only invoked if it is\n          // specially universal or its namespaces are a superset of the event's.\n          if ( !event.rnamespace || handleObj.namespace === false ||\n            event.rnamespace.test( handleObj.namespace ) ) {\n\n            event.handleObj = handleObj;\n            event.data = handleObj.data;\n\n            ret = ( ( jQuery.event.special[ handleObj.origType ] || {} ).handle ||\n              handleObj.handler ).apply( matched.elem, args );\n\n            if ( ret !== undefined ) {\n              if ( ( event.result = ret ) === false ) {\n                event.preventDefault();\n                event.stopPropagation();\n              }\n            }\n          }\n        }\n      }\n\n      // Call the postDispatch hook for the mapped type\n      if ( special.postDispatch ) {\n        special.postDispatch.call( this, event );\n      }\n\n      return event.result;\n    },\n\n    handlers: function( event, handlers ) {\n      var i, handleObj, sel, matchedHandlers, matchedSelectors,\n        handlerQueue = [],\n        delegateCount = handlers.delegateCount,\n        cur = event.target;\n\n      // Find delegate handlers\n      if ( delegateCount &&\n\n        // Support: IE <=9\n        // Black-hole SVG <use> instance trees (trac-13180)\n        cur.nodeType &&\n\n        // Support: Firefox <=42\n        // Suppress spec-violating clicks indicating a non-primary pointer button (trac-3861)\n        // https://www.w3.org/TR/DOM-Level-3-Events/#event-type-click\n        // Support: IE 11 only\n        // ...but not arrow key \"clicks\" of radio inputs, which can have `button` -1 (gh-2343)\n        !( event.type === \"click\" && event.button >= 1 ) ) {\n\n        for ( ; cur !== this; cur = cur.parentNode || this ) {\n\n          // Don't check non-elements (#13208)\n          // Don't process clicks on disabled elements (#6911, #8165, #11382, #11764)\n          if ( cur.nodeType === 1 && !( event.type === \"click\" && cur.disabled === true ) ) {\n            matchedHandlers = [];\n            matchedSelectors = {};\n            for ( i = 0; i < delegateCount; i++ ) {\n              handleObj = handlers[ i ];\n\n              // Don't conflict with Object.prototype properties (#13203)\n              sel = handleObj.selector + \" \";\n\n              if ( matchedSelectors[ sel ] === undefined ) {\n                matchedSelectors[ sel ] = handleObj.needsContext ?\n                  jQuery( sel, this ).index( cur ) > -1 :\n                  jQuery.find( sel, this, null, [ cur ] ).length;\n              }\n              if ( matchedSelectors[ sel ] ) {\n                matchedHandlers.push( handleObj );\n              }\n            }\n            if ( matchedHandlers.length ) {\n              handlerQueue.push( { elem: cur, handlers: matchedHandlers } );\n            }\n          }\n        }\n      }\n\n      // Add the remaining (directly-bound) handlers\n      cur = this;\n      if ( delegateCount < handlers.length ) {\n        handlerQueue.push( { elem: cur, handlers: handlers.slice( delegateCount ) } );\n      }\n\n      return handlerQueue;\n    },\n\n    addProp: function( name, hook ) {\n      Object.defineProperty( jQuery.Event.prototype, name, {\n        enumerable: true,\n        configurable: true,\n\n        get: isFunction( hook ) ?\n          function() {\n            if ( this.originalEvent ) {\n              return hook( this.originalEvent );\n            }\n          } :\n          function() {\n            if ( this.originalEvent ) {\n              return this.originalEvent[ name ];\n            }\n          },\n\n        set: function( value ) {\n          Object.defineProperty( this, name, {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: value\n          } );\n        }\n      } );\n    },\n\n    fix: function( originalEvent ) {\n      return originalEvent[ jQuery.expando ] ?\n        originalEvent :\n        new jQuery.Event( originalEvent );\n    },\n\n    special: {\n      load: {\n\n        // Prevent triggered image.load events from bubbling to window.load\n        noBubble: true\n      },\n      click: {\n\n        // Utilize native event to ensure correct state for checkable inputs\n        setup: function( data ) {\n\n          // For mutual compressibility with _default, replace `this` access with a local var.\n          // `|| data` is dead code meant only to preserve the variable through minification.\n          var el = this || data;\n\n          // Claim the first handler\n          if ( rcheckableType.test( el.type ) &&\n            el.click && nodeName( el, \"input\" ) ) {\n\n            // dataPriv.set( el, \"click\", ... )\n            leverageNative( el, \"click\", returnTrue );\n          }\n\n          // Return false to allow normal processing in the caller\n          return false;\n        },\n        trigger: function( data ) {\n\n          // For mutual compressibility with _default, replace `this` access with a local var.\n          // `|| data` is dead code meant only to preserve the variable through minification.\n          var el = this || data;\n\n          // Force setup before triggering a click\n          if ( rcheckableType.test( el.type ) &&\n            el.click && nodeName( el, \"input\" ) ) {\n\n            leverageNative( el, \"click\" );\n          }\n\n          // Return non-false to allow normal event-path propagation\n          return true;\n        },\n\n        // For cross-browser consistency, suppress native .click() on links\n        // Also prevent it if we're currently inside a leveraged native-event stack\n        _default: function( event ) {\n          var target = event.target;\n          return rcheckableType.test( target.type ) &&\n            target.click && nodeName( target, \"input\" ) &&\n            dataPriv.get( target, \"click\" ) ||\n            nodeName( target, \"a\" );\n        }\n      },\n\n      beforeunload: {\n        postDispatch: function( event ) {\n\n          // Support: Firefox 20+\n          // Firefox doesn't alert if the returnValue field is not set.\n          if ( event.result !== undefined && event.originalEvent ) {\n            event.originalEvent.returnValue = event.result;\n          }\n        }\n      }\n    }\n  };\n\n// Ensure the presence of an event listener that handles manually-triggered\n// synthetic events by interrupting progress until reinvoked in response to\n// *native* events that it fires directly, ensuring that state changes have\n// already occurred before other listeners are invoked.\n  function leverageNative( el, type, expectSync ) {\n\n    // Missing expectSync indicates a trigger call, which must force setup through jQuery.event.add\n    if ( !expectSync ) {\n      if ( dataPriv.get( el, type ) === undefined ) {\n        jQuery.event.add( el, type, returnTrue );\n      }\n      return;\n    }\n\n    // Register the controller as a special universal handler for all event namespaces\n    dataPriv.set( el, type, false );\n    jQuery.event.add( el, type, {\n      namespace: false,\n      handler: function( event ) {\n        var notAsync, result,\n          saved = dataPriv.get( this, type );\n\n        if ( ( event.isTrigger & 1 ) && this[ type ] ) {\n\n          // Interrupt processing of the outer synthetic .trigger()ed event\n          // Saved data should be false in such cases, but might be a leftover capture object\n          // from an async native handler (gh-4350)\n          if ( !saved.length ) {\n\n            // Store arguments for use when handling the inner native event\n            // There will always be at least one argument (an event object), so this array\n            // will not be confused with a leftover capture object.\n            saved = slice.call( arguments );\n            dataPriv.set( this, type, saved );\n\n            // Trigger the native event and capture its result\n            // Support: IE <=9 - 11+\n            // focus() and blur() are asynchronous\n            notAsync = expectSync( this, type );\n            this[ type ]();\n            result = dataPriv.get( this, type );\n            if ( saved !== result || notAsync ) {\n              dataPriv.set( this, type, false );\n            } else {\n              result = {};\n            }\n            if ( saved !== result ) {\n\n              // Cancel the outer synthetic event\n              event.stopImmediatePropagation();\n              event.preventDefault();\n              return result.value;\n            }\n\n            // If this is an inner synthetic event for an event with a bubbling surrogate\n            // (focus or blur), assume that the surrogate already propagated from triggering the\n            // native event and prevent that from happening again here.\n            // This technically gets the ordering wrong w.r.t. to `.trigger()` (in which the\n            // bubbling surrogate propagates *after* the non-bubbling base), but that seems\n            // less bad than duplication.\n          } else if ( ( jQuery.event.special[ type ] || {} ).delegateType ) {\n            event.stopPropagation();\n          }\n\n          // If this is a native event triggered above, everything is now in order\n          // Fire an inner synthetic event with the original arguments\n        } else if ( saved.length ) {\n\n          // ...and capture the result\n          dataPriv.set( this, type, {\n            value: jQuery.event.trigger(\n\n              // Support: IE <=9 - 11+\n              // Extend with the prototype to reset the above stopImmediatePropagation()\n              jQuery.extend( saved[ 0 ], jQuery.Event.prototype ),\n              saved.slice( 1 ),\n              this\n            )\n          } );\n\n          // Abort handling of the native event\n          event.stopImmediatePropagation();\n        }\n      }\n    } );\n  }\n\n  jQuery.removeEvent = function( elem, type, handle ) {\n\n    // This \"if\" is needed for plain objects\n    if ( elem.removeEventListener ) {\n      elem.removeEventListener( type, handle );\n    }\n  };\n\n  jQuery.Event = function( src, props ) {\n\n    // Allow instantiation without the 'new' keyword\n    if ( !( this instanceof jQuery.Event ) ) {\n      return new jQuery.Event( src, props );\n    }\n\n    // Event object\n    if ( src && src.type ) {\n      this.originalEvent = src;\n      this.type = src.type;\n\n      // Events bubbling up the document may have been marked as prevented\n      // by a handler lower down the tree; reflect the correct value.\n      this.isDefaultPrevented = src.defaultPrevented ||\n      src.defaultPrevented === undefined &&\n\n      // Support: Android <=2.3 only\n      src.returnValue === false ?\n        returnTrue :\n        returnFalse;\n\n      // Create target properties\n      // Support: Safari <=6 - 7 only\n      // Target should not be a text node (#504, #13143)\n      this.target = ( src.target && src.target.nodeType === 3 ) ?\n        src.target.parentNode :\n        src.target;\n\n      this.currentTarget = src.currentTarget;\n      this.relatedTarget = src.relatedTarget;\n\n      // Event type\n    } else {\n      this.type = src;\n    }\n\n    // Put explicitly provided properties onto the event object\n    if ( props ) {\n      jQuery.extend( this, props );\n    }\n\n    // Create a timestamp if incoming event doesn't have one\n    this.timeStamp = src && src.timeStamp || Date.now();\n\n    // Mark it as fixed\n    this[ jQuery.expando ] = true;\n  };\n\n// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding\n// https://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html\n  jQuery.Event.prototype = {\n    constructor: jQuery.Event,\n    isDefaultPrevented: returnFalse,\n    isPropagationStopped: returnFalse,\n    isImmediatePropagationStopped: returnFalse,\n    isSimulated: false,\n\n    preventDefault: function() {\n      var e = this.originalEvent;\n\n      this.isDefaultPrevented = returnTrue;\n\n      if ( e && !this.isSimulated ) {\n        e.preventDefault();\n      }\n    },\n    stopPropagation: function() {\n      var e = this.originalEvent;\n\n      this.isPropagationStopped = returnTrue;\n\n      if ( e && !this.isSimulated ) {\n        e.stopPropagation();\n      }\n    },\n    stopImmediatePropagation: function() {\n      var e = this.originalEvent;\n\n      this.isImmediatePropagationStopped = returnTrue;\n\n      if ( e && !this.isSimulated ) {\n        e.stopImmediatePropagation();\n      }\n\n      this.stopPropagation();\n    }\n  };\n\n// Includes all common event props including KeyEvent and MouseEvent specific props\n  jQuery.each( {\n    altKey: true,\n    bubbles: true,\n    cancelable: true,\n    changedTouches: true,\n    ctrlKey: true,\n    detail: true,\n    eventPhase: true,\n    metaKey: true,\n    pageX: true,\n    pageY: true,\n    shiftKey: true,\n    view: true,\n    \"char\": true,\n    code: true,\n    charCode: true,\n    key: true,\n    keyCode: true,\n    button: true,\n    buttons: true,\n    clientX: true,\n    clientY: true,\n    offsetX: true,\n    offsetY: true,\n    pointerId: true,\n    pointerType: true,\n    screenX: true,\n    screenY: true,\n    targetTouches: true,\n    toElement: true,\n    touches: true,\n\n    which: function( event ) {\n      var button = event.button;\n\n      // Add which for key events\n      if ( event.which == null && rkeyEvent.test( event.type ) ) {\n        return event.charCode != null ? event.charCode : event.keyCode;\n      }\n\n      // Add which for click: 1 === left; 2 === middle; 3 === right\n      if ( !event.which && button !== undefined && rmouseEvent.test( event.type ) ) {\n        if ( button & 1 ) {\n          return 1;\n        }\n\n        if ( button & 2 ) {\n          return 3;\n        }\n\n        if ( button & 4 ) {\n          return 2;\n        }\n\n        return 0;\n      }\n\n      return event.which;\n    }\n  }, jQuery.event.addProp );\n\n  jQuery.each( { focus: \"focusin\", blur: \"focusout\" }, function( type, delegateType ) {\n    jQuery.event.special[ type ] = {\n\n      // Utilize native event if possible so blur/focus sequence is correct\n      setup: function() {\n\n        // Claim the first handler\n        // dataPriv.set( this, \"focus\", ... )\n        // dataPriv.set( this, \"blur\", ... )\n        leverageNative( this, type, expectSync );\n\n        // Return false to allow normal processing in the caller\n        return false;\n      },\n      trigger: function() {\n\n        // Force setup before trigger\n        leverageNative( this, type );\n\n        // Return non-false to allow normal event-path propagation\n        return true;\n      },\n\n      delegateType: delegateType\n    };\n  } );\n\n// Create mouseenter/leave events using mouseover/out and event-time checks\n// so that event delegation works in jQuery.\n// Do the same for pointerenter/pointerleave and pointerover/pointerout\n//\n// Support: Safari 7 only\n// Safari sends mouseenter too often; see:\n// https://bugs.chromium.org/p/chromium/issues/detail?id=470258\n// for the description of the bug (it existed in older Chrome versions as well).\n  jQuery.each( {\n    mouseenter: \"mouseover\",\n    mouseleave: \"mouseout\",\n    pointerenter: \"pointerover\",\n    pointerleave: \"pointerout\"\n  }, function( orig, fix ) {\n    jQuery.event.special[ orig ] = {\n      delegateType: fix,\n      bindType: fix,\n\n      handle: function( event ) {\n        var ret,\n          target = this,\n          related = event.relatedTarget,\n          handleObj = event.handleObj;\n\n        // For mouseenter/leave call the handler if related is outside the target.\n        // NB: No relatedTarget if the mouse left/entered the browser window\n        if ( !related || ( related !== target && !jQuery.contains( target, related ) ) ) {\n          event.type = handleObj.origType;\n          ret = handleObj.handler.apply( this, arguments );\n          event.type = fix;\n        }\n        return ret;\n      }\n    };\n  } );\n\n  jQuery.fn.extend( {\n\n    on: function( types, selector, data, fn ) {\n      return on( this, types, selector, data, fn );\n    },\n    one: function( types, selector, data, fn ) {\n      return on( this, types, selector, data, fn, 1 );\n    },\n    off: function( types, selector, fn ) {\n      var handleObj, type;\n      if ( types && types.preventDefault && types.handleObj ) {\n\n        // ( event )  dispatched jQuery.Event\n        handleObj = types.handleObj;\n        jQuery( types.delegateTarget ).off(\n          handleObj.namespace ?\n            handleObj.origType + \".\" + handleObj.namespace :\n            handleObj.origType,\n          handleObj.selector,\n          handleObj.handler\n        );\n        return this;\n      }\n      if ( typeof types === \"object\" ) {\n\n        // ( types-object [, selector] )\n        for ( type in types ) {\n          this.off( type, selector, types[ type ] );\n        }\n        return this;\n      }\n      if ( selector === false || typeof selector === \"function\" ) {\n\n        // ( types [, fn] )\n        fn = selector;\n        selector = undefined;\n      }\n      if ( fn === false ) {\n        fn = returnFalse;\n      }\n      return this.each( function() {\n        jQuery.event.remove( this, types, fn, selector );\n      } );\n    }\n  } );\n\n\n  var\n\n    // Support: IE <=10 - 11, Edge 12 - 13 only\n    // In IE/Edge using regex groups here causes severe slowdowns.\n    // See https://connect.microsoft.com/IE/feedback/details/1736512/\n    rnoInnerhtml = /<script|<style|<link/i,\n\n    // checked=\"checked\" or checked\n    rchecked = /checked\\s*(?:[^=]|=\\s*.checked.)/i,\n    rcleanScript = /^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g;\n\n// Prefer a tbody over its parent table for containing new rows\n  function manipulationTarget( elem, content ) {\n    if ( nodeName( elem, \"table\" ) &&\n      nodeName( content.nodeType !== 11 ? content : content.firstChild, \"tr\" ) ) {\n\n      return jQuery( elem ).children( \"tbody\" )[ 0 ] || elem;\n    }\n\n    return elem;\n  }\n\n// Replace/restore the type attribute of script elements for safe DOM manipulation\n  function disableScript( elem ) {\n    elem.type = ( elem.getAttribute( \"type\" ) !== null ) + \"/\" + elem.type;\n    return elem;\n  }\n  function restoreScript( elem ) {\n    if ( ( elem.type || \"\" ).slice( 0, 5 ) === \"true/\" ) {\n      elem.type = elem.type.slice( 5 );\n    } else {\n      elem.removeAttribute( \"type\" );\n    }\n\n    return elem;\n  }\n\n  function cloneCopyEvent( src, dest ) {\n    var i, l, type, pdataOld, udataOld, udataCur, events;\n\n    if ( dest.nodeType !== 1 ) {\n      return;\n    }\n\n    // 1. Copy private data: events, handlers, etc.\n    if ( dataPriv.hasData( src ) ) {\n      pdataOld = dataPriv.get( src );\n      events = pdataOld.events;\n\n      if ( events ) {\n        dataPriv.remove( dest, \"handle events\" );\n\n        for ( type in events ) {\n          for ( i = 0, l = events[ type ].length; i < l; i++ ) {\n            jQuery.event.add( dest, type, events[ type ][ i ] );\n          }\n        }\n      }\n    }\n\n    // 2. Copy user data\n    if ( dataUser.hasData( src ) ) {\n      udataOld = dataUser.access( src );\n      udataCur = jQuery.extend( {}, udataOld );\n\n      dataUser.set( dest, udataCur );\n    }\n  }\n\n// Fix IE bugs, see support tests\n  function fixInput( src, dest ) {\n    var nodeName = dest.nodeName.toLowerCase();\n\n    // Fails to persist the checked state of a cloned checkbox or radio button.\n    if ( nodeName === \"input\" && rcheckableType.test( src.type ) ) {\n      dest.checked = src.checked;\n\n      // Fails to return the selected option to the default selected state when cloning options\n    } else if ( nodeName === \"input\" || nodeName === \"textarea\" ) {\n      dest.defaultValue = src.defaultValue;\n    }\n  }\n\n  function domManip( collection, args, callback, ignored ) {\n\n    // Flatten any nested arrays\n    args = flat( args );\n\n    var fragment, first, scripts, hasScripts, node, doc,\n      i = 0,\n      l = collection.length,\n      iNoClone = l - 1,\n      value = args[ 0 ],\n      valueIsFunction = isFunction( value );\n\n    // We can't cloneNode fragments that contain checked, in WebKit\n    if ( valueIsFunction ||\n      ( l > 1 && typeof value === \"string\" &&\n        !support.checkClone && rchecked.test( value ) ) ) {\n      return collection.each( function( index ) {\n        var self = collection.eq( index );\n        if ( valueIsFunction ) {\n          args[ 0 ] = value.call( this, index, self.html() );\n        }\n        domManip( self, args, callback, ignored );\n      } );\n    }\n\n    if ( l ) {\n      fragment = buildFragment( args, collection[ 0 ].ownerDocument, false, collection, ignored );\n      first = fragment.firstChild;\n\n      if ( fragment.childNodes.length === 1 ) {\n        fragment = first;\n      }\n\n      // Require either new content or an interest in ignored elements to invoke the callback\n      if ( first || ignored ) {\n        scripts = jQuery.map( getAll( fragment, \"script\" ), disableScript );\n        hasScripts = scripts.length;\n\n        // Use the original fragment for the last item\n        // instead of the first because it can end up\n        // being emptied incorrectly in certain situations (#8070).\n        for ( ; i < l; i++ ) {\n          node = fragment;\n\n          if ( i !== iNoClone ) {\n            node = jQuery.clone( node, true, true );\n\n            // Keep references to cloned scripts for later restoration\n            if ( hasScripts ) {\n\n              // Support: Android <=4.0 only, PhantomJS 1 only\n              // push.apply(_, arraylike) throws on ancient WebKit\n              jQuery.merge( scripts, getAll( node, \"script\" ) );\n            }\n          }\n\n          callback.call( collection[ i ], node, i );\n        }\n\n        if ( hasScripts ) {\n          doc = scripts[ scripts.length - 1 ].ownerDocument;\n\n          // Reenable scripts\n          jQuery.map( scripts, restoreScript );\n\n          // Evaluate executable scripts on first document insertion\n          for ( i = 0; i < hasScripts; i++ ) {\n            node = scripts[ i ];\n            if ( rscriptType.test( node.type || \"\" ) &&\n              !dataPriv.access( node, \"globalEval\" ) &&\n              jQuery.contains( doc, node ) ) {\n\n              if ( node.src && ( node.type || \"\" ).toLowerCase()  !== \"module\" ) {\n\n                // Optional AJAX dependency, but won't run scripts if not present\n                if ( jQuery._evalUrl && !node.noModule ) {\n                  jQuery._evalUrl( node.src, {\n                    nonce: node.nonce || node.getAttribute( \"nonce\" )\n                  }, doc );\n                }\n              } else {\n                DOMEval( node.textContent.replace( rcleanScript, \"\" ), node, doc );\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return collection;\n  }\n\n  function remove( elem, selector, keepData ) {\n    var node,\n      nodes = selector ? jQuery.filter( selector, elem ) : elem,\n      i = 0;\n\n    for ( ; ( node = nodes[ i ] ) != null; i++ ) {\n      if ( !keepData && node.nodeType === 1 ) {\n        jQuery.cleanData( getAll( node ) );\n      }\n\n      if ( node.parentNode ) {\n        if ( keepData && isAttached( node ) ) {\n          setGlobalEval( getAll( node, \"script\" ) );\n        }\n        node.parentNode.removeChild( node );\n      }\n    }\n\n    return elem;\n  }\n\n  jQuery.extend( {\n    htmlPrefilter: function( html ) {\n      return html;\n    },\n\n    clone: function( elem, dataAndEvents, deepDataAndEvents ) {\n      var i, l, srcElements, destElements,\n        clone = elem.cloneNode( true ),\n        inPage = isAttached( elem );\n\n      // Fix IE cloning issues\n      if ( !support.noCloneChecked && ( elem.nodeType === 1 || elem.nodeType === 11 ) &&\n        !jQuery.isXMLDoc( elem ) ) {\n\n        // We eschew Sizzle here for performance reasons: https://jsperf.com/getall-vs-sizzle/2\n        destElements = getAll( clone );\n        srcElements = getAll( elem );\n\n        for ( i = 0, l = srcElements.length; i < l; i++ ) {\n          fixInput( srcElements[ i ], destElements[ i ] );\n        }\n      }\n\n      // Copy the events from the original to the clone\n      if ( dataAndEvents ) {\n        if ( deepDataAndEvents ) {\n          srcElements = srcElements || getAll( elem );\n          destElements = destElements || getAll( clone );\n\n          for ( i = 0, l = srcElements.length; i < l; i++ ) {\n            cloneCopyEvent( srcElements[ i ], destElements[ i ] );\n          }\n        } else {\n          cloneCopyEvent( elem, clone );\n        }\n      }\n\n      // Preserve script evaluation history\n      destElements = getAll( clone, \"script\" );\n      if ( destElements.length > 0 ) {\n        setGlobalEval( destElements, !inPage && getAll( elem, \"script\" ) );\n      }\n\n      // Return the cloned set\n      return clone;\n    },\n\n    cleanData: function( elems ) {\n      var data, elem, type,\n        special = jQuery.event.special,\n        i = 0;\n\n      for ( ; ( elem = elems[ i ] ) !== undefined; i++ ) {\n        if ( acceptData( elem ) ) {\n          if ( ( data = elem[ dataPriv.expando ] ) ) {\n            if ( data.events ) {\n              for ( type in data.events ) {\n                if ( special[ type ] ) {\n                  jQuery.event.remove( elem, type );\n\n                  // This is a shortcut to avoid jQuery.event.remove's overhead\n                } else {\n                  jQuery.removeEvent( elem, type, data.handle );\n                }\n              }\n            }\n\n            // Support: Chrome <=35 - 45+\n            // Assign undefined instead of using delete, see Data#remove\n            elem[ dataPriv.expando ] = undefined;\n          }\n          if ( elem[ dataUser.expando ] ) {\n\n            // Support: Chrome <=35 - 45+\n            // Assign undefined instead of using delete, see Data#remove\n            elem[ dataUser.expando ] = undefined;\n          }\n        }\n      }\n    }\n  } );\n\n  jQuery.fn.extend( {\n    detach: function( selector ) {\n      return remove( this, selector, true );\n    },\n\n    remove: function( selector ) {\n      return remove( this, selector );\n    },\n\n    text: function( value ) {\n      return access( this, function( value ) {\n        return value === undefined ?\n          jQuery.text( this ) :\n          this.empty().each( function() {\n            if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\n              this.textContent = value;\n            }\n          } );\n      }, null, value, arguments.length );\n    },\n\n    append: function() {\n      return domManip( this, arguments, function( elem ) {\n        if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\n          var target = manipulationTarget( this, elem );\n          target.appendChild( elem );\n        }\n      } );\n    },\n\n    prepend: function() {\n      return domManip( this, arguments, function( elem ) {\n        if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {\n          var target = manipulationTarget( this, elem );\n          target.insertBefore( elem, target.firstChild );\n        }\n      } );\n    },\n\n    before: function() {\n      return domManip( this, arguments, function( elem ) {\n        if ( this.parentNode ) {\n          this.parentNode.insertBefore( elem, this );\n        }\n      } );\n    },\n\n    after: function() {\n      return domManip( this, arguments, function( elem ) {\n        if ( this.parentNode ) {\n          this.parentNode.insertBefore( elem, this.nextSibling );\n        }\n      } );\n    },\n\n    empty: function() {\n      var elem,\n        i = 0;\n\n      for ( ; ( elem = this[ i ] ) != null; i++ ) {\n        if ( elem.nodeType === 1 ) {\n\n          // Prevent memory leaks\n          jQuery.cleanData( getAll( elem, false ) );\n\n          // Remove any remaining nodes\n          elem.textContent = \"\";\n        }\n      }\n\n      return this;\n    },\n\n    clone: function( dataAndEvents, deepDataAndEvents ) {\n      dataAndEvents = dataAndEvents == null ? false : dataAndEvents;\n      deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;\n\n      return this.map( function() {\n        return jQuery.clone( this, dataAndEvents, deepDataAndEvents );\n      } );\n    },\n\n    html: function( value ) {\n      return access( this, function( value ) {\n        var elem = this[ 0 ] || {},\n          i = 0,\n          l = this.length;\n\n        if ( value === undefined && elem.nodeType === 1 ) {\n          return elem.innerHTML;\n        }\n\n        // See if we can take a shortcut and just use innerHTML\n        if ( typeof value === \"string\" && !rnoInnerhtml.test( value ) &&\n          !wrapMap[ ( rtagName.exec( value ) || [ \"\", \"\" ] )[ 1 ].toLowerCase() ] ) {\n\n          value = jQuery.htmlPrefilter( value );\n\n          try {\n            for ( ; i < l; i++ ) {\n              elem = this[ i ] || {};\n\n              // Remove element nodes and prevent memory leaks\n              if ( elem.nodeType === 1 ) {\n                jQuery.cleanData( getAll( elem, false ) );\n                elem.innerHTML = value;\n              }\n            }\n\n            elem = 0;\n\n            // If using innerHTML throws an exception, use the fallback method\n          } catch ( e ) {}\n        }\n\n        if ( elem ) {\n          this.empty().append( value );\n        }\n      }, null, value, arguments.length );\n    },\n\n    replaceWith: function() {\n      var ignored = [];\n\n      // Make the changes, replacing each non-ignored context element with the new content\n      return domManip( this, arguments, function( elem ) {\n        var parent = this.parentNode;\n\n        if ( jQuery.inArray( this, ignored ) < 0 ) {\n          jQuery.cleanData( getAll( this ) );\n          if ( parent ) {\n            parent.replaceChild( elem, this );\n          }\n        }\n\n        // Force callback invocation\n      }, ignored );\n    }\n  } );\n\n  jQuery.each( {\n    appendTo: \"append\",\n    prependTo: \"prepend\",\n    insertBefore: \"before\",\n    insertAfter: \"after\",\n    replaceAll: \"replaceWith\"\n  }, function( name, original ) {\n    jQuery.fn[ name ] = function( selector ) {\n      var elems,\n        ret = [],\n        insert = jQuery( selector ),\n        last = insert.length - 1,\n        i = 0;\n\n      for ( ; i <= last; i++ ) {\n        elems = i === last ? this : this.clone( true );\n        jQuery( insert[ i ] )[ original ]( elems );\n\n        // Support: Android <=4.0 only, PhantomJS 1 only\n        // .get() because push.apply(_, arraylike) throws on ancient WebKit\n        push.apply( ret, elems.get() );\n      }\n\n      return this.pushStack( ret );\n    };\n  } );\n  var rnumnonpx = new RegExp( \"^(\" + pnum + \")(?!px)[a-z%]+$\", \"i\" );\n\n  var getStyles = function( elem ) {\n\n    // Support: IE <=11 only, Firefox <=30 (#15098, #14150)\n    // IE throws on elements created in popups\n    // FF meanwhile throws on frame elements through \"defaultView.getComputedStyle\"\n    var view = elem.ownerDocument.defaultView;\n\n    if ( !view || !view.opener ) {\n      view = window;\n    }\n\n    return view.getComputedStyle( elem );\n  };\n\n  var swap = function( elem, options, callback ) {\n    var ret, name,\n      old = {};\n\n    // Remember the old values, and insert the new ones\n    for ( name in options ) {\n      old[ name ] = elem.style[ name ];\n      elem.style[ name ] = options[ name ];\n    }\n\n    ret = callback.call( elem );\n\n    // Revert the old values\n    for ( name in options ) {\n      elem.style[ name ] = old[ name ];\n    }\n\n    return ret;\n  };\n\n\n  var rboxStyle = new RegExp( cssExpand.join( \"|\" ), \"i\" );\n\n\n\n  ( function() {\n\n    // Executing both pixelPosition & boxSizingReliable tests require only one layout\n    // so they're executed at the same time to save the second computation.\n    function computeStyleTests() {\n\n      // This is a singleton, we need to execute it only once\n      if ( !div ) {\n        return;\n      }\n\n      container.style.cssText = \"position:absolute;left:-11111px;width:60px;\" +\n        \"margin-top:1px;padding:0;border:0\";\n      div.style.cssText =\n        \"position:relative;display:block;box-sizing:border-box;overflow:scroll;\" +\n        \"margin:auto;border:1px;padding:1px;\" +\n        \"width:60%;top:1%\";\n      documentElement.appendChild( container ).appendChild( div );\n\n      var divStyle = window.getComputedStyle( div );\n      pixelPositionVal = divStyle.top !== \"1%\";\n\n      // Support: Android 4.0 - 4.3 only, Firefox <=3 - 44\n      reliableMarginLeftVal = roundPixelMeasures( divStyle.marginLeft ) === 12;\n\n      // Support: Android 4.0 - 4.3 only, Safari <=9.1 - 10.1, iOS <=7.0 - 9.3\n      // Some styles come back with percentage values, even though they shouldn't\n      div.style.right = \"60%\";\n      pixelBoxStylesVal = roundPixelMeasures( divStyle.right ) === 36;\n\n      // Support: IE 9 - 11 only\n      // Detect misreporting of content dimensions for box-sizing:border-box elements\n      boxSizingReliableVal = roundPixelMeasures( divStyle.width ) === 36;\n\n      // Support: IE 9 only\n      // Detect overflow:scroll screwiness (gh-3699)\n      // Support: Chrome <=64\n      // Don't get tricked when zoom affects offsetWidth (gh-4029)\n      div.style.position = \"absolute\";\n      scrollboxSizeVal = roundPixelMeasures( div.offsetWidth / 3 ) === 12;\n\n      documentElement.removeChild( container );\n\n      // Nullify the div so it wouldn't be stored in the memory and\n      // it will also be a sign that checks already performed\n      div = null;\n    }\n\n    function roundPixelMeasures( measure ) {\n      return Math.round( parseFloat( measure ) );\n    }\n\n    var pixelPositionVal, boxSizingReliableVal, scrollboxSizeVal, pixelBoxStylesVal,\n      reliableTrDimensionsVal, reliableMarginLeftVal,\n      container = document.createElement( \"div\" ),\n      div = document.createElement( \"div\" );\n\n    // Finish early in limited (non-browser) environments\n    if ( !div.style ) {\n      return;\n    }\n\n    // Support: IE <=9 - 11 only\n    // Style of cloned element affects source element cloned (#8908)\n    div.style.backgroundClip = \"content-box\";\n    div.cloneNode( true ).style.backgroundClip = \"\";\n    support.clearCloneStyle = div.style.backgroundClip === \"content-box\";\n\n    jQuery.extend( support, {\n      boxSizingReliable: function() {\n        computeStyleTests();\n        return boxSizingReliableVal;\n      },\n      pixelBoxStyles: function() {\n        computeStyleTests();\n        return pixelBoxStylesVal;\n      },\n      pixelPosition: function() {\n        computeStyleTests();\n        return pixelPositionVal;\n      },\n      reliableMarginLeft: function() {\n        computeStyleTests();\n        return reliableMarginLeftVal;\n      },\n      scrollboxSize: function() {\n        computeStyleTests();\n        return scrollboxSizeVal;\n      },\n\n      // Support: IE 9 - 11+, Edge 15 - 18+\n      // IE/Edge misreport `getComputedStyle` of table rows with width/height\n      // set in CSS while `offset*` properties report correct values.\n      // Behavior in IE 9 is more subtle than in newer versions & it passes\n      // some versions of this test; make sure not to make it pass there!\n      reliableTrDimensions: function() {\n        var table, tr, trChild, trStyle;\n        if ( reliableTrDimensionsVal == null ) {\n          table = document.createElement( \"table\" );\n          tr = document.createElement( \"tr\" );\n          trChild = document.createElement( \"div\" );\n\n          table.style.cssText = \"position:absolute;left:-11111px\";\n          tr.style.height = \"1px\";\n          trChild.style.height = \"9px\";\n\n          documentElement\n            .appendChild( table )\n            .appendChild( tr )\n            .appendChild( trChild );\n\n          trStyle = window.getComputedStyle( tr );\n          reliableTrDimensionsVal = parseInt( trStyle.height ) > 3;\n\n          documentElement.removeChild( table );\n        }\n        return reliableTrDimensionsVal;\n      }\n    } );\n  } )();\n\n\n  function curCSS( elem, name, computed ) {\n    var width, minWidth, maxWidth, ret,\n\n      // Support: Firefox 51+\n      // Retrieving style before computed somehow\n      // fixes an issue with getting wrong values\n      // on detached elements\n      style = elem.style;\n\n    computed = computed || getStyles( elem );\n\n    // getPropertyValue is needed for:\n    //   .css('filter') (IE 9 only, #12537)\n    //   .css('--customProperty) (#3144)\n    if ( computed ) {\n      ret = computed.getPropertyValue( name ) || computed[ name ];\n\n      if ( ret === \"\" && !isAttached( elem ) ) {\n        ret = jQuery.style( elem, name );\n      }\n\n      // A tribute to the \"awesome hack by Dean Edwards\"\n      // Android Browser returns percentage for some values,\n      // but width seems to be reliably pixels.\n      // This is against the CSSOM draft spec:\n      // https://drafts.csswg.org/cssom/#resolved-values\n      if ( !support.pixelBoxStyles() && rnumnonpx.test( ret ) && rboxStyle.test( name ) ) {\n\n        // Remember the original values\n        width = style.width;\n        minWidth = style.minWidth;\n        maxWidth = style.maxWidth;\n\n        // Put in the new values to get a computed value out\n        style.minWidth = style.maxWidth = style.width = ret;\n        ret = computed.width;\n\n        // Revert the changed values\n        style.width = width;\n        style.minWidth = minWidth;\n        style.maxWidth = maxWidth;\n      }\n    }\n\n    return ret !== undefined ?\n\n      // Support: IE <=9 - 11 only\n      // IE returns zIndex value as an integer.\n      ret + \"\" :\n      ret;\n  }\n\n\n  function addGetHookIf( conditionFn, hookFn ) {\n\n    // Define the hook, we'll check on the first run if it's really needed.\n    return {\n      get: function() {\n        if ( conditionFn() ) {\n\n          // Hook not needed (or it's not possible to use it due\n          // to missing dependency), remove it.\n          delete this.get;\n          return;\n        }\n\n        // Hook needed; redefine it so that the support test is not executed again.\n        return ( this.get = hookFn ).apply( this, arguments );\n      }\n    };\n  }\n\n\n  var cssPrefixes = [ \"Webkit\", \"Moz\", \"ms\" ],\n    emptyStyle = document.createElement( \"div\" ).style,\n    vendorProps = {};\n\n// Return a vendor-prefixed property or undefined\n  function vendorPropName( name ) {\n\n    // Check for vendor prefixed names\n    var capName = name[ 0 ].toUpperCase() + name.slice( 1 ),\n      i = cssPrefixes.length;\n\n    while ( i-- ) {\n      name = cssPrefixes[ i ] + capName;\n      if ( name in emptyStyle ) {\n        return name;\n      }\n    }\n  }\n\n// Return a potentially-mapped jQuery.cssProps or vendor prefixed property\n  function finalPropName( name ) {\n    var final = jQuery.cssProps[ name ] || vendorProps[ name ];\n\n    if ( final ) {\n      return final;\n    }\n    if ( name in emptyStyle ) {\n      return name;\n    }\n    return vendorProps[ name ] = vendorPropName( name ) || name;\n  }\n\n\n  var\n\n    // Swappable if display is none or starts with table\n    // except \"table\", \"table-cell\", or \"table-caption\"\n    // See here for display values: https://developer.mozilla.org/en-US/docs/CSS/display\n    rdisplayswap = /^(none|table(?!-c[ea]).+)/,\n    rcustomProp = /^--/,\n    cssShow = { position: \"absolute\", visibility: \"hidden\", display: \"block\" },\n    cssNormalTransform = {\n      letterSpacing: \"0\",\n      fontWeight: \"400\"\n    };\n\n  function setPositiveNumber( _elem, value, subtract ) {\n\n    // Any relative (+/-) values have already been\n    // normalized at this point\n    var matches = rcssNum.exec( value );\n    return matches ?\n\n      // Guard against undefined \"subtract\", e.g., when used as in cssHooks\n      Math.max( 0, matches[ 2 ] - ( subtract || 0 ) ) + ( matches[ 3 ] || \"px\" ) :\n      value;\n  }\n\n  function boxModelAdjustment( elem, dimension, box, isBorderBox, styles, computedVal ) {\n    var i = dimension === \"width\" ? 1 : 0,\n      extra = 0,\n      delta = 0;\n\n    // Adjustment may not be necessary\n    if ( box === ( isBorderBox ? \"border\" : \"content\" ) ) {\n      return 0;\n    }\n\n    for ( ; i < 4; i += 2 ) {\n\n      // Both box models exclude margin\n      if ( box === \"margin\" ) {\n        delta += jQuery.css( elem, box + cssExpand[ i ], true, styles );\n      }\n\n      // If we get here with a content-box, we're seeking \"padding\" or \"border\" or \"margin\"\n      if ( !isBorderBox ) {\n\n        // Add padding\n        delta += jQuery.css( elem, \"padding\" + cssExpand[ i ], true, styles );\n\n        // For \"border\" or \"margin\", add border\n        if ( box !== \"padding\" ) {\n          delta += jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\n\n          // But still keep track of it otherwise\n        } else {\n          extra += jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\n        }\n\n        // If we get here with a border-box (content + padding + border), we're seeking \"content\" or\n        // \"padding\" or \"margin\"\n      } else {\n\n        // For \"content\", subtract padding\n        if ( box === \"content\" ) {\n          delta -= jQuery.css( elem, \"padding\" + cssExpand[ i ], true, styles );\n        }\n\n        // For \"content\" or \"padding\", subtract border\n        if ( box !== \"margin\" ) {\n          delta -= jQuery.css( elem, \"border\" + cssExpand[ i ] + \"Width\", true, styles );\n        }\n      }\n    }\n\n    // Account for positive content-box scroll gutter when requested by providing computedVal\n    if ( !isBorderBox && computedVal >= 0 ) {\n\n      // offsetWidth/offsetHeight is a rounded sum of content, padding, scroll gutter, and border\n      // Assuming integer scroll gutter, subtract the rest and round down\n      delta += Math.max( 0, Math.ceil(\n        elem[ \"offset\" + dimension[ 0 ].toUpperCase() + dimension.slice( 1 ) ] -\n        computedVal -\n        delta -\n        extra -\n        0.5\n\n        // If offsetWidth/offsetHeight is unknown, then we can't determine content-box scroll gutter\n        // Use an explicit zero to avoid NaN (gh-3964)\n      ) ) || 0;\n    }\n\n    return delta;\n  }\n\n  function getWidthOrHeight( elem, dimension, extra ) {\n\n    // Start with computed style\n    var styles = getStyles( elem ),\n\n      // To avoid forcing a reflow, only fetch boxSizing if we need it (gh-4322).\n      // Fake content-box until we know it's needed to know the true value.\n      boxSizingNeeded = !support.boxSizingReliable() || extra,\n      isBorderBox = boxSizingNeeded &&\n        jQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\",\n      valueIsBorderBox = isBorderBox,\n\n      val = curCSS( elem, dimension, styles ),\n      offsetProp = \"offset\" + dimension[ 0 ].toUpperCase() + dimension.slice( 1 );\n\n    // Support: Firefox <=54\n    // Return a confounding non-pixel value or feign ignorance, as appropriate.\n    if ( rnumnonpx.test( val ) ) {\n      if ( !extra ) {\n        return val;\n      }\n      val = \"auto\";\n    }\n\n\n    // Support: IE 9 - 11 only\n    // Use offsetWidth/offsetHeight for when box sizing is unreliable.\n    // In those cases, the computed value can be trusted to be border-box.\n    if ( ( !support.boxSizingReliable() && isBorderBox ||\n\n        // Support: IE 10 - 11+, Edge 15 - 18+\n        // IE/Edge misreport `getComputedStyle` of table rows with width/height\n        // set in CSS while `offset*` properties report correct values.\n        // Interestingly, in some cases IE 9 doesn't suffer from this issue.\n        !support.reliableTrDimensions() && nodeName( elem, \"tr\" ) ||\n\n        // Fall back to offsetWidth/offsetHeight when value is \"auto\"\n        // This happens for inline elements with no explicit setting (gh-3571)\n        val === \"auto\" ||\n\n        // Support: Android <=4.1 - 4.3 only\n        // Also use offsetWidth/offsetHeight for misreported inline dimensions (gh-3602)\n        !parseFloat( val ) && jQuery.css( elem, \"display\", false, styles ) === \"inline\" ) &&\n\n      // Make sure the element is visible & connected\n      elem.getClientRects().length ) {\n\n      isBorderBox = jQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\";\n\n      // Where available, offsetWidth/offsetHeight approximate border box dimensions.\n      // Where not available (e.g., SVG), assume unreliable box-sizing and interpret the\n      // retrieved value as a content box dimension.\n      valueIsBorderBox = offsetProp in elem;\n      if ( valueIsBorderBox ) {\n        val = elem[ offsetProp ];\n      }\n    }\n\n    // Normalize \"\" and auto\n    val = parseFloat( val ) || 0;\n\n    // Adjust for the element's box model\n    return ( val +\n      boxModelAdjustment(\n        elem,\n        dimension,\n        extra || ( isBorderBox ? \"border\" : \"content\" ),\n        valueIsBorderBox,\n        styles,\n\n        // Provide the current computed size to request scroll gutter calculation (gh-3589)\n        val\n      )\n    ) + \"px\";\n  }\n\n  jQuery.extend( {\n\n    // Add in style property hooks for overriding the default\n    // behavior of getting and setting a style property\n    cssHooks: {\n      opacity: {\n        get: function( elem, computed ) {\n          if ( computed ) {\n\n            // We should always get a number back from opacity\n            var ret = curCSS( elem, \"opacity\" );\n            return ret === \"\" ? \"1\" : ret;\n          }\n        }\n      }\n    },\n\n    // Don't automatically add \"px\" to these possibly-unitless properties\n    cssNumber: {\n      \"animationIterationCount\": true,\n      \"columnCount\": true,\n      \"fillOpacity\": true,\n      \"flexGrow\": true,\n      \"flexShrink\": true,\n      \"fontWeight\": true,\n      \"gridArea\": true,\n      \"gridColumn\": true,\n      \"gridColumnEnd\": true,\n      \"gridColumnStart\": true,\n      \"gridRow\": true,\n      \"gridRowEnd\": true,\n      \"gridRowStart\": true,\n      \"lineHeight\": true,\n      \"opacity\": true,\n      \"order\": true,\n      \"orphans\": true,\n      \"widows\": true,\n      \"zIndex\": true,\n      \"zoom\": true\n    },\n\n    // Add in properties whose names you wish to fix before\n    // setting or getting the value\n    cssProps: {},\n\n    // Get and set the style property on a DOM Node\n    style: function( elem, name, value, extra ) {\n\n      // Don't set styles on text and comment nodes\n      if ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {\n        return;\n      }\n\n      // Make sure that we're working with the right name\n      var ret, type, hooks,\n        origName = camelCase( name ),\n        isCustomProp = rcustomProp.test( name ),\n        style = elem.style;\n\n      // Make sure that we're working with the right name. We don't\n      // want to query the value if it is a CSS custom property\n      // since they are user-defined.\n      if ( !isCustomProp ) {\n        name = finalPropName( origName );\n      }\n\n      // Gets hook for the prefixed version, then unprefixed version\n      hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];\n\n      // Check if we're setting a value\n      if ( value !== undefined ) {\n        type = typeof value;\n\n        // Convert \"+=\" or \"-=\" to relative numbers (#7345)\n        if ( type === \"string\" && ( ret = rcssNum.exec( value ) ) && ret[ 1 ] ) {\n          value = adjustCSS( elem, name, ret );\n\n          // Fixes bug #9237\n          type = \"number\";\n        }\n\n        // Make sure that null and NaN values aren't set (#7116)\n        if ( value == null || value !== value ) {\n          return;\n        }\n\n        // If a number was passed in, add the unit (except for certain CSS properties)\n        // The isCustomProp check can be removed in jQuery 4.0 when we only auto-append\n        // \"px\" to a few hardcoded values.\n        if ( type === \"number\" && !isCustomProp ) {\n          value += ret && ret[ 3 ] || ( jQuery.cssNumber[ origName ] ? \"\" : \"px\" );\n        }\n\n        // background-* props affect original clone's values\n        if ( !support.clearCloneStyle && value === \"\" && name.indexOf( \"background\" ) === 0 ) {\n          style[ name ] = \"inherit\";\n        }\n\n        // If a hook was provided, use that value, otherwise just set the specified value\n        if ( !hooks || !( \"set\" in hooks ) ||\n          ( value = hooks.set( elem, value, extra ) ) !== undefined ) {\n\n          if ( isCustomProp ) {\n            style.setProperty( name, value );\n          } else {\n            style[ name ] = value;\n          }\n        }\n\n      } else {\n\n        // If a hook was provided get the non-computed value from there\n        if ( hooks && \"get\" in hooks &&\n          ( ret = hooks.get( elem, false, extra ) ) !== undefined ) {\n\n          return ret;\n        }\n\n        // Otherwise just get the value from the style object\n        return style[ name ];\n      }\n    },\n\n    css: function( elem, name, extra, styles ) {\n      var val, num, hooks,\n        origName = camelCase( name ),\n        isCustomProp = rcustomProp.test( name );\n\n      // Make sure that we're working with the right name. We don't\n      // want to modify the value if it is a CSS custom property\n      // since they are user-defined.\n      if ( !isCustomProp ) {\n        name = finalPropName( origName );\n      }\n\n      // Try prefixed name followed by the unprefixed name\n      hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];\n\n      // If a hook was provided get the computed value from there\n      if ( hooks && \"get\" in hooks ) {\n        val = hooks.get( elem, true, extra );\n      }\n\n      // Otherwise, if a way to get the computed value exists, use that\n      if ( val === undefined ) {\n        val = curCSS( elem, name, styles );\n      }\n\n      // Convert \"normal\" to computed value\n      if ( val === \"normal\" && name in cssNormalTransform ) {\n        val = cssNormalTransform[ name ];\n      }\n\n      // Make numeric if forced or a qualifier was provided and val looks numeric\n      if ( extra === \"\" || extra ) {\n        num = parseFloat( val );\n        return extra === true || isFinite( num ) ? num || 0 : val;\n      }\n\n      return val;\n    }\n  } );\n\n  jQuery.each( [ \"height\", \"width\" ], function( _i, dimension ) {\n    jQuery.cssHooks[ dimension ] = {\n      get: function( elem, computed, extra ) {\n        if ( computed ) {\n\n          // Certain elements can have dimension info if we invisibly show them\n          // but it must have a current display style that would benefit\n          return rdisplayswap.test( jQuery.css( elem, \"display\" ) ) &&\n\n          // Support: Safari 8+\n          // Table columns in Safari have non-zero offsetWidth & zero\n          // getBoundingClientRect().width unless display is changed.\n          // Support: IE <=11 only\n          // Running getBoundingClientRect on a disconnected node\n          // in IE throws an error.\n          ( !elem.getClientRects().length || !elem.getBoundingClientRect().width ) ?\n            swap( elem, cssShow, function() {\n              return getWidthOrHeight( elem, dimension, extra );\n            } ) :\n            getWidthOrHeight( elem, dimension, extra );\n        }\n      },\n\n      set: function( elem, value, extra ) {\n        var matches,\n          styles = getStyles( elem ),\n\n          // Only read styles.position if the test has a chance to fail\n          // to avoid forcing a reflow.\n          scrollboxSizeBuggy = !support.scrollboxSize() &&\n            styles.position === \"absolute\",\n\n          // To avoid forcing a reflow, only fetch boxSizing if we need it (gh-3991)\n          boxSizingNeeded = scrollboxSizeBuggy || extra,\n          isBorderBox = boxSizingNeeded &&\n            jQuery.css( elem, \"boxSizing\", false, styles ) === \"border-box\",\n          subtract = extra ?\n            boxModelAdjustment(\n              elem,\n              dimension,\n              extra,\n              isBorderBox,\n              styles\n            ) :\n            0;\n\n        // Account for unreliable border-box dimensions by comparing offset* to computed and\n        // faking a content-box to get border and padding (gh-3699)\n        if ( isBorderBox && scrollboxSizeBuggy ) {\n          subtract -= Math.ceil(\n            elem[ \"offset\" + dimension[ 0 ].toUpperCase() + dimension.slice( 1 ) ] -\n            parseFloat( styles[ dimension ] ) -\n            boxModelAdjustment( elem, dimension, \"border\", false, styles ) -\n            0.5\n          );\n        }\n\n        // Convert to pixels if value adjustment is needed\n        if ( subtract && ( matches = rcssNum.exec( value ) ) &&\n          ( matches[ 3 ] || \"px\" ) !== \"px\" ) {\n\n          elem.style[ dimension ] = value;\n          value = jQuery.css( elem, dimension );\n        }\n\n        return setPositiveNumber( elem, value, subtract );\n      }\n    };\n  } );\n\n  jQuery.cssHooks.marginLeft = addGetHookIf( support.reliableMarginLeft,\n    function( elem, computed ) {\n      if ( computed ) {\n        return ( parseFloat( curCSS( elem, \"marginLeft\" ) ) ||\n          elem.getBoundingClientRect().left -\n          swap( elem, { marginLeft: 0 }, function() {\n            return elem.getBoundingClientRect().left;\n          } )\n        ) + \"px\";\n      }\n    }\n  );\n\n// These hooks are used by animate to expand properties\n  jQuery.each( {\n    margin: \"\",\n    padding: \"\",\n    border: \"Width\"\n  }, function( prefix, suffix ) {\n    jQuery.cssHooks[ prefix + suffix ] = {\n      expand: function( value ) {\n        var i = 0,\n          expanded = {},\n\n          // Assumes a single number if not a string\n          parts = typeof value === \"string\" ? value.split( \" \" ) : [ value ];\n\n        for ( ; i < 4; i++ ) {\n          expanded[ prefix + cssExpand[ i ] + suffix ] =\n            parts[ i ] || parts[ i - 2 ] || parts[ 0 ];\n        }\n\n        return expanded;\n      }\n    };\n\n    if ( prefix !== \"margin\" ) {\n      jQuery.cssHooks[ prefix + suffix ].set = setPositiveNumber;\n    }\n  } );\n\n  jQuery.fn.extend( {\n    css: function( name, value ) {\n      return access( this, function( elem, name, value ) {\n        var styles, len,\n          map = {},\n          i = 0;\n\n        if ( Array.isArray( name ) ) {\n          styles = getStyles( elem );\n          len = name.length;\n\n          for ( ; i < len; i++ ) {\n            map[ name[ i ] ] = jQuery.css( elem, name[ i ], false, styles );\n          }\n\n          return map;\n        }\n\n        return value !== undefined ?\n          jQuery.style( elem, name, value ) :\n          jQuery.css( elem, name );\n      }, name, value, arguments.length > 1 );\n    }\n  } );\n\n\n  function Tween( elem, options, prop, end, easing ) {\n    return new Tween.prototype.init( elem, options, prop, end, easing );\n  }\n  jQuery.Tween = Tween;\n\n  Tween.prototype = {\n    constructor: Tween,\n    init: function( elem, options, prop, end, easing, unit ) {\n      this.elem = elem;\n      this.prop = prop;\n      this.easing = easing || jQuery.easing._default;\n      this.options = options;\n      this.start = this.now = this.cur();\n      this.end = end;\n      this.unit = unit || ( jQuery.cssNumber[ prop ] ? \"\" : \"px\" );\n    },\n    cur: function() {\n      var hooks = Tween.propHooks[ this.prop ];\n\n      return hooks && hooks.get ?\n        hooks.get( this ) :\n        Tween.propHooks._default.get( this );\n    },\n    run: function( percent ) {\n      var eased,\n        hooks = Tween.propHooks[ this.prop ];\n\n      if ( this.options.duration ) {\n        this.pos = eased = jQuery.easing[ this.easing ](\n          percent, this.options.duration * percent, 0, 1, this.options.duration\n        );\n      } else {\n        this.pos = eased = percent;\n      }\n      this.now = ( this.end - this.start ) * eased + this.start;\n\n      if ( this.options.step ) {\n        this.options.step.call( this.elem, this.now, this );\n      }\n\n      if ( hooks && hooks.set ) {\n        hooks.set( this );\n      } else {\n        Tween.propHooks._default.set( this );\n      }\n      return this;\n    }\n  };\n\n  Tween.prototype.init.prototype = Tween.prototype;\n\n  Tween.propHooks = {\n    _default: {\n      get: function( tween ) {\n        var result;\n\n        // Use a property on the element directly when it is not a DOM element,\n        // or when there is no matching style property that exists.\n        if ( tween.elem.nodeType !== 1 ||\n          tween.elem[ tween.prop ] != null && tween.elem.style[ tween.prop ] == null ) {\n          return tween.elem[ tween.prop ];\n        }\n\n        // Passing an empty string as a 3rd parameter to .css will automatically\n        // attempt a parseFloat and fallback to a string if the parse fails.\n        // Simple values such as \"10px\" are parsed to Float;\n        // complex values such as \"rotate(1rad)\" are returned as-is.\n        result = jQuery.css( tween.elem, tween.prop, \"\" );\n\n        // Empty strings, null, undefined and \"auto\" are converted to 0.\n        return !result || result === \"auto\" ? 0 : result;\n      },\n      set: function( tween ) {\n\n        // Use step hook for back compat.\n        // Use cssHook if its there.\n        // Use .style if available and use plain properties where available.\n        if ( jQuery.fx.step[ tween.prop ] ) {\n          jQuery.fx.step[ tween.prop ]( tween );\n        } else if ( tween.elem.nodeType === 1 && (\n          jQuery.cssHooks[ tween.prop ] ||\n          tween.elem.style[ finalPropName( tween.prop ) ] != null ) ) {\n          jQuery.style( tween.elem, tween.prop, tween.now + tween.unit );\n        } else {\n          tween.elem[ tween.prop ] = tween.now;\n        }\n      }\n    }\n  };\n\n// Support: IE <=9 only\n// Panic based approach to setting things on disconnected nodes\n  Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {\n    set: function( tween ) {\n      if ( tween.elem.nodeType && tween.elem.parentNode ) {\n        tween.elem[ tween.prop ] = tween.now;\n      }\n    }\n  };\n\n  jQuery.easing = {\n    linear: function( p ) {\n      return p;\n    },\n    swing: function( p ) {\n      return 0.5 - Math.cos( p * Math.PI ) / 2;\n    },\n    _default: \"swing\"\n  };\n\n  jQuery.fx = Tween.prototype.init;\n\n// Back compat <1.8 extension point\n  jQuery.fx.step = {};\n\n\n\n\n  var\n    fxNow, inProgress,\n    rfxtypes = /^(?:toggle|show|hide)$/,\n    rrun = /queueHooks$/;\n\n  function schedule() {\n    if ( inProgress ) {\n      if ( document.hidden === false && window.requestAnimationFrame ) {\n        window.requestAnimationFrame( schedule );\n      } else {\n        window.setTimeout( schedule, jQuery.fx.interval );\n      }\n\n      jQuery.fx.tick();\n    }\n  }\n\n// Animations created synchronously will run synchronously\n  function createFxNow() {\n    window.setTimeout( function() {\n      fxNow = undefined;\n    } );\n    return ( fxNow = Date.now() );\n  }\n\n// Generate parameters to create a standard animation\n  function genFx( type, includeWidth ) {\n    var which,\n      i = 0,\n      attrs = { height: type };\n\n    // If we include width, step value is 1 to do all cssExpand values,\n    // otherwise step value is 2 to skip over Left and Right\n    includeWidth = includeWidth ? 1 : 0;\n    for ( ; i < 4; i += 2 - includeWidth ) {\n      which = cssExpand[ i ];\n      attrs[ \"margin\" + which ] = attrs[ \"padding\" + which ] = type;\n    }\n\n    if ( includeWidth ) {\n      attrs.opacity = attrs.width = type;\n    }\n\n    return attrs;\n  }\n\n  function createTween( value, prop, animation ) {\n    var tween,\n      collection = ( Animation.tweeners[ prop ] || [] ).concat( Animation.tweeners[ \"*\" ] ),\n      index = 0,\n      length = collection.length;\n    for ( ; index < length; index++ ) {\n      if ( ( tween = collection[ index ].call( animation, prop, value ) ) ) {\n\n        // We're done with this property\n        return tween;\n      }\n    }\n  }\n\n  function defaultPrefilter( elem, props, opts ) {\n    var prop, value, toggle, hooks, oldfire, propTween, restoreDisplay, display,\n      isBox = \"width\" in props || \"height\" in props,\n      anim = this,\n      orig = {},\n      style = elem.style,\n      hidden = elem.nodeType && isHiddenWithinTree( elem ),\n      dataShow = dataPriv.get( elem, \"fxshow\" );\n\n    // Queue-skipping animations hijack the fx hooks\n    if ( !opts.queue ) {\n      hooks = jQuery._queueHooks( elem, \"fx\" );\n      if ( hooks.unqueued == null ) {\n        hooks.unqueued = 0;\n        oldfire = hooks.empty.fire;\n        hooks.empty.fire = function() {\n          if ( !hooks.unqueued ) {\n            oldfire();\n          }\n        };\n      }\n      hooks.unqueued++;\n\n      anim.always( function() {\n\n        // Ensure the complete handler is called before this completes\n        anim.always( function() {\n          hooks.unqueued--;\n          if ( !jQuery.queue( elem, \"fx\" ).length ) {\n            hooks.empty.fire();\n          }\n        } );\n      } );\n    }\n\n    // Detect show/hide animations\n    for ( prop in props ) {\n      value = props[ prop ];\n      if ( rfxtypes.test( value ) ) {\n        delete props[ prop ];\n        toggle = toggle || value === \"toggle\";\n        if ( value === ( hidden ? \"hide\" : \"show\" ) ) {\n\n          // Pretend to be hidden if this is a \"show\" and\n          // there is still data from a stopped show/hide\n          if ( value === \"show\" && dataShow && dataShow[ prop ] !== undefined ) {\n            hidden = true;\n\n            // Ignore all other no-op show/hide data\n          } else {\n            continue;\n          }\n        }\n        orig[ prop ] = dataShow && dataShow[ prop ] || jQuery.style( elem, prop );\n      }\n    }\n\n    // Bail out if this is a no-op like .hide().hide()\n    propTween = !jQuery.isEmptyObject( props );\n    if ( !propTween && jQuery.isEmptyObject( orig ) ) {\n      return;\n    }\n\n    // Restrict \"overflow\" and \"display\" styles during box animations\n    if ( isBox && elem.nodeType === 1 ) {\n\n      // Support: IE <=9 - 11, Edge 12 - 15\n      // Record all 3 overflow attributes because IE does not infer the shorthand\n      // from identically-valued overflowX and overflowY and Edge just mirrors\n      // the overflowX value there.\n      opts.overflow = [ style.overflow, style.overflowX, style.overflowY ];\n\n      // Identify a display type, preferring old show/hide data over the CSS cascade\n      restoreDisplay = dataShow && dataShow.display;\n      if ( restoreDisplay == null ) {\n        restoreDisplay = dataPriv.get( elem, \"display\" );\n      }\n      display = jQuery.css( elem, \"display\" );\n      if ( display === \"none\" ) {\n        if ( restoreDisplay ) {\n          display = restoreDisplay;\n        } else {\n\n          // Get nonempty value(s) by temporarily forcing visibility\n          showHide( [ elem ], true );\n          restoreDisplay = elem.style.display || restoreDisplay;\n          display = jQuery.css( elem, \"display\" );\n          showHide( [ elem ] );\n        }\n      }\n\n      // Animate inline elements as inline-block\n      if ( display === \"inline\" || display === \"inline-block\" && restoreDisplay != null ) {\n        if ( jQuery.css( elem, \"float\" ) === \"none\" ) {\n\n          // Restore the original display value at the end of pure show/hide animations\n          if ( !propTween ) {\n            anim.done( function() {\n              style.display = restoreDisplay;\n            } );\n            if ( restoreDisplay == null ) {\n              display = style.display;\n              restoreDisplay = display === \"none\" ? \"\" : display;\n            }\n          }\n          style.display = \"inline-block\";\n        }\n      }\n    }\n\n    if ( opts.overflow ) {\n      style.overflow = \"hidden\";\n      anim.always( function() {\n        style.overflow = opts.overflow[ 0 ];\n        style.overflowX = opts.overflow[ 1 ];\n        style.overflowY = opts.overflow[ 2 ];\n      } );\n    }\n\n    // Implement show/hide animations\n    propTween = false;\n    for ( prop in orig ) {\n\n      // General show/hide setup for this element animation\n      if ( !propTween ) {\n        if ( dataShow ) {\n          if ( \"hidden\" in dataShow ) {\n            hidden = dataShow.hidden;\n          }\n        } else {\n          dataShow = dataPriv.access( elem, \"fxshow\", { display: restoreDisplay } );\n        }\n\n        // Store hidden/visible for toggle so `.stop().toggle()` \"reverses\"\n        if ( toggle ) {\n          dataShow.hidden = !hidden;\n        }\n\n        // Show elements before animating them\n        if ( hidden ) {\n          showHide( [ elem ], true );\n        }\n\n        /* eslint-disable no-loop-func */\n\n        anim.done( function() {\n\n          /* eslint-enable no-loop-func */\n\n          // The final step of a \"hide\" animation is actually hiding the element\n          if ( !hidden ) {\n            showHide( [ elem ] );\n          }\n          dataPriv.remove( elem, \"fxshow\" );\n          for ( prop in orig ) {\n            jQuery.style( elem, prop, orig[ prop ] );\n          }\n        } );\n      }\n\n      // Per-property setup\n      propTween = createTween( hidden ? dataShow[ prop ] : 0, prop, anim );\n      if ( !( prop in dataShow ) ) {\n        dataShow[ prop ] = propTween.start;\n        if ( hidden ) {\n          propTween.end = propTween.start;\n          propTween.start = 0;\n        }\n      }\n    }\n  }\n\n  function propFilter( props, specialEasing ) {\n    var index, name, easing, value, hooks;\n\n    // camelCase, specialEasing and expand cssHook pass\n    for ( index in props ) {\n      name = camelCase( index );\n      easing = specialEasing[ name ];\n      value = props[ index ];\n      if ( Array.isArray( value ) ) {\n        easing = value[ 1 ];\n        value = props[ index ] = value[ 0 ];\n      }\n\n      if ( index !== name ) {\n        props[ name ] = value;\n        delete props[ index ];\n      }\n\n      hooks = jQuery.cssHooks[ name ];\n      if ( hooks && \"expand\" in hooks ) {\n        value = hooks.expand( value );\n        delete props[ name ];\n\n        // Not quite $.extend, this won't overwrite existing keys.\n        // Reusing 'index' because we have the correct \"name\"\n        for ( index in value ) {\n          if ( !( index in props ) ) {\n            props[ index ] = value[ index ];\n            specialEasing[ index ] = easing;\n          }\n        }\n      } else {\n        specialEasing[ name ] = easing;\n      }\n    }\n  }\n\n  function Animation( elem, properties, options ) {\n    var result,\n      stopped,\n      index = 0,\n      length = Animation.prefilters.length,\n      deferred = jQuery.Deferred().always( function() {\n\n        // Don't match elem in the :animated selector\n        delete tick.elem;\n      } ),\n      tick = function() {\n        if ( stopped ) {\n          return false;\n        }\n        var currentTime = fxNow || createFxNow(),\n          remaining = Math.max( 0, animation.startTime + animation.duration - currentTime ),\n\n          // Support: Android 2.3 only\n          // Archaic crash bug won't allow us to use `1 - ( 0.5 || 0 )` (#12497)\n          temp = remaining / animation.duration || 0,\n          percent = 1 - temp,\n          index = 0,\n          length = animation.tweens.length;\n\n        for ( ; index < length; index++ ) {\n          animation.tweens[ index ].run( percent );\n        }\n\n        deferred.notifyWith( elem, [ animation, percent, remaining ] );\n\n        // If there's more to do, yield\n        if ( percent < 1 && length ) {\n          return remaining;\n        }\n\n        // If this was an empty animation, synthesize a final progress notification\n        if ( !length ) {\n          deferred.notifyWith( elem, [ animation, 1, 0 ] );\n        }\n\n        // Resolve the animation and report its conclusion\n        deferred.resolveWith( elem, [ animation ] );\n        return false;\n      },\n      animation = deferred.promise( {\n        elem: elem,\n        props: jQuery.extend( {}, properties ),\n        opts: jQuery.extend( true, {\n          specialEasing: {},\n          easing: jQuery.easing._default\n        }, options ),\n        originalProperties: properties,\n        originalOptions: options,\n        startTime: fxNow || createFxNow(),\n        duration: options.duration,\n        tweens: [],\n        createTween: function( prop, end ) {\n          var tween = jQuery.Tween( elem, animation.opts, prop, end,\n            animation.opts.specialEasing[ prop ] || animation.opts.easing );\n          animation.tweens.push( tween );\n          return tween;\n        },\n        stop: function( gotoEnd ) {\n          var index = 0,\n\n            // If we are going to the end, we want to run all the tweens\n            // otherwise we skip this part\n            length = gotoEnd ? animation.tweens.length : 0;\n          if ( stopped ) {\n            return this;\n          }\n          stopped = true;\n          for ( ; index < length; index++ ) {\n            animation.tweens[ index ].run( 1 );\n          }\n\n          // Resolve when we played the last frame; otherwise, reject\n          if ( gotoEnd ) {\n            deferred.notifyWith( elem, [ animation, 1, 0 ] );\n            deferred.resolveWith( elem, [ animation, gotoEnd ] );\n          } else {\n            deferred.rejectWith( elem, [ animation, gotoEnd ] );\n          }\n          return this;\n        }\n      } ),\n      props = animation.props;\n\n    propFilter( props, animation.opts.specialEasing );\n\n    for ( ; index < length; index++ ) {\n      result = Animation.prefilters[ index ].call( animation, elem, props, animation.opts );\n      if ( result ) {\n        if ( isFunction( result.stop ) ) {\n          jQuery._queueHooks( animation.elem, animation.opts.queue ).stop =\n            result.stop.bind( result );\n        }\n        return result;\n      }\n    }\n\n    jQuery.map( props, createTween, animation );\n\n    if ( isFunction( animation.opts.start ) ) {\n      animation.opts.start.call( elem, animation );\n    }\n\n    // Attach callbacks from options\n    animation\n      .progress( animation.opts.progress )\n      .done( animation.opts.done, animation.opts.complete )\n      .fail( animation.opts.fail )\n      .always( animation.opts.always );\n\n    jQuery.fx.timer(\n      jQuery.extend( tick, {\n        elem: elem,\n        anim: animation,\n        queue: animation.opts.queue\n      } )\n    );\n\n    return animation;\n  }\n\n  jQuery.Animation = jQuery.extend( Animation, {\n\n    tweeners: {\n      \"*\": [ function( prop, value ) {\n        var tween = this.createTween( prop, value );\n        adjustCSS( tween.elem, prop, rcssNum.exec( value ), tween );\n        return tween;\n      } ]\n    },\n\n    tweener: function( props, callback ) {\n      if ( isFunction( props ) ) {\n        callback = props;\n        props = [ \"*\" ];\n      } else {\n        props = props.match( rnothtmlwhite );\n      }\n\n      var prop,\n        index = 0,\n        length = props.length;\n\n      for ( ; index < length; index++ ) {\n        prop = props[ index ];\n        Animation.tweeners[ prop ] = Animation.tweeners[ prop ] || [];\n        Animation.tweeners[ prop ].unshift( callback );\n      }\n    },\n\n    prefilters: [ defaultPrefilter ],\n\n    prefilter: function( callback, prepend ) {\n      if ( prepend ) {\n        Animation.prefilters.unshift( callback );\n      } else {\n        Animation.prefilters.push( callback );\n      }\n    }\n  } );\n\n  jQuery.speed = function( speed, easing, fn ) {\n    var opt = speed && typeof speed === \"object\" ? jQuery.extend( {}, speed ) : {\n      complete: fn || !fn && easing ||\n        isFunction( speed ) && speed,\n      duration: speed,\n      easing: fn && easing || easing && !isFunction( easing ) && easing\n    };\n\n    // Go to the end state if fx are off\n    if ( jQuery.fx.off ) {\n      opt.duration = 0;\n\n    } else {\n      if ( typeof opt.duration !== \"number\" ) {\n        if ( opt.duration in jQuery.fx.speeds ) {\n          opt.duration = jQuery.fx.speeds[ opt.duration ];\n\n        } else {\n          opt.duration = jQuery.fx.speeds._default;\n        }\n      }\n    }\n\n    // Normalize opt.queue - true/undefined/null -> \"fx\"\n    if ( opt.queue == null || opt.queue === true ) {\n      opt.queue = \"fx\";\n    }\n\n    // Queueing\n    opt.old = opt.complete;\n\n    opt.complete = function() {\n      if ( isFunction( opt.old ) ) {\n        opt.old.call( this );\n      }\n\n      if ( opt.queue ) {\n        jQuery.dequeue( this, opt.queue );\n      }\n    };\n\n    return opt;\n  };\n\n  jQuery.fn.extend( {\n    fadeTo: function( speed, to, easing, callback ) {\n\n      // Show any hidden elements after setting opacity to 0\n      return this.filter( isHiddenWithinTree ).css( \"opacity\", 0 ).show()\n\n        // Animate to the value specified\n        .end().animate( { opacity: to }, speed, easing, callback );\n    },\n    animate: function( prop, speed, easing, callback ) {\n      var empty = jQuery.isEmptyObject( prop ),\n        optall = jQuery.speed( speed, easing, callback ),\n        doAnimation = function() {\n\n          // Operate on a copy of prop so per-property easing won't be lost\n          var anim = Animation( this, jQuery.extend( {}, prop ), optall );\n\n          // Empty animations, or finishing resolves immediately\n          if ( empty || dataPriv.get( this, \"finish\" ) ) {\n            anim.stop( true );\n          }\n        };\n      doAnimation.finish = doAnimation;\n\n      return empty || optall.queue === false ?\n        this.each( doAnimation ) :\n        this.queue( optall.queue, doAnimation );\n    },\n    stop: function( type, clearQueue, gotoEnd ) {\n      var stopQueue = function( hooks ) {\n        var stop = hooks.stop;\n        delete hooks.stop;\n        stop( gotoEnd );\n      };\n\n      if ( typeof type !== \"string\" ) {\n        gotoEnd = clearQueue;\n        clearQueue = type;\n        type = undefined;\n      }\n      if ( clearQueue ) {\n        this.queue( type || \"fx\", [] );\n      }\n\n      return this.each( function() {\n        var dequeue = true,\n          index = type != null && type + \"queueHooks\",\n          timers = jQuery.timers,\n          data = dataPriv.get( this );\n\n        if ( index ) {\n          if ( data[ index ] && data[ index ].stop ) {\n            stopQueue( data[ index ] );\n          }\n        } else {\n          for ( index in data ) {\n            if ( data[ index ] && data[ index ].stop && rrun.test( index ) ) {\n              stopQueue( data[ index ] );\n            }\n          }\n        }\n\n        for ( index = timers.length; index--; ) {\n          if ( timers[ index ].elem === this &&\n            ( type == null || timers[ index ].queue === type ) ) {\n\n            timers[ index ].anim.stop( gotoEnd );\n            dequeue = false;\n            timers.splice( index, 1 );\n          }\n        }\n\n        // Start the next in the queue if the last step wasn't forced.\n        // Timers currently will call their complete callbacks, which\n        // will dequeue but only if they were gotoEnd.\n        if ( dequeue || !gotoEnd ) {\n          jQuery.dequeue( this, type );\n        }\n      } );\n    },\n    finish: function( type ) {\n      if ( type !== false ) {\n        type = type || \"fx\";\n      }\n      return this.each( function() {\n        var index,\n          data = dataPriv.get( this ),\n          queue = data[ type + \"queue\" ],\n          hooks = data[ type + \"queueHooks\" ],\n          timers = jQuery.timers,\n          length = queue ? queue.length : 0;\n\n        // Enable finishing flag on private data\n        data.finish = true;\n\n        // Empty the queue first\n        jQuery.queue( this, type, [] );\n\n        if ( hooks && hooks.stop ) {\n          hooks.stop.call( this, true );\n        }\n\n        // Look for any active animations, and finish them\n        for ( index = timers.length; index--; ) {\n          if ( timers[ index ].elem === this && timers[ index ].queue === type ) {\n            timers[ index ].anim.stop( true );\n            timers.splice( index, 1 );\n          }\n        }\n\n        // Look for any animations in the old queue and finish them\n        for ( index = 0; index < length; index++ ) {\n          if ( queue[ index ] && queue[ index ].finish ) {\n            queue[ index ].finish.call( this );\n          }\n        }\n\n        // Turn off finishing flag\n        delete data.finish;\n      } );\n    }\n  } );\n\n  jQuery.each( [ \"toggle\", \"show\", \"hide\" ], function( _i, name ) {\n    var cssFn = jQuery.fn[ name ];\n    jQuery.fn[ name ] = function( speed, easing, callback ) {\n      return speed == null || typeof speed === \"boolean\" ?\n        cssFn.apply( this, arguments ) :\n        this.animate( genFx( name, true ), speed, easing, callback );\n    };\n  } );\n\n// Generate shortcuts for custom animations\n  jQuery.each( {\n    slideDown: genFx( \"show\" ),\n    slideUp: genFx( \"hide\" ),\n    slideToggle: genFx( \"toggle\" ),\n    fadeIn: { opacity: \"show\" },\n    fadeOut: { opacity: \"hide\" },\n    fadeToggle: { opacity: \"toggle\" }\n  }, function( name, props ) {\n    jQuery.fn[ name ] = function( speed, easing, callback ) {\n      return this.animate( props, speed, easing, callback );\n    };\n  } );\n\n  jQuery.timers = [];\n  jQuery.fx.tick = function() {\n    var timer,\n      i = 0,\n      timers = jQuery.timers;\n\n    fxNow = Date.now();\n\n    for ( ; i < timers.length; i++ ) {\n      timer = timers[ i ];\n\n      // Run the timer and safely remove it when done (allowing for external removal)\n      if ( !timer() && timers[ i ] === timer ) {\n        timers.splice( i--, 1 );\n      }\n    }\n\n    if ( !timers.length ) {\n      jQuery.fx.stop();\n    }\n    fxNow = undefined;\n  };\n\n  jQuery.fx.timer = function( timer ) {\n    jQuery.timers.push( timer );\n    jQuery.fx.start();\n  };\n\n  jQuery.fx.interval = 13;\n  jQuery.fx.start = function() {\n    if ( inProgress ) {\n      return;\n    }\n\n    inProgress = true;\n    schedule();\n  };\n\n  jQuery.fx.stop = function() {\n    inProgress = null;\n  };\n\n  jQuery.fx.speeds = {\n    slow: 600,\n    fast: 200,\n\n    // Default speed\n    _default: 400\n  };\n\n\n// Based off of the plugin by Clint Helfers, with permission.\n// https://web.archive.org/web/20100324014747/http://blindsignals.com/index.php/2009/07/jquery-delay/\n  jQuery.fn.delay = function( time, type ) {\n    time = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;\n    type = type || \"fx\";\n\n    return this.queue( type, function( next, hooks ) {\n      var timeout = window.setTimeout( next, time );\n      hooks.stop = function() {\n        window.clearTimeout( timeout );\n      };\n    } );\n  };\n\n\n  ( function() {\n    var input = document.createElement( \"input\" ),\n      select = document.createElement( \"select\" ),\n      opt = select.appendChild( document.createElement( \"option\" ) );\n\n    input.type = \"checkbox\";\n\n    // Support: Android <=4.3 only\n    // Default value for a checkbox should be \"on\"\n    support.checkOn = input.value !== \"\";\n\n    // Support: IE <=11 only\n    // Must access selectedIndex to make default options select\n    support.optSelected = opt.selected;\n\n    // Support: IE <=11 only\n    // An input loses its value after becoming a radio\n    input = document.createElement( \"input\" );\n    input.value = \"t\";\n    input.type = \"radio\";\n    support.radioValue = input.value === \"t\";\n  } )();\n\n\n  var boolHook,\n    attrHandle = jQuery.expr.attrHandle;\n\n  jQuery.fn.extend( {\n    attr: function( name, value ) {\n      return access( this, jQuery.attr, name, value, arguments.length > 1 );\n    },\n\n    removeAttr: function( name ) {\n      return this.each( function() {\n        jQuery.removeAttr( this, name );\n      } );\n    }\n  } );\n\n  jQuery.extend( {\n    attr: function( elem, name, value ) {\n      var ret, hooks,\n        nType = elem.nodeType;\n\n      // Don't get/set attributes on text, comment and attribute nodes\n      if ( nType === 3 || nType === 8 || nType === 2 ) {\n        return;\n      }\n\n      // Fallback to prop when attributes are not supported\n      if ( typeof elem.getAttribute === \"undefined\" ) {\n        return jQuery.prop( elem, name, value );\n      }\n\n      // Attribute hooks are determined by the lowercase version\n      // Grab necessary hook if one is defined\n      if ( nType !== 1 || !jQuery.isXMLDoc( elem ) ) {\n        hooks = jQuery.attrHooks[ name.toLowerCase() ] ||\n          ( jQuery.expr.match.bool.test( name ) ? boolHook : undefined );\n      }\n\n      if ( value !== undefined ) {\n        if ( value === null ) {\n          jQuery.removeAttr( elem, name );\n          return;\n        }\n\n        if ( hooks && \"set\" in hooks &&\n          ( ret = hooks.set( elem, value, name ) ) !== undefined ) {\n          return ret;\n        }\n\n        elem.setAttribute( name, value + \"\" );\n        return value;\n      }\n\n      if ( hooks && \"get\" in hooks && ( ret = hooks.get( elem, name ) ) !== null ) {\n        return ret;\n      }\n\n      ret = jQuery.find.attr( elem, name );\n\n      // Non-existent attributes return null, we normalize to undefined\n      return ret == null ? undefined : ret;\n    },\n\n    attrHooks: {\n      type: {\n        set: function( elem, value ) {\n          if ( !support.radioValue && value === \"radio\" &&\n            nodeName( elem, \"input\" ) ) {\n            var val = elem.value;\n            elem.setAttribute( \"type\", value );\n            if ( val ) {\n              elem.value = val;\n            }\n            return value;\n          }\n        }\n      }\n    },\n\n    removeAttr: function( elem, value ) {\n      var name,\n        i = 0,\n\n        // Attribute names can contain non-HTML whitespace characters\n        // https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n        attrNames = value && value.match( rnothtmlwhite );\n\n      if ( attrNames && elem.nodeType === 1 ) {\n        while ( ( name = attrNames[ i++ ] ) ) {\n          elem.removeAttribute( name );\n        }\n      }\n    }\n  } );\n\n// Hooks for boolean attributes\n  boolHook = {\n    set: function( elem, value, name ) {\n      if ( value === false ) {\n\n        // Remove boolean attributes when set to false\n        jQuery.removeAttr( elem, name );\n      } else {\n        elem.setAttribute( name, name );\n      }\n      return name;\n    }\n  };\n\n  jQuery.each( jQuery.expr.match.bool.source.match( /\\w+/g ), function( _i, name ) {\n    var getter = attrHandle[ name ] || jQuery.find.attr;\n\n    attrHandle[ name ] = function( elem, name, isXML ) {\n      var ret, handle,\n        lowercaseName = name.toLowerCase();\n\n      if ( !isXML ) {\n\n        // Avoid an infinite loop by temporarily removing this function from the getter\n        handle = attrHandle[ lowercaseName ];\n        attrHandle[ lowercaseName ] = ret;\n        ret = getter( elem, name, isXML ) != null ?\n          lowercaseName :\n          null;\n        attrHandle[ lowercaseName ] = handle;\n      }\n      return ret;\n    };\n  } );\n\n\n\n\n  var rfocusable = /^(?:input|select|textarea|button)$/i,\n    rclickable = /^(?:a|area)$/i;\n\n  jQuery.fn.extend( {\n    prop: function( name, value ) {\n      return access( this, jQuery.prop, name, value, arguments.length > 1 );\n    },\n\n    removeProp: function( name ) {\n      return this.each( function() {\n        delete this[ jQuery.propFix[ name ] || name ];\n      } );\n    }\n  } );\n\n  jQuery.extend( {\n    prop: function( elem, name, value ) {\n      var ret, hooks,\n        nType = elem.nodeType;\n\n      // Don't get/set properties on text, comment and attribute nodes\n      if ( nType === 3 || nType === 8 || nType === 2 ) {\n        return;\n      }\n\n      if ( nType !== 1 || !jQuery.isXMLDoc( elem ) ) {\n\n        // Fix name and attach hooks\n        name = jQuery.propFix[ name ] || name;\n        hooks = jQuery.propHooks[ name ];\n      }\n\n      if ( value !== undefined ) {\n        if ( hooks && \"set\" in hooks &&\n          ( ret = hooks.set( elem, value, name ) ) !== undefined ) {\n          return ret;\n        }\n\n        return ( elem[ name ] = value );\n      }\n\n      if ( hooks && \"get\" in hooks && ( ret = hooks.get( elem, name ) ) !== null ) {\n        return ret;\n      }\n\n      return elem[ name ];\n    },\n\n    propHooks: {\n      tabIndex: {\n        get: function( elem ) {\n\n          // Support: IE <=9 - 11 only\n          // elem.tabIndex doesn't always return the\n          // correct value when it hasn't been explicitly set\n          // https://web.archive.org/web/20141116233347/http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/\n          // Use proper attribute retrieval(#12072)\n          var tabindex = jQuery.find.attr( elem, \"tabindex\" );\n\n          if ( tabindex ) {\n            return parseInt( tabindex, 10 );\n          }\n\n          if (\n            rfocusable.test( elem.nodeName ) ||\n            rclickable.test( elem.nodeName ) &&\n            elem.href\n          ) {\n            return 0;\n          }\n\n          return -1;\n        }\n      }\n    },\n\n    propFix: {\n      \"for\": \"htmlFor\",\n      \"class\": \"className\"\n    }\n  } );\n\n// Support: IE <=11 only\n// Accessing the selectedIndex property\n// forces the browser to respect setting selected\n// on the option\n// The getter ensures a default option is selected\n// when in an optgroup\n// eslint rule \"no-unused-expressions\" is disabled for this code\n// since it considers such accessions noop\n  if ( !support.optSelected ) {\n    jQuery.propHooks.selected = {\n      get: function( elem ) {\n\n        /* eslint no-unused-expressions: \"off\" */\n\n        var parent = elem.parentNode;\n        if ( parent && parent.parentNode ) {\n          parent.parentNode.selectedIndex;\n        }\n        return null;\n      },\n      set: function( elem ) {\n\n        /* eslint no-unused-expressions: \"off\" */\n\n        var parent = elem.parentNode;\n        if ( parent ) {\n          parent.selectedIndex;\n\n          if ( parent.parentNode ) {\n            parent.parentNode.selectedIndex;\n          }\n        }\n      }\n    };\n  }\n\n  jQuery.each( [\n    \"tabIndex\",\n    \"readOnly\",\n    \"maxLength\",\n    \"cellSpacing\",\n    \"cellPadding\",\n    \"rowSpan\",\n    \"colSpan\",\n    \"useMap\",\n    \"frameBorder\",\n    \"contentEditable\"\n  ], function() {\n    jQuery.propFix[ this.toLowerCase() ] = this;\n  } );\n\n\n\n\n  // Strip and collapse whitespace according to HTML spec\n  // https://infra.spec.whatwg.org/#strip-and-collapse-ascii-whitespace\n  function stripAndCollapse( value ) {\n    var tokens = value.match( rnothtmlwhite ) || [];\n    return tokens.join( \" \" );\n  }\n\n\n  function getClass( elem ) {\n    return elem.getAttribute && elem.getAttribute( \"class\" ) || \"\";\n  }\n\n  function classesToArray( value ) {\n    if ( Array.isArray( value ) ) {\n      return value;\n    }\n    if ( typeof value === \"string\" ) {\n      return value.match( rnothtmlwhite ) || [];\n    }\n    return [];\n  }\n\n  jQuery.fn.extend( {\n    addClass: function( value ) {\n      var classes, elem, cur, curValue, clazz, j, finalValue,\n        i = 0;\n\n      if ( isFunction( value ) ) {\n        return this.each( function( j ) {\n          jQuery( this ).addClass( value.call( this, j, getClass( this ) ) );\n        } );\n      }\n\n      classes = classesToArray( value );\n\n      if ( classes.length ) {\n        while ( ( elem = this[ i++ ] ) ) {\n          curValue = getClass( elem );\n          cur = elem.nodeType === 1 && ( \" \" + stripAndCollapse( curValue ) + \" \" );\n\n          if ( cur ) {\n            j = 0;\n            while ( ( clazz = classes[ j++ ] ) ) {\n              if ( cur.indexOf( \" \" + clazz + \" \" ) < 0 ) {\n                cur += clazz + \" \";\n              }\n            }\n\n            // Only assign if different to avoid unneeded rendering.\n            finalValue = stripAndCollapse( cur );\n            if ( curValue !== finalValue ) {\n              elem.setAttribute( \"class\", finalValue );\n            }\n          }\n        }\n      }\n\n      return this;\n    },\n\n    removeClass: function( value ) {\n      var classes, elem, cur, curValue, clazz, j, finalValue,\n        i = 0;\n\n      if ( isFunction( value ) ) {\n        return this.each( function( j ) {\n          jQuery( this ).removeClass( value.call( this, j, getClass( this ) ) );\n        } );\n      }\n\n      if ( !arguments.length ) {\n        return this.attr( \"class\", \"\" );\n      }\n\n      classes = classesToArray( value );\n\n      if ( classes.length ) {\n        while ( ( elem = this[ i++ ] ) ) {\n          curValue = getClass( elem );\n\n          // This expression is here for better compressibility (see addClass)\n          cur = elem.nodeType === 1 && ( \" \" + stripAndCollapse( curValue ) + \" \" );\n\n          if ( cur ) {\n            j = 0;\n            while ( ( clazz = classes[ j++ ] ) ) {\n\n              // Remove *all* instances\n              while ( cur.indexOf( \" \" + clazz + \" \" ) > -1 ) {\n                cur = cur.replace( \" \" + clazz + \" \", \" \" );\n              }\n            }\n\n            // Only assign if different to avoid unneeded rendering.\n            finalValue = stripAndCollapse( cur );\n            if ( curValue !== finalValue ) {\n              elem.setAttribute( \"class\", finalValue );\n            }\n          }\n        }\n      }\n\n      return this;\n    },\n\n    toggleClass: function( value, stateVal ) {\n      var type = typeof value,\n        isValidValue = type === \"string\" || Array.isArray( value );\n\n      if ( typeof stateVal === \"boolean\" && isValidValue ) {\n        return stateVal ? this.addClass( value ) : this.removeClass( value );\n      }\n\n      if ( isFunction( value ) ) {\n        return this.each( function( i ) {\n          jQuery( this ).toggleClass(\n            value.call( this, i, getClass( this ), stateVal ),\n            stateVal\n          );\n        } );\n      }\n\n      return this.each( function() {\n        var className, i, self, classNames;\n\n        if ( isValidValue ) {\n\n          // Toggle individual class names\n          i = 0;\n          self = jQuery( this );\n          classNames = classesToArray( value );\n\n          while ( ( className = classNames[ i++ ] ) ) {\n\n            // Check each className given, space separated list\n            if ( self.hasClass( className ) ) {\n              self.removeClass( className );\n            } else {\n              self.addClass( className );\n            }\n          }\n\n          // Toggle whole class name\n        } else if ( value === undefined || type === \"boolean\" ) {\n          className = getClass( this );\n          if ( className ) {\n\n            // Store className if set\n            dataPriv.set( this, \"__className__\", className );\n          }\n\n          // If the element has a class name or if we're passed `false`,\n          // then remove the whole classname (if there was one, the above saved it).\n          // Otherwise bring back whatever was previously saved (if anything),\n          // falling back to the empty string if nothing was stored.\n          if ( this.setAttribute ) {\n            this.setAttribute( \"class\",\n              className || value === false ?\n                \"\" :\n                dataPriv.get( this, \"__className__\" ) || \"\"\n            );\n          }\n        }\n      } );\n    },\n\n    hasClass: function( selector ) {\n      var className, elem,\n        i = 0;\n\n      className = \" \" + selector + \" \";\n      while ( ( elem = this[ i++ ] ) ) {\n        if ( elem.nodeType === 1 &&\n          ( \" \" + stripAndCollapse( getClass( elem ) ) + \" \" ).indexOf( className ) > -1 ) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  } );\n\n\n\n\n  var rreturn = /\\r/g;\n\n  jQuery.fn.extend( {\n    val: function( value ) {\n      var hooks, ret, valueIsFunction,\n        elem = this[ 0 ];\n\n      if ( !arguments.length ) {\n        if ( elem ) {\n          hooks = jQuery.valHooks[ elem.type ] ||\n            jQuery.valHooks[ elem.nodeName.toLowerCase() ];\n\n          if ( hooks &&\n            \"get\" in hooks &&\n            ( ret = hooks.get( elem, \"value\" ) ) !== undefined\n          ) {\n            return ret;\n          }\n\n          ret = elem.value;\n\n          // Handle most common string cases\n          if ( typeof ret === \"string\" ) {\n            return ret.replace( rreturn, \"\" );\n          }\n\n          // Handle cases where value is null/undef or number\n          return ret == null ? \"\" : ret;\n        }\n\n        return;\n      }\n\n      valueIsFunction = isFunction( value );\n\n      return this.each( function( i ) {\n        var val;\n\n        if ( this.nodeType !== 1 ) {\n          return;\n        }\n\n        if ( valueIsFunction ) {\n          val = value.call( this, i, jQuery( this ).val() );\n        } else {\n          val = value;\n        }\n\n        // Treat null/undefined as \"\"; convert numbers to string\n        if ( val == null ) {\n          val = \"\";\n\n        } else if ( typeof val === \"number\" ) {\n          val += \"\";\n\n        } else if ( Array.isArray( val ) ) {\n          val = jQuery.map( val, function( value ) {\n            return value == null ? \"\" : value + \"\";\n          } );\n        }\n\n        hooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];\n\n        // If set returns undefined, fall back to normal setting\n        if ( !hooks || !( \"set\" in hooks ) || hooks.set( this, val, \"value\" ) === undefined ) {\n          this.value = val;\n        }\n      } );\n    }\n  } );\n\n  jQuery.extend( {\n    valHooks: {\n      option: {\n        get: function( elem ) {\n\n          var val = jQuery.find.attr( elem, \"value\" );\n          return val != null ?\n            val :\n\n            // Support: IE <=10 - 11 only\n            // option.text throws exceptions (#14686, #14858)\n            // Strip and collapse whitespace\n            // https://html.spec.whatwg.org/#strip-and-collapse-whitespace\n            stripAndCollapse( jQuery.text( elem ) );\n        }\n      },\n      select: {\n        get: function( elem ) {\n          var value, option, i,\n            options = elem.options,\n            index = elem.selectedIndex,\n            one = elem.type === \"select-one\",\n            values = one ? null : [],\n            max = one ? index + 1 : options.length;\n\n          if ( index < 0 ) {\n            i = max;\n\n          } else {\n            i = one ? index : 0;\n          }\n\n          // Loop through all the selected options\n          for ( ; i < max; i++ ) {\n            option = options[ i ];\n\n            // Support: IE <=9 only\n            // IE8-9 doesn't update selected after form reset (#2551)\n            if ( ( option.selected || i === index ) &&\n\n              // Don't return options that are disabled or in a disabled optgroup\n              !option.disabled &&\n              ( !option.parentNode.disabled ||\n                !nodeName( option.parentNode, \"optgroup\" ) ) ) {\n\n              // Get the specific value for the option\n              value = jQuery( option ).val();\n\n              // We don't need an array for one selects\n              if ( one ) {\n                return value;\n              }\n\n              // Multi-Selects return an array\n              values.push( value );\n            }\n          }\n\n          return values;\n        },\n\n        set: function( elem, value ) {\n          var optionSet, option,\n            options = elem.options,\n            values = jQuery.makeArray( value ),\n            i = options.length;\n\n          while ( i-- ) {\n            option = options[ i ];\n\n            /* eslint-disable no-cond-assign */\n\n            if ( option.selected =\n              jQuery.inArray( jQuery.valHooks.option.get( option ), values ) > -1\n            ) {\n              optionSet = true;\n            }\n\n            /* eslint-enable no-cond-assign */\n          }\n\n          // Force browsers to behave consistently when non-matching value is set\n          if ( !optionSet ) {\n            elem.selectedIndex = -1;\n          }\n          return values;\n        }\n      }\n    }\n  } );\n\n// Radios and checkboxes getter/setter\n  jQuery.each( [ \"radio\", \"checkbox\" ], function() {\n    jQuery.valHooks[ this ] = {\n      set: function( elem, value ) {\n        if ( Array.isArray( value ) ) {\n          return ( elem.checked = jQuery.inArray( jQuery( elem ).val(), value ) > -1 );\n        }\n      }\n    };\n    if ( !support.checkOn ) {\n      jQuery.valHooks[ this ].get = function( elem ) {\n        return elem.getAttribute( \"value\" ) === null ? \"on\" : elem.value;\n      };\n    }\n  } );\n\n\n\n\n// Return jQuery for attributes-only inclusion\n\n\n  support.focusin = \"onfocusin\" in window;\n\n\n  var rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,\n    stopPropagationCallback = function( e ) {\n      e.stopPropagation();\n    };\n\n  jQuery.extend( jQuery.event, {\n\n    trigger: function( event, data, elem, onlyHandlers ) {\n\n      var i, cur, tmp, bubbleType, ontype, handle, special, lastElement,\n        eventPath = [ elem || document ],\n        type = hasOwn.call( event, \"type\" ) ? event.type : event,\n        namespaces = hasOwn.call( event, \"namespace\" ) ? event.namespace.split( \".\" ) : [];\n\n      cur = lastElement = tmp = elem = elem || document;\n\n      // Don't do events on text and comment nodes\n      if ( elem.nodeType === 3 || elem.nodeType === 8 ) {\n        return;\n      }\n\n      // focus/blur morphs to focusin/out; ensure we're not firing them right now\n      if ( rfocusMorph.test( type + jQuery.event.triggered ) ) {\n        return;\n      }\n\n      if ( type.indexOf( \".\" ) > -1 ) {\n\n        // Namespaced trigger; create a regexp to match event type in handle()\n        namespaces = type.split( \".\" );\n        type = namespaces.shift();\n        namespaces.sort();\n      }\n      ontype = type.indexOf( \":\" ) < 0 && \"on\" + type;\n\n      // Caller can pass in a jQuery.Event object, Object, or just an event type string\n      event = event[ jQuery.expando ] ?\n        event :\n        new jQuery.Event( type, typeof event === \"object\" && event );\n\n      // Trigger bitmask: & 1 for native handlers; & 2 for jQuery (always true)\n      event.isTrigger = onlyHandlers ? 2 : 3;\n      event.namespace = namespaces.join( \".\" );\n      event.rnamespace = event.namespace ?\n        new RegExp( \"(^|\\\\.)\" + namespaces.join( \"\\\\.(?:.*\\\\.|)\" ) + \"(\\\\.|$)\" ) :\n        null;\n\n      // Clean up the event in case it is being reused\n      event.result = undefined;\n      if ( !event.target ) {\n        event.target = elem;\n      }\n\n      // Clone any incoming data and prepend the event, creating the handler arg list\n      data = data == null ?\n        [ event ] :\n        jQuery.makeArray( data, [ event ] );\n\n      // Allow special events to draw outside the lines\n      special = jQuery.event.special[ type ] || {};\n      if ( !onlyHandlers && special.trigger && special.trigger.apply( elem, data ) === false ) {\n        return;\n      }\n\n      // Determine event propagation path in advance, per W3C events spec (#9951)\n      // Bubble up to document, then to window; watch for a global ownerDocument var (#9724)\n      if ( !onlyHandlers && !special.noBubble && !isWindow( elem ) ) {\n\n        bubbleType = special.delegateType || type;\n        if ( !rfocusMorph.test( bubbleType + type ) ) {\n          cur = cur.parentNode;\n        }\n        for ( ; cur; cur = cur.parentNode ) {\n          eventPath.push( cur );\n          tmp = cur;\n        }\n\n        // Only add window if we got to document (e.g., not plain obj or detached DOM)\n        if ( tmp === ( elem.ownerDocument || document ) ) {\n          eventPath.push( tmp.defaultView || tmp.parentWindow || window );\n        }\n      }\n\n      // Fire handlers on the event path\n      i = 0;\n      while ( ( cur = eventPath[ i++ ] ) && !event.isPropagationStopped() ) {\n        lastElement = cur;\n        event.type = i > 1 ?\n          bubbleType :\n          special.bindType || type;\n\n        // jQuery handler\n        handle = (\n            dataPriv.get( cur, \"events\" ) || Object.create( null )\n          )[ event.type ] &&\n          dataPriv.get( cur, \"handle\" );\n        if ( handle ) {\n          handle.apply( cur, data );\n        }\n\n        // Native handler\n        handle = ontype && cur[ ontype ];\n        if ( handle && handle.apply && acceptData( cur ) ) {\n          event.result = handle.apply( cur, data );\n          if ( event.result === false ) {\n            event.preventDefault();\n          }\n        }\n      }\n      event.type = type;\n\n      // If nobody prevented the default action, do it now\n      if ( !onlyHandlers && !event.isDefaultPrevented() ) {\n\n        if ( ( !special._default ||\n            special._default.apply( eventPath.pop(), data ) === false ) &&\n          acceptData( elem ) ) {\n\n          // Call a native DOM method on the target with the same name as the event.\n          // Don't do default actions on window, that's where global variables be (#6170)\n          if ( ontype && isFunction( elem[ type ] ) && !isWindow( elem ) ) {\n\n            // Don't re-trigger an onFOO event when we call its FOO() method\n            tmp = elem[ ontype ];\n\n            if ( tmp ) {\n              elem[ ontype ] = null;\n            }\n\n            // Prevent re-triggering of the same event, since we already bubbled it above\n            jQuery.event.triggered = type;\n\n            if ( event.isPropagationStopped() ) {\n              lastElement.addEventListener( type, stopPropagationCallback );\n            }\n\n            elem[ type ]();\n\n            if ( event.isPropagationStopped() ) {\n              lastElement.removeEventListener( type, stopPropagationCallback );\n            }\n\n            jQuery.event.triggered = undefined;\n\n            if ( tmp ) {\n              elem[ ontype ] = tmp;\n            }\n          }\n        }\n      }\n\n      return event.result;\n    },\n\n    // Piggyback on a donor event to simulate a different one\n    // Used only for `focus(in | out)` events\n    simulate: function( type, elem, event ) {\n      var e = jQuery.extend(\n        new jQuery.Event(),\n        event,\n        {\n          type: type,\n          isSimulated: true\n        }\n      );\n\n      jQuery.event.trigger( e, null, elem );\n    }\n\n  } );\n\n  jQuery.fn.extend( {\n\n    trigger: function( type, data ) {\n      return this.each( function() {\n        jQuery.event.trigger( type, data, this );\n      } );\n    },\n    triggerHandler: function( type, data ) {\n      var elem = this[ 0 ];\n      if ( elem ) {\n        return jQuery.event.trigger( type, data, elem, true );\n      }\n    }\n  } );\n\n\n// Support: Firefox <=44\n// Firefox doesn't have focus(in | out) events\n// Related ticket - https://bugzilla.mozilla.org/show_bug.cgi?id=687787\n//\n// Support: Chrome <=48 - 49, Safari <=9.0 - 9.1\n// focus(in | out) events fire after focus & blur events,\n// which is spec violation - http://www.w3.org/TR/DOM-Level-3-Events/#events-focusevent-event-order\n// Related ticket - https://bugs.chromium.org/p/chromium/issues/detail?id=449857\n  if ( !support.focusin ) {\n    jQuery.each( { focus: \"focusin\", blur: \"focusout\" }, function( orig, fix ) {\n\n      // Attach a single capturing handler on the document while someone wants focusin/focusout\n      var handler = function( event ) {\n        jQuery.event.simulate( fix, event.target, jQuery.event.fix( event ) );\n      };\n\n      jQuery.event.special[ fix ] = {\n        setup: function() {\n\n          // Handle: regular nodes (via `this.ownerDocument`), window\n          // (via `this.document`) & document (via `this`).\n          var doc = this.ownerDocument || this.document || this,\n            attaches = dataPriv.access( doc, fix );\n\n          if ( !attaches ) {\n            doc.addEventListener( orig, handler, true );\n          }\n          dataPriv.access( doc, fix, ( attaches || 0 ) + 1 );\n        },\n        teardown: function() {\n          var doc = this.ownerDocument || this.document || this,\n            attaches = dataPriv.access( doc, fix ) - 1;\n\n          if ( !attaches ) {\n            doc.removeEventListener( orig, handler, true );\n            dataPriv.remove( doc, fix );\n\n          } else {\n            dataPriv.access( doc, fix, attaches );\n          }\n        }\n      };\n    } );\n  }\n  var location = window.location;\n\n  var nonce = { guid: Date.now() };\n\n  var rquery = ( /\\?/ );\n\n\n\n// Cross-browser xml parsing\n  jQuery.parseXML = function( data ) {\n    var xml;\n    if ( !data || typeof data !== \"string\" ) {\n      return null;\n    }\n\n    // Support: IE 9 - 11 only\n    // IE throws on parseFromString with invalid input.\n    try {\n      xml = ( new window.DOMParser() ).parseFromString( data, \"text/xml\" );\n    } catch ( e ) {\n      xml = undefined;\n    }\n\n    if ( !xml || xml.getElementsByTagName( \"parsererror\" ).length ) {\n      jQuery.error( \"Invalid XML: \" + data );\n    }\n    return xml;\n  };\n\n\n  var\n    rbracket = /\\[\\]$/,\n    rCRLF = /\\r?\\n/g,\n    rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i,\n    rsubmittable = /^(?:input|select|textarea|keygen)/i;\n\n  function buildParams( prefix, obj, traditional, add ) {\n    var name;\n\n    if ( Array.isArray( obj ) ) {\n\n      // Serialize array item.\n      jQuery.each( obj, function( i, v ) {\n        if ( traditional || rbracket.test( prefix ) ) {\n\n          // Treat each array item as a scalar.\n          add( prefix, v );\n\n        } else {\n\n          // Item is non-scalar (array or object), encode its numeric index.\n          buildParams(\n            prefix + \"[\" + ( typeof v === \"object\" && v != null ? i : \"\" ) + \"]\",\n            v,\n            traditional,\n            add\n          );\n        }\n      } );\n\n    } else if ( !traditional && toType( obj ) === \"object\" ) {\n\n      // Serialize object item.\n      for ( name in obj ) {\n        buildParams( prefix + \"[\" + name + \"]\", obj[ name ], traditional, add );\n      }\n\n    } else {\n\n      // Serialize scalar item.\n      add( prefix, obj );\n    }\n  }\n\n// Serialize an array of form elements or a set of\n// key/values into a query string\n  jQuery.param = function( a, traditional ) {\n    var prefix,\n      s = [],\n      add = function( key, valueOrFunction ) {\n\n        // If value is a function, invoke it and use its return value\n        var value = isFunction( valueOrFunction ) ?\n          valueOrFunction() :\n          valueOrFunction;\n\n        s[ s.length ] = encodeURIComponent( key ) + \"=\" +\n          encodeURIComponent( value == null ? \"\" : value );\n      };\n\n    if ( a == null ) {\n      return \"\";\n    }\n\n    // If an array was passed in, assume that it is an array of form elements.\n    if ( Array.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {\n\n      // Serialize the form elements\n      jQuery.each( a, function() {\n        add( this.name, this.value );\n      } );\n\n    } else {\n\n      // If traditional, encode the \"old\" way (the way 1.3.2 or older\n      // did it), otherwise encode params recursively.\n      for ( prefix in a ) {\n        buildParams( prefix, a[ prefix ], traditional, add );\n      }\n    }\n\n    // Return the resulting serialization\n    return s.join( \"&\" );\n  };\n\n  jQuery.fn.extend( {\n    serialize: function() {\n      return jQuery.param( this.serializeArray() );\n    },\n    serializeArray: function() {\n      return this.map( function() {\n\n        // Can add propHook for \"elements\" to filter or add form elements\n        var elements = jQuery.prop( this, \"elements\" );\n        return elements ? jQuery.makeArray( elements ) : this;\n      } )\n        .filter( function() {\n          var type = this.type;\n\n          // Use .is( \":disabled\" ) so that fieldset[disabled] works\n          return this.name && !jQuery( this ).is( \":disabled\" ) &&\n            rsubmittable.test( this.nodeName ) && !rsubmitterTypes.test( type ) &&\n            ( this.checked || !rcheckableType.test( type ) );\n        } )\n        .map( function( _i, elem ) {\n          var val = jQuery( this ).val();\n\n          if ( val == null ) {\n            return null;\n          }\n\n          if ( Array.isArray( val ) ) {\n            return jQuery.map( val, function( val ) {\n              return { name: elem.name, value: val.replace( rCRLF, \"\\r\\n\" ) };\n            } );\n          }\n\n          return { name: elem.name, value: val.replace( rCRLF, \"\\r\\n\" ) };\n        } ).get();\n    }\n  } );\n\n\n  var\n    r20 = /%20/g,\n    rhash = /#.*$/,\n    rantiCache = /([?&])_=[^&]*/,\n    rheaders = /^(.*?):[ \\t]*([^\\r\\n]*)$/mg,\n\n    // #7653, #8125, #8152: local protocol detection\n    rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,\n    rnoContent = /^(?:GET|HEAD)$/,\n    rprotocol = /^\\/\\//,\n\n    /* Prefilters\n\t * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)\n\t * 2) These are called:\n\t *    - BEFORE asking for a transport\n\t *    - AFTER param serialization (s.data is a string if s.processData is true)\n\t * 3) key is the dataType\n\t * 4) the catchall symbol \"*\" can be used\n\t * 5) execution will start with transport dataType and THEN continue down to \"*\" if needed\n\t */\n    prefilters = {},\n\n    /* Transports bindings\n\t * 1) key is the dataType\n\t * 2) the catchall symbol \"*\" can be used\n\t * 3) selection will start with transport dataType and THEN go to \"*\" if needed\n\t */\n    transports = {},\n\n    // Avoid comment-prolog char sequence (#10098); must appease lint and evade compression\n    allTypes = \"*/\".concat( \"*\" ),\n\n    // Anchor tag for parsing the document origin\n    originAnchor = document.createElement( \"a\" );\n  originAnchor.href = location.href;\n\n// Base \"constructor\" for jQuery.ajaxPrefilter and jQuery.ajaxTransport\n  function addToPrefiltersOrTransports( structure ) {\n\n    // dataTypeExpression is optional and defaults to \"*\"\n    return function( dataTypeExpression, func ) {\n\n      if ( typeof dataTypeExpression !== \"string\" ) {\n        func = dataTypeExpression;\n        dataTypeExpression = \"*\";\n      }\n\n      var dataType,\n        i = 0,\n        dataTypes = dataTypeExpression.toLowerCase().match( rnothtmlwhite ) || [];\n\n      if ( isFunction( func ) ) {\n\n        // For each dataType in the dataTypeExpression\n        while ( ( dataType = dataTypes[ i++ ] ) ) {\n\n          // Prepend if requested\n          if ( dataType[ 0 ] === \"+\" ) {\n            dataType = dataType.slice( 1 ) || \"*\";\n            ( structure[ dataType ] = structure[ dataType ] || [] ).unshift( func );\n\n            // Otherwise append\n          } else {\n            ( structure[ dataType ] = structure[ dataType ] || [] ).push( func );\n          }\n        }\n      }\n    };\n  }\n\n// Base inspection function for prefilters and transports\n  function inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR ) {\n\n    var inspected = {},\n      seekingTransport = ( structure === transports );\n\n    function inspect( dataType ) {\n      var selected;\n      inspected[ dataType ] = true;\n      jQuery.each( structure[ dataType ] || [], function( _, prefilterOrFactory ) {\n        var dataTypeOrTransport = prefilterOrFactory( options, originalOptions, jqXHR );\n        if ( typeof dataTypeOrTransport === \"string\" &&\n          !seekingTransport && !inspected[ dataTypeOrTransport ] ) {\n\n          options.dataTypes.unshift( dataTypeOrTransport );\n          inspect( dataTypeOrTransport );\n          return false;\n        } else if ( seekingTransport ) {\n          return !( selected = dataTypeOrTransport );\n        }\n      } );\n      return selected;\n    }\n\n    return inspect( options.dataTypes[ 0 ] ) || !inspected[ \"*\" ] && inspect( \"*\" );\n  }\n\n// A special extend for ajax options\n// that takes \"flat\" options (not to be deep extended)\n// Fixes #9887\n  function ajaxExtend( target, src ) {\n    var key, deep,\n      flatOptions = jQuery.ajaxSettings.flatOptions || {};\n\n    for ( key in src ) {\n      if ( src[ key ] !== undefined ) {\n        ( flatOptions[ key ] ? target : ( deep || ( deep = {} ) ) )[ key ] = src[ key ];\n      }\n    }\n    if ( deep ) {\n      jQuery.extend( true, target, deep );\n    }\n\n    return target;\n  }\n\n  /* Handles responses to an ajax request:\n * - finds the right dataType (mediates between content-type and expected dataType)\n * - returns the corresponding response\n */\n  function ajaxHandleResponses( s, jqXHR, responses ) {\n\n    var ct, type, finalDataType, firstDataType,\n      contents = s.contents,\n      dataTypes = s.dataTypes;\n\n    // Remove auto dataType and get content-type in the process\n    while ( dataTypes[ 0 ] === \"*\" ) {\n      dataTypes.shift();\n      if ( ct === undefined ) {\n        ct = s.mimeType || jqXHR.getResponseHeader( \"Content-Type\" );\n      }\n    }\n\n    // Check if we're dealing with a known content-type\n    if ( ct ) {\n      for ( type in contents ) {\n        if ( contents[ type ] && contents[ type ].test( ct ) ) {\n          dataTypes.unshift( type );\n          break;\n        }\n      }\n    }\n\n    // Check to see if we have a response for the expected dataType\n    if ( dataTypes[ 0 ] in responses ) {\n      finalDataType = dataTypes[ 0 ];\n    } else {\n\n      // Try convertible dataTypes\n      for ( type in responses ) {\n        if ( !dataTypes[ 0 ] || s.converters[ type + \" \" + dataTypes[ 0 ] ] ) {\n          finalDataType = type;\n          break;\n        }\n        if ( !firstDataType ) {\n          firstDataType = type;\n        }\n      }\n\n      // Or just use first one\n      finalDataType = finalDataType || firstDataType;\n    }\n\n    // If we found a dataType\n    // We add the dataType to the list if needed\n    // and return the corresponding response\n    if ( finalDataType ) {\n      if ( finalDataType !== dataTypes[ 0 ] ) {\n        dataTypes.unshift( finalDataType );\n      }\n      return responses[ finalDataType ];\n    }\n  }\n\n  /* Chain conversions given the request and the original response\n * Also sets the responseXXX fields on the jqXHR instance\n */\n  function ajaxConvert( s, response, jqXHR, isSuccess ) {\n    var conv2, current, conv, tmp, prev,\n      converters = {},\n\n      // Work with a copy of dataTypes in case we need to modify it for conversion\n      dataTypes = s.dataTypes.slice();\n\n    // Create converters map with lowercased keys\n    if ( dataTypes[ 1 ] ) {\n      for ( conv in s.converters ) {\n        converters[ conv.toLowerCase() ] = s.converters[ conv ];\n      }\n    }\n\n    current = dataTypes.shift();\n\n    // Convert to each sequential dataType\n    while ( current ) {\n\n      if ( s.responseFields[ current ] ) {\n        jqXHR[ s.responseFields[ current ] ] = response;\n      }\n\n      // Apply the dataFilter if provided\n      if ( !prev && isSuccess && s.dataFilter ) {\n        response = s.dataFilter( response, s.dataType );\n      }\n\n      prev = current;\n      current = dataTypes.shift();\n\n      if ( current ) {\n\n        // There's only work to do if current dataType is non-auto\n        if ( current === \"*\" ) {\n\n          current = prev;\n\n          // Convert response if prev dataType is non-auto and differs from current\n        } else if ( prev !== \"*\" && prev !== current ) {\n\n          // Seek a direct converter\n          conv = converters[ prev + \" \" + current ] || converters[ \"* \" + current ];\n\n          // If none found, seek a pair\n          if ( !conv ) {\n            for ( conv2 in converters ) {\n\n              // If conv2 outputs current\n              tmp = conv2.split( \" \" );\n              if ( tmp[ 1 ] === current ) {\n\n                // If prev can be converted to accepted input\n                conv = converters[ prev + \" \" + tmp[ 0 ] ] ||\n                  converters[ \"* \" + tmp[ 0 ] ];\n                if ( conv ) {\n\n                  // Condense equivalence converters\n                  if ( conv === true ) {\n                    conv = converters[ conv2 ];\n\n                    // Otherwise, insert the intermediate dataType\n                  } else if ( converters[ conv2 ] !== true ) {\n                    current = tmp[ 0 ];\n                    dataTypes.unshift( tmp[ 1 ] );\n                  }\n                  break;\n                }\n              }\n            }\n          }\n\n          // Apply converter (if not an equivalence)\n          if ( conv !== true ) {\n\n            // Unless errors are allowed to bubble, catch and return them\n            if ( conv && s.throws ) {\n              response = conv( response );\n            } else {\n              try {\n                response = conv( response );\n              } catch ( e ) {\n                return {\n                  state: \"parsererror\",\n                  error: conv ? e : \"No conversion from \" + prev + \" to \" + current\n                };\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return { state: \"success\", data: response };\n  }\n\n  jQuery.extend( {\n\n    // Counter for holding the number of active queries\n    active: 0,\n\n    // Last-Modified header cache for next request\n    lastModified: {},\n    etag: {},\n\n    ajaxSettings: {\n      url: location.href,\n      type: \"GET\",\n      isLocal: rlocalProtocol.test( location.protocol ),\n      global: true,\n      processData: true,\n      async: true,\n      contentType: \"application/x-www-form-urlencoded; charset=UTF-8\",\n\n      /*\n\t\ttimeout: 0,\n\t\tdata: null,\n\t\tdataType: null,\n\t\tusername: null,\n\t\tpassword: null,\n\t\tcache: null,\n\t\tthrows: false,\n\t\ttraditional: false,\n\t\theaders: {},\n\t\t*/\n\n      accepts: {\n        \"*\": allTypes,\n        text: \"text/plain\",\n        html: \"text/html\",\n        xml: \"application/xml, text/xml\",\n        json: \"application/json, text/javascript\"\n      },\n\n      contents: {\n        xml: /\\bxml\\b/,\n        html: /\\bhtml/,\n        json: /\\bjson\\b/\n      },\n\n      responseFields: {\n        xml: \"responseXML\",\n        text: \"responseText\",\n        json: \"responseJSON\"\n      },\n\n      // Data converters\n      // Keys separate source (or catchall \"*\") and destination types with a single space\n      converters: {\n\n        // Convert anything to text\n        \"* text\": String,\n\n        // Text to html (true = no transformation)\n        \"text html\": true,\n\n        // Evaluate text as a json expression\n        \"text json\": JSON.parse,\n\n        // Parse text as xml\n        \"text xml\": jQuery.parseXML\n      },\n\n      // For options that shouldn't be deep extended:\n      // you can add your own custom options here if\n      // and when you create one that shouldn't be\n      // deep extended (see ajaxExtend)\n      flatOptions: {\n        url: true,\n        context: true\n      }\n    },\n\n    // Creates a full fledged settings object into target\n    // with both ajaxSettings and settings fields.\n    // If target is omitted, writes into ajaxSettings.\n    ajaxSetup: function( target, settings ) {\n      return settings ?\n\n        // Building a settings object\n        ajaxExtend( ajaxExtend( target, jQuery.ajaxSettings ), settings ) :\n\n        // Extending ajaxSettings\n        ajaxExtend( jQuery.ajaxSettings, target );\n    },\n\n    ajaxPrefilter: addToPrefiltersOrTransports( prefilters ),\n    ajaxTransport: addToPrefiltersOrTransports( transports ),\n\n    // Main method\n    ajax: function( url, options ) {\n\n      // If url is an object, simulate pre-1.5 signature\n      if ( typeof url === \"object\" ) {\n        options = url;\n        url = undefined;\n      }\n\n      // Force options to be an object\n      options = options || {};\n\n      var transport,\n\n        // URL without anti-cache param\n        cacheURL,\n\n        // Response headers\n        responseHeadersString,\n        responseHeaders,\n\n        // timeout handle\n        timeoutTimer,\n\n        // Url cleanup var\n        urlAnchor,\n\n        // Request state (becomes false upon send and true upon completion)\n        completed,\n\n        // To know if global events are to be dispatched\n        fireGlobals,\n\n        // Loop variable\n        i,\n\n        // uncached part of the url\n        uncached,\n\n        // Create the final options object\n        s = jQuery.ajaxSetup( {}, options ),\n\n        // Callbacks context\n        callbackContext = s.context || s,\n\n        // Context for global events is callbackContext if it is a DOM node or jQuery collection\n        globalEventContext = s.context &&\n        ( callbackContext.nodeType || callbackContext.jquery ) ?\n          jQuery( callbackContext ) :\n          jQuery.event,\n\n        // Deferreds\n        deferred = jQuery.Deferred(),\n        completeDeferred = jQuery.Callbacks( \"once memory\" ),\n\n        // Status-dependent callbacks\n        statusCode = s.statusCode || {},\n\n        // Headers (they are sent all at once)\n        requestHeaders = {},\n        requestHeadersNames = {},\n\n        // Default abort message\n        strAbort = \"canceled\",\n\n        // Fake xhr\n        jqXHR = {\n          readyState: 0,\n\n          // Builds headers hashtable if needed\n          getResponseHeader: function( key ) {\n            var match;\n            if ( completed ) {\n              if ( !responseHeaders ) {\n                responseHeaders = {};\n                while ( ( match = rheaders.exec( responseHeadersString ) ) ) {\n                  responseHeaders[ match[ 1 ].toLowerCase() + \" \" ] =\n                    ( responseHeaders[ match[ 1 ].toLowerCase() + \" \" ] || [] )\n                      .concat( match[ 2 ] );\n                }\n              }\n              match = responseHeaders[ key.toLowerCase() + \" \" ];\n            }\n            return match == null ? null : match.join( \", \" );\n          },\n\n          // Raw string\n          getAllResponseHeaders: function() {\n            return completed ? responseHeadersString : null;\n          },\n\n          // Caches the header\n          setRequestHeader: function( name, value ) {\n            if ( completed == null ) {\n              name = requestHeadersNames[ name.toLowerCase() ] =\n                requestHeadersNames[ name.toLowerCase() ] || name;\n              requestHeaders[ name ] = value;\n            }\n            return this;\n          },\n\n          // Overrides response content-type header\n          overrideMimeType: function( type ) {\n            if ( completed == null ) {\n              s.mimeType = type;\n            }\n            return this;\n          },\n\n          // Status-dependent callbacks\n          statusCode: function( map ) {\n            var code;\n            if ( map ) {\n              if ( completed ) {\n\n                // Execute the appropriate callbacks\n                jqXHR.always( map[ jqXHR.status ] );\n              } else {\n\n                // Lazy-add the new callbacks in a way that preserves old ones\n                for ( code in map ) {\n                  statusCode[ code ] = [ statusCode[ code ], map[ code ] ];\n                }\n              }\n            }\n            return this;\n          },\n\n          // Cancel the request\n          abort: function( statusText ) {\n            var finalText = statusText || strAbort;\n            if ( transport ) {\n              transport.abort( finalText );\n            }\n            done( 0, finalText );\n            return this;\n          }\n        };\n\n      // Attach deferreds\n      deferred.promise( jqXHR );\n\n      // Add protocol if not provided (prefilters might expect it)\n      // Handle falsy url in the settings object (#10093: consistency with old signature)\n      // We also use the url parameter if available\n      s.url = ( ( url || s.url || location.href ) + \"\" )\n        .replace( rprotocol, location.protocol + \"//\" );\n\n      // Alias method option to type as per ticket #12004\n      s.type = options.method || options.type || s.method || s.type;\n\n      // Extract dataTypes list\n      s.dataTypes = ( s.dataType || \"*\" ).toLowerCase().match( rnothtmlwhite ) || [ \"\" ];\n\n      // A cross-domain request is in order when the origin doesn't match the current origin.\n      if ( s.crossDomain == null ) {\n        urlAnchor = document.createElement( \"a\" );\n\n        // Support: IE <=8 - 11, Edge 12 - 15\n        // IE throws exception on accessing the href property if url is malformed,\n        // e.g. http://example.com:80x/\n        try {\n          urlAnchor.href = s.url;\n\n          // Support: IE <=8 - 11 only\n          // Anchor's host property isn't correctly set when s.url is relative\n          urlAnchor.href = urlAnchor.href;\n          s.crossDomain = originAnchor.protocol + \"//\" + originAnchor.host !==\n            urlAnchor.protocol + \"//\" + urlAnchor.host;\n        } catch ( e ) {\n\n          // If there is an error parsing the URL, assume it is crossDomain,\n          // it can be rejected by the transport if it is invalid\n          s.crossDomain = true;\n        }\n      }\n\n      // Convert data if not already a string\n      if ( s.data && s.processData && typeof s.data !== \"string\" ) {\n        s.data = jQuery.param( s.data, s.traditional );\n      }\n\n      // Apply prefilters\n      inspectPrefiltersOrTransports( prefilters, s, options, jqXHR );\n\n      // If request was aborted inside a prefilter, stop there\n      if ( completed ) {\n        return jqXHR;\n      }\n\n      // We can fire global events as of now if asked to\n      // Don't fire events if jQuery.event is undefined in an AMD-usage scenario (#15118)\n      fireGlobals = jQuery.event && s.global;\n\n      // Watch for a new set of requests\n      if ( fireGlobals && jQuery.active++ === 0 ) {\n        jQuery.event.trigger( \"ajaxStart\" );\n      }\n\n      // Uppercase the type\n      s.type = s.type.toUpperCase();\n\n      // Determine if request has content\n      s.hasContent = !rnoContent.test( s.type );\n\n      // Save the URL in case we're toying with the If-Modified-Since\n      // and/or If-None-Match header later on\n      // Remove hash to simplify url manipulation\n      cacheURL = s.url.replace( rhash, \"\" );\n\n      // More options handling for requests with no content\n      if ( !s.hasContent ) {\n\n        // Remember the hash so we can put it back\n        uncached = s.url.slice( cacheURL.length );\n\n        // If data is available and should be processed, append data to url\n        if ( s.data && ( s.processData || typeof s.data === \"string\" ) ) {\n          cacheURL += ( rquery.test( cacheURL ) ? \"&\" : \"?\" ) + s.data;\n\n          // #9682: remove data so that it's not used in an eventual retry\n          delete s.data;\n        }\n\n        // Add or update anti-cache param if needed\n        if ( s.cache === false ) {\n          cacheURL = cacheURL.replace( rantiCache, \"$1\" );\n          uncached = ( rquery.test( cacheURL ) ? \"&\" : \"?\" ) + \"_=\" + ( nonce.guid++ ) +\n            uncached;\n        }\n\n        // Put hash and anti-cache on the URL that will be requested (gh-1732)\n        s.url = cacheURL + uncached;\n\n        // Change '%20' to '+' if this is encoded form body content (gh-2658)\n      } else if ( s.data && s.processData &&\n        ( s.contentType || \"\" ).indexOf( \"application/x-www-form-urlencoded\" ) === 0 ) {\n        s.data = s.data.replace( r20, \"+\" );\n      }\n\n      // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.\n      if ( s.ifModified ) {\n        if ( jQuery.lastModified[ cacheURL ] ) {\n          jqXHR.setRequestHeader( \"If-Modified-Since\", jQuery.lastModified[ cacheURL ] );\n        }\n        if ( jQuery.etag[ cacheURL ] ) {\n          jqXHR.setRequestHeader( \"If-None-Match\", jQuery.etag[ cacheURL ] );\n        }\n      }\n\n      // Set the correct header, if data is being sent\n      if ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {\n        jqXHR.setRequestHeader( \"Content-Type\", s.contentType );\n      }\n\n      // Set the Accepts header for the server, depending on the dataType\n      jqXHR.setRequestHeader(\n        \"Accept\",\n        s.dataTypes[ 0 ] && s.accepts[ s.dataTypes[ 0 ] ] ?\n          s.accepts[ s.dataTypes[ 0 ] ] +\n          ( s.dataTypes[ 0 ] !== \"*\" ? \", \" + allTypes + \"; q=0.01\" : \"\" ) :\n          s.accepts[ \"*\" ]\n      );\n\n      // Check for headers option\n      for ( i in s.headers ) {\n        jqXHR.setRequestHeader( i, s.headers[ i ] );\n      }\n\n      // Allow custom headers/mimetypes and early abort\n      if ( s.beforeSend &&\n        ( s.beforeSend.call( callbackContext, jqXHR, s ) === false || completed ) ) {\n\n        // Abort if not done already and return\n        return jqXHR.abort();\n      }\n\n      // Aborting is no longer a cancellation\n      strAbort = \"abort\";\n\n      // Install callbacks on deferreds\n      completeDeferred.add( s.complete );\n      jqXHR.done( s.success );\n      jqXHR.fail( s.error );\n\n      // Get transport\n      transport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );\n\n      // If no transport, we auto-abort\n      if ( !transport ) {\n        done( -1, \"No Transport\" );\n      } else {\n        jqXHR.readyState = 1;\n\n        // Send global event\n        if ( fireGlobals ) {\n          globalEventContext.trigger( \"ajaxSend\", [ jqXHR, s ] );\n        }\n\n        // If request was aborted inside ajaxSend, stop there\n        if ( completed ) {\n          return jqXHR;\n        }\n\n        // Timeout\n        if ( s.async && s.timeout > 0 ) {\n          timeoutTimer = window.setTimeout( function() {\n            jqXHR.abort( \"timeout\" );\n          }, s.timeout );\n        }\n\n        try {\n          completed = false;\n          transport.send( requestHeaders, done );\n        } catch ( e ) {\n\n          // Rethrow post-completion exceptions\n          if ( completed ) {\n            throw e;\n          }\n\n          // Propagate others as results\n          done( -1, e );\n        }\n      }\n\n      // Callback for when everything is done\n      function done( status, nativeStatusText, responses, headers ) {\n        var isSuccess, success, error, response, modified,\n          statusText = nativeStatusText;\n\n        // Ignore repeat invocations\n        if ( completed ) {\n          return;\n        }\n\n        completed = true;\n\n        // Clear timeout if it exists\n        if ( timeoutTimer ) {\n          window.clearTimeout( timeoutTimer );\n        }\n\n        // Dereference transport for early garbage collection\n        // (no matter how long the jqXHR object will be used)\n        transport = undefined;\n\n        // Cache response headers\n        responseHeadersString = headers || \"\";\n\n        // Set readyState\n        jqXHR.readyState = status > 0 ? 4 : 0;\n\n        // Determine if successful\n        isSuccess = status >= 200 && status < 300 || status === 304;\n\n        // Get response data\n        if ( responses ) {\n          response = ajaxHandleResponses( s, jqXHR, responses );\n        }\n\n        // Use a noop converter for missing script\n        if ( !isSuccess && jQuery.inArray( \"script\", s.dataTypes ) > -1 ) {\n          s.converters[ \"text script\" ] = function() {};\n        }\n\n        // Convert no matter what (that way responseXXX fields are always set)\n        response = ajaxConvert( s, response, jqXHR, isSuccess );\n\n        // If successful, handle type chaining\n        if ( isSuccess ) {\n\n          // Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.\n          if ( s.ifModified ) {\n            modified = jqXHR.getResponseHeader( \"Last-Modified\" );\n            if ( modified ) {\n              jQuery.lastModified[ cacheURL ] = modified;\n            }\n            modified = jqXHR.getResponseHeader( \"etag\" );\n            if ( modified ) {\n              jQuery.etag[ cacheURL ] = modified;\n            }\n          }\n\n          // if no content\n          if ( status === 204 || s.type === \"HEAD\" ) {\n            statusText = \"nocontent\";\n\n            // if not modified\n          } else if ( status === 304 ) {\n            statusText = \"notmodified\";\n\n            // If we have data, let's convert it\n          } else {\n            statusText = response.state;\n            success = response.data;\n            error = response.error;\n            isSuccess = !error;\n          }\n        } else {\n\n          // Extract error from statusText and normalize for non-aborts\n          error = statusText;\n          if ( status || !statusText ) {\n            statusText = \"error\";\n            if ( status < 0 ) {\n              status = 0;\n            }\n          }\n        }\n\n        // Set data for the fake xhr object\n        jqXHR.status = status;\n        jqXHR.statusText = ( nativeStatusText || statusText ) + \"\";\n\n        // Success/Error\n        if ( isSuccess ) {\n          deferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );\n        } else {\n          deferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );\n        }\n\n        // Status-dependent callbacks\n        jqXHR.statusCode( statusCode );\n        statusCode = undefined;\n\n        if ( fireGlobals ) {\n          globalEventContext.trigger( isSuccess ? \"ajaxSuccess\" : \"ajaxError\",\n            [ jqXHR, s, isSuccess ? success : error ] );\n        }\n\n        // Complete\n        completeDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );\n\n        if ( fireGlobals ) {\n          globalEventContext.trigger( \"ajaxComplete\", [ jqXHR, s ] );\n\n          // Handle the global AJAX counter\n          if ( !( --jQuery.active ) ) {\n            jQuery.event.trigger( \"ajaxStop\" );\n          }\n        }\n      }\n\n      return jqXHR;\n    },\n\n    getJSON: function( url, data, callback ) {\n      return jQuery.get( url, data, callback, \"json\" );\n    },\n\n    getScript: function( url, callback ) {\n      return jQuery.get( url, undefined, callback, \"script\" );\n    }\n  } );\n\n  jQuery.each( [ \"get\", \"post\" ], function( _i, method ) {\n    jQuery[ method ] = function( url, data, callback, type ) {\n\n      // Shift arguments if data argument was omitted\n      if ( isFunction( data ) ) {\n        type = type || callback;\n        callback = data;\n        data = undefined;\n      }\n\n      // The url can be an options object (which then must have .url)\n      return jQuery.ajax( jQuery.extend( {\n        url: url,\n        type: method,\n        dataType: type,\n        data: data,\n        success: callback\n      }, jQuery.isPlainObject( url ) && url ) );\n    };\n  } );\n\n  jQuery.ajaxPrefilter( function( s ) {\n    var i;\n    for ( i in s.headers ) {\n      if ( i.toLowerCase() === \"content-type\" ) {\n        s.contentType = s.headers[ i ] || \"\";\n      }\n    }\n  } );\n\n\n  jQuery._evalUrl = function( url, options, doc ) {\n    return jQuery.ajax( {\n      url: url,\n\n      // Make this explicit, since user can override this through ajaxSetup (#11264)\n      type: \"GET\",\n      dataType: \"script\",\n      cache: true,\n      async: false,\n      global: false,\n\n      // Only evaluate the response if it is successful (gh-4126)\n      // dataFilter is not invoked for failure responses, so using it instead\n      // of the default converter is kludgy but it works.\n      converters: {\n        \"text script\": function() {}\n      },\n      dataFilter: function( response ) {\n        jQuery.globalEval( response, options, doc );\n      }\n    } );\n  };\n\n\n  jQuery.fn.extend( {\n    wrapAll: function( html ) {\n      var wrap;\n\n      if ( this[ 0 ] ) {\n        if ( isFunction( html ) ) {\n          html = html.call( this[ 0 ] );\n        }\n\n        // The elements to wrap the target around\n        wrap = jQuery( html, this[ 0 ].ownerDocument ).eq( 0 ).clone( true );\n\n        if ( this[ 0 ].parentNode ) {\n          wrap.insertBefore( this[ 0 ] );\n        }\n\n        wrap.map( function() {\n          var elem = this;\n\n          while ( elem.firstElementChild ) {\n            elem = elem.firstElementChild;\n          }\n\n          return elem;\n        } ).append( this );\n      }\n\n      return this;\n    },\n\n    wrapInner: function( html ) {\n      if ( isFunction( html ) ) {\n        return this.each( function( i ) {\n          jQuery( this ).wrapInner( html.call( this, i ) );\n        } );\n      }\n\n      return this.each( function() {\n        var self = jQuery( this ),\n          contents = self.contents();\n\n        if ( contents.length ) {\n          contents.wrapAll( html );\n\n        } else {\n          self.append( html );\n        }\n      } );\n    },\n\n    wrap: function( html ) {\n      var htmlIsFunction = isFunction( html );\n\n      return this.each( function( i ) {\n        jQuery( this ).wrapAll( htmlIsFunction ? html.call( this, i ) : html );\n      } );\n    },\n\n    unwrap: function( selector ) {\n      this.parent( selector ).not( \"body\" ).each( function() {\n        jQuery( this ).replaceWith( this.childNodes );\n      } );\n      return this;\n    }\n  } );\n\n\n  jQuery.expr.pseudos.hidden = function( elem ) {\n    return !jQuery.expr.pseudos.visible( elem );\n  };\n  jQuery.expr.pseudos.visible = function( elem ) {\n    return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\n  };\n\n\n\n\n  jQuery.ajaxSettings.xhr = function() {\n    try {\n      return new window.XMLHttpRequest();\n    } catch ( e ) {}\n  };\n\n  var xhrSuccessStatus = {\n\n      // File protocol always yields status code 0, assume 200\n      0: 200,\n\n      // Support: IE <=9 only\n      // #1450: sometimes IE returns 1223 when it should be 204\n      1223: 204\n    },\n    xhrSupported = jQuery.ajaxSettings.xhr();\n\n  support.cors = !!xhrSupported && ( \"withCredentials\" in xhrSupported );\n  support.ajax = xhrSupported = !!xhrSupported;\n\n  jQuery.ajaxTransport( function( options ) {\n    var callback, errorCallback;\n\n    // Cross domain only allowed if supported through XMLHttpRequest\n    if ( support.cors || xhrSupported && !options.crossDomain ) {\n      return {\n        send: function( headers, complete ) {\n          var i,\n            xhr = options.xhr();\n\n          xhr.open(\n            options.type,\n            options.url,\n            options.async,\n            options.username,\n            options.password\n          );\n\n          // Apply custom fields if provided\n          if ( options.xhrFields ) {\n            for ( i in options.xhrFields ) {\n              xhr[ i ] = options.xhrFields[ i ];\n            }\n          }\n\n          // Override mime type if needed\n          if ( options.mimeType && xhr.overrideMimeType ) {\n            xhr.overrideMimeType( options.mimeType );\n          }\n\n          // X-Requested-With header\n          // For cross-domain requests, seeing as conditions for a preflight are\n          // akin to a jigsaw puzzle, we simply never set it to be sure.\n          // (it can always be set on a per-request basis or even using ajaxSetup)\n          // For same-domain requests, won't change header if already provided.\n          if ( !options.crossDomain && !headers[ \"X-Requested-With\" ] ) {\n            headers[ \"X-Requested-With\" ] = \"XMLHttpRequest\";\n          }\n\n          // Set headers\n          for ( i in headers ) {\n            xhr.setRequestHeader( i, headers[ i ] );\n          }\n\n          // Callback\n          callback = function( type ) {\n            return function() {\n              if ( callback ) {\n                callback = errorCallback = xhr.onload =\n                  xhr.onerror = xhr.onabort = xhr.ontimeout =\n                    xhr.onreadystatechange = null;\n\n                if ( type === \"abort\" ) {\n                  xhr.abort();\n                } else if ( type === \"error\" ) {\n\n                  // Support: IE <=9 only\n                  // On a manual native abort, IE9 throws\n                  // errors on any property access that is not readyState\n                  if ( typeof xhr.status !== \"number\" ) {\n                    complete( 0, \"error\" );\n                  } else {\n                    complete(\n\n                      // File: protocol always yields status 0; see #8605, #14207\n                      xhr.status,\n                      xhr.statusText\n                    );\n                  }\n                } else {\n                  complete(\n                    xhrSuccessStatus[ xhr.status ] || xhr.status,\n                    xhr.statusText,\n\n                    // Support: IE <=9 only\n                    // IE9 has no XHR2 but throws on binary (trac-11426)\n                    // For XHR2 non-text, let the caller handle it (gh-2498)\n                    ( xhr.responseType || \"text\" ) !== \"text\"  ||\n                    typeof xhr.responseText !== \"string\" ?\n                      { binary: xhr.response } :\n                      { text: xhr.responseText },\n                    xhr.getAllResponseHeaders()\n                  );\n                }\n              }\n            };\n          };\n\n          // Listen to events\n          xhr.onload = callback();\n          errorCallback = xhr.onerror = xhr.ontimeout = callback( \"error\" );\n\n          // Support: IE 9 only\n          // Use onreadystatechange to replace onabort\n          // to handle uncaught aborts\n          if ( xhr.onabort !== undefined ) {\n            xhr.onabort = errorCallback;\n          } else {\n            xhr.onreadystatechange = function() {\n\n              // Check readyState before timeout as it changes\n              if ( xhr.readyState === 4 ) {\n\n                // Allow onerror to be called first,\n                // but that will not handle a native abort\n                // Also, save errorCallback to a variable\n                // as xhr.onerror cannot be accessed\n                window.setTimeout( function() {\n                  if ( callback ) {\n                    errorCallback();\n                  }\n                } );\n              }\n            };\n          }\n\n          // Create the abort callback\n          callback = callback( \"abort\" );\n\n          try {\n\n            // Do send the request (this may raise an exception)\n            xhr.send( options.hasContent && options.data || null );\n          } catch ( e ) {\n\n            // #14683: Only rethrow if this hasn't been notified as an error yet\n            if ( callback ) {\n              throw e;\n            }\n          }\n        },\n\n        abort: function() {\n          if ( callback ) {\n            callback();\n          }\n        }\n      };\n    }\n  } );\n\n\n\n\n// Prevent auto-execution of scripts when no explicit dataType was provided (See gh-2432)\n  jQuery.ajaxPrefilter( function( s ) {\n    if ( s.crossDomain ) {\n      s.contents.script = false;\n    }\n  } );\n\n// Install script dataType\n  jQuery.ajaxSetup( {\n    accepts: {\n      script: \"text/javascript, application/javascript, \" +\n        \"application/ecmascript, application/x-ecmascript\"\n    },\n    contents: {\n      script: /\\b(?:java|ecma)script\\b/\n    },\n    converters: {\n      \"text script\": function( text ) {\n        jQuery.globalEval( text );\n        return text;\n      }\n    }\n  } );\n\n// Handle cache's special case and crossDomain\n  jQuery.ajaxPrefilter( \"script\", function( s ) {\n    if ( s.cache === undefined ) {\n      s.cache = false;\n    }\n    if ( s.crossDomain ) {\n      s.type = \"GET\";\n    }\n  } );\n\n// Bind script tag hack transport\n  jQuery.ajaxTransport( \"script\", function( s ) {\n\n    // This transport only deals with cross domain or forced-by-attrs requests\n    if ( s.crossDomain || s.scriptAttrs ) {\n      var script, callback;\n      return {\n        send: function( _, complete ) {\n          script = jQuery( \"<script>\" )\n            .attr( s.scriptAttrs || {} )\n            .prop( { charset: s.scriptCharset, src: s.url } )\n            .on( \"load error\", callback = function( evt ) {\n              script.remove();\n              callback = null;\n              if ( evt ) {\n                complete( evt.type === \"error\" ? 404 : 200, evt.type );\n              }\n            } );\n\n          // Use native DOM manipulation to avoid our domManip AJAX trickery\n          document.head.appendChild( script[ 0 ] );\n        },\n        abort: function() {\n          if ( callback ) {\n            callback();\n          }\n        }\n      };\n    }\n  } );\n\n\n\n\n  var oldCallbacks = [],\n    rjsonp = /(=)\\?(?=&|$)|\\?\\?/;\n\n// Default jsonp settings\n  jQuery.ajaxSetup( {\n    jsonp: \"callback\",\n    jsonpCallback: function() {\n      var callback = oldCallbacks.pop() || ( jQuery.expando + \"_\" + ( nonce.guid++ ) );\n      this[ callback ] = true;\n      return callback;\n    }\n  } );\n\n// Detect, normalize options and install callbacks for jsonp requests\n  jQuery.ajaxPrefilter( \"json jsonp\", function( s, originalSettings, jqXHR ) {\n\n    var callbackName, overwritten, responseContainer,\n      jsonProp = s.jsonp !== false && ( rjsonp.test( s.url ) ?\n          \"url\" :\n          typeof s.data === \"string\" &&\n          ( s.contentType || \"\" )\n            .indexOf( \"application/x-www-form-urlencoded\" ) === 0 &&\n          rjsonp.test( s.data ) && \"data\"\n      );\n\n    // Handle iff the expected data type is \"jsonp\" or we have a parameter to set\n    if ( jsonProp || s.dataTypes[ 0 ] === \"jsonp\" ) {\n\n      // Get callback name, remembering preexisting value associated with it\n      callbackName = s.jsonpCallback = isFunction( s.jsonpCallback ) ?\n        s.jsonpCallback() :\n        s.jsonpCallback;\n\n      // Insert callback into url or form data\n      if ( jsonProp ) {\n        s[ jsonProp ] = s[ jsonProp ].replace( rjsonp, \"$1\" + callbackName );\n      } else if ( s.jsonp !== false ) {\n        s.url += ( rquery.test( s.url ) ? \"&\" : \"?\" ) + s.jsonp + \"=\" + callbackName;\n      }\n\n      // Use data converter to retrieve json after script execution\n      s.converters[ \"script json\" ] = function() {\n        if ( !responseContainer ) {\n          jQuery.error( callbackName + \" was not called\" );\n        }\n        return responseContainer[ 0 ];\n      };\n\n      // Force json dataType\n      s.dataTypes[ 0 ] = \"json\";\n\n      // Install callback\n      overwritten = window[ callbackName ];\n      window[ callbackName ] = function() {\n        responseContainer = arguments;\n      };\n\n      // Clean-up function (fires after converters)\n      jqXHR.always( function() {\n\n        // If previous value didn't exist - remove it\n        if ( overwritten === undefined ) {\n          jQuery( window ).removeProp( callbackName );\n\n          // Otherwise restore preexisting value\n        } else {\n          window[ callbackName ] = overwritten;\n        }\n\n        // Save back as free\n        if ( s[ callbackName ] ) {\n\n          // Make sure that re-using the options doesn't screw things around\n          s.jsonpCallback = originalSettings.jsonpCallback;\n\n          // Save the callback name for future use\n          oldCallbacks.push( callbackName );\n        }\n\n        // Call if it was a function and we have a response\n        if ( responseContainer && isFunction( overwritten ) ) {\n          overwritten( responseContainer[ 0 ] );\n        }\n\n        responseContainer = overwritten = undefined;\n      } );\n\n      // Delegate to script\n      return \"script\";\n    }\n  } );\n\n\n\n\n// Support: Safari 8 only\n// In Safari 8 documents created via document.implementation.createHTMLDocument\n// collapse sibling forms: the second one becomes a child of the first one.\n// Because of that, this security measure has to be disabled in Safari 8.\n// https://bugs.webkit.org/show_bug.cgi?id=137337\n  support.createHTMLDocument = ( function() {\n    var body = document.implementation.createHTMLDocument( \"\" ).body;\n    body.innerHTML = \"<form></form><form></form>\";\n    return body.childNodes.length === 2;\n  } )();\n\n\n// Argument \"data\" should be string of html\n// context (optional): If specified, the fragment will be created in this context,\n// defaults to document\n// keepScripts (optional): If true, will include scripts passed in the html string\n  jQuery.parseHTML = function( data, context, keepScripts ) {\n    if ( typeof data !== \"string\" ) {\n      return [];\n    }\n    if ( typeof context === \"boolean\" ) {\n      keepScripts = context;\n      context = false;\n    }\n\n    var base, parsed, scripts;\n\n    if ( !context ) {\n\n      // Stop scripts or inline event handlers from being executed immediately\n      // by using document.implementation\n      if ( support.createHTMLDocument ) {\n        context = document.implementation.createHTMLDocument( \"\" );\n\n        // Set the base href for the created document\n        // so any parsed elements with URLs\n        // are based on the document's URL (gh-2965)\n        base = context.createElement( \"base\" );\n        base.href = document.location.href;\n        context.head.appendChild( base );\n      } else {\n        context = document;\n      }\n    }\n\n    parsed = rsingleTag.exec( data );\n    scripts = !keepScripts && [];\n\n    // Single tag\n    if ( parsed ) {\n      return [ context.createElement( parsed[ 1 ] ) ];\n    }\n\n    parsed = buildFragment( [ data ], context, scripts );\n\n    if ( scripts && scripts.length ) {\n      jQuery( scripts ).remove();\n    }\n\n    return jQuery.merge( [], parsed.childNodes );\n  };\n\n\n  /**\n   * Load a url into a page\n   */\n  jQuery.fn.load = function( url, params, callback ) {\n    var selector, type, response,\n      self = this,\n      off = url.indexOf( \" \" );\n\n    if ( off > -1 ) {\n      selector = stripAndCollapse( url.slice( off ) );\n      url = url.slice( 0, off );\n    }\n\n    // If it's a function\n    if ( isFunction( params ) ) {\n\n      // We assume that it's the callback\n      callback = params;\n      params = undefined;\n\n      // Otherwise, build a param string\n    } else if ( params && typeof params === \"object\" ) {\n      type = \"POST\";\n    }\n\n    // If we have elements to modify, make the request\n    if ( self.length > 0 ) {\n      jQuery.ajax( {\n        url: url,\n\n        // If \"type\" variable is undefined, then \"GET\" method will be used.\n        // Make value of this field explicit since\n        // user can override it through ajaxSetup method\n        type: type || \"GET\",\n        dataType: \"html\",\n        data: params\n      } ).done( function( responseText ) {\n\n        // Save response for use in complete callback\n        response = arguments;\n\n        self.html( selector ?\n\n          // If a selector was specified, locate the right elements in a dummy div\n          // Exclude scripts to avoid IE 'Permission Denied' errors\n          jQuery( \"<div>\" ).append( jQuery.parseHTML( responseText ) ).find( selector ) :\n\n          // Otherwise use the full result\n          responseText );\n\n        // If the request succeeds, this function gets \"data\", \"status\", \"jqXHR\"\n        // but they are ignored because response was set above.\n        // If it fails, this function gets \"jqXHR\", \"status\", \"error\"\n      } ).always( callback && function( jqXHR, status ) {\n        self.each( function() {\n          callback.apply( this, response || [ jqXHR.responseText, status, jqXHR ] );\n        } );\n      } );\n    }\n\n    return this;\n  };\n\n\n\n\n  jQuery.expr.pseudos.animated = function( elem ) {\n    return jQuery.grep( jQuery.timers, function( fn ) {\n      return elem === fn.elem;\n    } ).length;\n  };\n\n\n\n\n  jQuery.offset = {\n    setOffset: function( elem, options, i ) {\n      var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition,\n        position = jQuery.css( elem, \"position\" ),\n        curElem = jQuery( elem ),\n        props = {};\n\n      // Set position first, in-case top/left are set even on static elem\n      if ( position === \"static\" ) {\n        elem.style.position = \"relative\";\n      }\n\n      curOffset = curElem.offset();\n      curCSSTop = jQuery.css( elem, \"top\" );\n      curCSSLeft = jQuery.css( elem, \"left\" );\n      calculatePosition = ( position === \"absolute\" || position === \"fixed\" ) &&\n        ( curCSSTop + curCSSLeft ).indexOf( \"auto\" ) > -1;\n\n      // Need to be able to calculate position if either\n      // top or left is auto and position is either absolute or fixed\n      if ( calculatePosition ) {\n        curPosition = curElem.position();\n        curTop = curPosition.top;\n        curLeft = curPosition.left;\n\n      } else {\n        curTop = parseFloat( curCSSTop ) || 0;\n        curLeft = parseFloat( curCSSLeft ) || 0;\n      }\n\n      if ( isFunction( options ) ) {\n\n        // Use jQuery.extend here to allow modification of coordinates argument (gh-1848)\n        options = options.call( elem, i, jQuery.extend( {}, curOffset ) );\n      }\n\n      if ( options.top != null ) {\n        props.top = ( options.top - curOffset.top ) + curTop;\n      }\n      if ( options.left != null ) {\n        props.left = ( options.left - curOffset.left ) + curLeft;\n      }\n\n      if ( \"using\" in options ) {\n        options.using.call( elem, props );\n\n      } else {\n        if ( typeof props.top === \"number\" ) {\n          props.top += \"px\";\n        }\n        if ( typeof props.left === \"number\" ) {\n          props.left += \"px\";\n        }\n        curElem.css( props );\n      }\n    }\n  };\n\n  jQuery.fn.extend( {\n\n    // offset() relates an element's border box to the document origin\n    offset: function( options ) {\n\n      // Preserve chaining for setter\n      if ( arguments.length ) {\n        return options === undefined ?\n          this :\n          this.each( function( i ) {\n            jQuery.offset.setOffset( this, options, i );\n          } );\n      }\n\n      var rect, win,\n        elem = this[ 0 ];\n\n      if ( !elem ) {\n        return;\n      }\n\n      // Return zeros for disconnected and hidden (display: none) elements (gh-2310)\n      // Support: IE <=11 only\n      // Running getBoundingClientRect on a\n      // disconnected node in IE throws an error\n      if ( !elem.getClientRects().length ) {\n        return { top: 0, left: 0 };\n      }\n\n      // Get document-relative position by adding viewport scroll to viewport-relative gBCR\n      rect = elem.getBoundingClientRect();\n      win = elem.ownerDocument.defaultView;\n      return {\n        top: rect.top + win.pageYOffset,\n        left: rect.left + win.pageXOffset\n      };\n    },\n\n    // position() relates an element's margin box to its offset parent's padding box\n    // This corresponds to the behavior of CSS absolute positioning\n    position: function() {\n      if ( !this[ 0 ] ) {\n        return;\n      }\n\n      var offsetParent, offset, doc,\n        elem = this[ 0 ],\n        parentOffset = { top: 0, left: 0 };\n\n      // position:fixed elements are offset from the viewport, which itself always has zero offset\n      if ( jQuery.css( elem, \"position\" ) === \"fixed\" ) {\n\n        // Assume position:fixed implies availability of getBoundingClientRect\n        offset = elem.getBoundingClientRect();\n\n      } else {\n        offset = this.offset();\n\n        // Account for the *real* offset parent, which can be the document or its root element\n        // when a statically positioned element is identified\n        doc = elem.ownerDocument;\n        offsetParent = elem.offsetParent || doc.documentElement;\n        while ( offsetParent &&\n        ( offsetParent === doc.body || offsetParent === doc.documentElement ) &&\n        jQuery.css( offsetParent, \"position\" ) === \"static\" ) {\n\n          offsetParent = offsetParent.parentNode;\n        }\n        if ( offsetParent && offsetParent !== elem && offsetParent.nodeType === 1 ) {\n\n          // Incorporate borders into its offset, since they are outside its content origin\n          parentOffset = jQuery( offsetParent ).offset();\n          parentOffset.top += jQuery.css( offsetParent, \"borderTopWidth\", true );\n          parentOffset.left += jQuery.css( offsetParent, \"borderLeftWidth\", true );\n        }\n      }\n\n      // Subtract parent offsets and element margins\n      return {\n        top: offset.top - parentOffset.top - jQuery.css( elem, \"marginTop\", true ),\n        left: offset.left - parentOffset.left - jQuery.css( elem, \"marginLeft\", true )\n      };\n    },\n\n    // This method will return documentElement in the following cases:\n    // 1) For the element inside the iframe without offsetParent, this method will return\n    //    documentElement of the parent window\n    // 2) For the hidden or detached element\n    // 3) For body or html element, i.e. in case of the html node - it will return itself\n    //\n    // but those exceptions were never presented as a real life use-cases\n    // and might be considered as more preferable results.\n    //\n    // This logic, however, is not guaranteed and can change at any point in the future\n    offsetParent: function() {\n      return this.map( function() {\n        var offsetParent = this.offsetParent;\n\n        while ( offsetParent && jQuery.css( offsetParent, \"position\" ) === \"static\" ) {\n          offsetParent = offsetParent.offsetParent;\n        }\n\n        return offsetParent || documentElement;\n      } );\n    }\n  } );\n\n// Create scrollLeft and scrollTop methods\n  jQuery.each( { scrollLeft: \"pageXOffset\", scrollTop: \"pageYOffset\" }, function( method, prop ) {\n    var top = \"pageYOffset\" === prop;\n\n    jQuery.fn[ method ] = function( val ) {\n      return access( this, function( elem, method, val ) {\n\n        // Coalesce documents and windows\n        var win;\n        if ( isWindow( elem ) ) {\n          win = elem;\n        } else if ( elem.nodeType === 9 ) {\n          win = elem.defaultView;\n        }\n\n        if ( val === undefined ) {\n          return win ? win[ prop ] : elem[ method ];\n        }\n\n        if ( win ) {\n          win.scrollTo(\n            !top ? val : win.pageXOffset,\n            top ? val : win.pageYOffset\n          );\n\n        } else {\n          elem[ method ] = val;\n        }\n      }, method, val, arguments.length );\n    };\n  } );\n\n// Support: Safari <=7 - 9.1, Chrome <=37 - 49\n// Add the top/left cssHooks using jQuery.fn.position\n// Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084\n// Blink bug: https://bugs.chromium.org/p/chromium/issues/detail?id=589347\n// getComputedStyle returns percent when specified for top/left/bottom/right;\n// rather than make the css module depend on the offset module, just check for it here\n  jQuery.each( [ \"top\", \"left\" ], function( _i, prop ) {\n    jQuery.cssHooks[ prop ] = addGetHookIf( support.pixelPosition,\n      function( elem, computed ) {\n        if ( computed ) {\n          computed = curCSS( elem, prop );\n\n          // If curCSS returns percentage, fallback to offset\n          return rnumnonpx.test( computed ) ?\n            jQuery( elem ).position()[ prop ] + \"px\" :\n            computed;\n        }\n      }\n    );\n  } );\n\n\n// Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods\n  jQuery.each( { Height: \"height\", Width: \"width\" }, function( name, type ) {\n    jQuery.each( { padding: \"inner\" + name, content: type, \"\": \"outer\" + name },\n      function( defaultExtra, funcName ) {\n\n        // Margin is only for outerHeight, outerWidth\n        jQuery.fn[ funcName ] = function( margin, value ) {\n          var chainable = arguments.length && ( defaultExtra || typeof margin !== \"boolean\" ),\n            extra = defaultExtra || ( margin === true || value === true ? \"margin\" : \"border\" );\n\n          return access( this, function( elem, type, value ) {\n            var doc;\n\n            if ( isWindow( elem ) ) {\n\n              // $( window ).outerWidth/Height return w/h including scrollbars (gh-1729)\n              return funcName.indexOf( \"outer\" ) === 0 ?\n                elem[ \"inner\" + name ] :\n                elem.document.documentElement[ \"client\" + name ];\n            }\n\n            // Get document width or height\n            if ( elem.nodeType === 9 ) {\n              doc = elem.documentElement;\n\n              // Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height],\n              // whichever is greatest\n              return Math.max(\n                elem.body[ \"scroll\" + name ], doc[ \"scroll\" + name ],\n                elem.body[ \"offset\" + name ], doc[ \"offset\" + name ],\n                doc[ \"client\" + name ]\n              );\n            }\n\n            return value === undefined ?\n\n              // Get width or height on the element, requesting but not forcing parseFloat\n              jQuery.css( elem, type, extra ) :\n\n              // Set width or height on the element\n              jQuery.style( elem, type, value, extra );\n          }, type, chainable ? margin : undefined, chainable );\n        };\n      } );\n  } );\n\n\n  jQuery.each( [\n    \"ajaxStart\",\n    \"ajaxStop\",\n    \"ajaxComplete\",\n    \"ajaxError\",\n    \"ajaxSuccess\",\n    \"ajaxSend\"\n  ], function( _i, type ) {\n    jQuery.fn[ type ] = function( fn ) {\n      return this.on( type, fn );\n    };\n  } );\n\n\n\n\n  jQuery.fn.extend( {\n\n    bind: function( types, data, fn ) {\n      return this.on( types, null, data, fn );\n    },\n    unbind: function( types, fn ) {\n      return this.off( types, null, fn );\n    },\n\n    delegate: function( selector, types, data, fn ) {\n      return this.on( types, selector, data, fn );\n    },\n    undelegate: function( selector, types, fn ) {\n\n      // ( namespace ) or ( selector, types [, fn] )\n      return arguments.length === 1 ?\n        this.off( selector, \"**\" ) :\n        this.off( types, selector || \"**\", fn );\n    },\n\n    hover: function( fnOver, fnOut ) {\n      return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );\n    }\n  } );\n\n  jQuery.each( ( \"blur focus focusin focusout resize scroll click dblclick \" +\n      \"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave \" +\n      \"change select submit keydown keypress keyup contextmenu\" ).split( \" \" ),\n    function( _i, name ) {\n\n      // Handle event binding\n      jQuery.fn[ name ] = function( data, fn ) {\n        return arguments.length > 0 ?\n          this.on( name, null, data, fn ) :\n          this.trigger( name );\n      };\n    } );\n\n\n\n\n// Support: Android <=4.0 only\n// Make sure we trim BOM and NBSP\n  var rtrim = /^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;\n\n// Bind a function to a context, optionally partially applying any\n// arguments.\n// jQuery.proxy is deprecated to promote standards (specifically Function#bind)\n// However, it is not slated for removal any time soon\n  jQuery.proxy = function( fn, context ) {\n    var tmp, args, proxy;\n\n    if ( typeof context === \"string\" ) {\n      tmp = fn[ context ];\n      context = fn;\n      fn = tmp;\n    }\n\n    // Quick check to determine if target is callable, in the spec\n    // this throws a TypeError, but we will just return undefined.\n    if ( !isFunction( fn ) ) {\n      return undefined;\n    }\n\n    // Simulated bind\n    args = slice.call( arguments, 2 );\n    proxy = function() {\n      return fn.apply( context || this, args.concat( slice.call( arguments ) ) );\n    };\n\n    // Set the guid of unique handler to the same of original handler, so it can be removed\n    proxy.guid = fn.guid = fn.guid || jQuery.guid++;\n\n    return proxy;\n  };\n\n  jQuery.holdReady = function( hold ) {\n    if ( hold ) {\n      jQuery.readyWait++;\n    } else {\n      jQuery.ready( true );\n    }\n  };\n  jQuery.isArray = Array.isArray;\n  jQuery.parseJSON = JSON.parse;\n  jQuery.nodeName = nodeName;\n  jQuery.isFunction = isFunction;\n  jQuery.isWindow = isWindow;\n  jQuery.camelCase = camelCase;\n  jQuery.type = toType;\n\n  jQuery.now = Date.now;\n\n  jQuery.isNumeric = function( obj ) {\n\n    // As of jQuery 3.0, isNumeric is limited to\n    // strings and numbers (primitives or objects)\n    // that can be coerced to finite numbers (gh-2662)\n    var type = jQuery.type( obj );\n    return ( type === \"number\" || type === \"string\" ) &&\n\n      // parseFloat NaNs numeric-cast false positives (\"\")\n      // ...but misinterprets leading-number strings, particularly hex literals (\"0x...\")\n      // subtraction forces infinities to NaN\n      !isNaN( obj - parseFloat( obj ) );\n  };\n\n  jQuery.trim = function( text ) {\n    return text == null ?\n      \"\" :\n      ( text + \"\" ).replace( rtrim, \"\" );\n  };\n\n\n\n// Register as a named AMD module, since jQuery can be concatenated with other\n// files that may use define, but not via a proper concatenation script that\n// understands anonymous AMD modules. A named AMD is safest and most robust\n// way to register. Lowercase jquery is used because AMD module names are\n// derived from file names, and jQuery is normally delivered in a lowercase\n// file name. Do this after creating the global so that if an AMD module wants\n// to call noConflict to hide this version of jQuery, it will work.\n\n// Note that for maximum portability, libraries that are not jQuery should\n// declare themselves as anonymous modules, and avoid setting a global if an\n// AMD loader is present. jQuery is a special case. For more information, see\n// https://github.com/jrburke/requirejs/wiki/Updating-existing-libraries#wiki-anon\n\n  if ( typeof define === \"function\" && define.amd ) {\n    define( \"jquery\", [], function() {\n      return jQuery;\n    } );\n  }\n\n\n\n\n  var\n\n    // Map over jQuery in case of overwrite\n    _jQuery = window.jQuery,\n\n    // Map over the $ in case of overwrite\n    _$ = window.$;\n\n  jQuery.noConflict = function( deep ) {\n    if ( window.$ === jQuery ) {\n      window.$ = _$;\n    }\n\n    if ( deep && window.jQuery === jQuery ) {\n      window.jQuery = _jQuery;\n    }\n\n    return jQuery;\n  };\n\n// Expose jQuery and $ identifiers, even in AMD\n// (#7102#comment:10, https://github.com/jquery/jquery/pull/557)\n// and CommonJS for browser emulators (#13566)\n  if ( typeof noGlobal === \"undefined\" ) {\n    window.jQuery = window.$ = jQuery;\n  }\n\n\n\n\n  return jQuery;\n} );\n"],"mappings":"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"}]}